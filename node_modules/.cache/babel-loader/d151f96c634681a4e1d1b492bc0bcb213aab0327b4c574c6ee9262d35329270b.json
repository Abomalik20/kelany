{"ast":null,"code":"import React,{useEffect,useState}from'react';import{supabase}from'../supabaseClient';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ExtendModal(_ref){let{row,onClose,onDone}=_ref;const[checkOut,setCheckOut]=useState((row===null||row===void 0?void 0:row.check_out_date)||'');const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[suggestions,setSuggestions]=useState([]);useEffect(()=>{setCheckOut((row===null||row===void 0?void 0:row.check_out_date)||'');},[row]);const submit=async()=>{setLoading(true);setError('');try{const{error}=await supabase.rpc('extend_reservation',{p_reservation_id:row.id,p_new_check_out:checkOut});if(error)throw error;onDone&&onDone();onClose&&onClose();}catch(e){const msg=String((e===null||e===void 0?void 0:e.message)||e||'');setError(msg);try{const{data,error:sErr}=await supabase.rpc('suggest_split_stay',{p_check_in:row.check_in_date,p_check_out:checkOut,p_room_type_id:null});if(!sErr)setSuggestions(data||[]);}catch(_){}}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4\",dir:\"rtl\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 border-b\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-bold\",children:\"\\u062A\\u0645\\u062F\\u064A\\u062F \\u0627\\u0644\\u062D\\u062C\\u0632\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"\\u0627\\u062E\\u062A\\u0631 \\u062A\\u0627\\u0631\\u064A\\u062E \\u0645\\u063A\\u0627\\u062F\\u0631\\u0629 \\u062C\\u062F\\u064A\\u062F \\u0648\\u0633\\u064A\\u062A\\u0645 \\u0627\\u0644\\u062A\\u062D\\u0642\\u0642 \\u0645\\u0646 \\u0627\\u0644\\u062A\\u0639\\u0627\\u0631\\u0636\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0646\\u0632\\u064A\\u0644:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.guest_name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u063A\\u0631\\u0641\\u0629:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.room_label}),\" \\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.room_type_name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0641\\u062A\\u0631\\u0629:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.check_in_date}),\" \\u2192 \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.check_out_date}),\" (\",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.nights}),\" \\u0644\\u064A\\u0627\\u0644)\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0633\\u0639\\u0631/\\u0644\\u064A\\u0644\\u0629:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.nightly_rate}),\" \\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.total_amount}),\" \\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0645\\u062A\\u0628\\u0642\\u064A:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.remaining_amount})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 flex flex-col gap-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:\"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u062E\\u0631\\u0648\\u062C \\u0627\\u0644\\u062C\\u062F\\u064A\\u062F\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"border rounded px-3 py-2\",value:checkOut,onChange:e=>setCheckOut(e.target.value)}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-red-600\",children:[\"\\u062A\\u0639\\u0630\\u0651\\u0631 \\u0627\\u0644\\u062A\\u0645\\u062F\\u064A\\u062F: \",error]}),suggestions&&suggestions.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-amber-50 border border-amber-200 rounded p-3 text-xs\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold mb-2\",children:\"\\u0628\\u062F\\u0627\\u0626\\u0644 \\u0645\\u0642\\u062A\\u0631\\u062D\\u0629 (Split Stay):\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"list-disc pr-5\",children:suggestions.slice(0,5).map((s,i)=>/*#__PURE__*/_jsxs(\"li\",{children:[s.room_label,\": \",s.available_from,\" \\u2192 \",s.available_to,\" (\",s.nights,\" \\u0644\\u064A\\u0627\\u0644)\"]},i))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 border-t bg-gray-50 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-2 border rounded\",onClick:onClose,children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-2 rounded bg-blue-600 text-white\",disabled:loading,onClick:submit,children:loading?'جارٍ...':'تمديد'})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","supabase","jsx","_jsx","jsxs","_jsxs","ExtendModal","_ref","row","onClose","onDone","checkOut","setCheckOut","check_out_date","loading","setLoading","error","setError","suggestions","setSuggestions","submit","rpc","p_reservation_id","id","p_new_check_out","e","msg","String","message","data","sErr","p_check_in","check_in_date","p_check_out","p_room_type_id","_","className","dir","children","guest_name","room_label","room_type_name","nights","nightly_rate","total_amount","remaining_amount","type","value","onChange","target","length","slice","map","s","i","available_from","available_to","onClick","disabled"],"sources":["F:/kelany/src/components/ExtendModal.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\n\r\nexport default function ExtendModal({ row, onClose, onDone }) {\r\n  const [checkOut, setCheckOut] = useState(row?.check_out_date || '');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [suggestions, setSuggestions] = useState([]);\r\n\r\n  useEffect(() => { setCheckOut(row?.check_out_date || ''); }, [row]);\r\n\r\n  const submit = async () => {\r\n    setLoading(true); setError('');\r\n    try {\r\n      const { error } = await supabase.rpc('extend_reservation', { p_reservation_id: row.id, p_new_check_out: checkOut });\r\n      if (error) throw error;\r\n      onDone && onDone();\r\n      onClose && onClose();\r\n    } catch (e) {\r\n      const msg = String(e?.message || e || '');\r\n      setError(msg);\r\n      try {\r\n        const { data, error: sErr } = await supabase.rpc('suggest_split_stay', { p_check_in: row.check_in_date, p_check_out: checkOut, p_room_type_id: null });\r\n        if (!sErr) setSuggestions(data||[]);\r\n      } catch (_) {}\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4\" dir=\"rtl\">\r\n      <div className=\"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b\">\r\n          <div className=\"font-bold\">تمديد الحجز</div>\r\n          <div className=\"text-xs text-gray-500\">اختر تاريخ مغادرة جديد وسيتم التحقق من التعارض</div>\r\n          <div className=\"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2\">\r\n            <div><span className=\"text-gray-500\">النزيل:</span> <span className=\"font-medium\">{row.guest_name}</span></div>\r\n            <div><span className=\"text-gray-500\">الغرفة:</span> <span className=\"font-medium\">{row.room_label}</span> • <span className=\"font-medium\">{row.room_type_name}</span></div>\r\n            <div><span className=\"text-gray-500\">الفترة:</span> <span className=\"font-medium\">{row.check_in_date}</span> → <span className=\"font-medium\">{row.check_out_date}</span> (<span className=\"font-medium\">{row.nights}</span> ليال)</div>\r\n            <div><span className=\"text-gray-500\">السعر/ليلة:</span> <span className=\"font-medium\">{row.nightly_rate}</span> • <span className=\"text-gray-500\">الإجمالي:</span> <span className=\"font-medium\">{row.total_amount}</span> • <span className=\"text-gray-500\">المتبقي:</span> <span className=\"font-medium\">{row.remaining_amount}</span></div>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-4 flex flex-col gap-3\">\r\n          <label className=\"text-sm\">تاريخ الخروج الجديد</label>\r\n          <input type=\"date\" className=\"border rounded px-3 py-2\" value={checkOut} onChange={e=>setCheckOut(e.target.value)} />\r\n          {error && <div className=\"text-xs text-red-600\">تعذّر التمديد: {error}</div>}\r\n          {suggestions && suggestions.length>0 && (\r\n            <div className=\"bg-amber-50 border border-amber-200 rounded p-3 text-xs\">\r\n              <div className=\"font-semibold mb-2\">بدائل مقترحة (Split Stay):</div>\r\n              <ul className=\"list-disc pr-5\">\r\n                {suggestions.slice(0,5).map((s,i)=> (\r\n                  <li key={i}>{s.room_label}: {s.available_from} → {s.available_to} ({s.nights} ليال)</li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"px-4 py-3 border-t bg-gray-50 flex items-center justify-between\">\r\n          <button className=\"px-3 py-2 border rounded\" onClick={onClose}>إلغاء</button>\r\n          <button className=\"px-3 py-2 rounded bg-blue-600 text-white\" disabled={loading} onClick={submit}>{loading?'جارٍ...':'تمديد'}</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}