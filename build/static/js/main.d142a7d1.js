/*! For license information please see main.d142a7d1.js.LICENSE.txt */
(()=>{"use strict";var e={43(e,t,n){e.exports=n(202)},153(e,t,n){var r=n(43),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,d=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:s,type:e,key:c,ref:d,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},202(e,t){var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,x={};function g(e,t,n){this.props=e,this.context=t,this.refs=x,this.updater=n||p}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=x,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=g.prototype;var y=b.prototype=new v;y.constructor=b,f(y,g.prototype),y.isPureReactComponent=!0;var w=Array.isArray,_=Object.prototype.hasOwnProperty,j={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var s,a={},i=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(i=""+t.key),t)_.call(t,s)&&!N.hasOwnProperty(s)&&(a[s]=t[s]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===a[s]&&(a[s]=l[s]);return{$$typeof:n,type:e,key:i,ref:o,props:a,_owner:j.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,s,a,i){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return i=i(l=e),e=""===a?"."+E(l,0):a,w(i)?(s="",null!=e&&(s=e.replace(C,"$&/")+"/"),T(i,t,s,"",function(e){return e})):null!=i&&(S(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,s+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(C,"$&/")+"/")+e)),t.push(i)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var d=a+E(o=e[c],c);l+=T(o,t,s,d,i)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=m&&e[m]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=T(o=o.value,t,s,d=a+E(o,c++),i);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function O(e,t,n){if(null==e)return e;var r=[],s=0;return T(e,r,"","",function(e){return t.call(n,e,s++)}),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},I={transition:null},A={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:I,ReactCurrentOwner:j};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:O,forEach:function(e,t,n){O(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return O(e,function(){t++}),t},toArray:function(e){return O(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=s,t.Profiler=i,t.PureComponent=b,t.StrictMode=a,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=A,t.act=D,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=f({},e.props),a=e.key,i=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,o=j.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!N.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:n,type:e.type,key:a,ref:i,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=I.transition;I.transition={};try{e()}finally{I.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},234(e,t){function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<a(s,t)))break e;e[r]=t,e[n]=s,n=r}}function r(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,i=s>>>1;r<i;){var o=2*(r+1)-1,l=e[o],c=o+1,d=e[c];if(0>a(l,n))c<s&&0>a(d,l)?(e[r]=d,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<s&&0>a(d,n)))break e;e[r]=d,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,m=3,p=!1,f=!1,x=!1,g="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=r(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,n(c,t)}t=r(d)}}function w(e){if(x=!1,y(e),!f)if(null!==r(c))f=!0,I(_);else{var t=r(d);null!==t&&A(w,t.startTime-e)}}function _(e,n){f=!1,x&&(x=!1,v(S),S=-1),p=!0;var a=m;try{for(y(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!T());){var i=h.callback;if("function"===typeof i){h.callback=null,m=h.priorityLevel;var o=i(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&s(c),y(n)}else s(c);h=r(c)}if(null!==h)var l=!0;else{var u=r(d);null!==u&&A(w,u.startTime-n),l=!1}return l}finally{h=null,m=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,N=!1,k=null,S=-1,C=5,E=-1;function T(){return!(t.unstable_now()-E<C)}function O(){if(null!==k){var e=t.unstable_now();E=e;var n=!0;try{n=k(!0,e)}finally{n?j():(N=!1,k=null)}}else N=!1}if("function"===typeof b)j=function(){b(O)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,P=R.port2;R.port1.onmessage=O,j=function(){P.postMessage(null)}}else j=function(){g(O,0)};function I(e){k=e,N||(N=!0,j())}function A(e,n){S=g(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,I(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var n=m;m=t;try{return e()}finally{m=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=m;m=e;try{return t()}finally{m=n}},t.unstable_scheduleCallback=function(e,s,a){var i=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>i?(e.sortIndex=a,n(d,e),null===r(c)&&e===r(d)&&(x?(v(S),S=-1):x=!0,A(w,a-i))):(e.sortIndex=o,n(c,e),f||p||(f=!0,I(_))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=m;return function(){var n=m;m=t;try{return e.apply(this,arguments)}finally{m=n}}}},391(e,t,n){var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},579(e,t,n){e.exports=n(153)},730(e,t,n){var r=n(43),s=n(853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)i.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,m={},p={};function f(e,t,n,r,s,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){x[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];x[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){x[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){x[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){x[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){x[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){x[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){x[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){x[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,r){var s=x.hasOwnProperty(t)?x[t]:null;(null!==s?0!==s.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,r)&&(n=null),r||null===s?function(e){return!!u.call(p,e)||!u.call(m,e)&&(h.test(e)?p[e]=!0:(m[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,r=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(g,v);x[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(g,v);x[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(g,v);x[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){x[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),x.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){x[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),_=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var I=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var A=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=A&&e[A]||e["@@iterator"])?e:null}var L,M=Object.assign;function q(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var U=!1;function z(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var s=c.stack.split("\n"),a=r.stack.split("\n"),i=s.length-1,o=a.length-1;1<=i&&0<=o&&s[i]!==a[o];)o--;for(;1<=i&&0<=o;i--,o--)if(s[i]!==a[o]){if(1!==i||1!==o)do{if(i--,0>--o||s[i]!==a[o]){var l="\n"+s[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=i&&0<=o);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?q(e):""}function B(e){switch(e.tag){case 5:return q(e.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function F(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case j:return"Fragment";case _:return"Portal";case k:return"Profiler";case N:return"StrictMode";case T:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:F(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return F(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return F(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(r&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function xe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),s=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,s):e[n]=s}}Object.keys(me).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]})});var ge=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,je=null,Ne=null;function ke(e){if(e=bs(e)){if("function"!==typeof _e)throw Error(a(280));var t=e.stateNode;t&&(t=ws(t),_e(e.stateNode,e.type,t))}}function Se(e){je?Ne?Ne.push(e):Ne=[e]:je=e}function Ce(){if(je){var e=je,t=Ne;if(Ne=je=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Ee(e,t){return e(t)}function Te(){}var Oe=!1;function Re(e,t,n){if(Oe)return e(t,n);Oe=!0;try{return Ee(e,t,n)}finally{Oe=!1,(null!==je||null!==Ne)&&(Te(),Ce())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=ws(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Ie=!1;if(d)try{var Ae={};Object.defineProperty(Ae,"passive",{get:function(){Ie=!0}}),window.addEventListener("test",Ae,Ae),window.removeEventListener("test",Ae,Ae)}catch(de){Ie=!1}function De(e,t,n,r,s,a,i,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var Le=!1,Me=null,qe=!1,Ue=null,ze={onError:function(e){Le=!0,Me=e}};function Be(e,t,n,r,s,a,i,o,l){Le=!1,Me=null,De.apply(ze,arguments)}function Fe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(Fe(e)!==e)throw Error(a(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Fe(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(null===s)break;var i=s.alternate;if(null===i){if(null!==(r=s.return)){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Ve(s),e;if(i===r)return Ve(s),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var Ge=s.unstable_scheduleCallback,Je=s.unstable_cancelCallback,$e=s.unstable_shouldYield,Qe=s.unstable_requestPaint,Ye=s.unstable_now,Xe=s.unstable_getCurrentPriorityLevel,Ze=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,rt=s.unstable_IdlePriority,st=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,s=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var o=i&~s;0!==o?r=ut(o):0!==(a&=i)&&(r=ut(a))}else 0!==(i=n&~s)?r=ut(i):0!==a&&(r=ut(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&s)&&((s=r&-r)>=(a=t&-t)||16===s&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)s=1<<(n=31-it(t)),r|=e[n],t&=~s;return r}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function xt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),s=1<<r;s&t|e[r]&t&&(e[r]|=t),n&=~s}}var bt=0;function yt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,_t,jt,Nt,kt,St=!1,Ct=[],Et=null,Tt=null,Ot=null,Rt=new Map,Pt=new Map,It=[],At="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Ot=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Lt(e,t,n,r,s,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&_t(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Mt(e){var t=vs(e.target);if(null!==t){var n=Fe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void kt(e.priority,function(){jt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function qt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bs(n))&&_t(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ye=r,n.target.dispatchEvent(r),ye=null,t.shift()}return!0}function Ut(e,t,n){qt(e)&&n.delete(t)}function zt(){St=!1,null!==Et&&qt(Et)&&(Et=null),null!==Tt&&qt(Tt)&&(Tt=null),null!==Ot&&qt(Ot)&&(Ot=null),Rt.forEach(Ut),Pt.forEach(Ut)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,zt)))}function Ft(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&Bt(Et,e),null!==Tt&&Bt(Tt,e),null!==Ot&&Bt(Ot,e),Rt.forEach(t),Pt.forEach(t),n=0;n<It.length;n++)(r=It[n]).blockedOn===e&&(r.blockedOn=null);for(;0<It.length&&null===(n=It[0]).blockedOn;)Mt(n),null===n.blockedOn&&It.shift()}var Wt=y.ReactCurrentBatchConfig,Vt=!0;function Ht(e,t,n,r){var s=bt,a=Wt.transition;Wt.transition=null;try{bt=1,Gt(e,t,n,r)}finally{bt=s,Wt.transition=a}}function Kt(e,t,n,r){var s=bt,a=Wt.transition;Wt.transition=null;try{bt=4,Gt(e,t,n,r)}finally{bt=s,Wt.transition=a}}function Gt(e,t,n,r){if(Vt){var s=$t(e,t,n,r);if(null===s)Vr(e,t,r,Jt,n),Dt(e,r);else if(function(e,t,n,r,s){switch(t){case"focusin":return Et=Lt(Et,e,t,n,r,s),!0;case"dragenter":return Tt=Lt(Tt,e,t,n,r,s),!0;case"mouseover":return Ot=Lt(Ot,e,t,n,r,s),!0;case"pointerover":var a=s.pointerId;return Rt.set(a,Lt(Rt.get(a)||null,e,t,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,Pt.set(a,Lt(Pt.get(a)||null,e,t,n,r,s)),!0}return!1}(s,e,t,n,r))r.stopPropagation();else if(Dt(e,r),4&t&&-1<At.indexOf(e)){for(;null!==s;){var a=bs(s);if(null!==a&&wt(a),null===(a=$t(e,t,n,r))&&Vr(e,t,r,Jt,n),a===s)break;s=a}null!==s&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Jt=null;function $t(e,t,n,r){if(Jt=null,null!==(e=vs(e=we(r))))if(null===(t=Fe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Jt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,s="value"in Yt?Yt.value:Yt.textContent,a=s.length;for(e=0;e<r&&n[e]===s[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===s[a-t];t++);return Zt=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,s,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(s):s[i]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(cn),un=M({},cn,{view:0,detail:0}),hn=sn(un),mn=M({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=sn(mn),fn=sn(M({},mn,{dataTransfer:0})),xn=sn(M({},un,{relatedTarget:0})),gn=sn(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(vn),yn=sn(M({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=jn[e])&&!!t[e]}function kn(){return Nn}var Sn=M({},un,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=sn(Sn),En=sn(M({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=sn(M({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),On=sn(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=M({},mn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(Rn),In=[9,13,27,32],An=d&&"CompositionEvent"in window,Dn=null;d&&"documentMode"in document&&(Dn=document.documentMode);var Ln=d&&"TextEvent"in window&&!Dn,Mn=d&&(!An||Dn&&8<Dn&&11>=Dn),qn=String.fromCharCode(32),Un=!1;function zn(e,t){switch(e){case"keyup":return-1!==In.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Fn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Hn(e,t,n,r){Se(r),0<(t=Kr(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Kn=null,Gn=null;function Jn(e){qr(e,0)}function $n(e){if(G(ys(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(d){var Xn;if(d){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Kn&&(Kn.detachEvent("onpropertychange",nr),Gn=Kn=null)}function nr(e){if("value"===e.propertyName&&$n(Gn)){var t=[];Hn(t,Gn,e,we(e)),Re(Jn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Kn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function sr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $n(Gn)}function ar(e,t){if("click"===e)return $n(t)}function ir(e,t){if("input"===e||"change"===e)return $n(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!u.call(t,s)||!or(e[s],t[s]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function ur(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ur(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function mr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ur(n.ownerDocument.documentElement,n)){if(null!==r&&mr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=void 0===r.end?a:Math.min(r.end,s),!e.extend&&a>r&&(s=r,r=a,a=s),s=dr(n,a);var i=dr(n,r);s&&i&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=d&&"documentMode"in document&&11>=document.documentMode,xr=null,gr=null,vr=null,br=!1;function yr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==xr||xr!==J(r)||("selectionStart"in(r=xr)&&mr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Kr(gr,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=xr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _r={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},jr={},Nr={};function kr(e){if(jr[e])return jr[e];if(!_r[e])return e;var t,n=_r[e];for(t in n)if(n.hasOwnProperty(t)&&t in Nr)return jr[e]=n[t];return e}d&&(Nr=document.createElement("div").style,"AnimationEvent"in window||(delete _r.animationend.animation,delete _r.animationiteration.animation,delete _r.animationstart.animation),"TransitionEvent"in window||delete _r.transitionend.transition);var Sr=kr("animationend"),Cr=kr("animationiteration"),Er=kr("animationstart"),Tr=kr("transitionend"),Or=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Or.set(e,t),l(t,[e])}for(var Ir=0;Ir<Rr.length;Ir++){var Ar=Rr[Ir];Pr(Ar.toLowerCase(),"on"+(Ar[0].toUpperCase()+Ar.slice(1)))}Pr(Sr,"onAnimationEnd"),Pr(Cr,"onAnimationIteration"),Pr(Er,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Tr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,s,i,o,l,c){if(Be.apply(this,arguments),Le){if(!Le)throw Error(a(198));var d=Me;Le=!1,Me=null,qe||(qe=!0,Ue=d)}}(r,t,void 0,e),e.currentTarget=null}function qr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],s=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var o=r[i],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&s.isPropagationStopped())break e;Mr(s,o,c),a=l}else for(i=0;i<r.length;i++){if(l=(o=r[i]).instance,c=o.currentTarget,o=o.listener,l!==a&&s.isPropagationStopped())break e;Mr(s,o,c),a=l}}}if(qe)throw e=Ue,qe=!1,Ue=null,e}function Ur(e,t){var n=t[fs];void 0===n&&(n=t[fs]=new Set);var r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Wr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Fr(e){if(!e[Br]){e[Br]=!0,i.forEach(function(t){"selectionchange"!==t&&(Lr.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,zr("selectionchange",!1,t))}}function Wr(e,t,n,r){switch(Qt(t)){case 1:var s=Ht;break;case 4:s=Kt;break;default:s=Gt}n=s.bind(null,t,n,e),s=void 0,!Ie||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),r?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,s){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var o=r.stateNode.containerInfo;if(o===s||8===o.nodeType&&o.parentNode===s)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&((l=i.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;i=i.return}for(;null!==o;){if(null===(i=vs(o)))return;if(5===(l=i.tag)||6===l){r=a=i;continue e}o=o.parentNode}}r=r.return}Re(function(){var r=a,s=we(n),i=[];e:{var o=Or.get(e);if(void 0!==o){var l=dn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Cn;break;case"focusin":c="focus",l=xn;break;case"focusout":c="blur",l=xn;break;case"beforeblur":case"afterblur":l=xn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case Sr:case Cr:case Er:l=gn;break;case Tr:l=On;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var m,p=r;null!==p;){var f=(m=p).stateNode;if(5===m.tag&&null!==f&&(m=f,null!==h&&(null!=(f=Pe(p,h))&&d.push(Hr(p,f,m)))),u)break;p=p.return}0<d.length&&(o=new l(o,c,null,n,s),i.push({event:o,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===ye||!(c=n.relatedTarget||n.fromElement)||!vs(c)&&!c[ps])&&(l||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?vs(c):null)&&(c!==(u=Fe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(d=pn,f="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=En,f="onPointerLeave",h="onPointerEnter",p="pointer"),u=null==l?o:ys(l),m=null==c?o:ys(c),(o=new d(f,p+"leave",l,n,s)).target=u,o.relatedTarget=m,f=null,vs(s)===r&&((d=new d(h,p+"enter",c,n,s)).target=m,d.relatedTarget=u,f=d),u=f,l&&c)e:{for(h=c,p=0,m=d=l;m;m=Gr(m))p++;for(m=0,f=h;f;f=Gr(f))m++;for(;0<p-m;)d=Gr(d),p--;for(;0<m-p;)h=Gr(h),m--;for(;p--;){if(d===h||null!==h&&d===h.alternate)break e;d=Gr(d),h=Gr(h)}d=null}else d=null;null!==l&&Jr(i,o,l,d,!1),null!==c&&null!==u&&Jr(i,u,c,d,!0)}if("select"===(l=(o=r?ys(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var x=Qn;else if(Vn(o))if(Yn)x=ir;else{x=sr;var g=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(x=ar);switch(x&&(x=x(e,r))?Hn(i,x,n,s):(g&&g(e,o,r),"focusout"===e&&(g=o._wrapperState)&&g.controlled&&"number"===o.type&&ee(o,"number",o.value)),g=r?ys(r):window,e){case"focusin":(Vn(g)||"true"===g.contentEditable)&&(xr=g,gr=r,vr=null);break;case"focusout":vr=gr=xr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,yr(i,n,s);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":yr(i,n,s)}var v;if(An)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Fn?zn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Mn&&"ko"!==n.locale&&(Fn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Fn&&(v=en()):(Xt="value"in(Yt=s)?Yt.value:Yt.textContent,Fn=!0)),0<(g=Kr(r,b)).length&&(b=new yn(b,e,null,n,s),i.push({event:b,listeners:g}),v?b.data=v:null!==(v=Bn(n))&&(b.data=v))),(v=Ln?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Un=!0,qn);case"textInput":return(e=t.data)===qn&&Un?null:e;default:return null}}(e,n):function(e,t){if(Fn)return"compositionend"===e||!An&&zn(e,t)?(e=en(),Zt=Xt=Yt=null,Fn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(s=new yn("onBeforeInput","beforeinput",null,n,s),i.push({event:s,listeners:r}),s.data=v))}qr(i,t)})}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var s=e,a=s.stateNode;5===s.tag&&null!==a&&(s=a,null!=(a=Pe(e,n))&&r.unshift(Hr(e,a,s)),null!=(a=Pe(e,t))&&r.push(Hr(e,a,s))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Jr(e,t,n,r,s){for(var a=t._reactName,i=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,s?null!=(l=Pe(n,a))&&i.unshift(Hr(n,l,o)):s||null!=(l=Pe(n,a))&&i.push(Hr(n,l,o))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var $r=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace($r,"\n").replace(Qr,"")}function Xr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(a(425))}function Zr(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rs="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,as="function"===typeof Promise?Promise:void 0,is="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof as?function(e){return as.resolve(null).then(e).catch(os)}:rs;function os(e){setTimeout(function(){throw e})}function ls(e,t){var n=t,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===r)return e.removeChild(s),void Ft(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=s}while(n);Ft(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ds(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var us=Math.random().toString(36).slice(2),hs="__reactFiber$"+us,ms="__reactProps$"+us,ps="__reactContainer$"+us,fs="__reactEvents$"+us,xs="__reactListeners$"+us,gs="__reactHandles$"+us;function vs(e){var t=e[hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ps]||n[hs]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ds(e);null!==e;){if(n=e[hs])return n;e=ds(e)}return t}n=(e=n).parentNode}return null}function bs(e){return!(e=e[hs]||e[ps])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ys(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function ws(e){return e[ms]||null}var _s=[],js=-1;function Ns(e){return{current:e}}function ks(e){0>js||(e.current=_s[js],_s[js]=null,js--)}function Ss(e,t){js++,_s[js]=e.current,e.current=t}var Cs={},Es=Ns(Cs),Ts=Ns(!1),Os=Cs;function Rs(e,t){var n=e.type.contextTypes;if(!n)return Cs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var s,a={};for(s in n)a[s]=t[s];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ps(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Is(){ks(Ts),ks(Es)}function As(e,t,n){if(Es.current!==Cs)throw Error(a(168));Ss(Es,t),Ss(Ts,n)}function Ds(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var s in r=r.getChildContext())if(!(s in t))throw Error(a(108,W(e)||"Unknown",s));return M({},n,r)}function Ls(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cs,Os=Es.current,Ss(Es,e),Ss(Ts,Ts.current),!0}function Ms(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Ds(e,t,Os),r.__reactInternalMemoizedMergedChildContext=e,ks(Ts),ks(Es),Ss(Es,e)):ks(Ts),Ss(Ts,n)}var qs=null,Us=!1,zs=!1;function Bs(e){null===qs?qs=[e]:qs.push(e)}function Fs(){if(!zs&&null!==qs){zs=!0;var e=0,t=bt;try{var n=qs;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}qs=null,Us=!1}catch(s){throw null!==qs&&(qs=qs.slice(e+1)),Ge(Ze,Fs),s}finally{bt=t,zs=!1}}return null}var Ws=[],Vs=0,Hs=null,Ks=0,Gs=[],Js=0,$s=null,Qs=1,Ys="";function Xs(e,t){Ws[Vs++]=Ks,Ws[Vs++]=Hs,Hs=e,Ks=t}function Zs(e,t,n){Gs[Js++]=Qs,Gs[Js++]=Ys,Gs[Js++]=$s,$s=e;var r=Qs;e=Ys;var s=32-it(r)-1;r&=~(1<<s),n+=1;var a=32-it(t)+s;if(30<a){var i=s-s%5;a=(r&(1<<i)-1).toString(32),r>>=i,s-=i,Qs=1<<32-it(t)+s|n<<s|r,Ys=a+e}else Qs=1<<a|n<<s|r,Ys=e}function ea(e){null!==e.return&&(Xs(e,1),Zs(e,1,0))}function ta(e){for(;e===Hs;)Hs=Ws[--Vs],Ws[Vs]=null,Ks=Ws[--Vs],Ws[Vs]=null;for(;e===$s;)$s=Gs[--Js],Gs[Js]=null,Ys=Gs[--Js],Gs[Js]=null,Qs=Gs[--Js],Gs[Js]=null}var na=null,ra=null,sa=!1,aa=null;function ia(e,t){var n=Oc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==$s?{id:Qs,overflow:Ys}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Oc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(sa){var t=ra;if(t){var n=t;if(!oa(e,t)){if(la(e))throw Error(a(418));t=cs(n.nextSibling);var r=na;t&&oa(e,t)?ia(r,n):(e.flags=-4097&e.flags|2,sa=!1,na=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,sa=!1,na=e}}}function da(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ua(e){if(e!==na)return!1;if(!sa)return da(e),sa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ra)){if(la(e))throw ha(),Error(a(418));for(;t;)ia(e,t),t=cs(t.nextSibling)}if(da(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=cs(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?cs(e.stateNode.nextSibling):null;return!0}function ha(){for(var e=ra;e;)e=cs(e.nextSibling)}function ma(){ra=na=null,sa=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var fa=y.ReactCurrentBatchConfig;function xa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var s=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=s.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ga(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function va(e){return(0,e._init)(e._payload)}function ba(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Lc(n,e.mode,r)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===j?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===P&&va(a)===t.type)?((r=s(t,n.props)).ref=xa(e,t,n),r.return=e,r):((r=Ic(n.type,n.key,n.props,null,e.mode,r)).ref=xa(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Mc(n,e.mode,r)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=Ac(n,e.mode,r,a)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Lc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Ic(t.type,t.key,t.props,null,e.mode,n)).ref=xa(e,null,t),n.return=e,n;case _:return(t=Mc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Ac(t,e.mode,n,null)).return=e,t;ga(e,t)}return null}function m(e,t,n,r){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===s?c(e,t,n,r):null;case _:return n.key===s?d(e,t,n,r):null;case P:return m(e,t,(s=n._init)(n._payload),r)}if(te(n)||D(n))return null!==s?null:u(e,t,n,r,null);ga(e,n)}return null}function p(e,t,n,r,s){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,s);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,s);case _:return d(t,e=e.get(null===r.key?n:r.key)||null,r,s);case P:return p(e,t,n,(0,r._init)(r._payload),s)}if(te(r)||D(r))return u(t,e=e.get(n)||null,r,s,null);ga(t,r)}return null}function f(s,a,o,l){for(var c=null,d=null,u=a,f=a=0,x=null;null!==u&&f<o.length;f++){u.index>f?(x=u,u=null):x=u.sibling;var g=m(s,u,o[f],l);if(null===g){null===u&&(u=x);break}e&&u&&null===g.alternate&&t(s,u),a=i(g,a,f),null===d?c=g:d.sibling=g,d=g,u=x}if(f===o.length)return n(s,u),sa&&Xs(s,f),c;if(null===u){for(;f<o.length;f++)null!==(u=h(s,o[f],l))&&(a=i(u,a,f),null===d?c=u:d.sibling=u,d=u);return sa&&Xs(s,f),c}for(u=r(s,u);f<o.length;f++)null!==(x=p(u,s,f,o[f],l))&&(e&&null!==x.alternate&&u.delete(null===x.key?f:x.key),a=i(x,a,f),null===d?c=x:d.sibling=x,d=x);return e&&u.forEach(function(e){return t(s,e)}),sa&&Xs(s,f),c}function x(s,o,l,c){var d=D(l);if("function"!==typeof d)throw Error(a(150));if(null==(l=d.call(l)))throw Error(a(151));for(var u=d=null,f=o,x=o=0,g=null,v=l.next();null!==f&&!v.done;x++,v=l.next()){f.index>x?(g=f,f=null):g=f.sibling;var b=m(s,f,v.value,c);if(null===b){null===f&&(f=g);break}e&&f&&null===b.alternate&&t(s,f),o=i(b,o,x),null===u?d=b:u.sibling=b,u=b,f=g}if(v.done)return n(s,f),sa&&Xs(s,x),d;if(null===f){for(;!v.done;x++,v=l.next())null!==(v=h(s,v.value,c))&&(o=i(v,o,x),null===u?d=v:u.sibling=v,u=v);return sa&&Xs(s,x),d}for(f=r(s,f);!v.done;x++,v=l.next())null!==(v=p(f,s,x,v.value,c))&&(e&&null!==v.alternate&&f.delete(null===v.key?x:v.key),o=i(v,o,x),null===u?d=v:u.sibling=v,u=v);return e&&f.forEach(function(e){return t(s,e)}),sa&&Xs(s,x),d}return function e(r,a,i,l){if("object"===typeof i&&null!==i&&i.type===j&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,d=a;null!==d;){if(d.key===c){if((c=i.type)===j){if(7===d.tag){n(r,d.sibling),(a=s(d,i.props.children)).return=r,r=a;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&va(c)===d.type){n(r,d.sibling),(a=s(d,i.props)).ref=xa(r,d,i),a.return=r,r=a;break e}n(r,d);break}t(r,d),d=d.sibling}i.type===j?((a=Ac(i.props.children,r.mode,l,i.key)).return=r,r=a):((l=Ic(i.type,i.key,i.props,null,r.mode,l)).ref=xa(r,a,i),l.return=r,r=l)}return o(r);case _:e:{for(d=i.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=s(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Mc(i,r.mode,l)).return=r,r=a}return o(r);case P:return e(r,a,(d=i._init)(i._payload),l)}if(te(i))return f(r,a,i,l);if(D(i))return x(r,a,i,l);ga(r,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=s(a,i)).return=r,r=a):(n(r,a),(a=Lc(i,r.mode,l)).return=r,r=a),o(r)):n(r,a)}}var ya=ba(!0),wa=ba(!1),_a=Ns(null),ja=null,Na=null,ka=null;function Sa(){ka=Na=ja=null}function Ca(e){var t=_a.current;ks(_a),e._currentValue=t}function Ea(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ta(e,t){ja=e,ka=Na=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Oa(e){var t=e._currentValue;if(ka!==e)if(e={context:e,memoizedValue:t,next:null},null===Na){if(null===ja)throw Error(a(308));Na=e,ja.dependencies={lanes:0,firstContext:e}}else Na=Na.next=e;return t}var Ra=null;function Pa(e){null===Ra?Ra=[e]:Ra.push(e)}function Ia(e,t,n,r){var s=t.interleaved;return null===s?(n.next=n,Pa(t)):(n.next=s.next,s.next=n),t.interleaved=n,Aa(e,r)}function Aa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Da=!1;function La(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ma(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function qa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ua(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Cl)){var s=r.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),r.pending=t,Aa(e,n)}return null===(s=r.interleaved)?(t.next=t,Pa(r)):(t.next=s.next,s.next=t),r.interleaved=t,Aa(e,n)}function za(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Ba(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var s=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?s=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?s=a=t:a=a.next=t}else s=a=t;return n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fa(e,t,n,r){var s=e.updateQueue;Da=!1;var a=s.firstBaseUpdate,i=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===i?a=c:i.next=c,i=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==i&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==a){var u=s.baseState;for(i=0,d=c=l=null,o=a;;){var h=o.lane,m=o.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,f=o;switch(h=t,m=n,f.tag){case 1:if("function"===typeof(p=f.payload)){u=p.call(m,u,h);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=f.payload)?p.call(m,u,h):p)||void 0===h)break e;u=M({},u,h);break e;case 2:Da=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[o]:h.push(o))}else m={eventTime:m,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,i|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null!==(t=s.shared.interleaved)){s=t;do{i|=s.lane,s=s.next}while(s!==t)}else null===a&&(s.shared.lanes=0);Dl|=i,e.lanes=i,e.memoizedState=u}}function Wa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(null!==s){if(r.callback=null,r=n,"function"!==typeof s)throw Error(a(191,s));s.call(r)}}}var Va={},Ha=Ns(Va),Ka=Ns(Va),Ga=Ns(Va);function Ja(e){if(e===Va)throw Error(a(174));return e}function $a(e,t){switch(Ss(Ga,t),Ss(Ka,e),Ss(Ha,Va),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ks(Ha),Ss(Ha,t)}function Qa(){ks(Ha),ks(Ka),ks(Ga)}function Ya(e){Ja(Ga.current);var t=Ja(Ha.current),n=le(t,e.type);t!==n&&(Ss(Ka,e),Ss(Ha,n))}function Xa(e){Ka.current===e&&(ks(Ha),ks(Ka))}var Za=Ns(0);function ei(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ti=[];function ni(){for(var e=0;e<ti.length;e++)ti[e]._workInProgressVersionPrimary=null;ti.length=0}var ri=y.ReactCurrentDispatcher,si=y.ReactCurrentBatchConfig,ai=0,ii=null,oi=null,li=null,ci=!1,di=!1,ui=0,hi=0;function mi(){throw Error(a(321))}function pi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function fi(e,t,n,r,s,i){if(ai=i,ii=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ri.current=null===e||null===e.memoizedState?Xi:Zi,e=n(r,s),di){i=0;do{if(di=!1,ui=0,25<=i)throw Error(a(301));i+=1,li=oi=null,t.updateQueue=null,ri.current=eo,e=n(r,s)}while(di)}if(ri.current=Yi,t=null!==oi&&null!==oi.next,ai=0,li=oi=ii=null,ci=!1,t)throw Error(a(300));return e}function xi(){var e=0!==ui;return ui=0,e}function gi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===li?ii.memoizedState=li=e:li=li.next=e,li}function vi(){if(null===oi){var e=ii.alternate;e=null!==e?e.memoizedState:null}else e=oi.next;var t=null===li?ii.memoizedState:li.next;if(null!==t)li=t,oi=e;else{if(null===e)throw Error(a(310));e={memoizedState:(oi=e).memoizedState,baseState:oi.baseState,baseQueue:oi.baseQueue,queue:oi.queue,next:null},null===li?ii.memoizedState=li=e:li=li.next=e}return li}function bi(e,t){return"function"===typeof t?t(e):t}function yi(e){var t=vi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=oi,s=r.baseQueue,i=n.pending;if(null!==i){if(null!==s){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(null!==s){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((ai&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,ii.lanes|=u,Dl|=u}d=d.next}while(null!==d&&d!==i);null===c?o=r:c.next=l,or(r,t.memoizedState)||(bo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){s=e;do{i=s.lane,ii.lanes|=i,Dl|=i,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wi(e){var t=vi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,i=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{i=e(i,o.action),o=o.next}while(o!==s);or(i,t.memoizedState)||(bo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function _i(){}function ji(e,t){var n=ii,r=vi(),s=t(),i=!or(r.memoizedState,s);if(i&&(r.memoizedState=s,bo=!0),r=r.queue,Di(Si.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==li&&1&li.memoizedState.tag){if(n.flags|=2048,Oi(9,ki.bind(null,n,r,s,t),void 0,null),null===El)throw Error(a(349));0!==(30&ai)||Ni(n,t,s)}return s}function Ni(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ki(e,t,n,r){t.value=n,t.getSnapshot=r,Ci(t)&&Ei(e)}function Si(e,t,n){return n(function(){Ci(t)&&Ei(e)})}function Ci(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ei(e){var t=Aa(e,1);null!==t&&tc(t,e,1,-1)}function Ti(e){var t=gi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bi,lastRenderedState:e},t.queue=e,e=e.dispatch=Gi.bind(null,ii,e),[t.memoizedState,e]}function Oi(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ri(){return vi().memoizedState}function Pi(e,t,n,r){var s=gi();ii.flags|=e,s.memoizedState=Oi(1|t,n,void 0,void 0===r?null:r)}function Ii(e,t,n,r){var s=vi();r=void 0===r?null:r;var a=void 0;if(null!==oi){var i=oi.memoizedState;if(a=i.destroy,null!==r&&pi(r,i.deps))return void(s.memoizedState=Oi(t,n,a,r))}ii.flags|=e,s.memoizedState=Oi(1|t,n,a,r)}function Ai(e,t){return Pi(8390656,8,e,t)}function Di(e,t){return Ii(2048,8,e,t)}function Li(e,t){return Ii(4,2,e,t)}function Mi(e,t){return Ii(4,4,e,t)}function qi(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ui(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ii(4,4,qi.bind(null,t,e),n)}function zi(){}function Bi(e,t){var n=vi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&pi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Fi(e,t){var n=vi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&pi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Wi(e,t,n){return 0===(21&ai)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=n):(or(n,t)||(n=ft(),ii.lanes|=n,Dl|=n,e.baseState=!0),t)}function Vi(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=si.transition;si.transition={};try{e(!1),t()}finally{bt=n,si.transition=r}}function Hi(){return vi().memoizedState}function Ki(e,t,n){var r=ec(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ji(e))$i(t,n);else if(null!==(n=Ia(e,t,n,r))){tc(n,e,r,Zl()),Qi(n,t,r)}}function Gi(e,t,n){var r=ec(e),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ji(e))$i(t,s);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,o=a(i,n);if(s.hasEagerState=!0,s.eagerState=o,or(o,i)){var l=t.interleaved;return null===l?(s.next=s,Pa(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(c){}null!==(n=Ia(e,t,s,r))&&(tc(n,e,r,s=Zl()),Qi(n,t,r))}}function Ji(e){var t=e.alternate;return e===ii||null!==t&&t===ii}function $i(e,t){di=ci=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qi(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var Yi={readContext:Oa,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useInsertionEffect:mi,useLayoutEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useMutableSource:mi,useSyncExternalStore:mi,useId:mi,unstable_isNewReconciler:!1},Xi={readContext:Oa,useCallback:function(e,t){return gi().memoizedState=[e,void 0===t?null:t],e},useContext:Oa,useEffect:Ai,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pi(4194308,4,qi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pi(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pi(4,2,e,t)},useMemo:function(e,t){var n=gi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=gi();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ki.bind(null,ii,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},gi().memoizedState=e},useState:Ti,useDebugValue:zi,useDeferredValue:function(e){return gi().memoizedState=e},useTransition:function(){var e=Ti(!1),t=e[0];return e=Vi.bind(null,e[1]),gi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ii,s=gi();if(sa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===El)throw Error(a(349));0!==(30&ai)||Ni(r,t,n)}s.memoizedState=n;var i={value:n,getSnapshot:t};return s.queue=i,Ai(Si.bind(null,r,i,e),[e]),r.flags|=2048,Oi(9,ki.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=gi(),t=El.identifierPrefix;if(sa){var n=Ys;t=":"+t+"R"+(n=(Qs&~(1<<32-it(Qs)-1)).toString(32)+n),0<(n=ui++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=hi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Zi={readContext:Oa,useCallback:Bi,useContext:Oa,useEffect:Di,useImperativeHandle:Ui,useInsertionEffect:Li,useLayoutEffect:Mi,useMemo:Fi,useReducer:yi,useRef:Ri,useState:function(){return yi(bi)},useDebugValue:zi,useDeferredValue:function(e){return Wi(vi(),oi.memoizedState,e)},useTransition:function(){return[yi(bi)[0],vi().memoizedState]},useMutableSource:_i,useSyncExternalStore:ji,useId:Hi,unstable_isNewReconciler:!1},eo={readContext:Oa,useCallback:Bi,useContext:Oa,useEffect:Di,useImperativeHandle:Ui,useInsertionEffect:Li,useLayoutEffect:Mi,useMemo:Fi,useReducer:wi,useRef:Ri,useState:function(){return wi(bi)},useDebugValue:zi,useDeferredValue:function(e){var t=vi();return null===oi?t.memoizedState=e:Wi(t,oi.memoizedState,e)},useTransition:function(){return[wi(bi)[0],vi().memoizedState]},useMutableSource:_i,useSyncExternalStore:ji,useId:Hi,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&Fe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zl(),s=ec(e),a=qa(r,s);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,s))&&(tc(t,e,s,r),za(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zl(),s=ec(e),a=qa(r,s);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,s))&&(tc(t,e,s,r),za(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zl(),r=ec(e),s=qa(n,r);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Ua(e,s,r))&&(tc(t,e,r,n),za(t,e,r))}};function so(e,t,n,r,s,a,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(s,a))}function ao(e,t,n){var r=!1,s=Cs,a=t.contextType;return"object"===typeof a&&null!==a?a=Oa(a):(s=Ps(t)?Os:Es.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Rs(e,s):Cs),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=a),t}function io(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},La(e);var a=t.contextType;"object"===typeof a&&null!==a?s.context=Oa(a):(a=Ps(t)?Os:Es.current,s.context=Rs(e,a)),s.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(no(e,t,a,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&ro.enqueueReplaceState(s,s.state,null),Fa(e,n,s,r),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var s=n}catch(a){s="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:s,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function mo(e,t,n){(n=qa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wl||(Wl=!0,Vl=r),uo(0,t)},n}function po(e,t,n){(n=qa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var s=t.value;n.payload=function(){return r(s)},n.callback=function(){uo(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var s=new Set;r.set(t,s)}else void 0===(s=r.get(t))&&(s=new Set,r.set(t,s));s.has(n)||(s.add(n),e=Nc.bind(null,e,t,n),t.then(e,e))}function xo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function go(e,t,n,r,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=qa(-1,1)).tag=2,Ua(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var vo=y.ReactCurrentOwner,bo=!1;function yo(e,t,n,r){t.child=null===e?wa(t,null,n,r):ya(t,e.child,n,r)}function wo(e,t,n,r,s){n=n.render;var a=t.ref;return Ta(t,s),r=fi(e,t,n,r,a,s),n=xi(),null===e||bo?(sa&&n&&ea(t),t.flags|=1,yo(e,t,r,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Wo(e,t,s))}function _o(e,t,n,r,s){if(null===e){var a=n.type;return"function"!==typeof a||Rc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ic(n.type,null,r,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,jo(e,t,a,r,s))}if(a=e.child,0===(e.lanes&s)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(i,r)&&e.ref===t.ref)return Wo(e,t,s)}return t.flags|=1,(e=Pc(a,r)).ref=t.ref,e.return=t,t.child=e}function jo(e,t,n,r,s){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(bo=!1,t.pendingProps=r=a,0===(e.lanes&s))return t.lanes=e.lanes,Wo(e,t,s);0!==(131072&e.flags)&&(bo=!0)}}return So(e,t,n,r,s)}function No(e,t,n){var r=t.pendingProps,s=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ss(Pl,Rl),Rl|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ss(Pl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ss(Pl,Rl),Rl|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ss(Pl,Rl),Rl|=r;return yo(e,t,s,n),t.child}function ko(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function So(e,t,n,r,s){var a=Ps(n)?Os:Es.current;return a=Rs(t,a),Ta(t,s),n=fi(e,t,n,r,a,s),r=xi(),null===e||bo?(sa&&r&&ea(t),t.flags|=1,yo(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Wo(e,t,s))}function Co(e,t,n,r,s){if(Ps(n)){var a=!0;Ls(t)}else a=!1;if(Ta(t,s),null===t.stateNode)Fo(e,t),ao(t,n,r),oo(t,n,r,s),r=!0;else if(null===e){var i=t.stateNode,o=t.memoizedProps;i.props=o;var l=i.context,c=n.contextType;"object"===typeof c&&null!==c?c=Oa(c):c=Rs(t,c=Ps(n)?Os:Es.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof i.getSnapshotBeforeUpdate;u||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o!==r||l!==c)&&io(t,i,r,c),Da=!1;var h=t.memoizedState;i.state=h,Fa(t,r,i,s),l=t.memoizedState,o!==r||h!==l||Ts.current||Da?("function"===typeof d&&(no(t,n,d,r),l=t.memoizedState),(o=Da||so(t,n,o,r,h,l,c))?(u||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),i.props=r,i.state=l,i.context=c,r=o):("function"===typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Ma(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),i.props=c,u=t.pendingProps,h=i.context,"object"===typeof(l=n.contextType)&&null!==l?l=Oa(l):l=Rs(t,l=Ps(n)?Os:Es.current);var m=n.getDerivedStateFromProps;(d="function"===typeof m||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o!==u||h!==l)&&io(t,i,r,l),Da=!1,h=t.memoizedState,i.state=h,Fa(t,r,i,s);var p=t.memoizedState;o!==u||h!==p||Ts.current||Da?("function"===typeof m&&(no(t,n,m,r),p=t.memoizedState),(c=Da||so(t,n,c,r,h,p,l)||!1)?(d||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(r,p,l),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),i.props=r,i.state=p,i.context=l,r=c):("function"!==typeof i.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Eo(e,t,n,r,a,s)}function Eo(e,t,n,r,s,a){ko(e,t);var i=0!==(128&t.flags);if(!r&&!i)return s&&Ms(t,n,!1),Wo(e,t,a);r=t.stateNode,vo.current=t;var o=i&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=ya(t,e.child,null,a),t.child=ya(t,null,o,a)):yo(e,t,o,a),t.memoizedState=r.state,s&&Ms(t,n,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?As(0,t.pendingContext,t.pendingContext!==t.context):t.context&&As(0,t.context,!1),$a(e,t.containerInfo)}function Oo(e,t,n,r,s){return ma(),pa(s),t.flags|=256,yo(e,t,n,r),t.child}var Ro,Po,Io,Ao={dehydrated:null,treeContext:null,retryLane:0};function Do(e){return{baseLanes:e,cachePool:null,transitions:null}}function Lo(e,t,n){var r,s=t.pendingProps,i=Za.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Ss(Za,1&i),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Dc(l,s,0,null),e=Ac(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Do(n),t.memoizedState=Ao,e):Mo(t,l));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,s,i,o){if(n)return 256&t.flags?(t.flags&=-257,qo(e,t,o,r=co(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,s=t.mode,r=Dc({mode:"visible",children:r.children},s,0,null),(i=Ac(i,s,o,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,0!==(1&t.mode)&&ya(t,e.child,null,o),t.child.memoizedState=Do(o),t.memoizedState=Ao,i);if(0===(1&t.mode))return qo(e,t,o,null);if("$!"===s.data){if(r=s.nextSibling&&s.nextSibling.dataset)var l=r.dgst;return r=l,qo(e,t,o,r=co(i=Error(a(419)),r,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(r=El)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(r.suspendedLanes|o))?0:s)&&s!==i.retryLane&&(i.retryLane=s,Aa(e,s),tc(r,e,s,-1))}return pc(),qo(e,t,o,r=co(Error(a(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Sc.bind(null,e),s._reactRetry=t,null):(e=i.treeContext,ra=cs(s.nextSibling),na=t,sa=!0,aa=null,null!==e&&(Gs[Js++]=Qs,Gs[Js++]=Ys,Gs[Js++]=$s,Qs=e.id,Ys=e.overflow,$s=t),t=Mo(t,r.children),t.flags|=4096,t)}(e,t,l,s,r,i,n);if(o){o=s.fallback,l=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==i?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=Pc(i,c)).subtreeFlags=14680064&i.subtreeFlags,null!==r?o=Pc(r,o):(o=Ac(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Do(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Ao,s}return e=(o=e.child).sibling,s=Pc(o,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Mo(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function qo(e,t,n,r){return null!==r&&pa(r),ya(t,e.child,null,n),(e=Mo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Uo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ea(e.return,t,n)}function zo(e,t,n,r,s){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function Bo(e,t,n){var r=t.pendingProps,s=r.revealOrder,a=r.tail;if(yo(e,t,r.children,n),0!==(2&(r=Za.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Uo(e,n,t);else if(19===e.tag)Uo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ss(Za,r),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===ei(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),zo(t,!1,s,n,a);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===ei(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}zo(t,!0,n,null,a);break;case"together":zo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Fo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Dl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Pc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Vo(e,t){if(!sa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ho(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=14680064&s.subtreeFlags,r|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ko(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ho(t),null;case 1:case 17:return Ps(t.type)&&Is(),Ho(t),null;case 3:return r=t.stateNode,Qa(),ks(Ts),ks(Es),ni(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ua(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ac(aa),aa=null))),Ho(t),null;case 5:Xa(t);var s=Ja(Ga.current);if(n=t.type,null!==e&&null!=t.stateNode)Po(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Ho(t),null}if(e=Ja(Ha.current),ua(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[hs]=t,r[ms]=i,e=0!==(1&t.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(s=0;s<Dr.length;s++)Ur(Dr[s],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":Q(r,i),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ur("invalid",r);break;case"textarea":se(r,i),Ur("invalid",r)}for(var l in ve(n,i),s=null,i)if(i.hasOwnProperty(l)){var c=i[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),s=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),s=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ur("scroll",r)}switch(n){case"input":K(r),Z(r,i,!0);break;case"textarea":K(r),ie(r);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(r.onclick=Zr)}r=s,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hs]=t,e[ms]=r,Ro(e,t),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Ur("cancel",e),Ur("close",e),s=r;break;case"iframe":case"object":case"embed":Ur("load",e),s=r;break;case"video":case"audio":for(s=0;s<Dr.length;s++)Ur(Dr[s],e);s=r;break;case"source":Ur("error",e),s=r;break;case"img":case"image":case"link":Ur("error",e),Ur("load",e),s=r;break;case"details":Ur("toggle",e),s=r;break;case"input":Q(e,r),s=$(e,r),Ur("invalid",e);break;case"option":default:s=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},s=M({},r,{value:void 0}),Ur("invalid",e);break;case"textarea":se(e,r),s=re(e,r),Ur("invalid",e)}for(i in ve(n,s),c=s)if(c.hasOwnProperty(i)){var d=c[i];"style"===i?xe(e,d):"dangerouslySetInnerHTML"===i?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===i?"string"===typeof d?("textarea"!==n||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(o.hasOwnProperty(i)?null!=d&&"onScroll"===i&&Ur("scroll",e):null!=d&&b(e,i,d,l))}switch(n){case"input":K(e),Z(e,r,!1);break;case"textarea":K(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ho(t),null;case 6:if(e&&null!=t.stateNode)Io(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ja(Ga.current),Ja(Ha.current),ua(t)){if(r=t.stateNode,n=t.memoizedProps,r[hs]=t,(i=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hs]=t,t.stateNode=r}return Ho(t),null;case 13:if(ks(Za),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(sa&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))ha(),ma(),t.flags|=98560,i=!1;else if(i=ua(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[hs]=t}else ma(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ho(t),i=!1}else null!==aa&&(ac(aa),aa=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Za.current)?0===Il&&(Il=3):pc())),null!==t.updateQueue&&(t.flags|=4),Ho(t),null);case 4:return Qa(),null===e&&Fr(t.stateNode.containerInfo),Ho(t),null;case 10:return Ca(t.type._context),Ho(t),null;case 19:if(ks(Za),null===(i=t.memoizedState))return Ho(t),null;if(r=0!==(128&t.flags),null===(l=i.rendering))if(r)Vo(i,!1);else{if(0!==Il||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ei(e))){for(t.flags|=128,Vo(i,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(l=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ss(Za,1&Za.current|2),t.child}e=e.sibling}null!==i.tail&&Ye()>Bl&&(t.flags|=128,r=!0,Vo(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ei(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Vo(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!sa)return Ho(t),null}else 2*Ye()-i.renderingStartTime>Bl&&1073741824!==n&&(t.flags|=128,r=!0,Vo(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=i.last)?n.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ye(),t.sibling=null,n=Za.current,Ss(Za,r?1&n|2:1&n),t):(Ho(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Ho(t),6&t.subtreeFlags&&(t.flags|=8192)):Ho(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Go(e,t){switch(ta(t),t.tag){case 1:return Ps(t.type)&&Is(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qa(),ks(Ts),ks(Es),ni(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xa(t),null;case 13:if(ks(Za),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ma()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ks(Za),null;case 4:return Qa(),null;case 10:return Ca(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ro=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(e,t,n,r){var s=e.memoizedProps;if(s!==r){e=t.stateNode,Ja(Ha.current);var a,i=null;switch(n){case"input":s=$(e,s),r=$(e,r),i=[];break;case"select":s=M({},s,{value:void 0}),r=M({},r,{value:void 0}),i=[];break;case"textarea":s=re(e,s),r=re(e,r),i=[];break;default:"function"!==typeof s.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(d in ve(n,r),n=null,s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&null!=s[d])if("style"===d){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=null!=s?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(i=i||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(i=i||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Ur("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(t.updateQueue=d)&&(t.flags|=4)}},Io=function(e,t,n,r){n!==r&&(t.flags|=4)};var Jo=!1,$o=!1,Qo="function"===typeof WeakSet?WeakSet:Set,Yo=null;function Xo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){jc(e,t,r)}else n.current=null}function Zo(e,t,n){try{n()}catch(r){jc(e,t,r)}}var el=!1;function tl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var s=r=r.next;do{if((s.tag&e)===e){var a=s.destroy;s.destroy=void 0,void 0!==a&&Zo(t,n,a)}s=s.next}while(s!==r)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[ms],delete t[fs],delete t[xs],delete t[gs])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ol(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(ol(e,t,n),e=e.sibling;null!==e;)ol(e,t,n),e=e.sibling}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}var cl=null,dl=!1;function ul(e,t,n){for(n=n.child;null!==n;)hl(e,t,n),n=n.sibling}function hl(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(st,n)}catch(o){}switch(n.tag){case 5:$o||Xo(n,t);case 6:var r=cl,s=dl;cl=null,ul(e,t,n),dl=s,null!==(cl=r)&&(dl?(e=cl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cl.removeChild(n.stateNode));break;case 18:null!==cl&&(dl?(e=cl,n=n.stateNode,8===e.nodeType?ls(e.parentNode,n):1===e.nodeType&&ls(e,n),Ft(e)):ls(cl,n.stateNode));break;case 4:r=cl,s=dl,cl=n.stateNode.containerInfo,dl=!0,ul(e,t,n),cl=r,dl=s;break;case 0:case 11:case 14:case 15:if(!$o&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){s=r=r.next;do{var a=s,i=a.destroy;a=a.tag,void 0!==i&&(0!==(2&a)||0!==(4&a))&&Zo(n,t,i),s=s.next}while(s!==r)}ul(e,t,n);break;case 1:if(!$o&&(Xo(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){jc(n,t,o)}ul(e,t,n);break;case 21:ul(e,t,n);break;case 22:1&n.mode?($o=(r=$o)||null!==n.memoizedState,ul(e,t,n),$o=r):ul(e,t,n);break;default:ul(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qo),t.forEach(function(t){var r=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var s=n[r];try{var i=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,dl=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===cl)throw Error(a(160));hl(i,o,s),cl=null,dl=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(d){jc(s,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),t=t.sibling}function fl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),xl(e),4&r){try{tl(3,e,e.return),nl(3,e)}catch(x){jc(e,e.return,x)}try{tl(5,e,e.return)}catch(x){jc(e,e.return,x)}}break;case 1:pl(t,e),xl(e),512&r&&null!==n&&Xo(n,n.return);break;case 5:if(pl(t,e),xl(e),512&r&&null!==n&&Xo(n,n.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(x){jc(e,e.return,x)}}if(4&r&&null!=(s=e.stateNode)){var i=e.memoizedProps,o=null!==n?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===i.type&&null!=i.name&&Y(s,i),be(l,o);var d=be(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];"style"===u?xe(s,h):"dangerouslySetInnerHTML"===u?ue(s,h):"children"===u?he(s,h):b(s,u,h,d)}switch(l){case"input":X(s,i);break;case"textarea":ae(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;null!=p?ne(s,!!i.multiple,p,!1):m!==!!i.multiple&&(null!=i.defaultValue?ne(s,!!i.multiple,i.defaultValue,!0):ne(s,!!i.multiple,i.multiple?[]:"",!1))}s[ms]=i}catch(x){jc(e,e.return,x)}}break;case 6:if(pl(t,e),xl(e),4&r){if(null===e.stateNode)throw Error(a(162));s=e.stateNode,i=e.memoizedProps;try{s.nodeValue=i}catch(x){jc(e,e.return,x)}}break;case 3:if(pl(t,e),xl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ft(t.containerInfo)}catch(x){jc(e,e.return,x)}break;case 4:default:pl(t,e),xl(e);break;case 13:pl(t,e),xl(e),8192&(s=e.child).flags&&(i=null!==s.memoizedState,s.stateNode.isHidden=i,!i||null!==s.alternate&&null!==s.alternate.memoizedState||(zl=Ye())),4&r&&ml(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?($o=(d=$o)||u,pl(t,e),$o=d):pl(t,e),xl(e),8192&r){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Yo=e,u=e.child;null!==u;){for(h=Yo=u;null!==Yo;){switch(p=(m=Yo).child,m.tag){case 0:case 11:case 14:case 15:tl(4,m,m.return);break;case 1:Xo(m,m.return);var f=m.stateNode;if("function"===typeof f.componentWillUnmount){r=m,n=m.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(x){jc(r,n,x)}}break;case 5:Xo(m,m.return);break;case 22:if(null!==m.memoizedState){yl(h);continue}}null!==p?(p.return=m,Yo=p):yl(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{s=h.stateNode,d?"function"===typeof(i=s.style).setProperty?i.setProperty("display","none","important"):i.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",o))}catch(x){jc(e,e.return,x)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(x){jc(e,e.return,x)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),xl(e),4&r&&ml(e);case 21:}}function xl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var s=r.stateNode;32&r.flags&&(he(s,""),r.flags&=-33),ll(e,il(e),s);break;case 3:case 4:var i=r.stateNode.containerInfo;ol(e,il(e),i);break;default:throw Error(a(161))}}catch(o){jc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gl(e,t,n){Yo=e,vl(e,t,n)}function vl(e,t,n){for(var r=0!==(1&e.mode);null!==Yo;){var s=Yo,a=s.child;if(22===s.tag&&r){var i=null!==s.memoizedState||Jo;if(!i){var o=s.alternate,l=null!==o&&null!==o.memoizedState||$o;o=Jo;var c=$o;if(Jo=i,($o=l)&&!c)for(Yo=s;null!==Yo;)l=(i=Yo).child,22===i.tag&&null!==i.memoizedState?wl(s):null!==l?(l.return=i,Yo=l):wl(s);for(;null!==a;)Yo=a,vl(a,t,n),a=a.sibling;Yo=s,Jo=o,$o=c}bl(e)}else 0!==(8772&s.subtreeFlags)&&null!==a?(a.return=s,Yo=a):bl(e)}}function bl(e){for(;null!==Yo;){var t=Yo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$o||nl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$o)if(null===n)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Wa(t,i,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wa(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Ft(h)}}}break;default:throw Error(a(163))}$o||512&t.flags&&rl(t)}catch(m){jc(t,t.return,m)}}if(t===e){Yo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Yo=n;break}Yo=t.return}}function yl(e){for(;null!==Yo;){var t=Yo;if(t===e){Yo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Yo=n;break}Yo=t.return}}function wl(e){for(;null!==Yo;){var t=Yo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nl(4,t)}catch(l){jc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var s=t.return;try{r.componentDidMount()}catch(l){jc(t,s,l)}}var a=t.return;try{rl(t)}catch(l){jc(t,a,l)}break;case 5:var i=t.return;try{rl(t)}catch(l){jc(t,i,l)}}}catch(l){jc(t,t.return,l)}if(t===e){Yo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Yo=o;break}Yo=t.return}}var _l,jl=Math.ceil,Nl=y.ReactCurrentDispatcher,kl=y.ReactCurrentOwner,Sl=y.ReactCurrentBatchConfig,Cl=0,El=null,Tl=null,Ol=0,Rl=0,Pl=Ns(0),Il=0,Al=null,Dl=0,Ll=0,Ml=0,ql=null,Ul=null,zl=0,Bl=1/0,Fl=null,Wl=!1,Vl=null,Hl=null,Kl=!1,Gl=null,Jl=0,$l=0,Ql=null,Yl=-1,Xl=0;function Zl(){return 0!==(6&Cl)?Ye():-1!==Yl?Yl:Yl=Ye()}function ec(e){return 0===(1&e.mode)?1:0!==(2&Cl)&&0!==Ol?Ol&-Ol:null!==fa.transition?(0===Xl&&(Xl=ft()),Xl):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function tc(e,t,n,r){if(50<$l)throw $l=0,Ql=null,Error(a(185));gt(e,n,r),0!==(2&Cl)&&e===El||(e===El&&(0===(2&Cl)&&(Ll|=n),4===Il&&ic(e,Ol)),nc(e,r),1===n&&0===Cl&&0===(1&t.mode)&&(Bl=Ye()+500,Us&&Fs()))}function nc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,s=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),o=1<<i,l=s[i];-1===l?0!==(o&n)&&0===(o&r)||(s[i]=mt(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var r=ht(e,e===El?Ol:0);if(0===r)null!==n&&Je(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Je(n),1===t)0===e.tag?function(e){Us=!0,Bs(e)}(oc.bind(null,e)):Bs(oc.bind(null,e)),is(function(){0===(6&Cl)&&Fs()}),n=null;else{switch(yt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ec(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Yl=-1,Xl=0,0!==(6&Cl))throw Error(a(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var r=ht(e,e===El?Ol:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=fc(e,r);else{t=r;var s=Cl;Cl|=2;var i=mc();for(El===e&&Ol===t||(Fl=null,Bl=Ye()+500,uc(e,t));;)try{gc();break}catch(l){hc(e,l)}Sa(),Nl.current=i,Cl=s,null!==Tl?t=0:(El=null,Ol=0,t=Il)}if(0!==t){if(2===t&&(0!==(s=pt(e))&&(r=s,t=sc(e,s))),1===t)throw n=Al,uc(e,0),ic(e,r),nc(e,Ye()),n;if(6===t)ic(e,r);else{if(s=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!or(a(),s))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=fc(e,r))&&(0!==(i=pt(e))&&(r=i,t=sc(e,i))),1===t))throw n=Al,uc(e,0),ic(e,r),nc(e,Ye()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:yc(e,Ul,Fl);break;case 3:if(ic(e,r),(130023424&r)===r&&10<(t=zl+500-Ye())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&r)!==r){Zl(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=rs(yc.bind(null,e,Ul,Fl),t);break}yc(e,Ul,Fl);break;case 4:if(ic(e,r),(4194240&r)===r)break;for(t=e.eventTimes,s=-1;0<r;){var o=31-it(r);i=1<<o,(o=t[o])>s&&(s=o),r&=~i}if(r=s,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*jl(r/1960))-r)){e.timeoutHandle=rs(yc.bind(null,e,Ul,Fl),r);break}yc(e,Ul,Fl);break;default:throw Error(a(329))}}}return nc(e,Ye()),e.callbackNode===n?rc.bind(null,e):null}function sc(e,t){var n=ql;return e.current.memoizedState.isDehydrated&&(uc(e,t).flags|=256),2!==(e=fc(e,t))&&(t=Ul,Ul=n,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function ic(e,t){for(t&=~Ml,t&=~Ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function oc(e){if(0!==(6&Cl))throw Error(a(327));wc();var t=ht(e,0);if(0===(1&t))return nc(e,Ye()),null;var n=fc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=Al,uc(e,0),ic(e,t),nc(e,Ye()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,yc(e,Ul,Fl),nc(e,Ye()),null}function lc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(Bl=Ye()+500,Us&&Fs())}}function cc(e){null!==Gl&&0===Gl.tag&&0===(6&Cl)&&wc();var t=Cl;Cl|=1;var n=Sl.transition,r=bt;try{if(Sl.transition=null,bt=1,e)return e()}finally{bt=r,Sl.transition=n,0===(6&(Cl=t))&&Fs()}}function dc(){Rl=Pl.current,ks(Pl)}function uc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==Tl)for(n=Tl.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Is();break;case 3:Qa(),ks(Ts),ks(Es),ni();break;case 5:Xa(r);break;case 4:Qa();break;case 13:case 19:ks(Za);break;case 10:Ca(r.type._context);break;case 22:case 23:dc()}n=n.return}if(El=e,Tl=e=Pc(e.current,null),Ol=Rl=t,Il=0,Al=null,Ml=Ll=Dl=0,Ul=ql=null,null!==Ra){for(t=0;t<Ra.length;t++)if(null!==(r=(n=Ra[t]).interleaved)){n.interleaved=null;var s=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=s,r.next=i}n.pending=r}Ra=null}return e}function hc(e,t){for(;;){var n=Tl;try{if(Sa(),ri.current=Yi,ci){for(var r=ii.memoizedState;null!==r;){var s=r.queue;null!==s&&(s.pending=null),r=r.next}ci=!1}if(ai=0,li=oi=ii=null,di=!1,ui=0,kl.current=null,null===n||null===n.return){Il=1,Al=t,Tl=null;break}e:{var i=e,o=n.return,l=n,c=t;if(t=Ol,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=xo(o);if(null!==p){p.flags&=-257,go(p,o,l,0,t),1&p.mode&&fo(i,d,t),c=d;var f=(t=p).updateQueue;if(null===f){var x=new Set;x.add(c),t.updateQueue=x}else f.add(c);break e}if(0===(1&t)){fo(i,d,t),pc();break e}c=Error(a(426))}else if(sa&&1&l.mode){var g=xo(o);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),go(g,o,l,0,t),pa(lo(c,l));break e}}i=c=lo(c,l),4!==Il&&(Il=2),null===ql?ql=[i]:ql.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Ba(i,mo(0,c,t));break e;case 1:l=c;var v=i.type,b=i.stateNode;if(0===(128&i.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hl||!Hl.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,Ba(i,po(i,l,t));break e}}i=i.return}while(null!==i)}bc(n)}catch(y){t=y,Tl===n&&null!==n&&(Tl=n=n.return);continue}break}}function mc(){var e=Nl.current;return Nl.current=Yi,null===e?Yi:e}function pc(){0!==Il&&3!==Il&&2!==Il||(Il=4),null===El||0===(268435455&Dl)&&0===(268435455&Ll)||ic(El,Ol)}function fc(e,t){var n=Cl;Cl|=2;var r=mc();for(El===e&&Ol===t||(Fl=null,uc(e,t));;)try{xc();break}catch(s){hc(e,s)}if(Sa(),Cl=n,Nl.current=r,null!==Tl)throw Error(a(261));return El=null,Ol=0,Il}function xc(){for(;null!==Tl;)vc(Tl)}function gc(){for(;null!==Tl&&!$e();)vc(Tl)}function vc(e){var t=_l(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?bc(e):Tl=t,kl.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ko(n,t,Rl)))return void(Tl=n)}else{if(null!==(n=Go(n,t)))return n.flags&=32767,void(Tl=n);if(null===e)return Il=6,void(Tl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Tl=t);Tl=t=e}while(null!==t);0===Il&&(Il=5)}function yc(e,t,n){var r=bt,s=Sl.transition;try{Sl.transition=null,bt=1,function(e,t,n,r){do{wc()}while(null!==Gl);if(0!==(6&Cl))throw Error(a(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-it(n),a=1<<s;t[s]=0,r[s]=-1,e[s]=-1,n&=~a}}(e,i),e===El&&(Tl=El=null,Ol=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kl||(Kl=!0,Ec(tt,function(){return wc(),null})),i=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||i){i=Sl.transition,Sl.transition=null;var o=bt;bt=1;var l=Cl;Cl|=4,kl.current=null,function(e,t){if(es=Vt,mr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(w){n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var p;h!==n||0!==s&&3!==h.nodeType||(l=o+s),h!==i||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)m=h,h=p;for(;;){if(h===e)break t;if(m===n&&++d===s&&(l=o),m===i&&++u===r&&(c=o),null!==(p=h.nextSibling))break;m=(h=m).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},Vt=!1,Yo=t;null!==Yo;)if(e=(t=Yo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Yo=e;else for(;null!==Yo;){t=Yo;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var x=f.memoizedProps,g=f.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?x:to(t.type,x),g);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(a(163))}}catch(w){jc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Yo=e;break}Yo=t.return}f=el,el=!1}(e,n),fl(n,e),pr(ts),Vt=!!es,ts=es=null,e.current=n,gl(n,e,s),Qe(),Cl=l,bt=o,Sl.transition=i}else e.current=n;if(Kl&&(Kl=!1,Gl=e,Jl=s),i=e.pendingLanes,0===i&&(Hl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),nc(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Wl)throw Wl=!1,e=Vl,Vl=null,e;0!==(1&Jl)&&0!==e.tag&&wc(),i=e.pendingLanes,0!==(1&i)?e===Ql?$l++:($l=0,Ql=e):$l=0,Fs()}(e,t,n,r)}finally{Sl.transition=s,bt=r}return null}function wc(){if(null!==Gl){var e=yt(Jl),t=Sl.transition,n=bt;try{if(Sl.transition=null,bt=16>e?16:e,null===Gl)var r=!1;else{if(e=Gl,Gl=null,Jl=0,0!==(6&Cl))throw Error(a(331));var s=Cl;for(Cl|=4,Yo=e.current;null!==Yo;){var i=Yo,o=i.child;if(0!==(16&Yo.flags)){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Yo=d;null!==Yo;){var u=Yo;switch(u.tag){case 0:case 11:case 15:tl(8,u,i)}var h=u.child;if(null!==h)h.return=u,Yo=h;else for(;null!==Yo;){var m=(u=Yo).sibling,p=u.return;if(sl(u),u===d){Yo=null;break}if(null!==m){m.return=p,Yo=m;break}Yo=p}}}var f=i.alternate;if(null!==f){var x=f.child;if(null!==x){f.child=null;do{var g=x.sibling;x.sibling=null,x=g}while(null!==x)}}Yo=i}}if(0!==(2064&i.subtreeFlags)&&null!==o)o.return=i,Yo=o;else e:for(;null!==Yo;){if(0!==(2048&(i=Yo).flags))switch(i.tag){case 0:case 11:case 15:tl(9,i,i.return)}var v=i.sibling;if(null!==v){v.return=i.return,Yo=v;break e}Yo=i.return}}var b=e.current;for(Yo=b;null!==Yo;){var y=(o=Yo).child;if(0!==(2064&o.subtreeFlags)&&null!==y)y.return=o,Yo=y;else e:for(o=b;null!==Yo;){if(0!==(2048&(l=Yo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(_){jc(l,l.return,_)}if(l===o){Yo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Yo=w;break e}Yo=l.return}}if(Cl=s,Fs(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(st,e)}catch(_){}r=!0}return r}finally{bt=n,Sl.transition=t}}return!1}function _c(e,t,n){e=Ua(e,t=mo(0,t=lo(n,t),1),1),t=Zl(),null!==e&&(gt(e,1,t),nc(e,t))}function jc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){t=Ua(t,e=po(t,e=lo(n,e),1),1),e=Zl(),null!==t&&(gt(t,1,e),nc(t,e));break}}t=t.return}}function Nc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zl(),e.pingedLanes|=e.suspendedLanes&n,El===e&&(Ol&n)===n&&(4===Il||3===Il&&(130023424&Ol)===Ol&&500>Ye()-zl?uc(e,0):Ml|=n),nc(e,t)}function kc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=Zl();null!==(e=Aa(e,t))&&(gt(e,t,n),nc(e,n))}function Sc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),kc(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),kc(e,n)}function Ec(e,t){return Ge(e,t)}function Tc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oc(e,t,n,r){return new Tc(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=Oc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ic(e,t,n,r,s,i){var o=2;if(r=e,"function"===typeof e)Rc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case j:return Ac(n.children,s,i,t);case N:o=8,s|=8;break;case k:return(e=Oc(12,n,t,2|s)).elementType=k,e.lanes=i,e;case T:return(e=Oc(13,n,t,s)).elementType=T,e.lanes=i,e;case O:return(e=Oc(19,n,t,s)).elementType=O,e.lanes=i,e;case I:return Dc(n,s,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:o=10;break e;case C:o=9;break e;case E:o=11;break e;case R:o=14;break e;case P:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Oc(o,n,t,s)).elementType=e,t.type=r,t.lanes=i,t}function Ac(e,t,n,r){return(e=Oc(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=Oc(22,e,r,t)).elementType=I,e.lanes=n,e.stateNode={isHidden:!1},e}function Lc(e,t,n){return(e=Oc(6,e,null,t)).lanes=n,e}function Mc(e,t,n){return(t=Oc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qc(e,t,n,r,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=xt(0),this.expirationTimes=xt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xt(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,s,a,i,o,l){return e=new qc(e,t,n,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Oc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},La(a),e}function zc(e){if(!e)return Cs;e:{if(Fe(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ps(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ps(n))return Ds(e,n,t)}return t}function Bc(e,t,n,r,s,a,i,o,l){return(e=Uc(n,r,!0,e,0,a,0,o,l)).context=zc(null),n=e.current,(a=qa(r=Zl(),s=ec(n))).callback=void 0!==t&&null!==t?t:null,Ua(n,a,s),e.current.lanes=s,gt(e,s,r),nc(e,r),e}function Fc(e,t,n,r){var s=t.current,a=Zl(),i=ec(s);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=qa(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ua(s,t,i))&&(tc(e,s,i,a),za(e,s,i)),i}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Vc(e,t),(e=e.alternate)&&Vc(e,t)}_l=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ts.current)bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bo=!1,function(e,t,n){switch(t.tag){case 3:To(t),ma();break;case 5:Ya(t);break;case 1:Ps(t.type)&&Ls(t);break;case 4:$a(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,s=t.memoizedProps.value;Ss(_a,r._currentValue),r._currentValue=s;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ss(Za,1&Za.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Lo(e,t,n):(Ss(Za,1&Za.current),null!==(e=Wo(e,t,n))?e.sibling:null);Ss(Za,1&Za.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Bo(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ss(Za,Za.current),r)break;return null;case 22:case 23:return t.lanes=0,No(e,t,n)}return Wo(e,t,n)}(e,t,n);bo=0!==(131072&e.flags)}else bo=!1,sa&&0!==(1048576&t.flags)&&Zs(t,Ks,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Fo(e,t),e=t.pendingProps;var s=Rs(t,Es.current);Ta(t,n),s=fi(null,t,r,e,s,n);var i=xi();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ps(r)?(i=!0,Ls(t)):i=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,La(t),s.updater=ro,t.stateNode=s,s._reactInternals=t,oo(t,r,e,n),t=Eo(null,t,r,!0,i,n)):(t.tag=0,sa&&i&&ea(t),yo(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Fo(e,t),e=t.pendingProps,r=(s=r._init)(r._payload),t.type=r,s=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===R)return 14}return 2}(r),e=to(r,e),s){case 0:t=So(null,t,r,e,n);break e;case 1:t=Co(null,t,r,e,n);break e;case 11:t=wo(null,t,r,e,n);break e;case 14:t=_o(null,t,r,to(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,So(e,t,r,s=t.elementType===r?s:to(r,s),n);case 1:return r=t.type,s=t.pendingProps,Co(e,t,r,s=t.elementType===r?s:to(r,s),n);case 3:e:{if(To(t),null===e)throw Error(a(387));r=t.pendingProps,s=(i=t.memoizedState).element,Ma(e,t),Fa(t,r,null,n);var o=t.memoizedState;if(r=o.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Oo(e,t,r,n,s=lo(Error(a(423)),t));break e}if(r!==s){t=Oo(e,t,r,n,s=lo(Error(a(424)),t));break e}for(ra=cs(t.stateNode.containerInfo.firstChild),na=t,sa=!0,aa=null,n=wa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ma(),r===s){t=Wo(e,t,n);break e}yo(e,t,r,n)}t=t.child}return t;case 5:return Ya(t),null===e&&ca(t),r=t.type,s=t.pendingProps,i=null!==e?e.memoizedProps:null,o=s.children,ns(r,s)?o=null:null!==i&&ns(r,i)&&(t.flags|=32),ko(e,t),yo(e,t,o,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Lo(e,t,n);case 4:return $a(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ya(t,null,r,n):yo(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,wo(e,t,r,s=t.elementType===r?s:to(r,s),n);case 7:return yo(e,t,t.pendingProps,n),t.child;case 8:case 12:return yo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,i=t.memoizedProps,o=s.value,Ss(_a,r._currentValue),r._currentValue=o,null!==i)if(or(i.value,o)){if(i.children===s.children&&!Ts.current){t=Wo(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){o=i.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=qa(-1,n&-n)).tag=2;var d=i.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Ea(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===i.tag)o=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(o=i.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ea(o,n,t),o=i.sibling}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===t){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}yo(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Ta(t,n),r=r(s=Oa(s)),t.flags|=1,yo(e,t,r,n),t.child;case 14:return s=to(r=t.type,t.pendingProps),_o(e,t,r,s=to(r.type,s),n);case 15:return jo(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:to(r,s),Fo(e,t),t.tag=1,Ps(r)?(e=!0,Ls(t)):e=!1,Ta(t,n),ao(t,r,s),oo(t,r,s,n),Eo(null,t,r,!0,e,n);case 19:return Bo(e,t,n);case 22:return No(e,t,n)}throw Error(a(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Gc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Yc(){}function Xc(e,t,n,r,s){var a=n._reactRootContainer;if(a){var i=a;if("function"===typeof s){var o=s;s=function(){var e=Wc(i);o.call(e)}}Fc(t,i,e,s)}else i=function(e,t,n,r,s){if(s){if("function"===typeof r){var a=r;r=function(){var e=Wc(i);a.call(e)}}var i=Bc(t,r,e,0,null,!1,0,"",Yc);return e._reactRootContainer=i,e[ps]=i.current,Fr(8===e.nodeType?e.parentNode:e),cc(),i}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof r){var o=r;r=function(){var e=Wc(l);o.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Yc);return e._reactRootContainer=l,e[ps]=l.current,Fr(8===e.nodeType?e.parentNode:e),cc(function(){Fc(t,l,n,r)}),l}(n,t,e,s,r);return Wc(i)}Jc.prototype.render=Gc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Fc(e,t,null,null)},Jc.prototype.unmount=Gc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cc(function(){Fc(null,e,null,null)}),t[ps]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<It.length&&0!==t&&t<It[n].priority;n++);It.splice(n,0,e),0===n&&Mt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(vt(t,1|n),nc(t,Ye()),0===(6&Cl)&&(Bl=Ye()+500,Fs()))}break;case 13:cc(function(){var t=Aa(e,1);if(null!==t){var n=Zl();tc(t,e,1,n)}}),Hc(e,1)}},_t=function(e){if(13===e.tag){var t=Aa(e,134217728);if(null!==t)tc(t,e,134217728,Zl());Hc(e,134217728)}},jt=function(e){if(13===e.tag){var t=ec(e),n=Aa(e,t);if(null!==n)tc(n,e,t,Zl());Hc(e,t)}},Nt=function(){return bt},kt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},_e=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=ws(r);if(!s)throw Error(a(90));G(r),X(r,s)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=lc,Te=cc;var Zc={usingClientEntryPoint:!1,Events:[bs,ys,ws,Se,Ce,lc]},ed={findFiberByHostInstance:vs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},td={bundleType:ed.bundleType,version:ed.version,rendererPackageName:ed.rendererPackageName,rendererConfig:ed.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:ed.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nd.isDisabled&&nd.supportsFiber)try{st=nd.inject(td),at=nd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$c(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$c(e))throw Error(a(299));var n=!1,r="",s=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,s),e[ps]=t.current,Fr(8===e.nodeType?e.parentNode:e),new Gc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return cc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(a(200));return Xc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$c(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,s=!1,i="",o=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Bc(t,null,e,1,null!=n?n:null,s,0,i,o),e[ps]=t.current,Fr(e),r)for(e=0;e<r.length;e++)s=(s=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Jc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(a(200));return Xc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(a(40));return!!e._reactRootContainer&&(cc(function(){Xc(null,null,e,!1,function(){e._reactRootContainer=null,e[ps]=null})}),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Xc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853(e,t,n){e.exports=n(234)},950(e,t,n){!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();var r=n(43),s=n(391),a=n(579);function i(e){let{className:t="w-8 h-8"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("circle",{cx:"12",cy:"8",r:"3",fill:"#fff"}),(0,a.jsx)("path",{d:"M4 20c1.5-4 6-6 8-6s6.5 2 8 6",stroke:"#6b7280",strokeWidth:"1"})]})}function o(e){let{className:t="w-8 h-8"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1.5",fill:"#fff"}),(0,a.jsx)("path",{d:"M7 6v12M12 6v12M17 6v12",stroke:"#6b7280",strokeWidth:"1"})]})}function l(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"3",width:"8",height:"8",rx:"1",fill:"#ffd700"}),(0,a.jsx)("rect",{x:"13",y:"3",width:"8",height:"5",rx:"1",fill:"#6a82fb"}),(0,a.jsx)("rect",{x:"13",y:"10",width:"8",height:"11",rx:"1",fill:"#43e97b"})]})}function c(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"4",y:"3",width:"6",height:"18",rx:"1",fill:"#4b6cb7"}),(0,a.jsx)("rect",{x:"14",y:"7",width:"6",height:"14",rx:"1",fill:"#182848"})]})}function d(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"6",width:"18",height:"3",rx:"1",fill:"#6a82fb"}),(0,a.jsx)("rect",{x:"3",y:"11",width:"18",height:"3",rx:"1",fill:"#fc5c7d"}),(0,a.jsx)("rect",{x:"3",y:"16",width:"18",height:"3",rx:"1",fill:"#43e97b"})]})}function u(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"#f3f4f6"}),(0,a.jsx)("rect",{x:"7",y:"7",width:"3",height:"3",fill:"#6a82fb"}),(0,a.jsx)("rect",{x:"14",y:"7",width:"3",height:"3",fill:"#ffd700"}),(0,a.jsx)("rect",{x:"7",y:"14",width:"3",height:"3",fill:"#43e97b"}),(0,a.jsx)("rect",{x:"14",y:"14",width:"3",height:"3",fill:"#ff6b6b"})]})}function h(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("circle",{cx:"12",cy:"8",r:"4",fill:"#ff6b6b"}),(0,a.jsx)("rect",{x:"3",y:"14",width:"18",height:"6",rx:"1",fill:"#e2e8f0"})]})}function m(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",fill:"#ffffff",stroke:"#e5e7eb"}),(0,a.jsx)("rect",{x:"4",y:"9",width:"6",height:"2",rx:"0.5",fill:"#6a82fb"})]})}function p(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",fill:"#f8fafc",stroke:"#e6eef8"}),(0,a.jsx)("path",{d:"M8 2v4M16 2v4",stroke:"#6b7280",strokeWidth:"1"})]})}function f(e){let{className:t="w-5 h-5"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z",fill:"#fff",stroke:"#6b7280"}),(0,a.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 2.41 16l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.67 0 1.21-.42 1.51-1a1.65 1.65 0 0 0-.33-1.82L4.3 2.41A2 2 0 1 1 7.13.58l.06.06A1.65 1.65 0 0 0 9 1.47c.3.58.84 1 1.51 1H12a2 2 0 1 1 0 4h-.09c-.67 0-1.21.42-1.51 1a1.65 1.65 0 0 0 .33 1.82l.06.06A2 2 0 1 1 16.87 7.9l-.06-.06a1.65 1.65 0 0 0-1.82-.33c-.58.3-1 0-1 1.51V9a2 2 0 1 1 4 0v.09c0 .67.42 1.21 1 1.51.7.3 1 .84 1.51 1.82z",stroke:"#6b7280",strokeWidth:"0.5"})]})}function x(e){let{className:t="w-5 h-5"}=e;return(0,a.jsx)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M21.7 13.35l-2.45-2.45a3 3 0 0 0-4.24 0l-.9.9-1.06-1.06.9-.9a3 3 0 0 0 0-4.24L10.65 2.3 8.3 4.65 9.7 6.05 7.95 7.8a6 6 0 1 0 8.49 8.49l1.75-1.75 1.4 1.4 2.35-2.35z",fill:"#fff",stroke:"#6b7280"})})}function g(e){let{className:t="w-8 h-8"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M7 5v14M12 5v14M17 5v14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}function v(e){let{className:t="w-8 h-8"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M8 12.5l2.5 2.5L16 9.5",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})]})}function b(e){let{className:t="w-8 h-8"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3.5",y:"5",width:"17",height:"15",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M8 4v3M16 4v3M3.5 9h17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),(0,a.jsx)("path",{d:"M12 12.5l2 .8-1.2 1.7.1 2-1.9-.8-1.9.8.1-2L8 13.3l2-.8L12 10.8l2 1.7z",stroke:"currentColor",strokeWidth:"1.2",fill:"none"})]})}function y(e){let{className:t="w-8 h-8"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"4",y:"12",width:"16",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"1.5"}),(0,a.jsx)("rect",{x:"5",y:"9",width:"6",height:"3",rx:"1",stroke:"currentColor",strokeWidth:"1.5"}),(0,a.jsx)("path",{d:"M14 9h5a2 2 0 0 1 2 2v1",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}function w(e){let{className:t="w-8 h-8"}=e;return(0,a.jsx)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M21 13l-2.5-2.5a3 3 0 0 0-4.2 0l-1 1-1.8-1.8 1-1a3 3 0 0 0 0-4.2L10 2.8 7.8 5l1.2 1.2-1.5 1.5a6 6 0 1 0 8.5 8.5l1.5-1.5 1.2 1.2L21 13z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function _(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M4 10a12 12 0 0 1 16 0",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,a.jsx)("path",{d:"M7 13a8 8 0 0 1 10 0",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,a.jsx)("path",{d:"M10 16a4 4 0 0 1 4 0",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,a.jsx)("circle",{cx:"12",cy:"19",r:"1",fill:"currentColor"})]})}function j(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),(0,a.jsx)("path",{d:"M8 3l4 3 4-3",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function N(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M12 4v16M4 12h16",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,a.jsx)("path",{d:"M7 7l3 3M14 14l3 3M7 17l3-3M14 10l3-3",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function k(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"6",y:"5",width:"12",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),(0,a.jsx)("path",{d:"M9 9h6M9 13h6",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function S(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,a.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("circle",{cx:"9",cy:"9",r:"2",stroke:"currentColor",strokeWidth:"1"}),(0,a.jsx)("circle",{cx:"15",cy:"9",r:"2",stroke:"currentColor",strokeWidth:"1"}),(0,a.jsx)("path",{d:"M3 20c2-4 8-4 9-4s7 0 9 4",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}const C=[{id:"manager",label:"\u0627\u0644\u0645\u062f\u064a\u0631 \u0627\u0644\u0639\u0627\u0645",description:"\u062a\u062d\u0643\u0645 \u0643\u0627\u0645\u0644 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645 \u0648\u062c\u0645\u064a\u0639 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0648\u0627\u0644\u0625\u0639\u062f\u0627\u062f\u0627\u062a."},{id:"assistant_manager",label:"\u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631",description:"\u0645\u0633\u0627\u0639\u062f\u0629 \u0641\u064a \u0645\u062a\u0627\u0628\u0639\u0629 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0648\u0627\u0644\u0636\u064a\u0648\u0641 \u0648\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u064a\u0648\u0645\u064a\u0629."},{id:"reception",label:"\u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644",description:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644 \u0648\u062e\u0631\u0648\u062c \u0627\u0644\u0646\u0632\u0644\u0627\u0621 \u0648\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u064a\u0648\u0645\u064a\u0629."},{id:"housekeeping",label:"\u062e\u062f\u0645\u0629 \u0627\u0644\u063a\u0631\u0641 (Housekeeping)",description:"\u0645\u062a\u0627\u0628\u0639\u0629 \u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641 \u0648\u0627\u0644\u062a\u0646\u0638\u064a\u0641 \u0648\u0627\u0644\u062a\u0646\u0633\u064a\u0642 \u0645\u0639 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644."}],E=e=>{const t=C.find(t=>t.id===e);return t?t.label:"\u0645\u0633\u062a\u062e\u062f\u0645"},T={dashboard:["manager","assistant_manager","reception","housekeeping"],buildings:["manager","assistant_manager"],floors:["manager","assistant_manager","housekeeping"],rooms:["manager","assistant_manager"],"room-types":["manager","assistant_manager"],reservations:["manager","assistant_manager","reception"],"checkin-out":["manager","assistant_manager","reception"],guests:["manager","assistant_manager","reception"],"activity-log":["manager","assistant_manager"],housekeeping:["manager","assistant_manager","housekeeping"],laundry:["manager","assistant_manager","housekeeping"],accounting:["manager","assistant_manager"],reports:["manager","assistant_manager"],users:["manager"],settings:["manager"]};function O(e,t){if(!e)return!1;const n=T[t];return!n||n.includes(e.role)}function R(e){return!!e&&"manager"===e.role}function P(e){return!!e&&"assistant_manager"===e.role}function I(e){return R(e)}function A(e){let{onNavigate:t,currentUser:n,onLogout:s}=e;const[o,x]=(0,r.useState)(()=>{try{return"1"===window.localStorage.getItem("sidebar_collapsed")}catch(e){return!1}}),g=(e,n)=>{if(t){n.preventDefault&&n.preventDefault();try{console.log("Sidebar nav ->",e)}catch(r){}t(e);try{window.history.pushState({},"","/".concat(e))}catch(r){}}};return(0,a.jsxs)("aside",{className:"bg-[#16213e] text-white ".concat(o?"w-16":"w-64"," h-screen flex flex-col justify-between shadow-xl relative transition-all duration-200 sticky top-0"),dir:"rtl",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{x(e=>{const t=!e;try{window.localStorage.setItem("sidebar_collapsed",t?"1":"0")}catch(n){}return t})},className:"absolute -right-3 top-24 z-20 w-8 h-8 rounded-full bg-[#facc15] border border-[#92400e] flex items-center justify-center hover:bg-[#fde68a] shadow-lg",title:o?"\u062a\u0648\u0633\u064a\u0639 \u0627\u0644\u0634\u0631\u064a\u0637 \u0627\u0644\u062c\u0627\u0646\u0628\u064a":"\u0637\u064a \u0627\u0644\u0634\u0631\u064a\u0637 \u0627\u0644\u062c\u0627\u0646\u0628\u064a",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-[#111827]",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:o?(0,a.jsx)("path",{d:"M10 6l6 6-6 6",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}):(0,a.jsx)("path",{d:"M14 6l-6 6 6 6",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"p-6 text-2xl font-bold border-b border-[#1f2a48] flex items-center justify-between gap-2",children:[(0,a.jsx)("span",{className:"truncate",children:"\u0641\u0646\u062f\u0642 \u0627\u0644\u0643\u064a\u0644\u0627\u0646\u064a"}),!o&&(0,a.jsx)("span",{className:"text-xs font-normal mt-1 text-[#ffd700] whitespace-nowrap",children:"\u0646\u0638\u0627\u0645 \u0625\u062f\u0627\u0631\u0629 \u0645\u062a\u0643\u0627\u0645\u0644"})]}),(0,a.jsxs)("nav",{className:"mt-6 flex flex-col gap-2 px-2 text-base",children:[(!n||O(n,"dashboard"))&&(0,a.jsxs)("a",{href:"/dashboard",onClick:e=>g("dashboard",e),className:"py-2 px-3 rounded flex items-center gap-3 bg-[#1f2a48] text-[#ffd700]",children:[(0,a.jsx)(l,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645"})]}),n&&O(n,"reports")&&(0,a.jsxs)("a",{href:"/reports",onClick:e=>g("reports",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(m,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0648\u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a"})]}),n&&O(n,"buildings")&&(0,a.jsxs)("a",{href:"/buildings",onClick:e=>g("buildings",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(c,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u0645\u0628\u0627\u0646\u064a"})]}),n&&O(n,"floors")&&(0,a.jsxs)("a",{href:"/floors",onClick:e=>g("floors",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(d,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u0637\u0648\u0627\u0628\u0642"})]}),n&&O(n,"rooms")&&(0,a.jsxs)("a",{href:"/rooms",onClick:e=>g("rooms",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(u,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u063a\u0631\u0641"})]}),n&&O(n,"room-types")&&(0,a.jsxs)("a",{href:"/room-types",onClick:e=>g("room-types",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(u,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u063a\u0631\u0641"})]}),n&&O(n,"reservations")&&(0,a.jsxs)("a",{href:"/reservations",onClick:e=>g("reservations",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(p,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0634\u0627\u0645\u0644\u0629"})]}),n&&O(n,"housekeeping")&&(0,a.jsxs)("a",{href:"/housekeeping",onClick:e=>g("housekeeping",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(h,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062a\u0646\u0638\u064a\u0641"})]}),n&&O(n,"laundry")&&(0,a.jsxs)("a",{href:"/laundry",onClick:e=>g("laundry",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(m,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a / \u0627\u0644\u0645\u062e\u0632\u0648\u0646"})]}),n&&O(n,"accounting")&&(0,a.jsxs)("a",{href:"/accounting",onClick:e=>g("accounting",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(m,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u0645\u062d\u0627\u0633\u0628\u0629 \u0627\u0644\u0630\u0643\u064a\u0629"})]}),n&&O(n,"checkin-out")&&(0,a.jsxs)("a",{href:"/checkin-out",onClick:e=>g("checkin-out",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(h,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644/\u062e\u0631\u0648\u062c"})]}),n&&O(n,"guests")&&(0,a.jsxs)("a",{href:"/guests",onClick:e=>g("guests",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(i,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),n&&O(n,"activity-log")&&(0,a.jsxs)("a",{href:"/activity-log",onClick:e=>g("activity-log",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(m,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0633\u062c\u0644 \u0627\u0644\u0646\u0634\u0627\u0637\u0627\u062a"})]}),n&&O(n,"users")&&(0,a.jsxs)("a",{href:"/users",className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(i,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u0648\u0646"})]}),n&&O(n,"settings")&&(0,a.jsxs)("a",{href:"/settings",className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,a.jsx)(f,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"truncate ".concat(o?"hidden":"inline"),children:"\u0625\u0639\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645"})]})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-[#1f2a48] flex ".concat(o?"flex-col items-center gap-1":"flex-col gap-2"),children:[!o&&(0,a.jsx)("div",{className:"text-sm text-gray-100",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"font-semibold truncate",children:n.name}),(0,a.jsx)("div",{className:"text-xs text-gray-300",children:E(n.role)})]}):(0,a.jsx)("span",{children:"\u0645\u0633\u062a\u062e\u062f\u0645 \u0627\u0644\u0646\u0638\u0627\u0645"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{s&&s()},className:"bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded text-sm w-full",children:"\u062e\u0631\u0648\u062c"})]})]})}function D(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}function L(e,t,n,r){return new(n||(n=Promise))(function(s,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;class M extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",n=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=n}}class q extends M{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class U extends M{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class z extends M{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var B;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(B||(B={}));class F{constructor(e){let{headers:t={},customFetch:n,region:r=B.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=r,this.fetch=(e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)})(n)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){return L(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){var r;let s,a;try{const{headers:i,method:o,body:l,signal:c,timeout:d}=n;let u={},{region:h}=n;h||(h=t.region);const m=new URL("".concat(t.url,"/").concat(e));let p;h&&"any"!==h&&(u["x-region"]=h,m.searchParams.set("forceFunctionRegion",h)),l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",p=l):"string"===typeof l?(u["Content-Type"]="text/plain",p=l):"undefined"!==typeof FormData&&l instanceof FormData?p=l:(u["Content-Type"]="application/json",p=JSON.stringify(l)):p=!l||"string"===typeof l||"undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer||"undefined"!==typeof FormData&&l instanceof FormData?l:JSON.stringify(l);let f=c;d&&(a=new AbortController,s=setTimeout(()=>a.abort(),d),c?(f=a.signal,c.addEventListener("abort",()=>a.abort())):f=a.signal);const x=yield t.fetch(m.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},u),t.headers),i),body:p,signal:f}).catch(e=>{throw new q(e)}),g=x.headers.get("x-relay-error");if(g&&"true"===g)throw new U(x);if(!x.ok)throw new z(x);let v,b=(null!==(r=x.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return v="application/json"===b?yield x.json():"application/octet-stream"===b||"application/pdf"===b?yield x.blob():"text/event-stream"===b?x:"multipart/form-data"===b?yield x.formData():yield x.text(),{data:v,error:null,response:x}}catch(i){return{data:null,error:i,response:i instanceof z||i instanceof U?i.context:void 0}}finally{s&&clearTimeout(s)}}()})}}var W=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},V=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(n=e.isMaybeSingle)&&void 0!==n&&n,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var n=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,r=null,s=null,a=e.status,i=e.statusText;if(e.ok){var o,l;if("HEAD"!==n.method){var c;const t=await e.text();""===t||(r="text/csv"===n.headers.get("Accept")||n.headers.get("Accept")&&(null===(c=n.headers.get("Accept"))||void 0===c?void 0:c.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const d=null===(o=n.headers.get("Prefer"))||void 0===o?void 0:o.match(/count=(exact|planned|estimated)/),u=null===(l=e.headers.get("content-range"))||void 0===l?void 0:l.split("/");d&&u&&u.length>1&&(s=parseInt(u[1])),n.isMaybeSingle&&"GET"===n.method&&Array.isArray(r)&&(r.length>1?(t={code:"PGRST116",details:"Results contain ".concat(r.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},r=null,s=null,a=406,i="Not Acceptable"):r=1===r.length?r[0]:null)}else{var d;const s=await e.text();try{t=JSON.parse(s),Array.isArray(t)&&404===e.status&&(r=[],t=null,a=200,i="OK")}catch(u){404===e.status&&""===s?(a=204,i="No Content"):t={message:s}}if(t&&n.isMaybeSingle&&(null===t||void 0===t||null===(d=t.details)||void 0===d?void 0:d.includes("0 rows"))&&(t=null,a=200,i="OK"),t&&n.shouldThrowOnError)throw new W(t)}return{error:t,data:r,count:s,status:a,statusText:i}});return this.shouldThrowOnError||(r=r.catch(e=>{var t;let n="";const r=null===e||void 0===e?void 0:e.cause;if(r){var s,a,i,o;const t=null!==(s=null===r||void 0===r?void 0:r.message)&&void 0!==s?s:"",l=null!==(a=null===r||void 0===r?void 0:r.code)&&void 0!==a?a:"";n="".concat(null!==(i=null===e||void 0===e?void 0:e.name)&&void 0!==i?i:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),n+="\n\nCaused by: ".concat(null!==(o=null===r||void 0===r?void 0:r.name)&&void 0!==o?o:"Error",": ").concat(t),l&&(n+=" (".concat(l,")")),(null===r||void 0===r?void 0:r.stack)&&(n+="\n".concat(r.stack))}else{var l;n=null!==(l=null===e||void 0===e?void 0:e.stack)&&void 0!==l?l:""}return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:n,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}},H=class extends V{select(e){let t=!1;const n=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=s?"".concat(s,".order"):"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,"".concat(i?"".concat(i,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===n?"":n?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="undefined"===typeof n?"limit":"".concat(n,".limit");return this.url.searchParams.set(r,"".concat(e)),this}range(e,t){let{foreignTable:n,referencedTable:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s="undefined"===typeof r?"offset":"".concat(r,".offset"),a="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(s,"".concat(e)),this.url.searchParams.set(a,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:a="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var i;const o=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(a,'; for="').concat(l,'"; options=').concat(o,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}};const K=new RegExp("[,()]");var G=class extends H{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}regexMatch(e,t){return this.url.searchParams.append(e,"match.".concat(t)),this}regexIMatch(e,t){return this.url.searchParams.append(e,"imatch.".concat(t)),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}isDistinct(e,t){return this.url.searchParams.append(e,"isdistinct.".concat(t)),this}in(e,t){const n=Array.from(new Set(t)).map(e=>"string"===typeof e&&K.test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(n,")")),this}notIn(e,t){const n=Array.from(new Set(t)).map(e=>"string"===typeof e&&K.test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"not.in.(".concat(n,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:n,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s="";"plain"===r?s="pl":"phrase"===r?s="ph":"websearch"===r&&(s="w");const a=void 0===n?"":"(".concat(n,")");return this.url.searchParams.append(e,"".concat(s,"fts").concat(a,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,n]=e;this.url.searchParams.append(t,"eq.".concat(n))}),this}not(e,t,n){return this.url.searchParams.append(e,"not.".concat(t,".").concat(n)),this}or(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n?"".concat(n,".or"):"or";return this.url.searchParams.append(r,"(".concat(e,")")),this}filter(e,t,n){return this.url.searchParams.append(e,"".concat(t,".").concat(n)),this}},J=class{constructor(e,t){let{headers:n={},schema:r,fetch:s}=t;this.url=e,this.headers=new Headers(n),this.schema=r,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:n=!1,count:r}=null!==t&&void 0!==t?t:{},s=n?"HEAD":"GET";let a=!1;const i=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",i),r&&l.append("Prefer","count=".concat(r)),new G({method:s,url:o,headers:l,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;const{url:s,headers:a}=this.cloneRequestState();if(t&&a.append("Prefer","count=".concat(t)),n||a.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));s.searchParams.set("columns",e.join(","))}}return new G({method:"POST",url:s,headers:a,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var a;const{url:i,headers:o}=this.cloneRequestState();if(o.append("Prefer","resolution=".concat(n?"ignore":"merge","-duplicates")),void 0!==t&&i.searchParams.set("on_conflict",t),r&&o.append("Prefer","count=".concat(r)),s||o.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));i.searchParams.set("columns",e.join(","))}}return new G({method:"POST",url:i,headers:o,schema:this.schema,body:e,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const{url:r,headers:s}=this.cloneRequestState();return t&&s.append("Prefer","count=".concat(t)),new G({method:"PATCH",url:r,headers:s,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;const{url:n,headers:r}=this.cloneRequestState();return e&&r.append("Prefer","count=".concat(e)),new G({method:"DELETE",url:n,headers:r,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}},$=class e{constructor(e){let{headers:t={},schema:n,fetch:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=r}from(e){if(!e||"string"!==typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new J(new URL("".concat(this.url,"/").concat(e)),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:n=!1,get:r=!1,count:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var a;let i;const o=new URL("".concat(this.url,"/rpc/").concat(e));let l;const c=e=>null!==e&&"object"===typeof e&&(!Array.isArray(e)||e.some(c)),d=n&&Object.values(t).some(c);d?(i="POST",l=t):n||r?(i=n?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,n]=e;return void 0!==n}).map(e=>{let[t,n]=e;return[t,Array.isArray(n)?"{".concat(n.join(","),"}"):"".concat(n)]}).forEach(e=>{let[t,n]=e;o.searchParams.append(t,n)})):(i="POST",l=t);const u=new Headers(this.headers);return d?u.set("Prefer",s?"count=".concat(s,",return=minimal"):"return=minimal"):s&&u.set("Prefer","count=".concat(s)),new G({method:i,url:o,headers:u,schema:this.schemaName,body:l,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}};const Q=class{constructor(){}static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket)return{type:"native",constructor:n.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node){const t=e.node,n=parseInt(t.replace(/^v/,"").split(".")[0]);return n>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(n," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(n," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},Y="realtime-js/".concat("2.91.0"),X="2.0.0",Z=X,ee=1e4;var te,ne,re,se,ae,ie;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(te||(te={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(ne||(ne={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(re||(re={})),function(e){e.websocket="websocket"}(se||(se={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(ae||(ae={}));class oe{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!==e&&void 0!==e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"===typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,n;const r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:{},s=(new TextEncoder).encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(e,t,n){var r,s;const a=e.topic,i=null!==(r=e.ref)&&void 0!==r?r:"",o=null!==(s=e.join_ref)&&void 0!==s?s:"",l=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=0===Object.keys(c).length?"":JSON.stringify(c);if(o.length>255)throw new Error("joinRef length ".concat(o.length," exceeds maximum of 255"));if(i.length>255)throw new Error("ref length ".concat(i.length," exceeds maximum of 255"));if(a.length>255)throw new Error("topic length ".concat(a.length," exceeds maximum of 255"));if(l.length>255)throw new Error("userEvent length ".concat(l.length," exceeds maximum of 255"));if(d.length>255)throw new Error("metadata length ".concat(d.length," exceeds maximum of 255"));const u=this.USER_BROADCAST_PUSH_META_LENGTH+o.length+i.length+a.length+l.length+d.length,h=new ArrayBuffer(this.HEADER_LENGTH+u);let m=new DataView(h),p=0;m.setUint8(p++,this.KINDS.userBroadcastPush),m.setUint8(p++,o.length),m.setUint8(p++,i.length),m.setUint8(p++,a.length),m.setUint8(p++,l.length),m.setUint8(p++,d.length),m.setUint8(p++,t),Array.from(o,e=>m.setUint8(p++,e.charCodeAt(0))),Array.from(i,e=>m.setUint8(p++,e.charCodeAt(0))),Array.from(a,e=>m.setUint8(p++,e.charCodeAt(0))),Array.from(l,e=>m.setUint8(p++,e.charCodeAt(0))),Array.from(d,e=>m.setUint8(p++,e.charCodeAt(0)));var f=new Uint8Array(h.byteLength+n.byteLength);return f.set(new Uint8Array(h),0),f.set(new Uint8Array(n),h.byteLength),f.buffer}decode(e,t){if(this._isArrayBuffer(e)){return t(this._binaryDecode(e))}if("string"===typeof e){const n=JSON.parse(e),[r,s,a,i,o]=n;return t({join_ref:r,ref:s,topic:a,event:i,payload:o})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;if(n===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}_decodeUserBroadcast(e,t,n){const r=t.getUint8(1),s=t.getUint8(2),a=t.getUint8(3),i=t.getUint8(4);let o=this.HEADER_LENGTH+4;const l=n.decode(e.slice(o,o+r));o+=r;const c=n.decode(e.slice(o,o+s));o+=s;const d=n.decode(e.slice(o,o+a));o+=a;const u=e.slice(o,e.byteLength),h=i===this.JSON_ENCODING?JSON.parse(n.decode(u)):u,m={type:this.BROADCAST_EVENT,event:c,payload:h};return a>0&&(m.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null===e||void 0===e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"===typeof e?Object.fromEntries(Object.entries(e).filter(e=>{let[n]=e;return t.includes(n)})):{}}}class le{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(ie||(ie={}));const ce=function(e,t){var n;const r=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((n,s)=>(n[s]=de(s,e,t,r),n),{}):{}},de=(e,t,n,r)=>{const s=t.find(t=>t.name===e),a=null===s||void 0===s?void 0:s.type,i=n[e];return a&&!r.includes(a)?ue(a,i):he(i)},ue=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return xe(t,n)}switch(e){case ie.bool:return me(t);case ie.float4:case ie.float8:case ie.int2:case ie.int4:case ie.int8:case ie.numeric:case ie.oid:return pe(t);case ie.json:case ie.jsonb:return fe(t);case ie.timestamp:return ge(t);case ie.abstime:case ie.date:case ie.daterange:case ie.int4range:case ie.int8range:case ie.money:case ie.reltime:case ie.text:case ie.time:case ie.timestamptz:case ie.timetz:case ie.tsrange:case ie.tstzrange:default:return he(t)}},he=e=>e,me=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},pe=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},fe=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return e}return e},xe=(e,t)=>{if("string"!==typeof e)return e;const n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){let r;const a=e.slice(1,n);try{r=JSON.parse("["+a+"]")}catch(s){r=a?a.split(","):[]}return r.map(e=>ue(t,e))}return e},ge=e=>"string"===typeof e?e.replace(" ","T"):e,ve=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class be{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ee;this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:n}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ye,we,_e,je;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(ye||(ye={}));class Ne{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ne.syncState(this.state,e,t,n),this.pendingDiffs.forEach(e=>{this.state=Ne.syncDiff(this.state,e,t,n)}),this.pendingDiffs=[],r()}),this.channel._on(n.diff,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Ne.syncDiff(this.state,e,t,n),r())}),this.onJoin((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})}),this.onLeave((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const s=this.cloneDeep(e),a=this.transformState(t),i={},o={};return this.map(s,(e,t)=>{a[e]||(o[e]=t)}),this.map(a,(e,t)=>{const n=s[e];if(n){const r=t.map(e=>e.presence_ref),s=n.map(e=>e.presence_ref),a=t.filter(e=>s.indexOf(e.presence_ref)<0),l=n.filter(e=>r.indexOf(e.presence_ref)<0);a.length>0&&(i[e]=a),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(s,{joins:i,leaves:o},n,r)}static syncDiff(e,t,n,r){const{joins:s,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(s,(t,r)=>{var s;const a=null!==(s=e[t])&&void 0!==s?s:[];if(e[t]=this.cloneDeep(r),a.length>0){const n=e[t].map(e=>e.presence_ref),r=a.filter(e=>n.indexOf(e.presence_ref)<0);e[t].unshift(...r)}n(t,a,r)}),this.map(a,(t,n)=>{let s=e[t];if(!s)return;const a=n.map(e=>e.presence_ref);s=s.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=s,r(t,s,n),0===s.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return t[n]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(we||(we={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(_e||(_e={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(je||(je={}));class ke{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n=arguments.length>2?arguments[2]:void 0;var r,s;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=ne.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new be(this,re.join,this.params,this.timeout),this.rejoinTimer=new le(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ne.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=ne.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=ne.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=ne.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=ne.errored,this.rejoinTimer.scheduleTimeout())}),this._on(re.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Ne(this),this.broadcastEndpointURL=ve(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(s=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===s?void 0:s.replay))throw"tried to use replay on public channel '".concat(this.topic,"'. It must be a private channel.")}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var n,r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==ne.closed){const{config:{broadcast:a,presence:i,private:o}}=this.params,l=null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[_e.PRESENCE]&&this.bindings[_e.PRESENCE].length>0||!0===(null===(s=this.params.config.presence)||void 0===s?void 0:s.enabled),d={},u={broadcast:a,presence:Object.assign(Object.assign({},i),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e(je.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e(je.CLOSED)),this.updateJoinPayload(Object.assign({config:u},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:n}=t;var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==n){const t=this.bindings.postgres_changes,s=null!==(r=null===t||void 0===t?void 0:t.length)&&void 0!==r?r:0,a=[];for(let r=0;r<s;r++){const s=t[r],{filter:{event:i,schema:o,table:l,filter:c}}=s,d=n&&n[r];if(!(d&&d.event===i&&ke.isFilterValueEqual(d.schema,o)&&ke.isFilterValueEqual(d.table,l)&&ke.isFilterValueEqual(d.filter,c)))return this.unsubscribe(),this.state=ne.errored,void(null===e||void 0===e||e(je.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},s),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e(je.SUBSCRIBED))}null===e||void 0===e||e(je.SUBSCRIBED)}).receive("error",t=>{this.state=ne.errored,null===e||void 0===e||e(je.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e(je.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===ne.joined&&e===_e.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r;if(void 0===t||null===t)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization="Bearer ".concat(this.socket.accessTokenValue));const a={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=n.timeout)&&void 0!==r?r:this.timeout);if(202===i.status)return{success:!0};let o=i.statusText;try{const e=await i.json();o=e.error||e.message||o}catch(l){}return Promise.reject(new Error(o))}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(n=>{var r,s,a;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(s=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===s?void 0:s.broadcast)||void 0===a?void 0:a.ack)||n("ok"),i.receive("ok",()=>n("ok")),i.receive("error",()=>n("error")),i.receive("timeout",()=>n("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization="Bearer ".concat(this.socket.accessTokenValue));const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,l,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(s){return"AbortError"===s.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=ne.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(re.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new be(this,re.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null===n||void 0===n||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ne.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,s=setTimeout(()=>r.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(s),a}_push(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let r=new be(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,s;const a=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=re;if(n&&[i,o,l,c].indexOf(a)>=0&&n!==this._joinRef())return;let d=this._onMessage(a,t,n);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,n,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===a}).map(e=>e.callback(d,n)):null===(s=this.bindings[a])||void 0===s||s.filter(e=>{var n,r,s,i,o,l,c,d;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,l=null===(n=e.filter)||void 0===n?void 0:n.event;return a&&(null===(r=t.ids)||void 0===r?void 0:r.includes(a))&&("*"===l||(null===l||void 0===l?void 0:l.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))&&(!(null===(i=e.filter)||void 0===i?void 0:i.table)||e.filter.table===(null===(o=t.data)||void 0===o?void 0:o.table))}{const n=null===(c=null===(l=null===e||void 0===e?void 0:e.filter)||void 0===l?void 0:l.event)||void 0===c?void 0:c.toLocaleLowerCase();return"*"===n||n===(null===(d=null===t||void 0===t?void 0:t.event)||void 0===d?void 0:d.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"===typeof d&&"ids"in d){const e=d.data,{schema:t,table:n,commit_timestamp:r,type:s,errors:a}=e,i={schema:t,table:n,commit_timestamp:r,eventType:s,new:{},old:{},errors:a};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,n)})}_isClosed(){return this.state===ne.closed}_isJoined(){return this.state===ne.joined}_isJoining(){return this.state===ne.joining}_isLeaving(){return this.state===ne.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,n){const r=e.toLocaleLowerCase(),s={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(s):this.bindings[r]=[s],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&ke.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(null!==e&&void 0!==e?e:void 0)===(null!==t&&void 0!==t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(re.close,{},e)}_onError(e){this._on(re.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ne.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=ce(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=ce(e.columns,e.old_record)),t}}const Se=()=>{},Ce=25e3,Ee=10,Te=100,Oe=[1e3,2e3,5e3,1e4];class Re{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ee,this.transport=null,this.heartbeatIntervalMs=Ce,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Se,this.ref=0,this.reconnectTimer=null,this.vsn=Z,this.logger=Se,this.conn=null,this.sendBuffer=[],this.serializer=new oe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},!(null===(n=null===t||void 0===t?void 0:t.params)||void 0===n?void 0:n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(se.websocket),this.httpEndpoint=ve(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Q.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},"function"===typeof this.conn.close&&(e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case te.connecting:return ae.Connecting;case te.open:return ae.Open;case te.closing:return ae.Closing;default:return ae.Closed}}isConnected(){return this.connectionState()===ae.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const n="realtime:".concat(e),r=this.getChannels().find(e=>e.topic===n);if(r)return r;{const n=new ke("realtime:".concat(e),t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:n,payload:r,ref:s}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(n," (").concat(s,")"),r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Te)}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){const t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(o){this.log("error","error in heartbeat callback",o)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:t,event:n,payload:r,ref:s}=e,a=s?"(".concat(s,")"):"",i=r.status||"";this.log("receive","".concat(i," ").concat(t," ").concat(n," ").concat(a).trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(n,r,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===te.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===te.open||this.conn.readyState===te.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL()));(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(re.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return"".concat(e).concat(n).concat(r)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!1;if(t)e=t,n=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),e=this.accessTokenValue}else e=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const n={access_token:e,version:Y};e&&t.updateJoinPayload(n),t.joinedOnce&&t._isJoined()&&t._push(re.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this._isManualToken()||this.setAuth().catch(t=>{this.log("error","Error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(r){this.log("error","error in ".concat(e," callback"),r)}})}catch(n){this.log("error","error triggering ".concat(e," callbacks"),n)}}_setupReconnectionTimer(){this.reconnectTimer=new le(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ee)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,s,a,i,o,l,c,d,u,h;switch(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(n=null===e||void 0===e?void 0:e.timeout)&&void 0!==n?n:ee,this.heartbeatIntervalMs=null!==(r=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Ce,this.worker=null!==(s=null===e||void 0===e?void 0:e.worker)&&void 0!==s&&s,this.accessToken=null!==(a=null===e||void 0===e?void 0:e.accessToken)&&void 0!==a?a:null,this.heartbeatCallback=null!==(i=null===e||void 0===e?void 0:e.heartbeatCallback)&&void 0!==i?i:Se,this.vsn=null!==(o=null===e||void 0===e?void 0:e.vsn)&&void 0!==o?o:Z,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>Oe[e-1]||1e4,this.vsn){case"1.0.0":this.encode=null!==(c=null===e||void 0===e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(d=null===e||void 0===e?void 0:e.decode)&&void 0!==d?d:(e,t)=>t(JSON.parse(e));break;case X:this.encode=null!==(u=null===e||void 0===e?void 0:e.encode)&&void 0!==u?u:this.serializer.encode.bind(this.serializer),this.decode=null!==(h=null===e||void 0===e?void 0:e.decode)&&void 0!==h?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error("Unsupported serializer version: ".concat(this.vsn))}if(this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function Ie(e){var t=function(e,t){if("object"!=Pe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pe(t)?t:t+""}function Ae(e,t,n){return(t=Ie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach(function(t){Ae(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Me=class extends Error{constructor(e,t){var n;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===(null===(n=t.icebergType)||void 0===n?void 0:n.includes("CommitState"))}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function qe(e){var t;const n=null!==(t=e.fetchImpl)&&void 0!==t?t:globalThis.fetch;return{async request(t){let{method:r,path:s,query:a,body:i,headers:o}=t;const l=function(e,t,n){const r=new URL(t,e);if(n)for(const[s,a]of Object.entries(n))void 0!==a&&r.searchParams.set(s,a);return r.toString()}(e.baseUrl,s,a),c=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:"Bearer ".concat(e.token)}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),d=await n(l,{method:r,headers:Le(Le(Le({},i?{"Content-Type":"application/json"}:{}),c),o),body:i?JSON.stringify(i):void 0}),u=await d.text(),h=(d.headers.get("content-type")||"").includes("application/json"),m=h&&u?JSON.parse(u):u;if(!d.ok){var p;const e=h?m:void 0,t=null===e||void 0===e?void 0:e.error;throw new Me(null!==(p=null===t||void 0===t?void 0:t.message)&&void 0!==p?p:"Request failed with status ".concat(d.status),{status:d.status,icebergType:null===t||void 0===t?void 0:t.type,icebergCode:null===t||void 0===t?void 0:t.code,details:e})}return{status:d.status,headers:d.headers,data:m}}}}function Ue(e){return e.join("\x1f")}var ze=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Ue(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces"),query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const n={namespace:e.namespace,properties:null===t||void 0===t?void 0:t.properties};return(await this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces"),body:n})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:"".concat(this.prefix,"/namespaces/").concat(Ue(e.namespace))})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Ue(e.namespace))})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:"".concat(this.prefix,"/namespaces/").concat(Ue(e.namespace))}),!0}catch(t){if(t instanceof Me&&404===t.status)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(n){if(n instanceof Me&&409===n.status)return;throw n}}};function Be(e){return e.join("\x1f")}var Fe=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;this.client=e,this.prefix=t,this.accessDelegation=n}async listTables(e){return(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Be(e.namespace),"/tables")})).data.identifiers}async createTable(e,t){const n={};this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces/").concat(Be(e.namespace),"/tables"),body:t,headers:n})).data.metadata}async updateTable(e,t){const n=await this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces/").concat(Be(e.namespace),"/tables/").concat(e.name),body:t});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(e,t){var n;await this.client.request({method:"DELETE",path:"".concat(this.prefix,"/namespaces/").concat(Be(e.namespace),"/tables/").concat(e.name),query:{purgeRequested:String(null!==(n=null===t||void 0===t?void 0:t.purge)&&void 0!==n&&n)}})}async loadTable(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Be(e.namespace),"/tables/").concat(e.name),headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:"".concat(this.prefix,"/namespaces/").concat(Be(e.namespace),"/tables/").concat(e.name),headers:t}),!0}catch(n){if(n instanceof Me&&404===n.status)return!1;throw n}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(n){if(n instanceof Me&&409===n.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw n}}},We=class{constructor(e){var t;let n="v1";e.catalogName&&(n+="/".concat(e.catalogName));const r=e.baseUrl.endsWith("/")?e.baseUrl:"".concat(e.baseUrl,"/");this.client=qe({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=null===(t=e.accessDelegation)||void 0===t?void 0:t.join(","),this.namespaceOps=new ze(this.client,n),this.tableOps=new Fe(this.client,n,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}};var Ve=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function He(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}var Ke=class extends Ve{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Ge=class extends Ve{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const Je=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},$e=e=>{if(Array.isArray(e))return e.map(e=>$e(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[n,r]=e;const s=n.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=$e(r)}),t};function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ye(e){var t=function(e,t){if("object"!=Qe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Qe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Qe(t)?t:t+""}function Xe(e,t,n){return(t=Ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach(function(t){Xe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const tt=e=>{var t;return e.msg||e.message||e.error_description||("string"===typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},nt=async(e,t,n)=>{e instanceof await Response&&!(null===n||void 0===n?void 0:n.noResolveJson)?e.json().then(n=>{const r=e.status||500,s=(null===n||void 0===n?void 0:n.statusCode)||r+"";t(new Ke(tt(n),r,s))}).catch(e=>{t(new Ge(tt(e),e))}):t(new Ge(tt(e),e))},rt=(e,t,n,r)=>{const s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(s.headers=et({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(r)):s.body=r,(null===t||void 0===t?void 0:t.duplex)&&(s.duplex=t.duplex),et(et({},s),n)):s};async function st(e,t,n,r,s,a){return new Promise((i,o)=>{e(n,rt(t,r,s,a)).then(e=>{if(!e.ok)throw e;return(null===r||void 0===r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>nt(e,o,r))})}async function at(e,t,n,r){return st(e,"GET",t,n,r)}async function it(e,t,n,r,s){return st(e,"POST",t,r,s,n)}async function ot(e,t,n,r,s){return st(e,"PUT",t,r,s,n)}async function lt(e,t,n,r,s){return st(e,"DELETE",t,r,s,n)}var ct=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(He(e))return{data:null,error:e};throw e}}};let dt;dt=Symbol.toStringTag;var ut=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[dt]="BlobDownloadBuilder",this.promise=null}asStream(){return new ct(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(He(e))return{data:null,error:e};throw e}}};const ht={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var pt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=Je(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,n,r){var s=this;try{let a;const i=et(et({},mt),r);let o=et(et({},s.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const l=i.metadata;"undefined"!==typeof Blob&&n instanceof Blob?(a=new FormData,a.append("cacheControl",i.cacheControl),l&&a.append("metadata",s.encodeMetadata(l)),a.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(a=n,a.has("cacheControl")||a.append("cacheControl",i.cacheControl),l&&!a.has("metadata")&&a.append("metadata",s.encodeMetadata(l))):(a=n,o["cache-control"]="max-age=".concat(i.cacheControl),o["content-type"]=i.contentType,l&&(o["x-metadata"]=s.toBase64(s.encodeMetadata(l))),("undefined"!==typeof ReadableStream&&a instanceof ReadableStream||a&&"object"===typeof a&&"pipe"in a&&"function"===typeof a.pipe)&&!i.duplex&&(i.duplex="half")),(null===r||void 0===r?void 0:r.headers)&&(o=et(et({},o),r.headers));const c=s._removeEmptyFolders(t),d=s._getFinalPath(c),u=await("PUT"==e?ot:it)(s.fetch,"".concat(s.url,"/object/").concat(d),a,et({headers:o},(null===i||void 0===i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:c,id:u.Id,fullPath:u.Key},error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(He(a))return{data:null,error:a};throw a}}async upload(e,t,n){return this.uploadOrUpdate("POST",e,t,n)}async uploadToSignedUrl(e,t,n,r){var s=this;const a=s._removeEmptyFolders(e),i=s._getFinalPath(a),o=new URL(s.url+"/object/upload/sign/".concat(i));o.searchParams.set("token",t);try{let e;const t=et({upsert:mt.upsert},r),i=et(et({},s.headers),{"x-upsert":String(t.upsert)});return"undefined"!==typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,i["cache-control"]="max-age=".concat(t.cacheControl),i["content-type"]=t.contentType),{data:{path:a,fullPath:(await ot(s.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(He(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(e,t){var n=this;try{let r=n._getFinalPath(e);const s=et({},n.headers);(null===t||void 0===t?void 0:t.upsert)&&(s["x-upsert"]="true");const a=await it(n.fetch,"".concat(n.url,"/object/upload/sign/").concat(r),{},{headers:s}),i=new URL(n.url+a.url),o=i.searchParams.get("token");if(!o)throw new Ve("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(He(r))return{data:null,error:r};throw r}}async update(e,t,n){return this.uploadOrUpdate("PUT",e,t,n)}async move(e,t,n){var r=this;try{return{data:await it(r.fetch,"".concat(r.url,"/object/move"),{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(He(s))return{data:null,error:s};throw s}}async copy(e,t,n){var r=this;try{return{data:{path:(await it(r.fetch,"".concat(r.url,"/object/copy"),{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(He(s))return{data:null,error:s};throw s}}async createSignedUrl(e,t,n){var r=this;try{let s=r._getFinalPath(e),a=await it(r.fetch,"".concat(r.url,"/object/sign/").concat(s),et({expiresIn:t},(null===n||void 0===n?void 0:n.transform)?{transform:n.transform}:{}),{headers:r.headers});const i=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return a={signedUrl:encodeURI("".concat(r.url).concat(a.signedURL).concat(i))},{data:a,error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(He(s))return{data:null,error:s};throw s}}async createSignedUrls(e,t,n){var r=this;try{const s=await it(r.fetch,"".concat(r.url,"/object/sign/").concat(r.bucketId),{expiresIn:t,paths:e},{headers:r.headers}),a=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return{data:s.map(e=>et(et({},e),{},{signedUrl:e.signedURL?encodeURI("".concat(r.url).concat(e.signedURL).concat(a)):null})),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(He(s))return{data:null,error:s};throw s}}download(e,t){const n="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),s=r?"?".concat(r):"",a=this._getFinalPath(e);return new ut(()=>at(this.fetch,"".concat(this.url,"/").concat(n,"/").concat(a).concat(s),{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){var t=this;const n=t._getFinalPath(e);try{return{data:$e(await at(t.fetch,"".concat(t.url,"/object/info/").concat(n),{headers:t.headers})),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(He(r))return{data:null,error:r};throw r}}async exists(e){var t=this;const n=t._getFinalPath(e);try{return await async function(e,t,n,r){return st(e,"HEAD",t,et(et({},n),{},{noResolveJson:!0}),r)}(t.fetch,"".concat(t.url,"/object/").concat(n),{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(He(r)&&r instanceof Ge){const e=r.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:r}}throw r}}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],s=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==s&&r.push(s);const a="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==i&&r.push(i);let o=r.join("&");return""!==o&&(o="?".concat(o)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(a,"/public/").concat(n).concat(o))}}}async remove(e){var t=this;try{return{data:await lt(t.fetch,"".concat(t.url,"/object/").concat(t.bucketId),{prefixes:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}async list(e,t,n){var r=this;try{const s=et(et(et({},ht),t),{},{prefix:e||""});return{data:await it(r.fetch,"".concat(r.url,"/object/list/").concat(r.bucketId),s,{headers:r.headers},n),error:null}}catch(s){if(r.shouldThrowOnError)throw s;if(He(s))return{data:null,error:s};throw s}}async listV2(e,t){var n=this;try{const r=et({},e);return{data:await it(n.fetch,"".concat(n.url,"/object/list-v2/").concat(n.bucketId),r,{headers:n.headers},t),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(He(r))return{data:null,error:r};throw r}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}};const ft="2.91.0",xt={"X-Client-Info":"storage-js/".concat(ft)};var gt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1;const s=new URL(e);(null===r||void 0===r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=et(et({},xt),t),this.fetch=Je(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const n=t.listBucketOptionsToQueryString(e);return{data:await at(t.fetch,"".concat(t.url,"/bucket").concat(n),{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}async getBucket(e){var t=this;try{return{data:await at(t.fetch,"".concat(t.url,"/bucket/").concat(e),{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}async createBucket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};var n=this;try{return{data:await it(n.fetch,"".concat(n.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(He(r))return{data:null,error:r};throw r}}async updateBucket(e,t){var n=this;try{return{data:await ot(n.fetch,"".concat(n.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(He(r))return{data:null,error:r};throw r}}async emptyBucket(e){var t=this;try{return{data:await it(t.fetch,"".concat(t.url,"/bucket/").concat(e,"/empty"),{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await lt(t.fetch,"".concat(t.url,"/bucket/").concat(e),{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},vt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=et(et({},xt),t),this.fetch=Je(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await it(t.fetch,"".concat(t.url,"/bucket"),{name:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}async listBuckets(e){var t=this;try{const n=new URLSearchParams;void 0!==(null===e||void 0===e?void 0:e.limit)&&n.set("limit",e.limit.toString()),void 0!==(null===e||void 0===e?void 0:e.offset)&&n.set("offset",e.offset.toString()),(null===e||void 0===e?void 0:e.sortColumn)&&n.set("sortColumn",e.sortColumn),(null===e||void 0===e?void 0:e.sortOrder)&&n.set("sortOrder",e.sortOrder),(null===e||void 0===e?void 0:e.search)&&n.set("search",e.search);const r=n.toString(),s=r?"".concat(t.url,"/bucket?").concat(r):"".concat(t.url,"/bucket");return{data:await at(t.fetch,s,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await lt(t.fetch,"".concat(t.url,"/bucket/").concat(e),{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(He(n))return{data:null,error:n};throw n}}from(e){var t=this;if(!(e=>!(!e||"string"!==typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new Ve("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new We({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(e,t){const n=e[t];return"function"!==typeof n?n:async function(){try{for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return{data:await n.apply(e,s),error:null}}catch(i){if(r)throw i;return{data:null,error:i}}}}})}};const bt={"X-Client-Info":"storage-js/".concat(ft),"Content-Type":"application/json"};var yt=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function wt(e){return"object"===typeof e&&null!==e&&"__isStorageVectorsError"in e}var _t=class extends yt{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},jt=class extends yt{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const Nt=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},kt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),St=(e,t,n,r)=>{const s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(s.headers=et({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(r)):s.body=r,et(et({},s),n)):s};async function Ct(e,t,n,r,s,a){return new Promise((i,o)=>{e(n,St(t,r,s,a)).then(e=>{if(!e.ok)throw e;if(null===r||void 0===r?void 0:r.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>i(e)).catch(e=>(async(e,t,n)=>{if(e&&"object"===typeof e&&"status"in e&&"ok"in e&&"number"===typeof e.status&&!(null===n||void 0===n?void 0:n.noResolveJson)){const n=e.status||500,r=e;if("function"===typeof r.json)r.json().then(e=>{const r=(null===e||void 0===e?void 0:e.statusCode)||(null===e||void 0===e?void 0:e.code)||n+"";t(new _t(kt(e),n,r))}).catch(()=>{const e=n+"";t(new _t(r.statusText||"HTTP ".concat(n," error"),n,e))});else{const e=n+"";t(new _t(r.statusText||"HTTP ".concat(n," error"),n,e))}}else t(new jt(kt(e),e))})(e,o,r))})}async function Et(e,t,n,r,s){return Ct(e,"POST",t,r,s,n)}var Tt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=et(et({},bt),t),this.fetch=Nt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/CreateIndex"),e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async getIndex(e,t){var n=this;try{return{data:await Et(n.fetch,"".concat(n.url,"/GetIndex"),{vectorBucketName:e,indexName:t},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}async listIndexes(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/ListIndexes"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async deleteIndex(e,t){var n=this;try{return{data:await Et(n.fetch,"".concat(n.url,"/DeleteIndex"),{vectorBucketName:e,indexName:t},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(wt(r))return{data:null,error:r};throw r}}},Ot=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=et(et({},bt),t),this.fetch=Nt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Et(t.fetch,"".concat(t.url,"/PutVectors"),e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async getVectors(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/GetVectors"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async listVectors(e){var t=this;try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and ".concat(e.segmentCount-1))}return{data:await Et(t.fetch,"".concat(t.url,"/ListVectors"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async queryVectors(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/QueryVectors"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Et(t.fetch,"".concat(t.url,"/DeleteVectors"),e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}},Rt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=et(et({},bt),t),this.fetch=Nt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/CreateVectorBucket"),{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async getBucket(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/GetVectorBucket"),{vectorBucketName:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async listBuckets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/ListVectorBuckets"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await Et(t.fetch,"".concat(t.url,"/DeleteVectorBucket"),{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(wt(n))return{data:null,error:n};throw n}}},Pt=class extends Rt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t.headers||{},t.fetch)}from(e){return new It(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},It=class extends Tt{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n}async createIndex(e){return(()=>super.createIndex)().call(this,et(et({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(()=>super.listIndexes)().call(this,et(et({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new At(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},At=class extends Ot{constructor(e,t,n,r,s){super(e,t,s),this.vectorBucketName=n,this.indexName=r}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,et(et({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,et(et({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=this;return(()=>super.listVectors)().call(t,et(et({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,et(et({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,et(et({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Dt=class extends gt{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new pt(this.url,this.headers,e,this.fetch)}get vectors(){return new Pt(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new vt(this.url+"/iceberg",this.headers,this.fetch)}};const Lt="2.91.0",Mt=3e4,qt=9e4,Ut={"X-Client-Info":"gotrue-js/".concat(Lt)},zt="X-Supabase-Api-Version",Bt={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Ft=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Wt extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Vt(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Ht extends Wt{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class Kt extends Wt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Gt extends Wt{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class Jt extends Gt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class $t extends Gt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Qt extends Gt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Yt extends Gt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xt extends Gt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Zt extends Gt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class en extends Gt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function tn(e){return Vt(e)&&"AuthRetryableFetchError"===e.name}class nn extends Gt{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class rn extends Gt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),an=" \t\n\r=".split(""),on=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<an.length;t+=1)e[an[t].charCodeAt(0)]=-2;for(let t=0;t<sn.length;t+=1)e[sn[t].charCodeAt(0)]=t;return e})();function ln(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(sn[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(sn[e]),t.queuedBits-=6}}function cn(e,t,n){const r=on[e];if(!(r>-1)){if(-2===r)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function dn(e){const t=[],n=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},a=e=>{!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(let n=1;n<6;n+=1)if(0===(e>>7-n&1)){t.utf8seq=n;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,r,n)};for(let i=0;i<e.length;i+=1)cn(e.charCodeAt(i),s,a);return t.join("")}function un(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function hn(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(n+1)-56320&65535|t),n+=1}un(r,t)}}function mn(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let s=0;s<e.length;s+=1)cn(e.charCodeAt(s),n,r);return new Uint8Array(t)}function pn(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>ln(e,n,r)),ln(null,n,r),t.join("")}const fn=()=>"undefined"!==typeof window&&"undefined"!==typeof document,xn={tested:!1,writable:!1},gn=()=>{if(!fn())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(t){return!1}if(xn.tested)return xn.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),xn.tested=!0,xn.writable=!0}catch(t){xn.tested=!0,xn.writable=!1}return xn.writable};const vn=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},bn=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},yn=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(r){return n}},wn=async(e,t)=>{await e.removeItem(t)};class _n{constructor(){this.promise=new _n.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function jn(e){const t=e.split(".");if(3!==t.length)throw new rn("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Ft.test(t[n]))throw new rn("JWT not in base64url format");return{header:JSON.parse(dn(t[0])),payload:JSON.parse(dn(t[1])),signature:mn(t[2]),raw:{header:t[0],payload:t[1]}}}function Nn(e){return("0"+e.toString(16)).substr(-2)}async function kn(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Sn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,Nn).join("")}();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await bn(e,"".concat(t,"-code-verifier"),s);const a=await kn(r);return[a,r===a?"plain":"s256"]}_n.promiseConstructor=Promise;const Cn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const En=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Tn(e){if(!En.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function On(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function Rn(e){return JSON.parse(JSON.stringify(e))}const Pn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),In=[502,503,504];async function An(e){var t,n;if(!("object"===typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json))throw new en(Pn(e),0);if(In.includes(e.status))throw new en(Pn(e),e.status);let r,s;try{r=await e.json()}catch(i){throw new Kt(Pn(i),i)}const a=function(e){const t=e.headers.get(zt);if(!t)return null;if(!t.match(Cn))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(i){return null}}(e);if(a&&a.getTime()>=Bt.timestamp&&"object"===typeof r&&r&&"string"===typeof r.code?s=r.code:"object"===typeof r&&r&&"string"===typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new nn(Pn(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new Jt}else if("object"===typeof r&&r&&"object"===typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new nn(Pn(r),e.status,r.weak_password.reasons);throw new Ht(Pn(r),e.status||500,s)}async function Dn(e,t,n,r){var s;const a=Object.assign({},null===r||void 0===r?void 0:r.headers);a[zt]||(a[zt]=Bt.name),(null===r||void 0===r?void 0:r.jwt)&&(a.Authorization="Bearer ".concat(r.jwt));const i=null!==(s=null===r||void 0===r?void 0:r.query)&&void 0!==s?s:{};(null===r||void 0===r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,n,r,s,a){const i=((e,t,n,r)=>{const s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))})(t,r,s,a);let o;try{o=await e(n,Object.assign({},i))}catch(l){throw console.error(l),new en(Pn(l),0)}o.ok||await An(o);if(null===r||void 0===r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await An(l)}}(e,t,n+o,{headers:a,noResolveJson:null===r||void 0===r?void 0:r.noResolveJson},{},null===r||void 0===r?void 0:r.body);return(null===r||void 0===r?void 0:r.xform)?null===r||void 0===r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Ln(e){var t;let n=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Mn(e){const t=Ln(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function qn(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Un(e){return{data:e,error:null}}function zn(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:s,verification_type:a}=e,i=D(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:r,redirect_to:s,verification_type:a},user:Object.assign({},i)},error:null}}function Bn(e){return e}const Fn=["global","local","others"];class Wn{constructor(e){let{url:t="",headers:n={},fetch:r}=e;this.url=t,this.headers=n,this.fetch=vn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fn[0];if(Fn.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Fn.join(", ")));try{return await Dn(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Dn(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:qn})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=D(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=null===n||void 0===n?void 0:n.newEmail,delete r.newEmail),await Dn(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:r,headers:this.headers,xform:zn,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Vt(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Dn(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:qn})}catch(t){if(Vt(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,s,a,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Dn(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(s=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==s?s:""},xform:Bn});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(n,"Page")]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Vt(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Tn(e);try{return await Dn(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:qn})}catch(t){if(Vt(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Tn(e);try{return await Dn(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:qn})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Tn(e);try{return await Dn(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:qn})}catch(n){if(Vt(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Tn(e.userId);try{const{data:t,error:n}=await Dn(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(t){if(Vt(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Tn(e.userId),Tn(e.id);try{return{data:await Dn(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Vt(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,r,s,a,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Dn(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(s=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==s?s:""},xform:Bn});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(n,"Page")]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Vt(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await Dn(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients"),{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Vt(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Dn(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Vt(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Dn(this.fetch,"PUT","".concat(this.url,"/admin/oauth/clients/").concat(e),{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(n){if(Vt(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await Dn(this.fetch,"DELETE","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Vt(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Dn(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients/").concat(e,"/regenerate_secret"),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Vt(t))return{data:null,error:t};throw t}}}function Vn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Hn=!!(globalThis&&gn()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Kn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Gn extends Kn{}async function Jn(e,t,n){Hn&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Hn&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw Hn&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Gn('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(Hn)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}Hn&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await n()}finally{Hn&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}function $n(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error('@supabase/auth-js: Address "'.concat(e,'" is invalid.'));return e.toLowerCase()}function Qn(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Yn extends Error{constructor(e){let{message:t,code:n,cause:r,name:s}=e;var a;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(a=null!==s&&void 0!==s?s:r instanceof Error?r.name:void 0)&&void 0!==a?a:"Unknown Error",this.code=n}}class Xn extends Yn{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Zn(e){let{error:t,options:n}=e;var r,s,a;const{publicKey:i}=n;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Yn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("ConstraintError"===t.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Yn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if("conditional"===n.mediation&&"required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new Yn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if("required"===(null===(a=i.authenticatorSelection)||void 0===a?void 0:a.userVerification))return new Yn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if("InvalidStateError"===t.name)return new Yn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if("NotAllowedError"===t.name)return new Yn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("NotSupportedError"===t.name){return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Yn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Yn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t})}if("SecurityError"===t.name){const e=window.location.hostname;if(!ir(e))return new Yn({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(i.rp.id!==e)return new Yn({message:'The RP ID "'.concat(i.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("TypeError"===t.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Yn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if("UnknownError"===t.name)return new Yn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Yn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function er(e){let{error:t,options:n}=e;const{publicKey:r}=n;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Yn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new Yn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!ir(e))return new Yn({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==e)return new Yn({message:'The RP ID "'.concat(r.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new Yn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Yn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}const tr=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function nr(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!==typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"===typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,s=D(e,["challenge","user","excludeCredentials"]),a=mn(t).buffer,i=Object.assign(Object.assign({},n),{id:mn(n.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:a,user:i});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:mn(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function rr(e){if(!e)throw new Error("Credential request options are required");if("undefined"!==typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"===typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=D(e,["challenge","allowCredentials"]),s=mn(t).buffer,a=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){a.allowCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];a.allowCredentials[e]=Object.assign(Object.assign({},t),{id:mn(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}function sr(e){var t;if("toJSON"in e&&"function"===typeof e.toJSON)return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:pn(new Uint8Array(e.response.attestationObject)),clientDataJSON:pn(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function ar(e){var t;if("toJSON"in e&&"function"===typeof e.toJSON)return e.toJSON();const n=e,r=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:pn(new Uint8Array(s.authenticatorData)),clientDataJSON:pn(new Uint8Array(s.clientDataJSON)),signature:pn(new Uint8Array(s.signature)),userHandle:s.userHandle?pn(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function ir(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function or(){var e,t;return!!(fn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"===typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"===typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const lr={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},cr={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function dr(){const e=e=>null!==e&&"object"===typeof e&&!Array.isArray(e),t=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];for(const i of s)if(i)for(const r in i){const s=i[r];if(void 0!==s)if(Array.isArray(s))n[r]=s;else if(t(s))n[r]=s;else if(e(s)){const t=n[r];e(t)?n[r]=dr(t,s):n[r]=dr(s)}else n[r]=s}return n}class ur{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge(e,t){let{factorId:n,webauthn:r,friendlyName:s,signal:a}=e;try{const{data:e,error:i}=await this.client.mfa.challenge({factorId:n,webauthn:r});if(!e)return{data:null,error:i};const o=null!==a&&void 0!==a?a:tr.createNewAbortSignal();if("create"===e.webauthn.type){const{user:t}=e.webauthn.credential_options.publicKey;t.name||(t.name="".concat(t.id,":").concat(s)),t.displayName||(t.displayName=t.name)}switch(e.webauthn.type){case"create":{const r=function(e,t){return dr(lr,e,t||{})}(e.webauthn.credential_options.publicKey,null===t||void 0===t?void 0:t.create),{data:s,error:a}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Xn("Browser returned unexpected credential type",t)}:{data:null,error:new Xn("Empty credential response",t)}}catch(t){return{data:null,error:Zn({error:t,options:e})}}}({publicKey:r,signal:o});return s?{data:{factorId:n,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:s}},error:null}:{data:null,error:a}}case"request":{const r=function(e,t){return dr(cr,e,t||{})}(e.webauthn.credential_options.publicKey,null===t||void 0===t?void 0:t.request),{data:s,error:a}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Xn("Browser returned unexpected credential type",t)}:{data:null,error:new Xn("Empty credential response",t)}}catch(t){return{data:null,error:er({error:t,options:e})}}}(Object.assign(Object.assign({},e.webauthn.credential_options),{publicKey:r,signal:o}));return s?{data:{factorId:n,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:s}},error:null}:{data:null,error:a}}}}catch(i){return Vt(i)?{data:null,error:i}:{data:null,error:new Kt("Unexpected error in challenge",i)}}}async _verify(e){let{challengeId:t,factorId:n,webauthn:r}=e;return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:r})}async _authenticate(e,t){let{factorId:n,webauthn:{rpId:r=("undefined"!==typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!==typeof window?[window.location.origin]:void 0),signal:a}={}}=e;if(!r)return{data:null,error:new Wt("rpId is required for WebAuthn authentication")};try{if(!or())return{data:null,error:new Kt("Browser does not support WebAuthn",null)};const{data:e,error:i}=await this.challenge({factorId:n,webauthn:{rpId:r,rpOrigins:s},signal:a},{request:t});if(!e)return{data:null,error:i};const{webauthn:o}=e;return this._verify({factorId:n,challengeId:e.challengeId,webauthn:{type:o.type,rpId:r,rpOrigins:s,credential_response:o.credential_response}})}catch(i){return Vt(i)?{data:null,error:i}:{data:null,error:new Kt("Unexpected error in authenticate",i)}}}async _register(e,t){let{friendlyName:n,webauthn:{rpId:r=("undefined"!==typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!==typeof window?[window.location.origin]:void 0),signal:a}={}}=e;if(!r)return{data:null,error:new Wt("rpId is required for WebAuthn registration")};try{if(!or())return{data:null,error:new Kt("Browser does not support WebAuthn",null)};const{data:e,error:i}=await this._enroll({friendlyName:n});if(!e)return await this.client.mfa.listFactors().then(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===n&&"unverified"!==e.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null===e||void 0===e?void 0:e.id}):void 0),{data:null,error:i};const{data:o,error:l}=await this._challenge({factorId:e.id,friendlyName:e.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:a},{create:t});return o?this._verify({factorId:e.id,challengeId:o.challengeId,webauthn:{rpId:r,rpOrigins:s,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(i){return Vt(i)?{data:null,error:i}:{data:null,error:new Kt("Unexpected error in register",i)}}}}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!==typeof self&&(self.globalThis=self)}}();const hr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ut,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function mr(e,t,n){return await n()}const pr={};class fr{get jwks(){var e,t;return null!==(t=null===(e=pr[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){pr[this.storageKey]=Object.assign(Object.assign({},pr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=pr[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){pr[this.storageKey]=Object.assign(Object.assign({},pr[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},hr),e);if(this.storageKey=s.storageKey,this.instanceID=null!==(t=fr.nextInstanceID[this.storageKey])&&void 0!==t?t:0,fr.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"===typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&fn()){const e="".concat(this._logPrefix()," Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Wn({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=vn(s.fetch),this.lock=s.lock||mr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&fn()&&(null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===n?void 0:n.locks)?this.lock=Jn:this.lock=mr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ur(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:gn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Vn(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Vn(this.memoryStorage)),fn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return"GoTrueClient@"+"".concat(this.storageKey,":").concat(this.instanceID," (").concat(Lt,") ").concat((new Date).toISOString())}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger(this._logPrefix(),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},n="none";if(fn()&&(t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach((e,n)=>{t[n]=e})}catch(r){}return n.searchParams.forEach((e,n)=>{t[n]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),fn()&&this.detectSessionInUrl&&"none"!==n){const{data:r,error:s}=await this._getSessionFromURL(t,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(e){return Vt(e)&&"AuthImplicitGrantRedirectError"===e.name}(s)){const t=null===(e=s.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:s}}return{error:s}}const{session:a,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",i),await this._saveSession(a),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Vt(t)?this._returnResult({error:t}):this._returnResult({error:new Kt("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const s=await Dn(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(n=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Ln}),{data:a,error:i}=s;if(i||!a)return this._returnResult({data:{user:null,session:null},error:i});const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(s){if(Vt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var t,n,r;try{let s;if("email"in e){const{email:n,password:r,options:a}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Sn(this.storage,this.storageKey)),s=await Dn(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo,body:{email:n,password:r,data:null!==(t=null===a||void 0===a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:o},xform:Ln})}else{if(!("phone"in e))throw new Qt("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:i}=e;s=await Dn(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:a,data:null!==(n=null===i||void 0===i?void 0:i.data)&&void 0!==n?n:{},channel:null!==(r=null===i||void 0===i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:Ln})}}const{data:a,error:i}=s;if(i||!a)return await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),this._returnResult({data:{user:null,session:null},error:i});const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(s){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:r,options:s}=e;t=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:Mn})}else{if(!("phone"in e))throw new Qt("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:s}=e;t=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:Mn})}}const{data:n,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const e=new $t;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(Vt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,r,s;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}}async signInWithEthereum(e){var t,n,r,s,a,i,o,l,c,d,u;let h,m;if("message"in e)h=e.message,m=e.signature;else{const{chain:d,wallet:u,statement:p,options:f}=e;let x;if(fn())if("object"===typeof u)x=u;else{const e=window;if(!("ethereum"in e)||"object"!==typeof e.ethereum||!("request"in e.ethereum)||"function"!==typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");x=e.ethereum}else{if("object"!==typeof u||!(null===f||void 0===f?void 0:f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=u}const g=new URL(null!==(t=null===f||void 0===f?void 0:f.url)&&void 0!==t?t:window.location.href),v=await x.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const b=$n(v[0]);let y=null===(n=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===n?void 0:n.chainId;if(!y){const e=await x.request({method:"eth_chainId"});y=parseInt(e,16)}h=function(e){var t;const{chainId:n,domain:r,expirationTime:s,issuedAt:a=new Date,nonce:i,notBefore:o,requestId:l,resources:c,scheme:d,uri:u,version:h}=e;if(!Number.isInteger(n))throw new Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '.concat(n));if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '.concat(i));if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ".concat(h));if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: ".concat(e.statement));const m=$n(e.address),p=d?"".concat(d,"://").concat(r):r,f=e.statement?"".concat(e.statement,"\n"):"",x="".concat(p," wants you to sign in with your Ethereum account:\n").concat(m,"\n\n").concat(f);let g="URI: ".concat(u,"\nVersion: ").concat(h,"\nChain ID: ").concat(n).concat(i?"\nNonce: ".concat(i):"","\nIssued At: ").concat(a.toISOString());if(s&&(g+="\nExpiration Time: ".concat(s.toISOString())),o&&(g+="\nNot Before: ".concat(o.toISOString())),l&&(g+="\nRequest ID: ".concat(l)),c){let e="\nResources:";for(const t of c){if(!t||"string"!==typeof t)throw new Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '.concat(t));e+="\n- ".concat(t)}g+=e}return"".concat(x,"\n").concat(g)}({domain:g.host,address:b,statement:p,uri:g.href,version:"1",chainId:y,nonce:null===(r=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(a=null===(s=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===s?void 0:s.issuedAt)&&void 0!==a?a:new Date,expirationTime:null===(i=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===i?void 0:i.expirationTime,notBefore:null===(o=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null===f||void 0===f?void 0:f.signInWithEthereum)||void 0===c?void 0:c.resources}),m=await x.request({method:"personal_sign",params:[Qn(h),b]})}try{const{data:t,error:n}=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:m},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:Ln});if(n)throw n;if(!t||!t.session||!t.user){const e=new $t;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(p){if(Vt(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var t,n,r,s,a,i,o,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:f,options:x}=e;let g;if(fn())if("object"===typeof h)g=h;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");g=e.solana}else{if("object"!==typeof h||!(null===x||void 0===x?void 0:x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=h}const v=new URL(null!==(t=null===x||void 0===x?void 0:x.url)&&void 0!==t?t:window.location.href);if("signIn"in g&&g.signIn){const e=await g.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===x||void 0===x?void 0:x.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in g)||"function"!==typeof g.signMessage||!("publicKey"in g)||"object"!==typeof g||!g.publicKey||!("toBase58"in g.publicKey)||"function"!==typeof g.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=["".concat(v.host," wants you to sign in with your Solana account:"),g.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1","URI: ".concat(v.href),"Issued At: ".concat(null!==(r=null===(n=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==r?r:(new Date).toISOString()),...(null===(s=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===s?void 0:s.notBefore)?["Not Before: ".concat(x.signInWithSolana.notBefore)]:[],...(null===(a=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===a?void 0:a.expirationTime)?["Expiration Time: ".concat(x.signInWithSolana.expirationTime)]:[],...(null===(i=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===i?void 0:i.chainId)?["Chain ID: ".concat(x.signInWithSolana.chainId)]:[],...(null===(o=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===o?void 0:o.nonce)?["Nonce: ".concat(x.signInWithSolana.nonce)]:[],...(null===(l=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: ".concat(x.signInWithSolana.requestId)]:[],...(null===(d=null===(c=null===x||void 0===x?void 0:x.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...x.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await g.signMessage((new TextEncoder).encode(m),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:n}=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:pn(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Ln});if(n)throw n;if(!t||!t.session||!t.user){const e=new $t;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(f){if(Vt(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async _exchangeCodeForSession(e){const t=await yn(this.storage,"".concat(this.storageKey,"-code-verifier")),[n,r]=(null!==t&&void 0!==t?t:"").split("/");try{if(!n&&"pkce"===this.flowType)throw new Zt;const{data:t,error:s}=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Ln});if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),s)throw s;if(!t||!t.session||!t.user){const e=new $t;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),setTimeout(async()=>{await this._notifyAllSubscribers("SIGNED_IN",t.session)},0)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!==r&&void 0!==r?r:null}),error:s})}catch(s){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:s,nonce:a}=e,i=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:n,id_token:r,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:Ln}),{data:o,error:l}=i;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o||!o.session||!o.user){const e=new $t;return this._returnResult({data:{user:null,session:null},error:e})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:o,error:l})}catch(t){if(Vt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,r,s,a;try{if("email"in e){const{email:r,options:s}=e;let a=null,i=null;"pkce"===this.flowType&&([a,i]=await Sn(this.storage,this.storageKey));const{error:o}=await Dn(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:r,data:null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:{},create_user:null===(n=null===s||void 0===s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},code_challenge:a,code_challenge_method:i},redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){const{phone:t,options:n}=e,{data:i,error:o}=await Dn(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(r=null===n||void 0===n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(s=null===n||void 0===n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},channel:null!==(a=null===n||void 0===n?void 0:n.channel)&&void 0!==a?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null===i||void 0===i?void 0:i.message_id},error:o})}throw new Qt("You must provide either an email or phone number.")}catch(i){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(e){var t,n;try{let r,s;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,s=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:a,error:i}=await Dn(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:r,xform:Ln});if(i)throw i;if(!a){throw new Error("An error occurred on token verification.")}const o=a.session,l=a.user;return(null===o||void 0===o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(r){if(Vt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,n,r,s,a;try{let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Sn(this.storage,this.storageKey));const l=await Dn(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Un});return(null===(s=l.data)||void 0===s?void 0:s.url)&&fn()&&!(null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(i){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Jt;const{error:r}=await Dn(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(Vt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:n,type:r,options:s}=e,{error:a}=await Dn(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}if("phone"in e){const{phone:n,type:r,options:s}=e,{data:a,error:i}=await Dn(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null===a||void 0===a?void 0:a.message_id},error:i})}throw new Qt("You must provide either an email or phone number and a type")}catch(t){if(Vt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(e){}})()),n}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await yn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&1e3*e.expires_at-Date.now()<qt;if(this._debug("#__loadSession()","session has".concat(n?"":" not"," expired"),"expires_at",e.expires_at),!n){if(this.userStorage){const t=await yn(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=On()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,n,r)=>{if("__isInsecureUserWarningProxy"===n)return!0;if("symbol"===typeof n){const t=n.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,n,r)}return t.value||"string"!==typeof n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,n,r)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await Dn(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:qn}):await this._useSession(async e=>{var t,n,r;const{data:s,error:a}=e;if(a)throw a;return(null===(t=s.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Dn(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(r=null===(n=s.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,xform:qn}):{data:{user:null},error:new Jt}})}catch(t){if(Vt(t))return function(e){return Vt(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await wn(this.storage,"".concat(this.storageKey,"-code-verifier"))),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async n=>{const{data:r,error:s}=n;if(s)throw s;if(!r.session)throw new Jt;const a=r.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=await Sn(this.storage,this.storageKey));const{data:l,error:c}=await Dn(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:a.access_token,xform:qn});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(n){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Jt;const t=Date.now()/1e3;let n=t,r=!0,s=null;const{payload:a}=jn(e.access_token);if(a.exp&&(n=a.exp,r=n<=t),r){const{data:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!t)return{data:{user:null,session:null},error:null};s=t}else{const{data:r,error:a}=await this._getUser(e.access_token);if(a)throw a;s={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(t){if(Vt(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:r,error:s}=t;if(s)throw s;e=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new Jt;const{data:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Vt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!fn())throw new Yt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Yt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Xt("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Yt("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Xt("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:s,refresh_token:a,expires_in:i,expires_at:o,token_type:l}=e;if(!s||!i||!a||!l)throw new Yt("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=Mt&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(h,"s, should have been closer to ").concat(d,"s"));const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:f}=await this._getUser(s);if(f)throw f;const x={provider_token:n,provider_refresh_token:r,access_token:s,expires_in:d,expires_at:u,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(n){if(Vt(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return"function"===typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await yn(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({error:s});const a=null===(n=r.session)||void 0===n?void 0:n.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Vt(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await wn(this.storage,"".concat(this.storageKey,"-code-verifier"))),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:r},error:s}=t;if(s)throw s;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(s){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null;"pkce"===this.flowType&&([n,r]=await Sn(this.storage,this.storageKey,!0));try{return await Dn(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:r}=await this._useSession(async t=>{var n,r,s,a,i;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await Dn(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==i?i:void 0})});if(r)throw r;return fn()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===n||void 0===n?void 0:n.url),this._returnResult({data:{provider:e.provider,url:null===n||void 0===n?void 0:n.url},error:null})}catch(n){if(Vt(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:r,data:{session:s}}=t;if(r)throw r;const{options:a,provider:i,token:o,access_token:l,nonce:c}=e,d=await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,jwt:null!==(n=null===s||void 0===s?void 0:s.access_token)&&void 0!==n?n:void 0,body:{provider:i,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:Ln}),{data:u,error:h}=d;return h?this._returnResult({data:{user:null,session:null},error:h}):u&&u.session&&u.user?(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("USER_UPDATED",u.session)),this._returnResult({data:u,error:h})):this._returnResult({data:{user:null,session:null},error:new $t})}catch(r){if(await wn(this.storage,"".concat(this.storageKey,"-code-verifier")),Vt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:s,error:a}=t;if(a)throw a;return await Dn(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(r=null===(n=s.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const s=Date.now();return await(n=async n=>(n>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await Dn(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:Ln})),r=(e,t)=>{const n=200*Math.pow(2,e);return t&&tn(t)&&Date.now()+n-s<Mt},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await n(a);if(!r(a,null,t))return void e(t)}catch(s){if(!r(a,s))return void t(s)}})()}))}catch(s){if(this._debug(t,"error",s),Vt(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}var n,r}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),fn()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await yn(this.storage,this.storageKey);if(s&&this.userStorage){let t=await yn(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:s.user},await bn(this.userStorage,this.storageKey+"-user",t)),s.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:On()}else if(s&&!s.user&&!s.user){const e=await yn(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(s.user=e.user,await wn(this.storage,this.storageKey+"-user"),await bn(this.storage,this.storageKey,s)):s.user=On()}if(this._debug(n,"session from storage",s),!this._isValidSession(s))return this._debug(n,"session is not valid"),void(null!==s&&await this._removeSession());const a=1e3*(null!==(t=s.expires_at)&&void 0!==t?t:1/0)-Date.now()<qt;if(this._debug(n,"session has".concat(a?"":" not"," expired with margin of ").concat(qt,"s")),a){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),tn(e)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(s.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(n,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(n,"error",s),void console.error(s)}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Jt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(r,"begin");try{this.refreshingDeferred=new _n;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new Jt;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(s){if(this._debug(r,"error",s),Vt(s)){const e={data:null,error:s};return tn(s)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r="#_notifyAllSubscribers(".concat(e,")");this._debug(r,"begin",t,"broadcast = ".concat(n));try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],s=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(e,t)}catch(s){r.push(s)}});if(await Promise.all(s),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await wn(this.storage,"".concat(this.storageKey,"-code-verifier"));const t=Object.assign({},e),n=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!n&&t.user&&await bn(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=Rn(e);await bn(this.storage,this.storageKey,r)}else{const e=Rn(t);await bn(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await wn(this.storage,this.storageKey),await wn(this.storage,this.storageKey+"-code-verifier"),await wn(this.storage,this.storageKey+"-user"),this.userStorage&&await wn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&fn()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Mt);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"===typeof t&&"function"===typeof t.unref?t.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:n}}=e;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-t)/Mt);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(r," ticks, a tick lasts ").concat(Mt,"ms, refresh threshold is ").concat(3," ticks")),r<=3&&await this._callRefreshToken(n.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Kn))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fn()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=["provider=".concat(encodeURIComponent(t))];if((null===n||void 0===n?void 0:n.redirectTo)&&r.push("redirect_to=".concat(encodeURIComponent(n.redirectTo))),(null===n||void 0===n?void 0:n.scopes)&&r.push("scopes=".concat(encodeURIComponent(n.scopes))),"pkce"===this.flowType){const[e,t]=await Sn(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});r.push(n.toString())}if(null===n||void 0===n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);r.push(e.toString())}return(null===n||void 0===n?void 0:n.skipBrowserRedirect)&&r.push("skip_http_redirect=".concat(n.skipBrowserRedirect)),"".concat(e,"?").concat(r.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;return s?this._returnResult({data:null,error:s}):await Dn(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:s,error:a}=t;if(a)return this._returnResult({data:null,error:a});const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await Dn(this.fetch,"POST","".concat(this.url,"/factors"),{body:i,headers:this.headers,jwt:null===(n=null===s||void 0===s?void 0:s.session)||void 0===n?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(r=null===o||void 0===o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code="data:image/svg+xml;utf-8,".concat(o.totp.qr_code)),this._returnResult({data:o,error:null}))})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({data:null,error:s});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?sr(e.webauthn.credential_response):ar(e.webauthn.credential_response)})}:{code:e.code}),{data:i,error:o}=await Dn(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:a,headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});return o?this._returnResult({data:null,error:o}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:o}))})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({data:null,error:s});const a=await Dn(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:e,headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});if(a.error)return a;const{data:i}=a;if("webauthn"!==i.type)return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:nr(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:rr(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const s of null!==(e=null===t||void 0===t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(s),"verified"===s.status&&r[s.factor_type].push(s);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=jn(n.access_token);let a=null;s.aal&&(a=s.aal);let i=a;(null!==(t=null===(e=n.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(i="aal2");return{data:{currentLevel:a,nextLevel:i,currentAuthenticationMethods:s.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await Dn(this.fetch,"GET","".concat(this.url,"/oauth/authorizations/").concat(e),{headers:this.headers,jwt:n.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Jt})})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!r)return this._returnResult({data:null,error:new Jt});const a=await Dn(this.fetch,"POST","".concat(this.url,"/oauth/authorizations/").concat(e,"/consent"),{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return a.data&&a.data.redirect_url&&fn()&&!(null===t||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!r)return this._returnResult({data:null,error:new Jt});const a=await Dn(this.fetch,"POST","".concat(this.url,"/oauth/authorizations/").concat(e,"/consent"),{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return a.data&&a.data.redirect_url&&fn()&&!(null===t||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await Dn(this.fetch,"GET","".concat(this.url,"/user/oauth/grants"),{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Jt})})}catch(e){if(Vt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?(await Dn(this.fetch,"DELETE","".concat(this.url,"/user/oauth/grants"),{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Jt})})}catch(t){if(Vt(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const n=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>n)return t;const{data:r,error:s}=await Dn(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(s)throw s;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=n,t=r.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=e;if(!n){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});n=e.session.access_token}const{header:r,payload:s,signature:a,raw:{header:i,payload:o}}=jn(n);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:s,header:r,signature:a},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,a,function(e){const t=[];return hn(e,e=>t.push(e)),new Uint8Array(t)}("".concat(i,".").concat(o))))throw new rn("Invalid JWT signature");return{data:{claims:s,header:r,signature:a},error:null}}catch(n){if(Vt(n))return this._returnResult({data:null,error:n});throw n}}}fr.nextInstanceID={};const xr=fr;let gr="";gr="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const vr={headers:{"X-Client-Info":"supabase-js-".concat(gr,"/").concat("2.91.0")}},br={schema:"public"},yr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wr={};function _r(e){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jr(e){var t=function(e,t){if("object"!=_r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_r(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_r(t)?t:t+""}function Nr(e,t,n){return(t=jr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(n),!0).forEach(function(t){Nr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const Cr=(e,t,n)=>{const r=(e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)})(n),s=Headers;return async(n,a)=>{var i;const o=null!==(i=await t())&&void 0!==i?i:e;let l=new s(null===a||void 0===a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization","Bearer ".concat(o)),r(n,Sr(Sr({},a),{},{headers:l}))}};var Er=class extends xr{constructor(e){super(e)}},Tr=class{constructor(e,t,n){var r,s;this.supabaseUrl=e,this.supabaseKey=t;const a=function(e){const t=null===e||void 0===e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((n=t).endsWith("/")?n:n+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var n}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const i="sb-".concat(a.hostname.split(".")[0],"-auth-token"),o=function(e,t){var n,r;const{db:s,auth:a,realtime:i,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Sr(Sr({},l),s),auth:Sr(Sr({},c),a),realtime:Sr(Sr({},d),i),storage:{},global:Sr(Sr(Sr({},u),o),{},{headers:Sr(Sr({},null!==(n=null===u||void 0===u?void 0:u.headers)&&void 0!==n?n:{}),null!==(r=null===o||void 0===o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!==n&&void 0!==n?n:{},{db:br,realtime:wr,auth:Sr(Sr({},yr),{},{storageKey:i}),global:vr});var l;(this.storageKey=null!==(r=o.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(s=o.global.headers)&&void 0!==s?s:{},o.accessToken)?(this.accessToken=o.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(l=o.auth)&&void 0!==l?l:{},this.headers,o.global.fetch);this.fetch=Cr(t,this._getAccessToken.bind(this),o.global.fetch),this.realtime=this._initRealtimeClient(Sr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},o.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new $(new URL("rest/v1",a).href,{headers:this.headers,schema:o.db.schema,fetch:this.fetch}),this.storage=new Dt(this.storageUrl.href,this.headers,this.fetch,null===n||void 0===n?void 0:n.storage),o.accessToken||this._listenForAuthEvents()}get functions(){return new F(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{head:!1,get:!1,count:void 0};return this.rest.rpc(e,t,n)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,n=this;if(n.accessToken)return await n.accessToken();const{data:r}=await n.auth.getSession();return null!==(e=null===(t=r.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:n.supabaseKey}_initSupabaseAuthClient(e,t,n){let{autoRefreshToken:r,persistSession:s,detectSessionInUrl:a,storage:i,userStorage:o,storageKey:l,flowType:c,lock:d,debug:u,throwOnError:h}=e;const m={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new Er({url:this.authUrl.href,headers:Sr(Sr({},m),t),storageKey:l,autoRefreshToken:r,persistSession:s,detectSessionInUrl:a,storage:i,userStorage:o,flowType:c,lock:d,debug:u,throwOnError:h,fetch:n,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Re(this.realtimeUrl.href,Sr(Sr({},e),{},{params:Sr(Sr({},{apikey:this.supabaseKey}),null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=n,this.realtime.setAuth(n))}};(function(){if("undefined"!==typeof window)return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(void 0===t||null===t)return!1;const n=t.match(/^v(\d+)\./);return!!n&&parseInt(n[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Or=((e,t,n)=>new Tr(e,t,n))("https://swsrtxzzwqykwcbbdann.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3c3J0eHp6d3F5a3djYmJkYW5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODk4NTMsImV4cCI6MjA4MzU2NTg1M30.tIWQg7hjphXJImqq9ZzNGFQyuDOdhN5GpGSmaiQlxSw");const Rr=function(){var e;const[t,n]=(0,r.useState)({visits:0,reservations:0,totalRooms:0,availableRooms:0,occupiedRooms:0,guestBalance:0,cashboxBalance:0,totalRevenue:0,todayRevenue:0,todayCheckins:0,todayCheckouts:0,currentVisits:0,pendingPayments:0,occupancyRate:0,lastTransaction:null}),[s,i]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{!async function(){i(!0);try{const{count:e}=await Or.from("guests").select("*",{count:"exact",head:!0}),{count:t}=await Or.from("reservations").select("*",{count:"exact",head:!0}),{data:r,count:s}=await Or.from("rooms").select("*",{count:"exact"}),a=r?r.filter(e=>"\u0645\u062a\u0627\u062d\u0629"===e.status).length:0,i=r?r.filter(e=>"\u0645\u0634\u063a\u0648\u0644\u0629"===e.status).length:0,{data:o}=await Or.from("financial_transactions").select("amount,transaction_type,created_at"),l=o?o.filter(e=>"\u062f\u0641\u0639"===e.transaction_type).reduce((e,t)=>e+Number(t.amount),0):0,c=o?o.reduce((e,t)=>e+Number(t.amount),0):0,d=c,u=(new Date).toISOString().slice(0,10),h=o?o.filter(e=>e.created_at&&e.created_at.startsWith(u)).reduce((e,t)=>e+Number(t.amount),0):0,{data:m}=await Or.from("reservations").select("check_in_date,check_out_date,status"),p=m?m.filter(e=>e.check_in_date===u).length:0,f=m?m.filter(e=>e.check_out_date===u).length:0,x=m?m.filter(e=>"\u0646\u0634\u0637\u0629"===e.status).length:0,g=o?o.filter(e=>"\u0645\u0639\u0644\u0642\u0629"===e.transaction_type).length:0,v=s&&i?Math.round(i/s*100):0,{data:b}=await Or.from("financial_transactions").select("*").order("created_at",{ascending:!1}).limit(1);n({visits:e||0,reservations:t||0,totalRooms:s||0,availableRooms:a,occupiedRooms:i,guestBalance:l,cashboxBalance:c,totalRevenue:d,todayRevenue:h,todayCheckins:p,todayCheckouts:f,currentVisits:x,pendingPayments:g,occupancyRate:v,lastTransaction:b&&b.length>0?b[0]:null})}catch(e){console.error("fetchStats error",e)}finally{i(!1)}}()},[]),s?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen text-xl",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a..."}):(0,a.jsxs)("div",{className:"flex flex-col gap-6 p-6 bg-gray-50 min-h-screen",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"bg-yellow-400 text-white px-4 py-2 rounded",children:"\u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629"}),(0,a.jsx)("button",{className:"bg-white border rounded p-2",children:(0,a.jsx)("span",{role:"img","aria-label":"\u062a\u0646\u0628\u064a\u0647",children:"\ud83d\udd14"})})]}),(0,a.jsx)("div",{className:"text-gray-600",children:(new Date).toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645 \u0627\u0644\u0630\u0643\u064a\u0629"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 bg-gradient-to-l from-blue-400 to-purple-400 rounded-lg p-4 text-white",children:[(0,a.jsxs)("a",{href:"/checkin",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udd11"}),(0,a.jsx)("span",{children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644"})]}),(0,a.jsxs)("a",{href:"/reservation",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"}),(0,a.jsx)("span",{children:"\u062d\u062c\u0632 \u062c\u062f\u064a\u062f"})]}),(0,a.jsxs)("a",{href:"/guests",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udc64"}),(0,a.jsx)("span",{children:"\u0625\u0636\u0627\u0641\u0629 \u0646\u0632\u064a\u0644"})]}),(0,a.jsxs)("a",{href:"/rooms",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83c\udfe8"}),(0,a.jsx)("span",{children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udc65"}),(0,a.jsx)("div",{className:"text-lg font-bold",children:t.visits}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"}),(0,a.jsx)("div",{className:"text-lg font-bold",children:t.reservations}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83c\udfe2"}),(0,a.jsx)("div",{className:"text-lg font-bold",children:t.totalRooms}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,a.jsx)("span",{className:"text-2xl text-green-500",children:"\u2705"}),(0,a.jsx)("div",{className:"text-lg font-bold",children:t.availableRooms}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u062a\u0627\u062d\u0629"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,a.jsx)("span",{className:"text-2xl text-red-500",children:"\u26d4"}),(0,a.jsx)("div",{className:"text-lg font-bold",children:t.occupiedRooms}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u0634\u063a\u0648\u0644\u0629"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-yellow-100 rounded-lg p-4 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-yellow-700",children:[t.guestBalance," \u062c\u0646\u064a\u0647"]}),(0,a.jsx)("div",{className:"text-gray-600",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),(0,a.jsxs)("div",{className:"bg-yellow-200 rounded-lg p-4 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-yellow-800",children:[t.cashboxBalance," \u062c\u0646\u064a\u0647"]}),(0,a.jsx)("div",{className:"text-gray-600",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u062e\u0632\u0646\u0629"})]}),(0,a.jsxs)("div",{className:"bg-blue-100 rounded-lg p-4 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-700",children:[t.totalRevenue," \u062c\u0646\u064a\u0647"]}),(0,a.jsx)("div",{className:"text-gray-600",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"})]}),(0,a.jsxs)("div",{className:"bg-green-100 rounded-lg p-4 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-green-700",children:[t.todayRevenue," \u062c\u0646\u064a\u0647"]}),(0,a.jsx)("div",{className:"text-gray-600",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u064a\u0648\u0645"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"font-bold mb-2",children:"\u062d\u0631\u0643\u0629 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{children:t.todayCheckins})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"\u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{children:t.todayCheckouts})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"\u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,a.jsx)("span",{children:t.currentVisits})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"\u0645\u062f\u0641\u0648\u0639\u0627\u062a \u0645\u0639\u0644\u0642\u0629"}),(0,a.jsx)("span",{children:t.pendingPayments})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"font-bold mb-2",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0625\u0634\u063a\u0627\u0644"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded h-3",children:(0,a.jsx)("div",{className:"bg-blue-500 h-3 rounded",style:{width:"".concat(t.occupancyRate,"%")}})}),(0,a.jsxs)("span",{className:"text-sm",children:[t.occupancyRate,"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["\u0645\u062a\u0627\u062d\u0629: ",t.availableRooms]}),(0,a.jsxs)("span",{children:["\u0645\u0634\u063a\u0648\u0644\u0629: ",t.occupiedRooms]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,a.jsx)("div",{className:"font-bold mb-2",children:"\u0622\u062e\u0631 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0627\u0644\u0645\u0627\u0644\u064a\u0629"}),t.lastTransaction?(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{children:[t.lastTransaction.id," - ",t.lastTransaction.description]}),(0,a.jsxs)("span",{className:"text-green-700 font-bold",children:["+",t.lastTransaction.amount," \u062c\u0646\u064a\u0647"]}),(0,a.jsx)("span",{className:"text-gray-500 text-sm",children:null===(e=t.lastTransaction.created_at)||void 0===e?void 0:e.slice(0,10)})]}):(0,a.jsx)("div",{className:"text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0645\u0627\u0644\u064a\u0629"})]})]})};function Pr(e){let{onClose:t,onDone:n}=e;const s=(0,r.useContext)(la),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)("cash"),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(null),[p,f]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[v,b]=(0,r.useState)(""),[y,w]=(0,r.useState)(""),[_,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{const[{data:e},{data:t}]=await Promise.all([Or.from("accounting_categories").select("id,name,type").eq("type","expense").eq("active",!0),Or.from("bank_accounts").select("id,bank_name,account_name,active").eq("active",!0)]);f(e||[]),g(t||[]);const n=(e||[]).find(e=>"\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0623\u062e\u0631\u0649"===e.name);n&&m(n.id)}catch(e){console.error("load expense lookups error",e)}})()},[]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-md rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-rose-50 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-rose-900",children:"\u062a\u0633\u062c\u064a\u0644 \u0645\u0635\u0631\u0648\u0641 \u062c\u062f\u064a\u062f"}),(0,a.jsx)("div",{className:"text-xs text-rose-700",children:"\u0633\u062c\u0644 \u0623\u064a \u0645\u0635\u0631\u0648\u0641 \u062a\u0634\u063a\u064a\u0644\u064a \u0644\u0644\u0641\u0646\u062f\u0642"})]}),(0,a.jsx)("button",{type:"button",className:"text-sm text-gray-500",onClick:t,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0641\u0626\u0629"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:h||"",onChange:e=>m(e.target.value||null),children:[(0,a.jsx)("option",{value:"",children:"\u0645\u0635\u0631\u0648\u0641 \u0639\u0627\u0645"}),p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("input",{type:"number",min:"0",className:"border rounded px-3 py-2 text-sm",value:i,onChange:e=>o(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:l,onChange:e=>c(e.target.value),children:[(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"bank",children:"\u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629"}),(0,a.jsx)("option",{value:"other",children:"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629"})]})]}),"bank"===l&&(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:v,onChange:e=>b(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u062d\u0633\u0627\u0628\u064b\u0627"}),x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.bank_name," - ",e.account_name]},e.id))]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,a.jsx)("textarea",{rows:3,className:"border rounded px-3 py-2 text-sm resize-none",value:d,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0645\u0648\u0631\u062f (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:y,onChange:e=>w(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-2 border rounded text-sm",onClick:t,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded text-sm text-white bg-rose-600 hover:bg-rose-700 disabled:opacity-60",onClick:async()=>{const e=Number(i||0);if(!e||e<=0)alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a\u064b\u0627 \u0635\u0627\u0644\u062d\u064b\u0627");else if("bank"!==l||v){j(!0);try{let r=null;try{if(s&&s.id){const e=(new Date).toISOString().slice(0,10),{data:t}=await Or.from("reception_shifts").select("id,status,shift_date").eq("staff_user_id",s.id).eq("shift_date",e).eq("status","open").order("opened_at",{ascending:!1}).limit(1);t&&t.length>0&&(r=t[0].id)}}catch(t){}const a=[d,y].filter(Boolean).join(" \u2014 "),i={tx_date:(new Date).toISOString().slice(0,10),direction:"expense",category_id:h||null,amount:e,payment_method:l,bank_account_id:"bank"===l?v:null,source_type:"manual",reservation_id:null,description:a||"\u0645\u0635\u0631\u0648\u0641 \u064a\u062f\u0648\u064a",status:"pending",reception_shift_id:r};s&&s.id&&(i.created_by=s.id);const{error:o}=await Or.from("accounting_transactions").insert(i);if(o)throw o;n&&n()}catch(r){console.error("save expense error",r),alert("\u062a\u0639\u0630\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0645\u0635\u0631\u0648\u0641: "+(r.message||r))}finally{j(!1)}}else alert("\u0627\u062e\u062a\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643 \u0644\u0647\u0630\u0647 \u0627\u0644\u0639\u0645\u0644\u064a\u0629")},disabled:_,children:_?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0645\u0635\u0631\u0648\u0641"})]})]})})}function Ir(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}const Ar=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Dr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var Lr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Mr=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],qr=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:s=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:o="",children:l,iconNode:c}=e,d=Ir(e,Mr);return(0,r.createElement)("svg",Le(Le(Le({ref:t},Lr),{},{width:s,height:s,stroke:n,strokeWidth:i?24*Number(a)/Number(s):a,className:Dr("lucide",o)},!l&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"}),d),[...c.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(l)?l:[l]])}),Ur=["className"],zr=(e,t)=>{const n=(0,r.forwardRef)((n,s)=>{let{className:a}=n,i=Ir(n,Ur);return(0,r.createElement)(qr,Le({ref:s,iconNode:t,className:Dr("lucide-".concat((o=Ar(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),a)},i));var o});return n.displayName=Ar(e),n},Br=zr("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Fr=zr("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Wr=zr("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Vr=zr("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),Hr=zr("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]),Kr=zr("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Gr=zr("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Jr=zr("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),$r=zr("badge-dollar-sign",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]),Qr=zr("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]),Yr=zr("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);function Xr(){const[e,t]=(0,r.useState)(!1),[n,s]=(0,r.useState)(null),i=(0,r.useRef)(),o=(0,r.useContext)(la),[l,c]=(0,r.useState)(!0),[d]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[u,h]=(0,r.useState)([]),[m,p]=(0,r.useState)([]),[f,x]=(0,r.useState)(""),[g,v]=(0,r.useState)([]),[b,y]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[j,N]=(0,r.useState)("manager"),[k,S]=(0,r.useState)(0),[C,E]=(0,r.useState)(null),[T,O]=(0,r.useState)([]),[R,P]=(0,r.useState)([]),[I,A]=(0,r.useState)(!1),[D,L]=(0,r.useState)([]),[M,q]=(0,r.useState)(!1),[U,z]=(0,r.useState)(0),[B,F]=(0,r.useState)(null),[W,V]=(0,r.useState)({cashIncome:0,cashExpense:0,net:0}),[H,K]=(0,r.useState)(0),[G,J]=(0,r.useState)({received:0,delivered:0,net:0}),[$,Q]=(0,r.useState)(!1),Y=e=>{let{icon:t,label:n,value:r,color:s}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-white rounded-xl shadow p-4 transition hover:scale-105 border-t-4 ".concat(s),children:[(0,a.jsx)("div",{className:"bg-gray-100 rounded-full p-2",children:t}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:r}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:n})]})]})},X=e=>{let{icon:t,label:n,onClick:r,disabled:s,tooltip:i}=e;return(0,a.jsxs)("button",{className:"flex flex-col items-center justify-center gap-1 bg-gradient-to-tr from-blue-100 to-blue-50 hover:from-blue-200 hover:to-blue-100 rounded-lg p-3 shadow transition disabled:opacity-50 relative",onClick:r,disabled:s,title:i,type:"button",children:[(0,a.jsx)("span",{className:"text-blue-600",children:t}),(0,a.jsx)("span",{className:"text-xs font-medium",children:n}),s&&(0,a.jsx)("span",{className:"absolute -top-2 -left-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full shadow",children:"\u0645\u063a\u0644\u0642"})]})},Z=(0,r.useCallback)(async e=>{const t=e||B;if(t&&null!==o&&void 0!==o&&o.id){try{let e=Or.from("accounting_transactions").select("direction,amount");e=t.id?e.eq("reception_shift_id",t.id):e.eq("tx_date",t.shift_date).eq("created_by",o.id);const{data:n,error:r}=await e;if(r)throw r;let s=0,a=0;(n||[]).forEach(e=>{const t=Number(e.amount||0);t&&("income"===e.direction?s+=t:a+=t)}),V({cashIncome:s,cashExpense:a,net:s-a})}catch(n){console.error("updateShiftStats error",n)}try{if(t&&t.id){const{data:e}=await Or.from("reception_shift_handovers").select("amount").eq("from_shift_id",t.id),n=(e||[]).reduce((e,t)=>e+Number(t.amount||0),0);K(n)}else K(0)}catch(n){console.error("fetch deliveredThisShift error",n),K(0)}}else V({cashIncome:0,cashExpense:0,net:0})},[B,o]),ee=(0,r.useCallback)(async()=>{if(null!==o&&void 0!==o&&o.id)try{const e=(new Date).toISOString().slice(0,10),{data:t}=await Or.from("reception_shifts").select("id").eq("staff_user_id",o.id).eq("shift_date",e),n=(t||[]).map(e=>e.id).filter(Boolean);let r=0;if(n.length>0){const{data:e}=await Or.from("reception_shift_handovers").select("amount").in("from_shift_id",n);r=(e||[]).reduce((e,t)=>e+Number(t.amount||0),0)}let s=0;if(n.length>0){const{data:e}=await Or.from("reception_shift_handovers").select("amount").in("to_shift_id",n);s+=(e||[]).reduce((e,t)=>e+Number(t.amount||0),0)}const{data:a}=await Or.from("reception_shift_handovers").select("amount").eq("to_staff_user_id",o.id).neq("status","pending");s+=(a||[]).reduce((e,t)=>e+Number(t.amount||0),0),J({received:s,delivered:r,net:s-r})}catch(e){console.error("fetchDailySummary error",e),J({received:0,delivered:0,net:0})}},[o]);(0,r.useEffect)(()=>{!async function(){c(!0);try{const{data:e}=await Or.from("reservations_overview").select("*").or("check_in_date.eq.".concat(d,",check_out_date.eq.").concat(d,",is_current.eq.true"));h(e||[])}catch(e){console.error(e)}finally{c(!1)}}();(async()=>{try{const e=(new Date).toISOString().slice(0,10),{data:t}=await Or.from("reception_shifts").select("id,status,shift_date,staff_user_id,opened_at,closed_at,opening_cash,closing_cash,opening_note,closing_note").eq("staff_user_id",null===o||void 0===o?void 0:o.id).eq("shift_date",e).in("status",["open","closed"]).order("opened_at",{ascending:!1}).limit(1),n=t&&t.length>0?t[0]:null;F(n),Q(!n||"open"!==n.status),n&&Z(n)}catch(e){console.error("fetchCurrentShift error",e)}})()},[d,null===o||void 0===o?void 0:o.id,Z]),(0,r.useEffect)(()=>{const e=()=>Z();return window.addEventListener("accounting-tx-updated",e),()=>{try{window.removeEventListener("accounting-tx-updated",e)}catch(t){}}},[Z]),(0,r.useEffect)(()=>{ee()},[ee,null===B||void 0===B?void 0:B.id]);const te=(0,r.useMemo)(()=>{try{return(new Date).toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}catch(e){return""}},[]),ne=(0,r.useMemo)(()=>{const e=f.trim().toLowerCase();return e?u.filter(t=>(t.guest_name||"").toLowerCase().includes(e)||(t.guest_phone||"").toLowerCase().includes(e)||String(t.room_label||t.room_id||"").toLowerCase().includes(e)):u},[u,f]),re=(0,r.useMemo)(()=>ne.filter(e=>e.check_in_date===d&&("pending"===e.status||"confirmed"===e.status)),[ne,d]),se=(0,r.useMemo)(()=>ne.filter(e=>e.check_out_date===d&&"checked_in"===e.status),[ne,d]),ae=(0,r.useMemo)(()=>ne.filter(e=>e.is_current&&"checked_in"===e.status),[ne]),ie=(0,r.useMemo)(()=>(m||[]).filter(e=>!e.is_past),[m]),oe=e=>{const t={pending:{text:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631",cls:"bg-yellow-100 text-yellow-800"},confirmed:{text:"\u0645\u0624\u0643\u062f",cls:"bg-emerald-100 text-emerald-800"},checked_in:{text:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644",cls:"bg-blue-100 text-blue-800"},checked_out:{text:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c",cls:"bg-gray-100 text-gray-800"},cancelled:{text:"\u0645\u0644\u063a\u064a",cls:"bg-red-100 text-red-800"},no_show:{text:"\u0644\u0645 \u064a\u062d\u0636\u0631",cls:"bg-orange-100 text-orange-800"}}[e]||{text:e||"-",cls:"bg-slate-100 text-slate-700"};return(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-[11px] font-medium ".concat(t.cls),children:t.text})};if(l)return(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",dir:"rtl",children:[(0,a.jsx)(Br,{className:"animate-spin w-6 h-6 text-blue-400 mx-2"}),(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0644\u0648\u062d\u0629 \u062a\u062d\u0643\u0645 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644..."})]});const le="open"===(null===B||void 0===B?void 0:B.status);return(0,a.jsxs)("div",{className:"flex flex-col gap-8 p-6 bg-gray-50 min-h-screen",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(Fr,{className:"text-blue-500"}),(0,a.jsx)("span",{className:"text-xl font-bold text-gray-700",children:"\u0644\u0648\u062d\u0629 \u062a\u062d\u0643\u0645 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644"}),(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded bg-blue-100 text-blue-700 text-xs",children:te})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{className:"bg-yellow-400 text-white px-4 py-2 rounded shadow hover:bg-yellow-500 transition",title:"\u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629",children:[(0,a.jsx)(Wr,{className:"inline w-4 h-4 mr-1"})," \u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629"]}),(0,a.jsx)("button",{className:"bg-white border rounded p-2 shadow hover:bg-gray-100 transition",title:"\u062a\u0646\u0628\u064a\u0647\u0627\u062a",children:(0,a.jsx)(Vr,{className:"w-5 h-5 text-blue-400"})}),"manager"===(null===o||void 0===o?void 0:o.role)&&(0,a.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-700 transition",title:"\u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645",onClick:async()=>{const e=(new Date).toISOString().slice(0,10);if(window.confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645\u061f"))try{const{error:t}=await Or.from("reception_shifts").delete().eq("shift_date",e).eq("status","closed");if(t)throw t;alert("\u062a\u0645 \u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645 \u0628\u0646\u062c\u0627\u062d.")}catch(t){alert("\u062a\u0639\u0630\u0631 \u062d\u0630\u0641 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629: "+(t.message||t))}},children:"\u062d\u0630\u0641 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsx)(Y,{icon:(0,a.jsx)(Hr,{className:"w-6 h-6 text-green-500"}),label:"\u0648\u0635\u0648\u0644 \u0627\u0644\u064a\u0648\u0645",value:re.length,color:"border-green-400"}),(0,a.jsx)(Y,{icon:(0,a.jsx)(Kr,{className:"w-6 h-6 text-red-500"}),label:"\u0645\u063a\u0627\u062f\u0631\u0629 \u0627\u0644\u064a\u0648\u0645",value:se.length,color:"border-red-400"}),(0,a.jsx)(Y,{icon:(0,a.jsx)(Gr,{className:"w-6 h-6 text-blue-500"}),label:"\u0645\u0642\u064a\u0645\u0648\u0646",value:ae.length,color:"border-blue-400"}),(0,a.jsx)(Y,{icon:(0,a.jsx)(Jr,{className:"w-6 h-6 text-yellow-500"}),label:"\u0642\u0627\u062f\u0645\u0629",value:ie.length,color:"border-yellow-400"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,a.jsx)(X,{icon:(0,a.jsx)($r,{className:"w-6 h-6"}),label:"\u062f\u0641\u0639",onClick:()=>alert("\u0627\u0644\u062f\u0641\u0639 \u064a\u062a\u0637\u0644\u0628 \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629"),disabled:!le,tooltip:le?"\u062a\u0646\u0641\u064a\u0630 \u062f\u0641\u0639":"\u064a\u062c\u0628 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b"}),(0,a.jsx)(X,{icon:(0,a.jsx)(Qr,{className:"w-6 h-6"}),label:"\u0645\u0635\u0631\u0648\u0641",onClick:()=>y(!0),disabled:!le,tooltip:le?"\u062a\u0633\u062c\u064a\u0644 \u0645\u0635\u0631\u0648\u0641":"\u064a\u062c\u0628 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b"}),(0,a.jsx)(X,{icon:(0,a.jsx)(Yr,{className:"w-6 h-6"}),label:"\u0625\u0636\u0627\u0641\u0629 \u062d\u062c\u0632",onClick:()=>alert("\u0625\u0636\u0627\u0641\u0629 \u062d\u062c\u0632"),disabled:!le,tooltip:le?"\u0625\u0636\u0627\u0641\u0629 \u062d\u062c\u0632 \u062c\u062f\u064a\u062f":"\u064a\u062c\u0628 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-4 flex flex-col md:flex-row md:items-center gap-4 border-t-4 border-blue-200",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Fr,{className:"w-5 h-5 text-blue-400"}),(0,a.jsx)("span",{className:"font-bold text-gray-700",children:"\u0645\u0644\u062e\u0635 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),le?(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded bg-green-100 text-green-700 text-xs",children:"\u0645\u0641\u062a\u0648\u062d\u0629"}):(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 rounded bg-red-100 text-red-700 text-xs",children:"\u0645\u063a\u0644\u0642\u0629"})]}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:["\u0627\u0644\u062f\u062e\u0644 \u0627\u0644\u0646\u0642\u062f\u064a: ",(0,a.jsxs)("span",{className:"font-bold text-green-600",children:[W.cashIncome," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{children:["\u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a: ",(0,a.jsxs)("span",{className:"font-bold text-red-600",children:[W.cashExpense," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{children:["\u0627\u0644\u0635\u0627\u0641\u064a: ",(0,a.jsxs)("span",{className:"font-bold text-blue-600",children:[W.net," \u062c.\u0645"]})]})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm text-gray-700",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0639\u0647\u062f\u0629 \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0644\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,a.jsxs)("div",{className:"font-bold text-lg",children:[((null===B||void 0===B?void 0:B.opening_cash)||0)+W.net," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"\u0645\u0627 \u062a\u0645 \u062a\u0633\u0644\u064a\u0645\u0647 \u0645\u0646 \u0647\u0630\u0647 \u0627\u0644\u0648\u0631\u062f\u064a\u0629"}),(0,a.jsxs)("div",{className:"font-bold text-lg",children:[H," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"\u0645\u0644\u062e\u0651\u0635 \u0627\u0644\u064a\u0648\u0645 \u0644\u0647\u0630\u0627 \u0627\u0644\u0645\u0648\u0638\u0641 (\u0635\u0627\u0641\u064a)"}),(0,a.jsxs)("div",{className:"font-bold text-lg",children:[G.net," \u062c.\u0645"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0627\u0633\u062a\u0644\u0645 \u0627\u0644\u064a\u0648\u0645: ",G.received," \u062c.\u0645 \u2014 \u0633\u0644\u0651\u0645 \u0627\u0644\u064a\u0648\u0645: ",G.delivered," \u062c.\u0645"]})]})]}),(null===B||void 0===B?void 0:B.opening_note)&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-700",children:["\u0645\u0644\u0627\u062d\u0638\u0629 \u0639\u0646\u062f \u0627\u0644\u0641\u062a\u062d: ",(0,a.jsx)("div",{className:"text-sm font-medium",children:B.opening_note})]}),(null===B||void 0===B?void 0:B.closing_note)&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-700",children:["\u0633\u062c\u0644 \u0627\u0644\u0648\u0631\u062f\u064a\u0629: ",(0,a.jsx)("div",{className:"text-sm font-medium whitespace-pre-line",children:B.closing_note})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[!le&&(0,a.jsxs)("button",{onClick:async()=>{if(null!==o&&void 0!==o&&o.id)if("open"!==(null===B||void 0===B?void 0:B.status))try{const{data:t}=await Or.from("reception_shifts").select("id,status").eq("staff_user_id",o.id).eq("status","open").limit(1);if(t&&t.length>0)return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u062c\u062f\u064a\u062f\u0629 \u0627\u0644\u0622\u0646\u060c \u064a\u0648\u062c\u062f \u0648\u0631\u062f\u064a\u0629 \u0642\u0627\u0626\u0645\u0629 \u0644\u0645 \u062a\u064f\u063a\u0644\u0642 \u0628\u0639\u062f. \u0628\u0631\u062c\u0627\u0621 \u0625\u063a\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062d\u0627\u0644\u064a\u0629 \u0623\u0648\u0644\u064b\u0627 \u062b\u0645 \u0625\u0639\u0627\u062f\u0629 \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629.");const{data:n,error:r}=await Or.rpc("open_reception_shift_if_allowed",{p_shift_date:d,p_staff_user_id:o.id});if(r){const e=r.message||r.details||"\u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641";return void("P0001"===r.code?alert(e):(console.error("Supabase RPC error:",r),alert("\u062a\u0639\u0630\u0631 \u0641\u062a\u062d \u0627\u0644\u0648\u0631\u062f\u064a\u0629: "+e)))}const s=Array.isArray(n)&&n.length>0?n[0]:null;if(F(s),Q(!s),V({cashIncome:0,cashExpense:0,net:0}),s&&s.id)try{const e=(new Date).toISOString().slice(0,10);console.debug("open shift debug",{shift:s,currentUserId:null===o||void 0===o?void 0:o.id,todayStr:e});const{data:t}=await Or.from("reception_shift_handovers").select("*").is("to_shift_id",null).eq("to_staff_user_id",o.id).eq("status","pending");if(console.debug("pending handovers fetched on open:",t),t&&t.length>0){const e=[...new Set(t.map(e=>e.from_shift_id).filter(Boolean))],{data:n}=await Or.from("reception_shifts").select("id,staff_user_id").in("id",e),r=[...new Set((n||[]).map(e=>e.staff_user_id).filter(Boolean))],{data:s}=await Or.from("staff_users").select("id,full_name").in("id",r),a={};(s||[]).forEach(e=>{a[e.id]=e.full_name});const i=(t||[]).map(e=>{const t=(n||[]).find(t=>String(t.id)===String(e.from_shift_id));return Le(Le({},e),{},{sender_id:(null===t||void 0===t?void 0:t.staff_user_id)||null,sender_name:a[null===t||void 0===t?void 0:t.staff_user_id]||"\u0645\u0648\u0638\u0641 \u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"})}),o=(i||[]).reduce((e,t)=>e+Number(t.amount||0),0);L(i),z(o),q(!0)}}catch(e){console.error("link pending handovers error",e)}alert(s?"\u062a\u0645 \u0641\u062a\u062d \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0628\u0646\u062c\u0627\u062d":"\u062a\u0639\u0630\u0631 \u0641\u062a\u062d \u0627\u0644\u0648\u0631\u062f\u064a\u0629")}catch(e){alert(e.message)}else alert("\u0647\u0646\u0627\u0643 \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629 \u0628\u0627\u0644\u0641\u0639\u0644.");else alert("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0628\u062f\u0648\u0646 \u0645\u0633\u062a\u062e\u062f\u0645 \u0641\u0639\u0651\u0627\u0644.")},className:"bg-green-500 text-white px-4 py-2 rounded shadow hover:bg-green-600 transition",children:[(0,a.jsx)(Hr,{className:"inline w-4 h-4 ml-1"})," \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629"]}),le&&(0,a.jsxs)("button",{onClick:async()=>{if(B&&"open"===B.status)try{const[{data:e},{data:t}]=await Promise.all([Or.from("staff_users").select("id,full_name").eq("role","reception"),Or.from("staff_users").select("id,full_name").eq("role","manager")]);O(e||[]),P(t||[]),S(W.net||0),N("manager"),E(t&&t[0]&&t[0].id||null),_(!0)}catch(e){console.error("open handover modal error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u062c\u0647\u064a\u0632 \u0645\u0648\u062f\u0627\u0644 \u0627\u0644\u062a\u0633\u0644\u064a\u0645: "+(e.message||e))}else alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629 \u0644\u0625\u063a\u0644\u0627\u0642\u0647\u0627")},className:"bg-red-500 text-white px-4 py-2 rounded shadow hover:bg-red-600 transition",children:[(0,a.jsx)(Kr,{className:"inline w-4 h-4 ml-1"})," \u0625\u063a\u0644\u0627\u0642 \u0648\u0631\u062f\u064a\u0629"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-4 border-t-4 border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"font-bold text-gray-700 flex items-center gap-2",children:[(0,a.jsx)(Gr,{className:"w-5 h-5 text-blue-400"}),"\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u064a\u0648\u0645",(0,a.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-xs",children:ne.length})]}),(0,a.jsx)("input",{className:"border rounded px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-200 transition",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0627\u0644\u063a\u0631\u0641\u0629...",value:f,onChange:e=>x(e.target.value),style:{minWidth:180}})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm text-right",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"px-2 py-1",children:"\u0627\u0644\u0636\u064a\u0641"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"\u0627\u0644\u0647\u0627\u062a\u0641"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"\u0627\u0644\u062f\u0641\u0639"})]})}),(0,a.jsxs)("tbody",{children:[0===ne.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"text-center text-gray-400 py-4",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u064a\u0648\u0645"})}),ne.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-blue-50 transition",children:[(0,a.jsx)("td",{className:"px-2 py-1",children:e.guest_name}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.guest_phone}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.room_label}),(0,a.jsx)("td",{className:"px-2 py-1",children:oe(e.status)}),(0,a.jsx)("td",{className:"px-2 py-1",children:(0,a.jsx)("button",{className:"bg-blue-500 text-white rounded px-3 py-1 text-xs shadow hover:bg-blue-600 transition",disabled:!le,title:le?"\u062f\u0641\u0639":"\u064a\u062c\u0628 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629",onClick:()=>alert("\u0627\u0644\u062f\u0641\u0639 \u064a\u062a\u0637\u0644\u0628 \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629"),children:(0,a.jsx)($r,{className:"inline w-4 h-4"})})})]},e.id))]})]})})]}),e&&n&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg p-6",dir:"rtl",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2",children:"\u0645\u0644\u062e\u0635 \u062a\u062d\u0635\u064a\u0644 \u0648\u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0648\u0631\u062f\u064a\u0629"}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0627\u0633\u0645 \u0627\u0644\u0645\u0648\u0638\u0641: ",(0,a.jsx)("span",{className:"font-bold",children:n.staffName})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0631\u0642\u0645 \u0627\u0644\u0648\u0631\u062f\u064a\u0629: ",(0,a.jsx)("span",{className:"font-bold",children:n.shiftId})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062a\u062d\u0635\u064a\u0644 \u0627\u0644\u0646\u0642\u062f\u064a \u0641\u064a \u0627\u0644\u0648\u0631\u062f\u064a\u0629: ",(0,a.jsxs)("span",{className:"font-bold",children:[n.totalCashIncome," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0627\u0644\u0646\u0642\u062f\u064a\u0629: ",(0,a.jsxs)("span",{className:"font-bold",children:[n.totalCashExpense," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0635\u0627\u0641\u064a \u0627\u0644\u0646\u0642\u062f\u064a\u0629: ",(0,a.jsxs)("span",{className:"font-bold",children:[n.netCash," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0645\u0628\u0627\u0644\u063a \u0645\u0631\u062d\u0651\u0644\u0629 \u0645\u0646 \u0648\u0631\u062f\u064a\u0627\u062a \u0633\u0627\u0628\u0642\u0629: ",(0,a.jsxs)("span",{className:"font-bold",children:[n.handoverInTotal," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0645\u0628\u0627\u0644\u063a \u0645\u0633\u0644\u0651\u0645\u0629 \u0645\u0646 \u0647\u0630\u0647 \u0627\u0644\u0648\u0631\u062f\u064a\u0629: ",(0,a.jsxs)("span",{className:"font-bold",children:[n.handoverOutTotal," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u062f\u0641\u0648\u0639\u0627\u062a \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629 (\u0644\u0644\u0639\u0644\u0645 \u0641\u0642\u0637): ",(0,a.jsxs)("span",{className:"font-bold",children:[n.totalEIncome," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-2 text-sm",children:["\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u0637\u0644\u0648\u0628 \u062a\u0633\u0644\u064a\u0645\u0647 \u0646\u0642\u062f\u064b\u0627: ",(0,a.jsxs)("span",{className:"font-bold",children:[n.closingCash," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0641\u0639\u0644\u064a \u0627\u0644\u0645\u0633\u062a\u0644\u0645 \u0645\u0646 \u0627\u0644\u0645\u0648\u0638\u0641"}),(0,a.jsx)("input",{ref:i,className:"w-full border rounded px-2 py-1",type:"number",defaultValue:n.closingCash})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"bg-gray-200 px-3 py-1 rounded",onClick:()=>t(!1),children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:async()=>{const e=Number(i.current.value);await Or.from("reception_shift_handovers").update({status:"received_by_manager",received_by:n.managerId,received_at:(new Date).toISOString()}).eq("from_shift_id",n.shiftId).eq("to_manager_id",n.managerId),await Or.from("accounting_transactions").insert({direction:"expense",amount:e,payment_method:"cash",tx_date:(new Date).toISOString().slice(0,10),reception_shift_id:n.shiftId,created_by:n.managerId,note:"\u0627\u0633\u062a\u0644\u0627\u0645 \u0646\u0642\u062f\u064a\u0629 \u0645\u0646 \u0627\u0644\u0645\u0648\u0638\u0641 ".concat(n.staffName," \u0644\u0644\u0648\u0631\u062f\u064a\u0629 ").concat(n.shiftId)}),t(!1),window.dispatchEvent(new Event("accounting-tx-updated")),alert("\u062a\u0645 \u062a\u0623\u0643\u064a\u062f \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0645\u0646 \u0627\u0644\u0645\u0648\u0638\u0641 \u0628\u0646\u062c\u0627\u062d.")},children:"\u062a\u0623\u0643\u064a\u062f \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u0646\u0642\u062f\u064a\u0629"})]})]})}),b&&(0,a.jsx)(Pr,{onClose:()=>y(!1)}),M&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg p-6",dir:"rtl",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2",children:"\u062a\u0645 \u062a\u0631\u062d\u064a\u0644 \u0646\u0642\u062f\u064a\u0629 \u0625\u0644\u064a\u0643"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-3",children:["\u062a\u0645 \u062a\u0631\u062d\u064a\u0644 \u0645\u0628\u0644\u063a \u0625\u062c\u0645\u0627\u0644\u064a ",(0,a.jsxs)("span",{className:"font-bold",children:[U," \u062c.\u0645"]})," \u0645\u0646 \u0648\u0631\u062f\u064a\u0627\u062a \u0633\u0627\u0628\u0642\u0629 \u0625\u0644\u064a\u0643. \u0627\u0644\u0645\u0631\u062c\u0648 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u0627\u0644\u0645\u0628\u0644\u063a \u0648\u0627\u0633\u062a\u0644\u0627\u0645\u0647 \u0641\u0639\u0644\u064a\u064b\u0627."]}),(0,a.jsx)("div",{className:"mb-3 max-h-48 overflow-auto border rounded p-2",children:(D||[]).map(e=>(0,a.jsx)("div",{className:"flex justify-between items-center py-2 border-b last:border-b-0",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm",children:["\u0627\u0644\u0645\u0628\u0644\u063a: ",(0,a.jsxs)("span",{className:"font-bold",children:[e.amount," \u062c.\u0645"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0645\u0646 \u0645\u0648\u0638\u0641: ",(0,a.jsx)("span",{className:"font-medium",children:e.sender_name})]})]})},e.id))}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"bg-gray-200 px-3 py-1 rounded",onClick:()=>q(!1),disabled:I,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:async()=>{if(B){A(!0);try{const t=D||[];let n=0;for(const s of t){n+=Number(s.amount||0),await Or.from("reception_shift_handovers").update({to_shift_id:B.id,to_staff_user_id:null,status:"received_by_staff",received_by:o.id,received_at:(new Date).toISOString()}).eq("id",s.id);try{const{data:e}=await Or.from("reception_shifts").select("id,closing_note").eq("id",s.from_shift_id).limit(1),t=e&&e.length>0?e[0]:null;let n=(null===o||void 0===o?void 0:o.full_name)||"";if(!n){const{data:e}=await Or.from("staff_users").select("full_name").eq("id",o.id).limit(1);n=e&&e[0]&&e[0].full_name||n}const r="\u062a\u0645 \u0627\u0633\u062a\u0644\u0627\u0645 \u0645\u0628\u0644\u063a ".concat(s.amount," \u062c.\u0645 \u0628\u0648\u0627\u0633\u0637\u0629 ").concat(n," \u0628\u062a\u0627\u0631\u064a\u062e ").concat((new Date).toLocaleString("ar-EG")),a=t&&t.closing_note?t.closing_note+"\n"+r:r;await Or.from("reception_shifts").update({closing_note:a}).eq("id",s.from_shift_id)}catch(e){console.error("failed updating from shift note",e)}}const{error:r}=await Or.from("reception_shifts").update({opening_cash:(B.opening_cash||0)+n}).eq("id",B.id);if(r)throw r;Z(Le(Le({},B),{},{opening_cash:(B.opening_cash||0)+n})),q(!1),L([]),z(0),alert("\u062a\u0645 \u062a\u0623\u0643\u064a\u062f \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u0645\u0628\u0627\u0644\u063a \u0627\u0644\u0645\u0631\u062d\u0651\u0644\u0629 \u0648\u0625\u0636\u0627\u0641\u062a\u0647\u0627 \u0625\u0644\u0649 \u0639\u0647\u062f\u062a\u0643 \u0627\u0644\u062d\u0627\u0644\u064a\u0629.")}catch(e){console.error("confirmPendingReceipts error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0623\u0643\u064a\u062f \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u062d\u0648\u0627\u0644\u0627\u062a: "+(e.message||e))}finally{A(!1)}}},disabled:I,children:I?"\u062c\u0627\u0631\u064a...":"\u062a\u0623\u0643\u064a\u062f \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u0646\u0642\u062f\u064a\u0629"})]})]})}),w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",dir:"rtl",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-3",children:"\u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0639\u0647\u062f\u0629 \u0639\u0646\u062f \u0625\u063a\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629"}),(0,a.jsx)("div",{className:"mb-3 text-sm text-gray-700",children:"\u0627\u062e\u062a\u0631 \u062c\u0647\u0629 \u0627\u0633\u062a\u0644\u0627\u0645 \u0627\u0644\u0639\u0647\u062f\u0629 \u0648\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u0637\u0644\u0648\u0628 \u062a\u0633\u062c\u064a\u0644\u0647."}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"\u0627\u0644\u0646\u0648\u0639"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,a.jsx)("input",{type:"radio",name:"handoverType",checked:"manager"===j,onChange:()=>N("manager")})," \u0645\u062f\u064a\u0631"]}),(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,a.jsx)("input",{type:"radio",name:"handoverType",checked:"staff"===j,onChange:()=>N("staff")})," \u0644\u0645\u0648\u0638\u0641 \u0627\u0644\u0648\u0631\u062f\u064a\u0647 \u0627\u0644\u062a\u0627\u0644\u064a\u0629"]})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"\u0627\u0644\u0645\u0633\u062a\u0644\u0645"}),"manager"===j?(0,a.jsxs)("select",{className:"w-full border rounded px-2 py-1",value:C||"",onChange:e=>E(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- \u0627\u062e\u062a\u0631 \u0645\u062f\u064a\u0631 --"}),R.map(e=>(0,a.jsx)("option",{value:e.id,children:e.full_name},e.id))]}):(0,a.jsxs)("select",{className:"w-full border rounded px-2 py-1",value:C||"",onChange:e=>E(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- \u0627\u062e\u062a\u0631 \u0645\u0648\u0638\u0641 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644 --"}),T.map(e=>(0,a.jsx)("option",{value:e.id,children:e.full_name},e.id))]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("input",{className:"w-full border rounded px-2 py-1",type:"number",value:k,onChange:e=>S(Number(e.target.value))})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"bg-gray-200 px-3 py-1 rounded",onClick:()=>{_(!1)},children:I?"...":"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:async()=>{if(B)if(k>=0)if("manager"!==j||C)if("staff"!==j||C){A(!0);try{const{error:t}=await Or.from("reception_shifts").update({status:"closed",closed_at:(new Date).toISOString(),closing_cash:k,counted_cash:k}).eq("id",B.id);if(t)throw t;const n={from_shift_id:B.id,amount:k,tx_date:B.shift_date,note:"staff"===j?"\u062a\u0633\u0644\u064a\u0645 \u0645\u0639\u0644\u0651\u0642 \u0644\u0645\u0648\u0638\u0641 \u0627\u0644\u0648\u0631\u062f\u064a\u0647 \u0627\u0644\u062a\u0627\u0644\u064a\u0629":"\u062a\u0633\u0644\u064a\u0645 \u0646\u0642\u062f\u064a \u0644\u0644\u0625\u062f\u0627\u0631\u0629",created_by:(null===o||void 0===o?void 0:o.id)||null};"manager"===j?n.to_manager_id=C:(n.to_shift_id=null,n.to_staff_user_id=C);const{data:r,error:s}=await Or.from("reception_shift_handovers").insert(n).select("*");if(s)throw s;if(console.debug("handover inserted:",r),"manager"===j&&r&&r[0]){const t=r[0];try{await Or.from("reception_shift_handovers").update({status:"received_by_manager",received_by:C,received_at:(new Date).toISOString()}).eq("id",t.id);const{data:e}=await Or.from("reception_shifts").select("id,closing_note").eq("id",B.id).limit(1),n=e&&e.length>0?e[0]:null,{data:r}=await Or.from("staff_users").select("full_name").eq("id",C).limit(1),s=r&&r[0]&&r[0].full_name||"\u0627\u0644\u0645\u062f\u064a\u0631",a="\u062a\u0645 \u062a\u0633\u0644\u064a\u0645 \u0645\u0628\u0644\u063a ".concat(k," \u062c.\u0645 \u0625\u0644\u0649 \u0627\u0644\u0645\u062f\u064a\u0631 ").concat(s),i=n&&n.closing_note?n.closing_note+"\n"+a:a;await Or.from("reception_shifts").update({closing_note:i}).eq("id",B.id)}catch(e){console.error("error marking handover received by manager",e)}}const a=(new Date).toISOString().slice(0,10),{data:i}=await Or.from("reception_shifts").select("id,status,opening_cash,closing_cash,closed_at,staff_user_id").eq("staff_user_id",o.id).eq("shift_date",a).eq("status","closed").limit(1),l=i&&i.length>0?i[0]:null;F(l),Q(!0),_(!1),Z(l),alert("\u062a\u0645 \u0625\u063a\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0648\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062a\u0633\u0644\u064a\u0645 \u0628\u0646\u062c\u0627\u062d.")}catch(e){console.error("submitHandover error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u063a\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629/\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062a\u0633\u0644\u064a\u0645: "+(e.message||e))}finally{A(!1)}}else alert("\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0648\u0638\u0641 \u0627\u0644\u0645\u0633\u062a\u0644\u0645 \u0644\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062a\u0627\u0644\u064a\u0629.");else alert("\u0627\u062e\u062a\u0631 \u0645\u062f\u064a\u0631\u064b\u0627 \u0644\u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0639\u0647\u062f\u0629.");else alert("\u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a\u0627\u064b \u0635\u062d\u064a\u062d\u0627\u064b \u0644\u0644\u062a\u0633\u0644\u064a\u0645.")},disabled:I,children:I?"\u062c\u0627\u0631\u064a...":"\u0625\u063a\u0644\u0627\u0642 \u0648\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062a\u0633\u0644\u064a\u0645"})]})]})})]})}function Zr(e){var t,n,r;let{building:s,onEdit:i,onDelete:o}=e;const l="inactive"===s.status?"\u063a\u064a\u0631 \u0646\u0634\u0637":"maintenance"===s.status?"\u0635\u064a\u0627\u0646\u0629":"\u0646\u0634\u0637",c="inactive"===s.status?"bg-gray-100 text-gray-700":"maintenance"===s.status?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-700";return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 relative",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm ".concat(c),children:["maintenance"===s.status&&(0,a.jsx)(x,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:l})]}),(0,a.jsx)("h3",{className:"text-lg font-semibold mt-3",children:s.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:s.name_en})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0645\u0628\u0646\u0649 ",s.code]})})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-blue-600 font-semibold",children:null!==(t=s.floors_count)&&void 0!==t?t:0}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0637\u0648\u0627\u0628\u0642"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-800 font-semibold",children:null!==(n=s.total_rooms)&&void 0!==n?n:0}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-green-600 font-semibold",children:null!==(r=s.available_rooms)&&void 0!==r?r:0}),(0,a.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u062a\u0627\u062d\u0629"})]})]}),(0,a.jsx)("div",{className:"mt-4 text-sm text-gray-600",children:s.description}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,a.jsx)("button",{onClick:i,className:"bg-yellow-400 px-4 py-2 rounded text-white",children:"\u062a\u0639\u062f\u064a\u0644 \u270f\ufe0f"}),(0,a.jsx)("button",{onClick:o,className:"bg-red-500 px-4 py-2 rounded text-white",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})]})}function es(e){let{initialData:t=null,onClose:n,onSave:s}=e;const[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(0),[h,m]=(0,r.useState)("active"),[p,f]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&(o(t.code||""),c(t.name||""),u(t.floors_count||0),m(t.status||"active"),f(t.description||""))},[t]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-start justify-center p-6 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6 shadow-lg mt-12",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0645\u0628\u0646\u0649":"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u0646\u0649"}),(0,a.jsx)("button",{onClick:n,className:"text-gray-500",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,a.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const n={code:i||null,name:l||null,description:p||null,floors_count:d||0,status:h};t&&t.id&&(n.id=t.id),await s(n)},className:"mt-4 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0631\u0642\u0645 \u0627\u0644\u0645\u0628\u0646\u0649 *"}),(0,a.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0628\u0646\u0649 *"}),(0,a.jsx)("input",{value:l,onChange:e=>c(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0637\u0648\u0627\u0628\u0642 *"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>u(Number(e.target.value)),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629 *"}),(0,a.jsxs)("select",{value:h,onChange:e=>m(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"active",children:"\u0646\u0634\u0637"}),(0,a.jsx)("option",{value:"inactive",children:"\u063a\u064a\u0631 \u0646\u0634\u0637"})]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,a.jsx)("textarea",{value:p,onChange:e=>f(e.target.value),className:"w-full border rounded px-3 py-2 h-28"})]}),(0,a.jsxs)("div",{className:"col-span-2 flex gap-3 justify-start mt-2",children:[(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a \ud83d\udcbe"}),(0,a.jsx)("button",{type:"button",onClick:n,className:"bg-gray-100 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})})}const ts=["floors_count"];function ns(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[o,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),u=async()=>{i(!0);try{const{data:e,error:t}=await Or.from("buildings_with_floor_count").select("*").order("created_at",{ascending:!1});if(t)throw t;const r=e||[],s=await Promise.all(r.map(async e=>{let t=0,n=0;try{const n=await Or.from("rooms").select("id",{count:"exact",head:!0}).eq("building_id",e.id);n.error||(t=n.count||0)}catch(r){}try{const t=await Or.from("rooms").select("id",{count:"exact",head:!0}).eq("building_id",e.id).eq("is_available",!0);t.error||(n=t.count||0)}catch(r){}return Le(Le({},e),{},{total_rooms:t,available_rooms:n})}));n(s)}catch(e){console.error("Failed loading buildings",e),n([])}finally{i(!1)}};(0,r.useEffect)(()=>{u()},[]);return(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0645\u0628\u0627\u0646\u064a"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0645\u0628\u0627\u0646\u064a \u0648\u0637\u0648\u0627\u0628\u0642 \u0627\u0644\u0641\u0646\u062f\u0642"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{d(null),l(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2",children:"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u0646\u0649 \u062c\u062f\u064a\u062f +"})})]}),s?(0,a.jsx)("div",{children:"\u062a\u062d\u0645\u064a\u0644..."}):0===t.length?(0,a.jsx)("div",{className:"p-6 bg-white rounded shadow",children:'\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0628\u0627\u0646\u064d \u0628\u0639\u062f. \u0627\u0636\u063a\u0637 "\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u0646\u0649 \u062c\u062f\u064a\u062f" \u0644\u0625\u0646\u0634\u0627\u0621 \u0623\u0648\u0644 \u0645\u0628\u0646\u0649.'}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.map(t=>(0,a.jsx)(Zr,{building:t,onEdit:()=>(d(t),void l(!0)),onDelete:()=>(async t=>{if(!I(e))return void window.alert("\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u062d\u0630\u0641 \u0627\u0644\u0645\u0628\u0627\u0646\u064a. \u0647\u0630\u0647 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0644\u0644\u0645\u062f\u064a\u0631 \u0641\u0642\u0637.");if(!window.confirm("\u0647\u0644 \u062a\u0631\u063a\u0628 \u062d\u0642\u0627\u064b \u0628\u062d\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u0645\u0628\u0646\u0649\u061f"))return;const n={is_deleted:!0};e&&e.id&&(n.updated_by=e.id),await Or.from("buildings").update(n).eq("id",t),u()})(t.id)},t.id))}),o&&(0,a.jsx)(es,{initialData:c,onClose:()=>l(!1),onSave:async t=>{try{const n=t||{},{floors_count:r}=n,s=Ir(n,ts);let a=null;if(s.id){e&&e.id&&(s.updated_by=e.id);const{error:t}=await Or.from("buildings").update(s).eq("id",s.id);if(t)throw t;const{data:n,error:r}=await Or.from("buildings").select("*").eq("id",s.id).single();if(r)throw r;a=n}else{e&&e.id&&(s.created_by=e.id);const{data:t,error:n}=await Or.from("buildings").insert([s]).select().single();if(n)throw n;a=t}const i=Number(r)||0;if(console.log("handleSave: floors_count=",r,"floorsCount=",i,"buildingRecord=",a),a&&i>0){const{data:e=[]}=await Or.from("floors").select("floor_number").eq("building_id",a.id),t=new Set(e.map(e=>Number(e.floor_number))),n=[];for(let r=1;r<=i;r++)t.has(r)||n.push({building_id:a.id,floor_number:r});if(console.log("Floors to insert:",n.length,n),n.length){const{error:e}=await Or.from("floors").insert(n);e?(console.error("Failed creating floors",e),window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0637\u0648\u0627\u0628\u0642: "+(e.message||e))):(console.log("Inserted floors count (requested):",n.length),window.alert("\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 "+n.length+" \u0637\u0627\u0628\u0642/\u0637\u0648\u0627\u0628\u0642 \u0644\u0644\u0645\u0628\u0646\u0649 \u0628\u0646\u062c\u0627\u062d."))}else console.log("No new floors to insert")}}catch(n){console.error("Failed saving building",n);try{const e=n&&n.message?n.message:JSON.stringify(n);window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u0645\u0628\u0646\u0649: "+e)}catch(r){}}l(!1),u()}})]})}function rs(e){let{status:t}=e;const n={available:{text:"\u0645\u062a\u0627\u062d\u0629",cls:"bg-green-100 text-green-700"},reserved:{text:"\u0645\u062d\u062c\u0648\u0632\u0629",cls:"bg-amber-100 text-amber-700"},occupied:{text:"\u0645\u0634\u063a\u0648\u0644\u0629",cls:"bg-pink-100 text-pink-700"},maintenance:{text:"\u0635\u064a\u0627\u0646\u0629",cls:"bg-red-100 text-red-700"}},r=n[t]||n.available;return(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(r.cls),children:r.text})}function ss(e){let{room:t,onEdit:n,onDelete:r,onSelect:s,selected:i}=e;const o=Array.isArray(t.features)?t.features:[],l=e=>{const t=String(e||"").toLowerCase();return t.includes("wifi")?(0,a.jsx)(_,{className:"w-[12px] h-[12px]",title:"\u0648\u0627\u064a \u0641\u0627\u064a"}):"tv"===t?(0,a.jsx)(j,{className:"w-[12px] h-[12px]",title:"\u062a\u0644\u0641\u0627\u0632"}):t.includes("ac")?(0,a.jsx)(N,{className:"w-[12px] h-[12px]",title:"\u062a\u0643\u064a\u064a\u0641"}):t.includes("minibar")?(0,a.jsx)(k,{className:"w-[12px] h-[12px]",title:"\u0645\u064a\u0646\u064a \u0628\u0627\u0631"}):null},c=e=>{let{value:t}=e;const n={clean:{text:"\u0646\u0638\u064a\u0641\u0629",cls:"bg-green-100 text-green-700"},in_cleaning:{text:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",cls:"bg-amber-100 text-amber-700"},needs_cleaning:{text:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",cls:"bg-red-100 text-red-700"}},r=n[t]||n.clean;return(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(r.cls),children:r.text})};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden",dir:"rtl",children:[(0,a.jsx)("div",{className:"h-1 ".concat((e=>{switch(e){case"available":return"bg-status-available";case"reserved":return"bg-status-reserved";case"occupied":return"bg-status-occupied";case"maintenance":return"bg-status-maintenance";default:return"bg-gray-300"}})(t.status)),title:"\u062d\u0627\u0644\u0629: ".concat(t.status)}),(0,a.jsxs)("div",{className:"px-4 pt-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["function"===typeof s&&(0,a.jsx)("input",{type:"checkbox",checked:!!i,onChange:s,title:"\u062a\u062d\u062f\u064a\u062f"}),(0,a.jsx)("div",{className:"text-gray-800 font-bold",children:t.room_code})]}),(0,a.jsx)(rs,{status:t.status})]}),(0,a.jsxs)("div",{className:"px-4 py-3 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"mb-1",children:[t.floor_name," \u2013 ",t.building_name]}),(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsx)("span",{className:"font-semibold",children:t.room_type_name_ar}),(0,a.jsxs)("span",{className:"ml-2 text-gray-500",children:["(",t.room_type_name_en,")"]})]}),(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-blue-700 font-bold text-base",children:Number(t.computed_price||0)}),(0,a.jsx)("span",{className:"text-gray-500",children:"\u062c\u0646\u064a\u0647/\u0644\u064a\u0644\u0629"})]}),(0,a.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,a.jsx)(S,{className:"w-[12px] h-[12px] text-gray-500",title:"\u0623\u0642\u0635\u0649 \u0639\u062f\u062f \u0636\u064a\u0648\u0641"}),(0,a.jsxs)("span",{children:["\u0623\u0642\u0635\u0649 \u0639\u062f\u062f \u0623\u0634\u062e\u0627\u0635: ",Number(t.max_guests||0)]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("span",{className:"text-gray-700 mr-2",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0646\u0638\u0627\u0641\u0629:"}),(0,a.jsx)(c,{value:t.cleanliness})]}),o.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:o.map((e,t)=>(0,a.jsxs)("span",{className:"text-[11px] px-2 py-[5px] rounded border border-gray-200 bg-gray-50 text-gray-600 flex items-center gap-2",title:String(e),children:[l(e),(0,a.jsx)("span",{children:e})]},t))}),t.description&&(0,a.jsx)("div",{className:"mt-2 text-gray-600",children:t.description})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-t bg-gray-50",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:n,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062a\u0639\u062f\u064a\u0644 \u270d\ufe0f"}),(0,a.jsx)("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})})]})}function as(e){let{initialData:t=null,onClose:n,onSave:s}=e;const[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)("active"),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&(o(t.floor_name||t.name||"\u0627\u0644\u0637\u0627\u0628\u0642 "+(t.floor_number||"")),c(t.status||"active"),u(t.description||""),m(t.maintenance_note||""),f(void 0!==t.capacity&&null!==t.capacity?String(t.capacity):""),g(Boolean(t.needs_inspection)))},[t]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-start justify-center p-6 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6 shadow-lg mt-12",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"\u062a\u0639\u062f\u064a\u0644 \u0637\u0627\u0628\u0642"}),(0,a.jsx)("button",{onClick:n,className:"text-gray-500",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();const n={id:t.floor_id||t.id,name:i||null,status:l,description:d||null,maintenance_note:h||null,capacity:""===p?null:Number(p),needs_inspection:x};s&&s(n)},className:"mt-4 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0631\u0642\u0645 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("input",{value:(null===t||void 0===t?void 0:t.floor_number)||"",disabled:!0,className:"w-full border rounded px-3 py-2 bg-gray-50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"active",children:"\u0646\u0634\u0637"}),(0,a.jsx)("option",{value:"inactive",children:"\u063a\u064a\u0631 \u0646\u0634\u0637"}),(0,a.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0633\u0639\u0629 \u0627\u0644\u0637\u0627\u0628\u0642 (\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641)"}),(0,a.jsx)("input",{value:p,onChange:e=>f(e.target.value),type:"number",className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0645\u0644\u0627\u062d\u0638\u0629 \u0627\u0644\u0635\u064a\u0627\u0646\u0629"}),(0,a.jsx)("input",{value:h,onChange:e=>m(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,a.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),className:"w-full border rounded px-3 py-2 h-28"})]}),(0,a.jsx)("div",{className:"col-span-2 flex items-center gap-4 mt-2",children:(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:x,onChange:e=>g(e.target.checked)}),(0,a.jsx)("span",{className:"text-sm",children:"\u064a\u062d\u062a\u0627\u062c \u0641\u062d\u0635"})]})}),(0,a.jsxs)("div",{className:"col-span-2 flex gap-3 justify-start mt-2",children:[(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"}),(0,a.jsx)("button",{type:"button",onClick:n,className:"bg-gray-100 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})})}function is(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)(null),[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[p,f]=(0,r.useState)(!1),[_,j]=(0,r.useState)(null),N=(0,r.useCallback)(async()=>{const{data:e,error:t}=await Or.from("buildings").select("*").order("created_at",{ascending:!1});t||(n(e||[]),!s&&e&&e.length&&i(e[0]))},[s]),k=(0,r.useCallback)(async e=>{m(!0);try{const{data:r,error:s}=await Or.from("building_floor_overview").select("*").eq("building_id",e).order("floor_number",{ascending:!0});let a=r||[];try{const{data:n,error:r}=await Or.from("floors").select("*").eq("building_id",e);if(!r&&n){const e=new Map(n.map(e=>[String(e.id),e])),r=new Map(n.map(e=>[String(e.floor_number),e]));a=(a||[]).map(t=>{const n=t.floor_id&&e.has(String(t.floor_id))?e.get(String(t.floor_id)):r.has(String(t.floor_number))?r.get(String(t.floor_number)):null;var s,a,i,o,l,c,d,u,h;return n?Le(Le({},t),{},{floor_id:n.id||t.floor_id,floor_number:null!==(s=n.floor_number)&&void 0!==s?s:t.floor_number,floor_name:null!==(a=null!==(i=n.floor_name)&&void 0!==i?i:n.name)&&void 0!==a?a:t.floor_name,name:null!==(o=n.name)&&void 0!==o?o:t.name,status:null!==(l=n.status)&&void 0!==l?l:t.status,description:null!==(c=n.description)&&void 0!==c?c:t.description,maintenance_note:null!==(d=n.maintenance_note)&&void 0!==d?d:t.maintenance_note,capacity:null!==(u=n.capacity)&&void 0!==u?u:t.capacity,needs_inspection:null!==(h=n.needs_inspection)&&void 0!==h?h:t.needs_inspection}):t});const s=new Set((a||[]).map(e=>String(e.floor_id||e.id)));for(const i of n){var t;if(!s.has(String(i.id)))a.push({floor_id:i.id,building_id:i.building_id,floor_number:i.floor_number,floor_name:null!==(t=i.floor_name)&&void 0!==t?t:i.name,name:i.name,status:i.status,description:i.description,maintenance_note:i.maintenance_note,capacity:i.capacity,needs_inspection:i.needs_inspection})}}}catch(n){console.warn("Failed fetching raw floors rows",n)}s||c(a||[]);const{data:i,error:o}=await Or.from("rooms_by_floor").select("*").eq("building_id",e).order("room_code",{ascending:!0});o||u(i||[])}catch(n){console.error(n),c([]),u([])}finally{m(!1)}},[]);(0,r.useEffect)(()=>{N()},[N]),(0,r.useEffect)(()=>{s&&k(s.id)},[s,k]);const S=(e,t)=>{const n="/rooms?building=".concat(e,"&floor=").concat(t);try{window.location.href=n}catch(r){console.log("navigate",n)}};return(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-400",children:(0,a.jsx)(o,{className:"w-12 h-12"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0637\u0648\u0627\u0628\u0642"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["\u0639\u0631\u0636 \u0648\u0637\u0628\u0627\u0639\u0629 \u0637\u0648\u0627\u0628\u0642 \u0648\u063a\u0631\u0641 \u0627\u0644\u0645\u0628\u0646\u0649",s?" \u2014 ".concat(s.name):""]})]})]})}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"flex gap-4 overflow-auto",children:t.map(e=>(0,a.jsxs)("button",{onClick:()=>i(e),className:"min-w-[160px] p-4 rounded shadow flex flex-col items-start justify-center ".concat(s&&s.id===e.id?"border-2 border-blue-400 bg-white":"bg-white/80"),children:[(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\u0645\u0628\u0646\u0649 ",e.code]}),(0,a.jsx)("div",{className:"font-semibold",children:e.name}),(0,a.jsx)("div",{className:"text-xs mt-2 inline-flex items-center gap-2",children:"maintenance"===e.status?(0,a.jsx)("span",{className:"px-2 py-1 rounded text-yellow-800 bg-yellow-100",children:"\u0635\u064a\u0627\u0646\u0629"}):"inactive"===e.status?(0,a.jsx)("span",{className:"px-2 py-1 rounded text-gray-700 bg-gray-100",children:"\u063a\u064a\u0631 \u0646\u0634\u0637"}):(0,a.jsx)("span",{className:"px-2 py-1 rounded text-white bg-green-500",children:"\u0646\u0634\u0637"})})]},e.id))}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4",children:(()=>{const e=l.reduce((e,t)=>(e.total+=Number(t.total_rooms||0),e.available+=Number(t.available_rooms||0),e.occupied+=Number(t.occupied_rooms||0),e.reserved+=Number(t.reserved_rooms||0),e.maintenance+=Number(t.maintenance_rooms||0),e),{total:0,available:0,occupied:0,reserved:0,maintenance:0});return[{key:"total",label:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641",value:e.total,color:"bg-white",iconBg:"bg-indigo-100 text-indigo-700",icon:(0,a.jsx)(g,{className:"w-8 h-8"})},{key:"available",label:"\u0645\u062a\u0627\u062d\u0629",value:e.available,color:"bg-green-50",iconBg:"bg-green-100 text-green-700",icon:(0,a.jsx)(v,{className:"w-8 h-8"})},{key:"reserved",label:"\u0645\u062d\u062c\u0648\u0632\u0629",value:e.reserved,color:"bg-amber-50",iconBg:"bg-amber-100 text-amber-700",icon:(0,a.jsx)(b,{className:"w-8 h-8"})},{key:"occupied",label:"\u0645\u0634\u063a\u0648\u0644\u0629",value:e.occupied,color:"bg-rose-50",iconBg:"bg-rose-100 text-rose-700",icon:(0,a.jsx)(y,{className:"w-8 h-8"})},{key:"maintenance",label:"\u0635\u064a\u0627\u0646\u0629",value:e.maintenance,color:"bg-yellow-50",iconBg:"bg-yellow-100 text-yellow-700",icon:(0,a.jsx)(w,{className:"w-8 h-8"})}].map(e=>(0,a.jsx)("div",{className:"p-4 rounded shadow ".concat(e.color),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.label}),(0,a.jsx)("div",{className:"text-2xl font-bold mt-1",children:e.value})]}),(0,a.jsx)("div",{className:"p-2 rounded-full ".concat(e.iconBg),children:e.icon})]})},e.key))})()})]}),h?(0,a.jsx)("div",{children:"\u062a\u062d\u0645\u064a\u0644..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[0===l.length?(0,a.jsx)("div",{className:"p-6 bg-white rounded shadow",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0637\u0648\u0627\u0628\u0642 \u0644\u0639\u0631\u0636\u0647\u0627 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u0645\u0628\u0646\u0649."}):l.map(t=>(0,a.jsxs)("section",{className:"bg-white rounded shadow",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between",style:"maintenance"===t.status?{background:"linear-gradient(90deg,#ff416c,#ff4b2b)"}:"inactive"===t.status?{background:"linear-gradient(90deg,#757f9a,#d7dde8)"}:{background:"linear-gradient(90deg,#6a11cb,#2575fc)"},children:[(0,a.jsxs)("div",{className:"text-white",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:t.floor_name||t.name||"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(t.floor_number)}),"maintenance"===t.status&&(0,a.jsxs)("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs",children:[(0,a.jsx)(x,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"\u0635\u064a\u0627\u0646\u0629"})]})]}),(0,a.jsxs)("div",{className:"text-sm opacity-90",children:[t.total_rooms," \u0625\u062c\u0645\u0627\u0644\u064a \xb7 ",t.available_rooms," \u0645\u062a\u0627\u062d\u0629 \xb7 ",t.occupied_rooms," \u0645\u0634\u063a\u0648\u0644\u0629"]}),t.description&&(0,a.jsx)("div",{className:"text-xs opacity-90 mt-1",children:t.description}),t.maintenance_note&&(0,a.jsxs)("div",{className:"text-xs opacity-90 mt-1",children:["\u0645\u0644\u0627\u062d\u0638\u0629: ",t.maintenance_note]}),void 0!==t.capacity&&null!==t.capacity&&(0,a.jsxs)("div",{className:"text-xs opacity-90 mt-1",children:["\u0633\u0639\u0629: ",t.capacity]})]}),(0,a.jsxs)("div",{className:"text-white text-sm flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>(async e=>{console.log("handleEditFloor - floor:",e);try{if(e.floor_id){const{data:t,error:n}=await Or.from("floors").select("*").eq("id",e.floor_id).single();!n&&t?j(Le(Le({},e),t)):(console.warn("Could not fetch full floor row, using view row",n),j(e))}else j(e)}catch(t){console.warn("Error fetching full floor row",t),j(e)}f(!0)})(t),className:"bg-white/20 px-3 py-1 rounded text-white",children:"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("button",{onClick:()=>S(t.building_id,t.floor_id),className:"bg-white/10 px-3 py-1 rounded text-white border border-white/40",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629"}),(0,a.jsx)("div",{children:s&&s.name})]})]}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto",children:0===d.filter(e=>e.floor_id===t.floor_id).length?(0,a.jsxs)("div",{className:"w-full py-8 text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-4",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("button",{onClick:()=>S(t.building_id,t.floor_id),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641"})]}):d.filter(e=>e.floor_id===t.floor_id).map(t=>(0,a.jsx)(ss,{room:t,onEdit:()=>S(t.building_id,t.floor_id),onDelete:()=>(async t=>{try{if(!I(e))return void window.alert("\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u062d\u0630\u0641 \u0627\u0644\u063a\u0631\u0641. \u0647\u0630\u0647 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0644\u0644\u0645\u062f\u064a\u0631 \u0641\u0642\u0637.");if(!t||!t.id)return;const r=window.prompt("\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641 \u0627\u0643\u062a\u0628: ok","");if(!r||"ok"!==String(r).trim().toLowerCase())return void window.alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062d\u0630\u0641.");try{await Or.from("rooms").update({updated_by:(null===e||void 0===e?void 0:e.id)||null}).eq("id",t.id)}catch(n){}const{error:a}=await Or.from("rooms").delete().eq("id",t.id);if(a)throw a;const i=t.building_id||s&&s.id;i&&await k(i)}catch(r){console.error("Delete room from Floors failed",r),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u063a\u0631\u0641\u0629: "+(r.message||r))}})(t)},t.id))})})]},t.floor_id)),(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"\u0645\u062e\u0637\u0637 \u0627\u0644\u0645\u0628\u0646\u0649 \u0627\u0644\u0643\u0627\u0645\u0644"}),(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-gray-500",children:[(0,a.jsx)("th",{className:"p-2",children:"\u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("th",{className:"p-2",children:"\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641"}),(0,a.jsx)("th",{className:"p-2",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("th",{className:"p-2",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("th",{className:"p-2",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("th",{className:"p-2",children:"\u0635\u064a\u0627\u0646\u0629"}),(0,a.jsx)("th",{className:"p-2",children:"\u0645\u0639\u062f\u0644 \u0627\u0644\u0627\u0634\u063a\u0627\u0644"})]})}),(0,a.jsx)("tbody",{children:l.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsxs)("td",{className:"p-2",children:["\u0627\u0644\u0637\u0627\u0628\u0642 ",e.floor_number]}),(0,a.jsx)("td",{className:"p-2",children:e.total_rooms}),(0,a.jsx)("td",{className:"p-2 text-green-600",children:e.available_rooms}),(0,a.jsx)("td",{className:"p-2 text-red-600",children:e.occupied_rooms}),(0,a.jsx)("td",{className:"p-2 text-yellow-600",children:e.reserved_rooms}),(0,a.jsx)("td",{className:"p-2",children:e.maintenance_rooms}),(0,a.jsxs)("td",{className:"p-2",children:[Math.round(100*(e.occupancy_rate||0)),"%"]})]},e.floor_id))})]})})]})]}),p&&(0,a.jsx)(as,{initialData:_,onClose:()=>f(!1),onSave:async t=>{console.group("handleSaveFloor"),console.log("payload:",t);try{const r=t.id;if(!r)throw new Error("Missing floor id");const a={};void 0!==t.status&&(a.status=t.status),void 0!==t.description&&(a.description=t.description),void 0!==t.name&&(a.name=t.name),void 0!==t.maintenance_note&&(a.maintenance_note=t.maintenance_note),void 0!==t.capacity&&null!==t.capacity&&(a.capacity=Number(t.capacity)),void 0!==t.needs_inspection&&(a.needs_inspection=Boolean(t.needs_inspection)),a.updated_by=(null===e||void 0===e?void 0:e.id)||null,console.log("Attempting bulk update with payload:",a);let i=0;for(;i<6;){i+=1;const e=await Or.from("floors").update(a).eq("id",r);if(console.log("bulk update attempt",i,e),!e.error)break;const t=(e.error.message||"").toLowerCase(),n=t.match(/column "([^"]+)"/);if(n&&n[1]){const e=n[1];if(a.hasOwnProperty(e)){console.warn("Removing column from payload and retrying:",e),delete a[e];continue}}const s=t.match(/could not find the '([^']+)'/);if(!(s&&s[1]&&a.hasOwnProperty(s[1])))throw e.error;console.warn("Removing column (alt message) from payload and retrying:",s[1]),delete a[s[1]]}try{const{data:e,error:t}=await Or.from("floors").select("*").eq("id",r).single();console.log("Refetched floor row:",{refData:e,refErr:t}),!t&&e&&c(t=>t.map(t=>{var n,r,s,a,i,o,l,c,d;return t.floor_id&&String(t.floor_id)===String(e.id)||t.id&&String(t.id)===String(e.id)?Le(Le({},t),{},{floor_id:e.id,floor_number:null!==(n=e.floor_number)&&void 0!==n?n:t.floor_number,floor_name:null!==(r=null!==(s=e.floor_name)&&void 0!==s?s:e.name)&&void 0!==r?r:t.floor_name,name:null!==(a=e.name)&&void 0!==a?a:t.name,status:null!==(i=e.status)&&void 0!==i?i:t.status,description:null!==(o=e.description)&&void 0!==o?o:t.description,maintenance_note:null!==(l=e.maintenance_note)&&void 0!==l?l:t.maintenance_note,capacity:null!==(c=e.capacity)&&void 0!==c?c:t.capacity,needs_inspection:null!==(d=e.needs_inspection)&&void 0!==d?d:t.needs_inspection}):t}))}catch(n){console.warn("Failed refetching floor row",n)}f(!1),s&&k(s.id)}catch(r){console.error("Failed saving floor",r);try{const e=r&&r.message?r.message:JSON.stringify(r);window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u0637\u0627\u0628\u0642: "+e)}catch(a){window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u0637\u0627\u0628\u0642. \u0641\u062a\u062d \u0627\u0644\u0640 Console \u0644\u0645\u0632\u064a\u062f \u0645\u0646 \u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644.")}}console.groupEnd()}})]})}function os(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)(!0),[s]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[i,o]=(0,r.useState)([]),[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[x,g]=(0,r.useState)({cashIncome:0,cashExpense:0,net:0});!p||p.status;(0,r.useEffect)(()=>{null!==e&&void 0!==e&&e.id&&async function(){n(!0);try{const{data:t}=await Or.from("reservations_overview").select("*").or("check_in_date.eq.".concat(s,",check_out_date.eq.").concat(s,",is_current.eq.true"));o(t||[]);const{data:n}=await Or.from("reservations_overview").select("*").gte("check_in_date",s).lte("check_in_date",new Date(Date.now()+2592e5).toISOString().slice(0,10));c(n||[]);const{data:r}=await Or.from("reception_shifts").select("*").eq("staff_user_id",e.id).eq("status","open").maybeSingle();f(r||null)}finally{n(!1)}}()},[s,null===e||void 0===e?void 0:e.id]);const v=(0,r.useMemo)(()=>(new Date).toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),[]),b=(0,r.useMemo)(()=>{const e=d.trim().toLowerCase();return e?i.filter(t=>(t.guest_name||"").toLowerCase().includes(e)||(t.guest_phone||"").toLowerCase().includes(e)||String(t.room_label||"").toLowerCase().includes(e)):i},[i,d]),y=b.filter(e=>e.check_in_date===s&&["pending","confirmed"].includes(e.status)),w=b.filter(e=>e.check_out_date===s&&"checked_in"===e.status),_=b.filter(e=>e.is_current&&"checked_in"===e.status),j=l.filter(e=>!e.is_past);return t?(0,a.jsx)("div",{className:"p-6",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):(0,a.jsxs)("div",{className:"p-6 space-y-6 bg-gray-50 min-h-screen",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)("button",{className:"bg-yellow-400 px-4 py-2 rounded",children:"\u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629"})}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:v})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"\u0644\u0648\u062d\u0629 \u062a\u062d\u0643\u0645 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0648\u0631\u062f\u064a\u0629\u060c \u0627\u0644\u062a\u062d\u0635\u064a\u0644 \u0627\u0644\u0646\u0642\u062f\u064a\u060c \u0648\u062d\u0631\u0643\u0629 \u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),(0,a.jsx)("div",{className:"bg-white border rounded p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:["\u062d\u0627\u0644\u0629 \u0627\u0644\u0648\u0631\u062f\u064a\u0629:"," ",(0,a.jsx)("span",{className:"font-bold",children:"open"===(null===p||void 0===p?void 0:p.status)?"\u0645\u0641\u062a\u0648\u062d\u0629":"\u0645\u063a\u0644\u0642\u0629 / \u0644\u0627 \u062a\u0648\u062c\u062f"})]}),!p&&(0,a.jsx)("button",{onClick:async()=>{if(null===e||void 0===e||!e.id)return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0628\u062f\u0648\u0646 \u0645\u0633\u062a\u062e\u062f\u0645.");if(p)return void alert("\u0647\u0646\u0627\u0643 \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629 \u0628\u0627\u0644\u0641\u0639\u0644.");const{data:t,error:n}=await Or.from("reception_shifts").insert({shift_date:s,staff_user_id:e.id,status:"open"}).select("*").single();n?alert(n.message):(f(t),g({cashIncome:0,cashExpense:0,net:0}))},className:"bg-green-600 text-white px-3 py-1 rounded",children:"\u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629"}),"open"===(null===p||void 0===p?void 0:p.status)&&(0,a.jsx)("button",{onClick:async()=>{if(!p)return;const t=prompt("\u0623\u062f\u062e\u0644 \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0627\u0644\u0641\u0639\u0644\u064a\u0629 \u0628\u0627\u0644\u062e\u0632\u0646\u0629:");if(null===t)return;const n=Number(t);if(isNaN(n))return void alert("\u0645\u0628\u0644\u063a \u063a\u064a\u0631 \u0635\u062d\u064a\u062d");const{data:r}=await Or.from("accounting_transactions").select("direction,amount").eq("payment_method","cash").eq("reception_shift_id",p.id);let s=0,a=0;(r||[]).forEach(e=>{"income"===e.direction?s+=Number(e.amount):a+=Number(e.amount)});const i=s-a,o=n-i,{data:l}=await Or.from("reception_shifts").update({status:"closed",closed_at:(new Date).toISOString(),expected_cash:i,counted_cash:n,difference:o}).eq("id",p.id).select("*").single();f(l);const c=prompt("\u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0646\u0642\u062f\u064a\u0629:\n1 = \u0644\u0644\u0625\u062f\u0627\u0631\u0629\n2 = \u0644\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062a\u0627\u0644\u064a\u0629\n\u0627\u062a\u0631\u0643\u0647 \u0641\u0627\u0631\u063a\u064b\u0627 \u0644\u0644\u062a\u0623\u062c\u064a\u0644");"1"===c&&(await Or.from("reception_shift_handovers").insert({from_shift_id:l.id,to_manager_id:e.id,amount:n,created_by:e.id,note:"\u062a\u0633\u0644\u064a\u0645 \u0646\u0642\u062f\u064a \u0644\u0644\u0625\u062f\u0627\u0631\u0629"}),alert("\u062a\u0645 \u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0644\u0644\u0625\u062f\u0627\u0631\u0629.")),"2"===c&&(await Or.from("reception_shift_handovers").insert({from_shift_id:l.id,to_shift_id:null,amount:n,created_by:e.id,note:"\u062a\u0633\u0644\u064a\u0645 \u0646\u0642\u062f\u064a \u0644\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062a\u0627\u0644\u064a\u0629 (\u0645\u0639\u0644\u0651\u0642)"}),alert("\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u062a\u0633\u0644\u064a\u0645 \u0646\u0642\u062f\u064a \u0644\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u062a\u0627\u0644\u064a\u0629 (\u0645\u0639\u0644\u0651\u0642)."))},className:"bg-amber-600 text-white px-3 py-1 rounded",children:"\u0625\u063a\u0644\u0627\u0642 \u0648\u0631\u062f\u064a\u0629"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-100 p-4 rounded",children:["\u0648\u0635\u0648\u0644 \u0627\u0644\u064a\u0648\u0645: ",y.length]}),(0,a.jsxs)("div",{className:"bg-emerald-100 p-4 rounded",children:["\u0645\u063a\u0627\u062f\u0631\u0629 \u0627\u0644\u064a\u0648\u0645: ",w.length]}),(0,a.jsxs)("div",{className:"bg-purple-100 p-4 rounded",children:["\u0645\u0642\u064a\u0645\u0648\u0646: ",_.length]}),(0,a.jsxs)("div",{className:"bg-amber-100 p-4 rounded",children:["\u0642\u0627\u062f\u0645\u0648\u0646 3 \u0623\u064a\u0627\u0645: ",j.length]})]}),h&&(0,a.jsx)(Pr,{shift:p,onClose:()=>m(!1)})]})}function ls(e){let{initialData:t,buildings:n,floors:s,roomTypes:i,onClose:o,onSave:l}=e;const[c,d]=(0,r.useState)((null===t||void 0===t?void 0:t.building_id)||""),[u,h]=(0,r.useState)((null===t||void 0===t?void 0:t.floor_id)||""),[m,p]=(0,r.useState)((null===t||void 0===t?void 0:t.room_type_id)||""),[f,x]=(0,r.useState)((null===t||void 0===t?void 0:t.room_code)||""),[g,v]=(0,r.useState)((null===t||void 0===t?void 0:t.status)||"available"),[b,y]=(0,r.useState)((null===t||void 0===t?void 0:t.cleanliness)||"clean"),[w,_]=(0,r.useState)((null===t||void 0===t?void 0:t.description)||""),[j,N]=(0,r.useState)(()=>(Array.isArray(null===t||void 0===t?void 0:t.features)?t.features:[]).join(", ")),[k,S]=(0,r.useState)((null===t||void 0===t?void 0:t.image_url)||""),[C,E]=(0,r.useState)(!1),[T,O]=(0,r.useState)({});(0,r.useEffect)(()=>{if(u&&!c){const e=s.find(e=>String(e.id)===String(u));e&&d(e.building_id)}},[u,c,s]);const R=(0,r.useMemo)(()=>{if(!c)return s;const e=s.filter(e=>String(e.building_id)===String(c));return e.length>0?e:s},[s,c]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b",children:(0,a.jsx)("h3",{className:"text-xl font-bold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u063a\u0631\u0641\u0629":"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629 \u062c\u062f\u064a\u062f\u0629"})}),(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return c||(e.building_id="\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0628\u0646\u0649."),u||(e.floor_id="\u0627\u062e\u062a\u0631 \u0627\u0644\u0637\u0627\u0628\u0642."),m||(e.room_type_id="\u0627\u062e\u062a\u0631 \u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629."),f&&0!==String(f).trim().length||(e.room_code="\u0627\u0643\u062a\u0628 \u0631\u0642\u0645/\u0631\u0645\u0632 \u0627\u0644\u063a\u0631\u0641\u0629."),O(e),0===Object.keys(e).length})()){E(!0);try{await l({building_id:c,floor_id:u,room_type_id:m,room_code:f,status:g,cleanliness:b,description:w,features:j,image_url:k})}finally{E(!1)}}},className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u0628\u0646\u0649 *"}),(0,a.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:c,onChange:e=>{d(e.target.value),O(e=>Le(Le({},e),{},{building_id:void 0}))},children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0628\u0646\u0649"}),n.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),T.building_id&&(0,a.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.building_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0637\u0627\u0628\u0642 *"}),(0,a.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:u,onChange:e=>{h(e.target.value),O(e=>Le(Le({},e),{},{floor_id:void 0}))},children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0637\u0627\u0628\u0642"}),R.map(e=>{const t=e.name||e.floor_name||(e.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.floor_number):e.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.number):"\u0637\u0627\u0628\u0642 #".concat(e.id));return(0,a.jsx)("option",{value:e.id,children:t},e.id)})]}),T.floor_id&&(0,a.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.floor_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629 *"}),(0,a.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:m,onChange:e=>{p(e.target.value),O(e=>Le(Le({},e),{},{room_type_id:void 0}))},children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0646\u0648\u0639"}),i.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name_ar," (",Number(e.base_price)," \u062c\u0646\u064a\u0647)"]},e.id))]}),T.room_type_id&&(0,a.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.room_type_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u063a\u0631\u0641\u0629 *"}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:f,onChange:e=>{x(e.target.value),O(e=>Le(Le({},e),{},{room_code:void 0}))},placeholder:"A101"})}),T.room_code&&(0,a.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.room_code})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u062d\u0627\u0644\u0629 *"}),(0,a.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:g,onChange:e=>v(e.target.value),children:[(0,a.jsx)("option",{value:"available",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("option",{value:"reserved",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("option",{value:"occupied",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0646\u0638\u0627\u0641\u0629 *"}),(0,a.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:b,onChange:e=>y(e.target.value),children:[(0,a.jsx)("option",{value:"clean",children:"\u0646\u0638\u064a\u0641\u0629"}),(0,a.jsx)("option",{value:"in_cleaning",children:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641"}),(0,a.jsx)("option",{value:"needs_cleaning",children:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,a.jsx)("textarea",{className:"mt-1 border rounded w-full px-3 py-2",rows:3,value:w,onChange:e=>_(e.target.value),placeholder:"\u0648\u0635\u0641 \u0625\u0636\u0627\u0641\u064a..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u0645\u064a\u0632\u0627\u062a"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:j,onChange:e=>N(e.target.value),placeholder:"WiFi\u060c \u062a\u0644\u0641\u0627\u0632\u060c \u062a\u0643\u064a\u064a\u0641\u060c \u0645\u064a\u0646\u064a \u0628\u0627\u0631"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0635\u0648\u0631\u0629 \u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,a.jsx)("input",{className:"border rounded px-3 py-2 flex-1",value:k,onChange:e=>S(e.target.value),placeholder:"\u0631\u0627\u0628\u0637 \u0627\u0644\u0635\u0648\u0631\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,a.jsxs)("label",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-2 rounded cursor-pointer",children:["\u0631\u0641\u0639 \u0645\u0644\u0641",(0,a.jsx)("input",{type:"file",className:"hidden",onChange:e=>{var t;return(async t=>{try{if(!t)return;const e=t.name.split(".").pop(),n="room-".concat(Date.now(),".").concat(e),{error:r}=await Or.storage.from("room-images").upload(n,t,{upsert:!0});if(r)throw r;const{data:s}=Or.storage.from("room-images").getPublicUrl(n);S((null===s||void 0===s?void 0:s.publicUrl)||n)}catch(e){console.error("Upload failed",e),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629: "+(e.message||e))}})(null===(t=e.target.files)||void 0===t?void 0:t[0])}})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0645\u062d\u0633\u0648\u0628"}),(0,a.jsx)("div",{className:"mt-1 border rounded w-full px-3 py-2 bg-green-50 text-green-700",children:(()=>{const e=i.find(e=>String(e.id)===String(m)),t=Number((null===e||void 0===e?void 0:e.base_price)||0);return"".concat(t," \u062c\u0646\u064a\u0647/\u0644\u064a\u0644\u0629")})()})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:o,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"submit",disabled:C,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:C?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"})]})]})]})})}function cs(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[o,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[u,h]=(0,r.useState)([]),[m,p]=(0,r.useState)([]),[f,x]=(0,r.useState)([]),[g,v]=(0,r.useState)("all"),[b,y]=(0,r.useState)("all"),[w,_]=(0,r.useState)({available:!0,reserved:!0,occupied:!0,maintenance:!0}),[j,N]=(0,r.useState)({clean:!0,in_cleaning:!0,needs_cleaning:!0}),[k,S]=(0,r.useState)(""),[C,E]=(0,r.useState)(""),[T,O]=(0,r.useState)(0),[R,P]=(0,r.useState)(12),[A,D]=(0,r.useState)(0),[L,M]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{try{const e=new URLSearchParams(window.location.search||""),t=e.get("building"),n=e.get("floor");t&&v(t),n&&y(n)}catch(e){}},[]);const q=(0,r.useCallback)(async()=>{try{var e;const[{data:s,error:a}]=await Promise.all([Or.from("buildings").select("id,name").order("name")]);if(a)throw a;h(s||[]);let i=[],o=null;try{const{data:e,error:t}=await Or.from("floors").select("id,name,floor_number,number,building_id").order("id");if(t)throw t;i=e||[]}catch(t){o=t;try{const{data:e,error:t}=await Or.from("floors").select("*");if(t)throw t;i=e||[]}catch(n){console.error("Failed floors lookup (fallback also failed)",n),i=[]}}o&&console.warn("Floors initial fetch err:",(null===(e=o)||void 0===e?void 0:e.message)||o),p(i);try{const{data:e,error:t}=await Or.from("room_types_active").select("id,name,name_ar,base_price,max_guests").order("display_order");if(t)throw t;x(e||[])}catch(r){console.error("Failed room types lookup",r),x([])}}catch(s){console.error("Failed to load lookups",s)}},[]),U=(0,r.useCallback)(()=>{const e=Or.from("rooms_overview").select("*",{count:"exact"}).order("room_code",{ascending:!0}),t=(C||"").trim();t&&e.or("room_code.ilike.%".concat(t,"%,description.ilike.%").concat(t,"%"));const n=Object.entries(w).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});n.length>0&&n.length<4&&e.in("status",n);const r=Object.entries(j).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});r.length>0&&r.length<3&&e.in("cleanliness",r);const s=T*R,a=s+R-1;return e.range(s,a),e},[C,T,R,w,j]),z=(0,r.useCallback)(async()=>{i(!0);try{const e=U(),{data:t,error:r,count:s}=await e;if(r)throw r;if(t&&t.length>0)return n(t),D(s||t.length),void i(!1);console.warn("rooms_overview returned empty result, falling back to base tables")}catch(e){console.warn("rooms_overview unavailable or failed, falling back to base tables:",(null===e||void 0===e?void 0:e.message)||e)}try{const[e,r,s,a]=await Promise.all([Or.from("rooms").select("id, room_code, status, cleanliness, room_type_id, building_id, floor_id").order("room_code"),Or.from("room_types_active").select("id, name, name_ar, base_price, max_guests").order("display_order"),Or.from("buildings").select("id, name").order("name"),Or.from("floors").select("id, name, floor_number, number, building_id").order("id")]);let i=r.data||[];if(r.error||0===i.length)try{const e=await Or.from("room_types").select("id, name, name_ar, base_price, max_guests").order("id");e.error||(i=e.data||[])}catch(t){}const o=new Map;i.forEach(e=>o.set(String(e.id),e));const l=new Map;(s.data||[]).forEach(e=>l.set(String(e.id),e));const c=new Map;(a.data||[]).forEach(e=>c.set(String(e.id),e));let d=(e.data||[]).map(e=>{const t=o.get(String(e.room_type_id)),n=l.get(String(e.building_id)),r=c.get(String(e.floor_id)),s=e.room_code||(e.id?"\u063a\u0631\u0641\u0629 #".concat(String(e.id).slice(0,8)):"\u063a\u0631\u0641\u0629"),a=(null===n||void 0===n?void 0:n.name)||"\u0645\u0628\u0646\u0649",i=(null===r||void 0===r?void 0:r.name)||(null!==r&&void 0!==r&&r.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(r.floor_number):null!==r&&void 0!==r&&r.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(r.number):"\u0637\u0627\u0628\u0642"),d=(null===t||void 0===t?void 0:t.base_price)||0;return{id:e.id,room_code:e.room_code,room_label:s,status:e.status,cleanliness:e.cleanliness,max_guests:(null===t||void 0===t?void 0:t.max_guests)||0,room_type_name_ar:null===t||void 0===t?void 0:t.name_ar,room_type_name_en:null===t||void 0===t?void 0:t.name,computed_price:d,building_id:e.building_id,building_name:a,floor_id:e.floor_id,floor_name:i}});const u=(C||"").trim().toLowerCase();u&&(d=d.filter(e=>(e.room_code||"").toLowerCase().includes(u)||(e.room_label||"").toLowerCase().includes(u)));const h=Object.entries(w).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});h.length>0&&h.length<4&&(d=d.filter(e=>h.includes(e.status)));const m=Object.entries(j).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});m.length>0&&m.length<3&&(d=d.filter(e=>m.includes(e.cleanliness)));const p=d.length,f=T*R,x=f+R,g=d.slice(f,x);n(g),D(p)}catch(r){console.error("Fallback loadRooms from base tables failed",r),n([]),D(0)}finally{i(!1)}},[U,C,T,R,w,j]);(0,r.useEffect)(()=>{q(),z()},[q,z]),(0,r.useEffect)(()=>{const e=Or.channel("rooms-live").on("postgres_changes",{event:"*",schema:"public",table:"rooms"},()=>{z()}).on("postgres_changes",{event:"*",schema:"public",table:"reservations"},()=>{z()}).subscribe();return()=>{try{Or.removeChannel(e)}catch(t){}}},[z]),(0,r.useEffect)(()=>{const e=setTimeout(()=>E(k),350);return()=>clearTimeout(e)},[k]),(0,r.useEffect)(()=>{z()},[z,C,w,j,g,b,T,R]);const B=(0,r.useMemo)(()=>t.filter(e=>{if("all"!==g){if(String(e.building_id||e.building_name||"")!==String(g))return!1}if("all"!==b){if(String(e.floor_id||e.floor_name||"")!==String(b))return!1}return!0}),[t,g,b]),F=(0,r.useMemo)(()=>({total:B.length,available:B.filter(e=>"available"===e.status).length,reserved:B.filter(e=>"reserved"===e.status).length,occupied:B.filter(e=>"occupied"===e.status).length,maintenance:B.filter(e=>"maintenance"===e.status).length}),[B]),W=()=>{d(null),l(!0)},V=(0,r.useMemo)(()=>{if("all"===g)return m;const e=m.filter(e=>String(e.building_id)===String(g));return e.length>0?e:m},[m,g]),H=(0,r.useMemo)(()=>{const e=new Map;t.forEach(t=>{const n=String(t.building_id||t.building_name||"");n&&(e.has(n)||e.set(n,t.building_name||"\u0645\u0628\u0646\u0649"))});const n=Array.from(e.entries()).map(e=>{let[t,n]=e;return{value:t,label:n}});return n.length>0?n:u.map(e=>({value:String(e.id),label:e.name}))},[t,u]),K=(0,r.useMemo)(()=>V.map(e=>{const t=e.name||e.floor_name||(e.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.floor_number):e.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.number):"\u0637\u0627\u0628\u0642 #".concat(e.id));return{value:String(e.id),label:t}}),[V]),G=e=>_(t=>Le(Le({},t),{},{[e]:!t[e]})),J=e=>N(t=>Le(Le({},t),{},{[e]:!t[e]})),$=e=>{let{active:t,color:n,label:r,count:s,onClick:i,title:o}=e;return(0,a.jsxs)("button",{title:o,onClick:i,className:"px-3 py-1 rounded-full text-sm border ".concat(t?"bg-".concat(n,"-100 text-").concat(n,"-700 border-").concat(n,"-300"):"bg-white text-gray-600 border-gray-200"," hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"ml-2",children:r}),(0,a.jsx)("span",{className:"px-2 py-[1px] rounded text-xs ".concat(t?"bg-".concat(n,"-200 text-").concat(n,"-800"):"bg-gray-200 text-gray-700"),children:s})]})},Q=L.size,Y=(0,r.useMemo)(()=>0!==B.length&&B.every(e=>L.has(e.id)),[B,L]),X=async(t,n)=>{if(0!==L.size)try{const r=Array.from(L),{error:s}=await Or.from("rooms").update({[t]:n,updated_by:(null===e||void 0===e?void 0:e.id)||null}).in("id",r);if(s)throw s;M(new Set),await z()}catch(r){console.error("Bulk update failed",r),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0625\u062c\u0631\u0627\u0621 \u0627\u0644\u062c\u0645\u0627\u0639\u064a: "+(r.message||r))}};return(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u063a\u0631\u0641"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0646\u0638\u0627\u0645 \u0645\u062a\u0643\u0627\u0645\u0644 \u0644\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u063a\u0631\u0641 \u0645\u0639 \u0627\u0644\u0639\u062f\u0651\u0627\u062f\u0627\u062a \u0648\u0627\u0644\u062a\u0635\u0641\u064a\u0627\u062a"})]}),(0,a.jsx)("button",{onClick:W,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629 \u062c\u062f\u064a\u062f\u0629 +"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\u0635\u064a\u0627\u0646\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:F.maintenance})]}),(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:F.reserved})]}),(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-pink-600",children:F.occupied})]}),(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:F.available})]}),(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:F.total})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,a.jsxs)("select",{className:"border rounded px-3 py-2",value:g,onChange:e=>{v(e.target.value),y("all"),O(0)},children:[(0,a.jsx)("option",{value:"all",children:"\u0643\u0644 \u0627\u0644\u0645\u0628\u0627\u0646\u064a"}),H.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2",value:b,onChange:e=>{y(e.target.value),O(0)},children:[(0,a.jsx)("option",{value:"all",children:"\u0643\u0644 \u0627\u0644\u0637\u0648\u0627\u0628\u0642"}),K.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,a.jsx)("input",{className:"border rounded px-3 py-2 flex-1 min-w-[180px]",placeholder:"\u0628\u062d\u062b: \u0631\u0642\u0645/\u0648\u0635\u0641 \u0627\u0644\u063a\u0631\u0641\u0629",value:k,onChange:e=>{S(e.target.value),O(0)}}),(0,a.jsx)("button",{className:"border rounded px-3 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>{_({available:!0,reserved:!0,occupied:!0,maintenance:!0}),N({clean:!0,in_cleaning:!0,needs_cleaning:!0}),v("all"),y("all"),S(""),O(0)},children:"\u0625\u0639\u0627\u062f\u0629 \u0636\u0628\u0637"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-6",children:[(0,a.jsx)($,{title:"\u062d\u0627\u0644\u0629: \u0645\u062a\u0627\u062d\u0629",active:w.available,color:"green",label:"\u0645\u062a\u0627\u062d\u0629",count:B.filter(e=>"available"===e.status).length,onClick:()=>G("available")}),(0,a.jsx)($,{title:"\u062d\u0627\u0644\u0629: \u0645\u062d\u062c\u0648\u0632\u0629",active:w.reserved,color:"amber",label:"\u0645\u062d\u062c\u0648\u0632\u0629",count:B.filter(e=>"reserved"===e.status).length,onClick:()=>G("reserved")}),(0,a.jsx)($,{title:"\u062d\u0627\u0644\u0629: \u0645\u0634\u063a\u0648\u0644\u0629",active:w.occupied,color:"pink",label:"\u0645\u0634\u063a\u0648\u0644\u0629",count:B.filter(e=>"occupied"===e.status).length,onClick:()=>G("occupied")}),(0,a.jsx)($,{title:"\u062d\u0627\u0644\u0629: \u0635\u064a\u0627\u0646\u0629",active:w.maintenance,color:"red",label:"\u0635\u064a\u0627\u0646\u0629",count:B.filter(e=>"maintenance"===e.status).length,onClick:()=>G("maintenance")}),(0,a.jsx)("span",{className:"mx-2 text-gray-400",children:"|"}),(0,a.jsx)($,{title:"\u0646\u0638\u0627\u0641\u0629: \u0646\u0638\u064a\u0641\u0629",active:j.clean,color:"green",label:"\u0646\u0638\u064a\u0641\u0629",count:B.filter(e=>"clean"===e.cleanliness).length,onClick:()=>J("clean")}),(0,a.jsx)($,{title:"\u0646\u0638\u0627\u0641\u0629: \u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",active:j.in_cleaning,color:"amber",label:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",count:B.filter(e=>"in_cleaning"===e.cleanliness).length,onClick:()=>J("in_cleaning")}),(0,a.jsx)($,{title:"\u0646\u0638\u0627\u0641\u0629: \u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",active:j.needs_cleaning,color:"red",label:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",count:B.filter(e=>"needs_cleaning"===e.cleanliness).length,onClick:()=>J("needs_cleaning")})]}),!s&&B.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)("input",{type:"checkbox",checked:Y,onChange:e=>{return t=e.target.checked,void M(e=>{const n=new Set(e);return t?B.forEach(e=>n.add(e.id)):B.forEach(e=>n.delete(e.id)),n});var t}}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"\u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0643\u0644 (\u0627\u0644\u0639\u0646\u0627\u0635\u0631 \u0627\u0644\u0638\u0627\u0647\u0631\u0629)"})]}),s?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden animate-pulse",children:[(0,a.jsx)("div",{className:"h-1 bg-gray-200"}),(0,a.jsx)("div",{className:"px-4 pt-4 h-6 bg-gray-100 mb-2"}),(0,a.jsxs)("div",{className:"px-4 pb-4 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-100"}),(0,a.jsx)("div",{className:"h-4 bg-gray-100 w-2/3"}),(0,a.jsx)("div",{className:"h-4 bg-gray-100 w-1/2"})]})]},t))}):0===B.length?(0,a.jsxs)("div",{className:"p-6 bg-white rounded shadow flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold mb-1",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0646\u062a\u0627\u0626\u062c \u0645\u0637\u0627\u0628\u0642\u0629"}),(0,a.jsx)("div",{className:"text-gray-600",children:"\u062c\u0631\u0651\u0628 \u062a\u0639\u062f\u064a\u0644 \u0639\u0648\u0627\u0645\u0644 \u0627\u0644\u0628\u062d\u062b \u0623\u0648 \u0623\u0636\u0641 \u063a\u0631\u0641\u0629 \u062c\u062f\u064a\u062f\u0629."})]}),(0,a.jsx)("button",{onClick:W,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:B.map(t=>(0,a.jsx)(ss,{room:t,onEdit:()=>(d(t),void l(!0)),onDelete:()=>(async t=>{try{if(!I(e))return void window.alert("\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u062d\u0630\u0641 \u0627\u0644\u063a\u0631\u0641. \u0647\u0630\u0647 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0644\u0644\u0645\u062f\u064a\u0631 \u0641\u0642\u0637.");if(!t||!t.id)return;const r=window.prompt("\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641 \u0627\u0643\u062a\u0628: ok","");if(!r||"ok"!==String(r).trim().toLowerCase())return void window.alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062d\u0630\u0641.");try{await Or.from("rooms").update({updated_by:(null===e||void 0===e?void 0:e.id)||null}).eq("id",t.id)}catch(n){}const{error:s}=await Or.from("rooms").delete().eq("id",t.id);if(s)throw s;await z()}catch(r){console.error("Delete room failed",r),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u063a\u0631\u0641\u0629: "+(r.message||r))}})(t),onSelect:()=>{return e=t.id,void M(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});var e},selected:L.has(t.id)},t.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",t.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",A]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>O(e=>Math.max(0,e-1)),disabled:0===T,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,a.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",T+1]}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>O(e=>e+1),disabled:(T+1)*R>=A,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:R,onChange:e=>{P(Number(e.target.value)),O(0)},children:[(0,a.jsx)("option",{value:6,children:"6"}),(0,a.jsx)("option",{value:12,children:"12"}),(0,a.jsx)("option",{value:24,children:"24"})]})]})]}),Q>0&&(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 bg-white border shadow-lg rounded p-3 flex items-center gap-2",dir:"rtl",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["\u0627\u0644\u0645\u062d\u062f\u062f: ",Q]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",onChange:e=>{const t=e.target.value;t&&X("status",t),e.target.value=""},children:[(0,a.jsx)("option",{value:"",children:"\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u062d\u0627\u0644\u0629..."}),(0,a.jsx)("option",{value:"available",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("option",{value:"reserved",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("option",{value:"occupied",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",onChange:e=>{const t=e.target.value;t&&X("cleanliness",t),e.target.value=""},children:[(0,a.jsx)("option",{value:"",children:"\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0646\u0638\u0627\u0641\u0629..."}),(0,a.jsx)("option",{value:"clean",children:"\u0646\u0638\u064a\u0641\u0629"}),(0,a.jsx)("option",{value:"in_cleaning",children:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641"}),(0,a.jsx)("option",{value:"needs_cleaning",children:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629"})]}),(0,a.jsx)("button",{className:"border rounded px-2 py-1",onClick:()=>M(new Set),children:"\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062a\u062d\u062f\u064a\u062f"})]}),o&&(0,a.jsx)(ls,{initialData:c,buildings:u,floors:m,roomTypes:f,onClose:()=>l(!1),onSave:async t=>{try{const n={building_id:t.building_id,floor_id:t.floor_id,room_type_id:t.room_type_id,room_code:(t.room_code||"").trim(),room_number:(t.room_code||"").trim(),status:t.status||"available",cleanliness:t.cleanliness||"clean",description:t.description||null,features:Array.isArray(t.features)?t.features:String(t.features||"").split(",").map(e=>e.trim()).filter(Boolean),image_url:t.image_url||null};c&&c.id?n.updated_by=(null===e||void 0===e?void 0:e.id)||null:n.created_by=(null===e||void 0===e?void 0:e.id)||null;const r=async()=>c&&c.id?Or.from("rooms").update(n).eq("id",c.id):Or.from("rooms").insert([n]);let{error:s}=await r();if(s){const e=String(s.message||s).toLowerCase();if(e.includes("room_number")&&e.includes("does not exist")){delete n.room_number;s=(await r()).error}if(s){const e=String(s.message||s).toLowerCase();["view_id","room_view_id"].forEach(t=>{e.includes(t)&&delete n[t]})}if(s)throw s}l(!1),await z()}catch(n){console.error("Save room failed",n),window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u063a\u0631\u0641\u0629: "+(n.message||n))}}})]})}const ds={pending:{color:"#F59E0B",labelAr:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"},confirmed:{color:"#10B981",labelAr:"\u0645\u0624\u0643\u062f"},checked_in:{color:"#3B82F6",labelAr:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"},checked_out:{color:"#6B7280",labelAr:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"},canceled:{color:"#EF4444",labelAr:"\u0645\u0644\u063a\u064a"},cancelled:{color:"#EF4444",labelAr:"\u0645\u0644\u063a\u064a"},no_show:{color:"#F59E0B",labelAr:"\u0644\u0645 \u064a\u062d\u0636\u0631"},empty:{color:"#E5E7EB",labelAr:"\u0641\u0627\u0631\u063a"}},us={available:{color:"#10B981",labelAr:"\u0645\u062a\u0627\u062d\u0629"},reserved:{color:"#F59E0B",labelAr:"\u0645\u062d\u062c\u0648\u0632\u0629"},occupied:{color:"#3B82F6",labelAr:"\u0645\u0634\u063a\u0648\u0644\u0629"},maintenance:{color:"#6B7280",labelAr:"\u0635\u064a\u0627\u0646\u0629"},unknown:{color:"#9CA3AF",labelAr:"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"}},hs={occupied:{color:"#3B82F6",labelAr:"\u0645\u0634\u063a\u0648\u0644"},empty:{color:"#E5E7EB",labelAr:"\u0641\u0627\u0631\u063a"}},ms={clean:{color:"#10B981",labelAr:"\u0646\u0638\u064a\u0641\u0629"},in_cleaning:{color:"#F59E0B",labelAr:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641"},needs_cleaning:{color:"#EF4444",labelAr:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629"}};function ps(e){const t=String(e||"").toLowerCase();return(ds[t]||ds.empty).color}function fs(e){const t=String(e||"").toLowerCase();return(ds[t]||{labelAr:"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"}).labelAr}function xs(e){const t=String(e||"").toLowerCase();return(us[t]||us.unknown).color}function gs(e){const t=String(e||"").toLowerCase();return(us[t]||us.unknown).labelAr}function vs(e){const t=String(e||"").toLowerCase();return(hs[t]||hs.empty).color}function bs(e){const t=String(e||"").toLowerCase();return(ms[t]||ms.clean).labelAr}function ys(e){let{selectedDate:t,onDateChange:n,searchQuery:s="",refreshTick:i=0}=e;const o=(0,r.useContext)(la),[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[p,f]=(0,r.useState)(()=>{const e=new Date;return e.setHours(0,0,0,0),e.toISOString().slice(0,10)}),[x,g]=(0,r.useState)(null),[v,b]=(0,r.useState)(!0),[y,w]=(0,r.useState)(null),[_,j]=(0,r.useState)(null),[N,k]=(0,r.useState)("full"),[S,C]=(0,r.useState)(""),[E,T]=(0,r.useState)(""),O=async()=>{m(!0);try{const{data:e,error:t}=await Or.from("rooms_overview").select("*").order("room_code");if(t)throw t;c(e||[])}catch(e){console.error("Calendar load failed",e),c([])}finally{m(!1)}},R=async(e,t)=>{try{const{data:n,error:r}=await Or.rpc("get_calendar_reservations",{p_start:e,p_end:t});if(r)throw r;u(n||[])}catch(n){console.error("Load calendar reservations failed",n),u([])}};(0,r.useEffect)(()=>{O()},[]),(0,r.useEffect)(()=>{const e=new Date(p);e.setDate(e.getDate()+6),R(p,e.toISOString().slice(0,10))},[p]),(0,r.useEffect)(()=>{t&&t!==p&&f(t)},[t]),(0,r.useEffect)(()=>{const e=new Date(p);e.setDate(e.getDate()+6),O(),R(p,e.toISOString().slice(0,10))},[i]);const P=(e=>{const t=[],n=new Date(e);for(let r=0;r<7;r++){const e=new Date(n);e.setDate(n.getDate()+r),t.push(e)}return t})(p),I=(0,r.useMemo)(()=>{if(!y)return[];const e=y;return(d||[]).filter(t=>e>=t.start_date&&e<t.end_date).sort((e,t)=>{const n=(e.room_label||"").localeCompare(t.room_label||"","ar");return 0!==n?n:String(e.start_date||"").localeCompare(String(t.start_date||""))})},[y,d]),A=(0,r.useMemo)(()=>{if(!y)return"";const e=new Date(y+"T00:00:00");return Number.isNaN(e.getTime())?y:e.toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"})},[y]);return(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u062a\u0642\u0648\u064a\u0645 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a (\u0623\u0633\u0628\u0648\u0639)"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0635\u064f\u0645\u0651\u0645 \u0644\u064a\u0633\u0647\u0651\u0644 \u0639\u0644\u0649 \u0627\u0644\u0645\u0628\u062a\u062f\u0626 \u0641\u0647\u0645 \u0627\u0644\u062d\u0627\u0644\u0629 \u0648\u0627\u0644\u062d\u0631\u0643\u0629"}),v&&(0,a.jsxs)("div",{className:"mt-2 text-xs bg-amber-50 border border-amber-200 text-amber-800 rounded px-3 py-2 max-w-2xl",children:["\u2022 \u0627\u062e\u062a\u0631 \u062a\u0627\u0631\u064a\u062e \u0628\u062f\u0627\u064a\u0629 \u0627\u0644\u0623\u0633\u0628\u0648\u0639 \u0645\u0646 \u0627\u0644\u0645\u0631\u0628\u0639 \u0627\u0644\u0645\u062c\u0627\u0648\u0631 \u0644\u0639\u0631\u0636 \u0623\u0633\u0628\u0648\u0639 \u0643\u0627\u0645\u0644.",(0,a.jsx)("br",{}),"\u2022 \u0645\u0631\u0628\u0639\u0627\u062a \u0645\u0644\u0648\u0651\u0646\u0629 \u062a\u0639\u0646\u064a \u0623\u064a\u0627\u0645\u064b\u0627 \u0645\u062d\u062c\u0648\u0632\u0629. \u0627\u0644\u0644\u0648\u0646 \u064a\u0648\u0636\u0651\u062d \u0627\u0644\u062d\u0627\u0644\u0629 (\u0627\u0646\u0638\u0631 \u0627\u0644\u062f\u0644\u064a\u0644 \u0623\u062f\u0646\u0627\u0647).",(0,a.jsx)("br",{}),"\u2022 \u0644\u0644\u062a\u0645\u062f\u064a\u062f: \u0627\u0633\u062d\u0628 \u0645\u0646 \u0645\u0631\u0628\u0639 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 \u064a\u0648\u0645 \u0623\u0628\u0639\u062f \u0641\u064a \u0646\u0641\u0633 \u0635\u0641 \u0627\u0644\u063a\u0631\u0641\u0629.",(0,a.jsx)("br",{}),"\u2022 \u0644\u0644\u0646\u0642\u0644: \u0627\u0633\u062d\u0628 \u0645\u0646 \u0645\u0631\u0628\u0639 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 \u0635\u0641 \u063a\u0631\u0641\u0629 \u0623\u062e\u0631\u0649 \u0641\u0627\u0631\u063a\u0629\u060c \u0648\u0633\u064a\u064f\u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0644\u0646\u0641\u0633 \u0639\u062f\u062f \u0627\u0644\u0644\u064a\u0627\u0644\u064a.",(0,a.jsx)("br",{}),"\u2022 \u0644\u0644\u062a\u0628\u062f\u064a\u0644: \u0627\u0633\u062d\u0628 \u0645\u0646 \u0645\u0631\u0628\u0639 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 \u0635\u0641 \u063a\u0631\u0641\u0629 \u0623\u062e\u0631\u0649 \u0645\u0634\u063a\u0648\u0644\u0629 \u0641\u064a \u0646\u0641\u0633 \u0627\u0644\u0641\u062a\u0631\u0629\u060c \u0648\u0633\u064a\u064f\u0639\u0631\u0636 \u062e\u064a\u0627\u0631 \u0644\u062a\u0628\u062f\u064a\u0644 \u0627\u0644\u063a\u0631\u0641 \u0628\u064a\u0646 \u0627\u0644\u062d\u062c\u0632\u064a\u0646."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{className:"border rounded px-3 py-2",type:"date",value:p,onChange:e=>{f(e.target.value),n&&n(e.target.value)}}),(0,a.jsx)("button",{className:"px-3 py-2 border rounded text-sm",onClick:()=>b(e=>!e),children:v?"\u0625\u062e\u0641\u0627\u0621 \u0627\u0644\u062a\u0639\u0644\u064a\u0645\u0627\u062a":"\u0625\u0638\u0647\u0627\u0631 \u0627\u0644\u062a\u0639\u0644\u064a\u0645\u0627\u062a"})]})]}),(0,a.jsxs)("div",{className:"mb-4 bg-white border rounded p-3 text-xs max-w-2xl",children:[(0,a.jsx)("div",{className:"font-semibold mb-2",children:"\u062f\u0644\u064a\u0644 \u0627\u0644\u0623\u0644\u0648\u0627\u0646"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:[{k:"pending",name:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"},{k:"confirmed",name:"\u0645\u0624\u0643\u062f"},{k:"checked_in",name:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"},{k:"checked_out",name:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"},{k:"canceled",name:"\u0645\u0644\u063a\u064a"},{k:"empty",name:"\u0641\u0627\u0631\u063a"}].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-block w-4 h-4 rounded",style:{backgroundColor:"empty"===e.k?ds.empty.color:ps(e.k)}}),(0,a.jsx)("span",{children:e.name})]},t))})]}),(0,a.jsx)("div",{className:"max-h-[70vh] overflow-auto bg-white rounded shadow relative",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white z-10",children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"border-b px-3 py-2 text-right w-40",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),P.map((e,t)=>{const n=e.toISOString().slice(0,10),r=new Date;r.setHours(0,0,0,0);const s=n===r.toISOString().slice(0,10);return(0,a.jsx)("th",{className:"border-b px-3 py-2 text-center w-32 ".concat(s?"bg-emerald-50":""),children:(0,a.jsxs)("button",{type:"button",className:"w-full text-xs sm:text-sm hover:bg-emerald-100 rounded px-1 py-1",onClick:()=>w(n),children:[e.toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"numeric"}),s&&(0,a.jsx)("span",{className:"ml-1 text-[10px] text-emerald-700",children:"\u0627\u0644\u064a\u0648\u0645"})]})},t)})]})}),(0,a.jsx)("tbody",{children:h?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"px-3 py-4 text-center",children:"\u062a\u062d\u0645\u064a\u0644..."})}):l.filter(e=>{const t=(s||"").trim();if(!t)return!0;const n=(e.room_code||e.room_label||"").toLowerCase().includes(t.toLowerCase()),r=d.some(n=>n.room_id===e.id&&(n.guest_names||n.guest_name||"").toLowerCase().includes(t.toLowerCase()));return n||r}).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"border-t px-3 py-2",children:[e.room_code," \u2013 ",e.room_type_name_ar]}),P.map((t,n)=>{const r=t.toISOString().slice(0,10);let i=d.find(t=>t.room_id===e.id&&r>=t.start_date&&r<t.end_date);const l=(s||"").trim().toLowerCase();if(i&&l){(i.guest_names||i.guest_name||"").toLowerCase().includes(l)||(i=null)}const c=i?ps(i.status):ds.empty.color,u=i&&"agency"===i.payer_type&&i.agency_name?"\n\u0634\u0631\u0643\u0629: ".concat(i.agency_name):"",h=i?"".concat(i.room_label," | ").concat(i.guest_names||i.guest_name).concat(u,"\n").concat(i.start_date," \u2192 ").concat(i.end_date," \u2022 ").concat(fs(i.status)):"\u0641\u0627\u0631\u063a",m=i&&(i.guest_names||i.guest_name)||"",f=m?m.split("\u060c").map(e=>e.trim()).filter(Boolean):[],v=f.length>0?f[0]:"",b=f.length>1?f.length-1:0;return(0,a.jsx)("td",{className:"border-t px-3 py-2 select-none",onMouseDown:()=>{i&&g({res:i,startDate:r})},onMouseUp:async()=>{if(x&&x.res){if(x.res.room_id===e.id)return x.startDate!==r&&j({type:"extend",res:x.res,fromDay:x.startDate,newEnd:r}),void g(null);try{const t=(d||[]).find(t=>t.room_id===e.id&&r>=t.start_date&&r<t.end_date),n=o&&o.id?o.id:null;if(t&&String(t.id)!==String(x.res.id)){if(!window.confirm("\u0627\u0644\u063a\u0631\u0641\u0629 ".concat(e.room_code||e.room_label," \u062a\u062d\u062a\u0648\u064a \u0639\u0644\u0649 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0641\u062a\u0631\u0629.\n")+"\u0647\u0644 \u062a\u0631\u064a\u062f \u062a\u0628\u062f\u064a\u0644 \u0627\u0644\u063a\u0631\u0641 \u0628\u064a\u0646 \u0627\u0644\u062d\u062c\u0632\u064a\u0646 \u0645\u0639 \u0627\u0644\u0627\u062d\u062a\u0641\u0627\u0638 \u0628\u0646\u0641\u0633 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e\u061f"))return;const{error:r}=await Or.rpc("swap_room_reservations",{p_reservation_id1:x.res.id,p_reservation_id2:t.id,p_staff_user_id:n});if(r)throw r;const s=new Date(p);s.setDate(s.getDate()+6),await R(p,s.toISOString().slice(0,10))}else{const t=(new Date(x.res.end_date)-new Date(x.res.start_date))/864e5,n=r,s=new Date(n);s.setDate(s.getDate()+t);const a=s.toISOString().slice(0,10);k("full"),C(x.startDate);const i=new Date(x.startDate);i.setDate(i.getDate()+1);const o=i.toISOString().slice(0,10);T(o),j({type:"move",res:x.res,fromDay:x.startDate,targetRoom:e,targetDay:r,newStart:n,newEnd:a})}}catch(t){console.error("Move failed",t),alert("\u062a\u0639\u0630\u0651\u0631 \u0646\u0642\u0644 / \u062a\u0628\u062f\u064a\u0644 \u0627\u0644\u062d\u062c\u0632: "+(t.message||t))}finally{g(null)}}},onMouseLeave:()=>{},children:(0,a.jsx)("div",{className:"h-8 rounded flex items-center justify-center",style:{backgroundColor:c,cursor:i?"grab":"default"},title:h,children:i&&(0,a.jsxs)("div",{className:"bg-white/95 text-gray-800 text-[10px] px-2 py-[2px] rounded-sm shadow-sm border border-white/80 max-w-full flex flex-col gap-0.5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,a.jsx)("span",{className:"truncate","aria-label":"\u0627\u0644\u0633\u0627\u0643\u0646 \u0627\u0644\u0631\u0626\u064a\u0633\u064a",children:v}),b>0&&(0,a.jsxs)("span",{className:"text-gray-500","aria-label":"\u0639\u062f\u062f \u0627\u0644\u0636\u064a\u0648\u0641 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u064a\u0646",children:["+",b]})]}),"agency"===i.payer_type&&i.agency_name&&(0,a.jsx)("div",{className:"flex items-center gap-1 min-w-0",children:(0,a.jsxs)("span",{className:"inline-flex items-center px-1.5 py-px rounded-full bg-emerald-50 border border-emerald-300 text-emerald-800 text-[9px] font-semibold truncate max-w-full",children:[(0,a.jsx)("span",{className:"mr-1",children:"\u0634\u0631\u0643\u0629"}),(0,a.jsx)("span",{className:"truncate",children:i.agency_name})]})})]})})},n)})]},e.id))})]})}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-40 flex items-start justify-center px-2 sm:px-4 py-6",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-4xl max-h-[80vh] overflow-auto",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b flex items-center justify-between sticky top-0 bg-white z-10",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold text-sm sm:text-base",children:"\u0645\u0644\u062e\u0651\u0635 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:A})]}),(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700 text-sm",onClick:()=>w(null),children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsxs)("div",{className:"p-3 space-y-3",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["\u0639\u062f\u062f \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645: ",(0,a.jsx)("span",{className:"font-semibold",children:I.length})]}),0===I.length?(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645."}):(0,a.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{className:"text-right",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0632\u064a\u0644 / \u0627\u0644\u0636\u064a\u0648\u0641"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0641\u062a\u0631\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062d\u0627\u0644\u0629"})]})}),(0,a.jsx)("tbody",{children:I.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:e.room_label}),(0,a.jsxs)("td",{className:"px-3 py-2 text-xs",children:[(0,a.jsx)("div",{children:e.guest_names||e.guest_name}),"agency"===e.payer_type&&e.agency_name&&(0,a.jsxs)("div",{className:"text-[10px] text-emerald-700 mt-0.5",children:["\u0634\u0631\u0643\u0629: ",e.agency_name]})]}),(0,a.jsxs)("td",{className:"px-3 py-2 whitespace-nowrap",children:[e.start_date," \u2192 ",e.end_date]}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] text-white",style:{backgroundColor:ps(e.status)},children:fs(e.status)})})]},e.id))})]})})]})]})}),_&&"extend"===_.type&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-40 flex items-center justify-center px-2 sm:px-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-bold text-sm sm:text-base",children:"\u062a\u0623\u0643\u064a\u062f \u062a\u0639\u062f\u064a\u0644 \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c"}),(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700 text-sm",onClick:()=>j(null),children:"\u0625\u0644\u063a\u0627\u0621"})]}),(0,a.jsxs)("div",{className:"p-4 text-sm space-y-2",children:[(0,a.jsxs)("div",{children:["\u0627\u0644\u0646\u0632\u064a\u0644: ",(0,a.jsx)("span",{className:"font-semibold",children:_.res.guest_names||_.res.guest_name})]}),(0,a.jsxs)("div",{children:["\u0627\u0644\u063a\u0631\u0641\u0629: ",(0,a.jsx)("span",{className:"font-semibold",children:_.res.room_label})]}),(0,a.jsxs)("div",{children:["\u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u062d\u0627\u0644\u064a\u0629: ",(0,a.jsxs)("span",{className:"font-semibold",children:[_.res.start_date," \u2192 ",_.res.end_date]})]}),(0,a.jsxs)("div",{children:["\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u0627\u0644\u062c\u062f\u064a\u062f \u0627\u0644\u0645\u0642\u062a\u0631\u062d: ",(0,a.jsx)("span",{className:"font-semibold",children:_.newEnd})]}),(0,a.jsx)("div",{className:"text-xs text-amber-600 bg-amber-50 border border-amber-100 rounded px-2 py-1",children:"\u0633\u064a\u062a\u0645 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u0639\u062f\u0645 \u0648\u062c\u0648\u062f \u062a\u0639\u0627\u0631\u0636 \u0642\u0628\u0644 \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644."})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1.5 border rounded text-sm",onClick:()=>j(null),children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white text-sm",onClick:async()=>{try{const e=o&&o.id?o.id:null,{error:t}=await Or.rpc("extend_reservation",{p_reservation_id:_.res.id,p_new_check_out:_.newEnd,p_staff_user_id:e});if(t)throw t;const n=new Date(p);n.setDate(n.getDate()+6),await R(p,n.toISOString().slice(0,10)),j(null)}catch(e){console.error("Confirm extend failed",e),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0639\u062f\u064a\u0644 \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c: "+(e.message||e))}},children:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062a\u0639\u062f\u064a\u0644"})]})]})}),_&&"move"===_.type&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-40 flex items-center justify-center px-2 sm:px-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-bold text-sm sm:text-base",children:"\u062a\u0623\u0643\u064a\u062f \u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632"}),(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700 text-sm",onClick:()=>j(null),children:"\u0625\u0644\u063a\u0627\u0621"})]}),(0,a.jsxs)("div",{className:"p-4 text-sm space-y-2",children:[(0,a.jsxs)("div",{children:["\u0627\u0644\u0646\u0632\u064a\u0644: ",(0,a.jsx)("span",{className:"font-semibold",children:_.res.guest_names||_.res.guest_name})]}),(0,a.jsxs)("div",{children:["\u0645\u0646 \u0627\u0644\u063a\u0631\u0641\u0629: ",(0,a.jsx)("span",{className:"font-semibold",children:_.res.room_label})]}),(0,a.jsxs)("div",{children:["\u0625\u0644\u0649 \u0627\u0644\u063a\u0631\u0641\u0629: ",(0,a.jsx)("span",{className:"font-semibold",children:_.targetRoom.room_code||_.targetRoom.room_label})]}),(0,a.jsxs)("div",{children:["\u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064a\u0629: ",(0,a.jsxs)("span",{className:"font-semibold",children:[_.res.start_date," \u2192 ",_.res.end_date]})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"font-semibold mb-1",children:"\u0646\u0648\u0639 \u0627\u0644\u0646\u0642\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628:"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"moveMode",value:"full",checked:"full"===N,onChange:()=>k("full")}),(0,a.jsx)("span",{children:"\u0646\u0642\u0644 \u0643\u0627\u0645\u0644 \u0627\u0644\u0625\u0642\u0627\u0645\u0629 \u0625\u0644\u0649 \u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629 (\u064a\u0628\u062f\u0623 \u0645\u0646 \u0627\u0644\u064a\u0648\u0645 \u0627\u0644\u0645\u062e\u062a\u0627\u0631 \u0641\u064a \u0627\u0644\u062a\u0642\u0648\u064a\u0645)."})]}),(0,a.jsxs)("label",{className:"flex items-start gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"moveMode",value:"segment",checked:"segment"===N,onChange:()=>k("segment")}),(0,a.jsxs)("span",{children:["\u0646\u0642\u0644 \u062c\u0632\u0621 \u0645\u0646 \u0627\u0644\u0625\u0642\u0627\u0645\u0629 \u0641\u0642\u0637 (\u0645\u062b\u0644\u0627\u064b \u064a\u0648\u0645 \u0648\u0627\u062d\u062f \u0623\u0648 \u0623\u0643\u062b\u0631) \u0625\u0644\u0649 \u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629.",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u064a\u0645\u0643\u0646\u0643 \u0627\u062e\u062a\u064a\u0627\u0631 \u0627\u0644\u0641\u062a\u0631\u0629 \u062f\u0627\u062e\u0644 \u0627\u0644\u062d\u062c\u0632 \u0627\u0644\u0623\u0635\u0644\u064a."})]})]})]})]}),"segment"===N&&(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"\u0628\u062f\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621 \u0627\u0644\u0645\u0631\u0627\u062f \u0646\u0642\u0644\u0647"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-2 py-1 w-full",value:S,min:_.res.start_date,max:_.res.end_date,onChange:e=>C(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1",children:"\u0646\u0647\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621 \u0627\u0644\u0645\u0631\u0627\u062f \u0646\u0642\u0644\u0647"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-2 py-1 w-full",value:E,min:S||_.res.start_date,max:_.res.end_date,onChange:e=>T(e.target.value)}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500 mt-1",children:"\u0627\u0644\u0646\u0647\u0627\u064a\u0629 \u062a\u064f\u0639\u062a\u0628\u0631 \u064a\u0648\u0645 \u0627\u0644\u062e\u0631\u0648\u062c (\u063a\u064a\u0631 \u0645\u064f\u0634\u0645\u0648\u0644 \u0641\u064a \u0627\u0644\u0625\u0642\u0627\u0645\u0629)\u060c \u0623\u064a \u0627\u0644\u0641\u062a\u0631\u0629 [\u0645\u0646\u060c \u0625\u0644\u0649)."})]})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1.5 border rounded text-sm",onClick:()=>j(null),children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white text-sm",onClick:async()=>{try{const e=o&&o.id?o.id:null,t=_.res;if("full"===N){const{error:e}=await Or.rpc("move_reservation",{p_reservation_id:t.id,p_new_room_id:_.targetRoom.id,p_new_check_in:_.newStart,p_new_check_out:_.newEnd});if(e)throw e}else{if(!S||!E)return void alert("\u0628\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0628\u062f\u0627\u064a\u0629 \u0648\u0646\u0647\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621 \u0627\u0644\u0645\u0631\u0627\u062f \u0646\u0642\u0644\u0647.");const{error:n}=await Or.rpc("split_and_move_reservation",{p_reservation_id:t.id,p_segment_start:S,p_segment_end:E,p_target_room_id:_.targetRoom.id,p_staff_user_id:e});if(n)throw n}const n=new Date(p);n.setDate(n.getDate()+6),await R(p,n.toISOString().slice(0,10)),j(null)}catch(e){console.error("Confirm move failed",e),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0646\u0641\u064a\u0630 \u0639\u0645\u0644\u064a\u0629 \u0627\u0644\u0646\u0642\u0644: "+(e.message||e))}},children:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u0646\u0642\u0644"})]})]})}),!h&&0===l.length&&(0,a.jsx)("div",{className:"mt-4 text-sm bg-blue-50 border border-blue-200 text-blue-800 rounded px-3 py-2",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641 \u0645\u0639\u0631\u0648\u0636\u0629. \u0623\u0636\u0641 \u063a\u0631\u0641\u064b\u0627 \u0623\u0648\u0644\u064b\u0627 \u0645\u0646 \u0635\u0641\u062d\u0629 \u0627\u0644\u063a\u0631\u0641 \u0644\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0648\u064a\u0645."})]})}const ws=[{value:"pending",label:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"},{value:"confirmed",label:"\u0645\u0624\u0643\u062f"},{value:"checked_in",label:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"},{value:"checked_out",label:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"},{value:"cancelled",label:"\u0645\u0644\u063a\u064a"},{value:"no_show",label:"\u0644\u0645 \u064a\u062d\u0636\u0631"}];function _s(e){var t,n,s;let{initialData:i,onClose:o,onSave:l,onAfterAction:c,groupMode:d=!1}=e;const[u,h]=(0,r.useState)(!1),[m,p]=(0,r.useState)([]),[f,x]=(0,r.useState)("all"),[g,v]=(0,r.useState)(""),[b,y]=(0,r.useState)([]),[w,_]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!0),[k,S]=(0,r.useState)(!1),[C,E]=(0,r.useState)([]),[T,O]=(0,r.useState)({}),[P,I]=(0,r.useState)([]),[A,D]=(0,r.useState)(!1),[L,M]=(0,r.useState)({guest_id:null,room_id:null,check_in_date:"",check_out_date:"",guests_count:1,status:"confirmed",nightly_rate:null,total_amount:null,amount_paid:0,currency:"EGP",payment_method:"cash",payer_type:"guest",agency_name:"",special_requests:"",notes:"",pending_guest_ids:[]}),q=(0,r.useContext)(la),U=R(q),z=["[\u062a\u0639\u062f\u064a\u0644 \u062a\u0648\u0627\u0631\u064a\u062e \u0625\u0642\u0627\u0645\u0629]","[\u062a\u0639\u062f\u064a\u0644 \u0625\u062c\u0645\u0627\u0644\u064a/\u0633\u0639\u0631]","[\u0625\u0644\u063a\u0627\u0621 \u0645\u0639 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0643\u0627\u0645\u0644]","[\u0625\u0644\u063a\u0627\u0621 \u0645\u0639 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062c\u0632\u0626\u064a]","[\u0625\u0644\u063a\u0627\u0621 \u0628\u062f\u0648\u0646 \u0627\u0633\u062a\u0631\u062f\u0627\u062f]"],B=(0,r.useMemo)(()=>{const e=b.find(e=>String(e.id)===String(L.room_id));return(null===e||void 0===e?void 0:e.max_guests)||null},[b,L.room_id]),F=(0,r.useMemo)(()=>{const e=new Map;return(b||[]).forEach(t=>{if(!t.room_type_id)return;const n=String(t.room_type_id),r=e.get(n)||{id:t.room_type_id,name:t.room_type_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f",count:0};r.count+=1,!r.name&&t.room_type_name&&(r.name=t.room_type_name),e.set(n,r)}),Array.from(e.values())},[b]),W=(0,r.useMemo)(()=>{if(!d||!P||0===P.length)return b;const e=new Set((P||[]).map(e=>String(e)));return(b||[]).filter(t=>e.has(String(t.room_type_id)))},[b,d,P]);(0,r.useEffect)(()=>{(async()=>{try{const{data:e,error:t}=await Or.from("guests_overview").select("id, full_name, phone, national_id, email, created_at, has_current_stay, has_upcoming_reservation, is_inactive").order("full_name");if(t)throw t;p(e||[])}catch(e){console.error("Failed loading guests for reservation modal",e),p([])}})()},[]),(0,r.useEffect)(()=>{if(!i||!i.guest_id||0===m.length)return;const e=m.find(e=>String(e.id)===String(i.guest_id));e&&("today"!==f&&"current"!==f&&"upcoming"!==f||!e.is_inactive||x("all"))},[i,m,f]),(0,r.useEffect)(()=>{if(i){var e,t,n,r,s,a,o,l,c,d,u;let h=null!==(e=i.payment_method)&&void 0!==e?e:"cash";"card"!==h&&"transfer"!==h&&"bank"!==h||(h="instapay"),M({guest_id:i.guest_id,room_id:i.room_id,check_in_date:i.check_in_date,check_out_date:i.check_out_date,guests_count:null!==(t=i.guests_count)&&void 0!==t?t:1,status:null!==(n=i.status)&&void 0!==n?n:"confirmed",nightly_rate:null!==(r=i.nightly_rate)&&void 0!==r?r:null,total_amount:null!==(s=i.total_amount)&&void 0!==s?s:null,amount_paid:null!==(a=i.amount_paid)&&void 0!==a?a:0,currency:null!==(o=i.currency)&&void 0!==o?o:"EGP",payment_method:h,payer_type:null!==(l=i.payer_type)&&void 0!==l?l:"guest",agency_name:null!==(c=i.agency_name)&&void 0!==c?c:"",special_requests:null!==(d=i.special_requests)&&void 0!==d?d:"",notes:null!==(u=i.notes)&&void 0!==u?u:"",pending_guest_ids:[]}),S(!1),E(i.room_id?[i.room_id]:[])}},[i]),(0,r.useEffect)(()=>{d&&!i&&(S(!0),M(e=>Le(Le({},e),{},{payer_type:"agency"})))},[d,i]);const V=(0,r.useMemo)(()=>{if(!L.check_in_date||!L.check_out_date)return 0;const e=new Date(L.check_in_date),t=(new Date(L.check_out_date)-e)/864e5;return t>0?t:0},[L.check_in_date,L.check_out_date]);(0,r.useEffect)(()=>{if((!d||!k)&&j&&null!=L.nightly_rate&&V>0){const e=Math.round(Number(L.nightly_rate)*V*100)/100;M(t=>Le(Le({},t),{},{total_amount:e}))}},[L.nightly_rate,V,j,d,k]);const H=(0,r.useMemo)(()=>{const e=Number(L.total_amount||0),t=Number(L.amount_paid||0);return Math.max(0,Math.round(100*(e-t))/100)},[L.total_amount,L.amount_paid]),K=(0,r.useMemo)(()=>{if(!d||!k)return null;if(!L.check_in_date||!L.check_out_date)return null;if(!C||0===C.length)return null;const e=V;if(!e||e<=0)return null;let t=0;return C.map(e=>String(e)).forEach(n=>{const r=b.find(e=>String(e.id)===n);if(!r)return;const s=null!=r.base_price?Number(r.base_price)||0:null!=L.nightly_rate&&Number(L.nightly_rate)||0;s&&(t+=s*e)}),Math.round(100*t)/100},[d,k,C,b,V,L.check_in_date,L.check_out_date,L.nightly_rate]);(0,r.useEffect)(()=>{d&&k&&j&&null!=K&&M(e=>Le(Le({},e),{},{total_amount:K}))},[d,k,j,K]);const G=(0,r.useMemo)(()=>{const e=(g||"").trim().toLowerCase(),t=m.filter(e=>{if("all"===f)return!0;if("inactive"===f)return e.is_inactive;if("current"===f)return e.has_current_stay;if("upcoming"===f)return e.has_upcoming_reservation;if("today"===f){const t=e.created_at?String(e.created_at).slice(0,10):null,n=new Date,r=e=>String(e).padStart(2,"0");return t==="".concat(n.getFullYear(),"-").concat(r(n.getMonth()+1),"-").concat(r(n.getDate()))}return!0});return e?t.filter(t=>{const n=String(t.full_name||"").toLowerCase(),r=String(t.phone||"").toLowerCase(),s=String(t.national_id||"").toLowerCase(),a=String(t.email||"").toLowerCase();return n&&n.includes(e)||r&&r.includes(e)||s&&s.includes(e)||a&&a.includes(e)}):t},[m,f,g]),J=(0,r.useCallback)(async()=>{_(!0);try{const{data:e,error:t}=await Or.from("rooms").select("id, room_number, room_code, status, cleanliness").order("room_number",{ascending:!0});if(t)throw t;y((e||[]).map(e=>({id:e.id,room_label:e.room_number||e.room_code||"\u063a\u0631\u0641\u0629 #"+String(e.id).slice(0,8),status:e.status,cleanliness:e.cleanliness})))}catch(e){console.error("Failed loading rooms list",e),y([])}finally{_(!1)}},[]),$=(0,r.useCallback)(async()=>{if(L.check_in_date&&L.check_out_date){_(!0);try{const{data:m,error:p}=await Or.rpc("get_available_rooms",{p_check_in:L.check_in_date,p_check_out:L.check_out_date,p_reservation_id:(null===i||void 0===i?void 0:i.id)||null});if(p)throw p;let f=m||[];if(null!==i&&void 0!==i&&i.room_id&&!f.some(e=>String(e.id)===String(i.room_id)))try{var e,t,n,r,s,a,o,l,c,d;const{data:h}=await Or.from("rooms").select("id, room_number, room_code, status, cleanliness, room_type_id").eq("id",i.room_id).single();let m=null;try{m=await Or.from("room_types").select("id,name,name_ar,base_price,max_guests").eq("id",h.room_type_id).single()}catch(u){}const p=null!==(e=null===(t=m)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.base_price)&&void 0!==e?e:null,x=(null===(r=m)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.name_ar)||(null===(a=m)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.name)||null,g=null!==(l=null===(c=m)||void 0===c||null===(d=c.data)||void 0===d?void 0:d.max_guests)&&void 0!==l?l:null;h&&(f=[{id:h.id,room_label:h.room_number||h.room_code||"\u063a\u0631\u0641\u0629 #"+String(h.id).slice(0,8),status:h.status,cleanliness:h.cleanliness,room_type_id:h.room_type_id,room_type_name:x,base_price:p,max_guests:g},...f])}catch(h){}y(f)}catch(m){console.warn("get_available_rooms RPC not available, falling back",(null===m||void 0===m?void 0:m.message)||m),await J()}finally{_(!1)}}else await J()},[L.check_in_date,L.check_out_date,i,J]);(0,r.useEffect)(()=>{$()},[$]),(0,r.useEffect)(()=>{L.check_in_date&&L.check_out_date||J()},[J,L.check_in_date,L.check_out_date]),(0,r.useEffect)(()=>{const e=b.find(e=>String(e.id)===String(L.room_id));e&&null!=e.base_price&&M(t=>Le(Le({},t),{},{nightly_rate:Number(e.base_price)}))},[L.room_id,b]);const[Q,Y]=(0,r.useState)(""),[X,Z]=(0,r.useState)([]);(0,r.useEffect)(()=>{const e=(Q||"").trim();if(!e)return void Z([]);const t=setTimeout(async()=>{try{const{data:t,error:n}=await Or.from("guests_overview").select("id, full_name, phone, national_id, email, created_at, has_current_stay, has_upcoming_reservation, is_inactive").or("full_name.ilike.%".concat(e,"%,phone.ilike.%").concat(e,"%,national_id.ilike.%").concat(e,"%,email.ilike.%").concat(e,"%")).limit(10);if(n)throw n;Z(t||[])}catch(t){Z([])}},350);return()=>clearTimeout(t)},[Q]);const[ee,te]=(0,r.useState)(!1),[ne,re]=(0,r.useState)(""),[se,ae]=(0,r.useState)([]),[ie,oe]=(0,r.useState)(""),[le,ce]=(0,r.useState)(!1),[de,ue]=(0,r.useState)(!1),[he,me]=(0,r.useState)(""),[pe,fe]=(0,r.useState)(""),[xe,ge]=(0,r.useState)([]),[ve,be]=(0,r.useState)(""),[ye,we]=(0,r.useState)(!1),_e=async(e,t,n)=>{if(e&&t)try{const{data:r,error:s}=await Or.rpc("get_available_rooms",{p_check_in:e,p_check_out:t,p_reservation_id:(null===i||void 0===i?void 0:i.id)||null});if(s)throw s;n?(ae(r||[]),r&&r.length>0&&oe(String(r[0].id))):(ge(r||[]),r&&r.length>0&&be(String(r[0].id)))}catch(r){console.warn("get_available_rooms for advanced action failed",(null===r||void 0===r?void 0:r.message)||r),n?ae([]):ge([])}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-start justify-center px-2 sm:px-3 py-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-[95vw] sm:max-w-xl md:max-w-2xl xl:max-w-3xl max-h-[85vh] overflow-auto",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b flex items-center justify-between sticky top-0 bg-white",children:[(0,a.jsx)("h3",{className:"font-bold",children:i?"\u062a\u0639\u062f\u064a\u0644 \u062d\u062c\u0632":"\u062d\u062c\u0632 \u062c\u062f\u064a\u062f"}),(0,a.jsx)("button",{className:"text-gray-500 hover:text-gray-700",onClick:o,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{var t;h(!0);const e=k&&!i?C&&C.length>0:!!L.room_id,s="agency"===String(L.payer_type);if(!s&&!L.guest_id||!e||!L.check_in_date||!L.check_out_date)return alert("\u064a\u0631\u062c\u0649 \u062a\u0639\u0628\u0626\u0629 \u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0644 \u0627\u0644\u0623\u0633\u0627\u0633\u064a\u0629"),void h(!1);try{const e=b.find(e=>String(e.id)===String(L.room_id));if(e&&e.cleanliness&&"clean"!==e.cleanliness){const e=new Date,t=e=>String(e).padStart(2,"0"),n="".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate()));if(String(L.check_in_date)===n){const e=window.prompt("\u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0646\u0638\u064a\u0641\u0629 \u0648\u0627\u0644\u062f\u062e\u0648\u0644 \u0627\u0644\u064a\u0648\u0645. \u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632 \u0627\u0643\u062a\u0628: ok","");if(!e||"ok"!==String(e).trim().toLowerCase())return alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632 \u0644\u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0627\u0644\u0646\u0638\u064a\u0641\u0629."),void h(!1)}}}catch(n){}try{if(!k||i){if(!1===await(async()=>{const{data:e,error:t}=await Or.rpc("check_room_availability",{p_room_id:L.room_id,p_check_in:L.check_in_date,p_check_out:L.check_out_date,p_reservation_id:(null===i||void 0===i?void 0:i.id)||null});if(t)throw t;return e})())return alert("\u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0645\u062a\u0627\u062d\u0629 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0641\u062a\u0631\u0629"),void h(!1)}}catch(r){}const a=b.find(e=>String(e.id)===String(L.room_id)),o=null!==(t=L.nightly_rate)&&void 0!==t?t:a&&null!=a.base_price?Number(a.base_price):null,c=j&&null!=o&&V>0?Math.round(o*V*100)/100:L.total_amount,u=Le(Le({},L),{},{nightly_rate:o,total_amount:c});if(k&&!i){const e=C&&C.length>0?C:L.room_id?[L.room_id]:[];if(!e.length)return alert("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u063a\u0631\u0641\u0629 \u0648\u0627\u062d\u062f\u0629 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 \u0644\u0644\u062d\u062c\u0632 \u0627\u0644\u062c\u0645\u0627\u0639\u064a"),void h(!1);const t=e.map(e=>{const t=String(e),n=b.find(e=>String(e.id)===t);let r;r=d&&k?T&&T[t]?T[t]:n&&null!=n.max_guests&&Number(n.max_guests)||1:T&&T[t]?T[t]:u.guests_count;const s=n&&null!=n.base_price?Number(n.base_price)||0:null!=o&&Number(o)||0,a=j&&s&&V>0?Math.round(s*V*100)/100:c;return Le(Le({},u),{},{room_id:e,guests_count:r,nightly_rate:s||null,total_amount:a})});l({multi:!0,reservations:t})}else l(u)}catch(e){console.error(e),alert("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639")}finally{h(!1)}},className:"p-3 space-y-3 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0646\u0632\u064a\u0644"}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 gap-1 text-[11px] text-gray-600",children:[(0,a.jsx)("span",{children:"\u0627\u062e\u062a\u0631 \u0645\u0646 \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 justify-end",children:[(0,a.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("today"===f?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700"),onClick:()=>x("today"),children:"\u0645\u0636\u0627\u0641\u0648\u0646 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("current"===f?"bg-emerald-600 text-white border-emerald-600":"bg-white text-gray-700"),onClick:()=>x("current"),children:"\u0645\u0642\u064a\u0645\u0648\u0646 \u062d\u0627\u0644\u064a\u0627\u064b"}),(0,a.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("upcoming"===f?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700"),onClick:()=>x("upcoming"),children:"\u0642\u0627\u062f\u0650\u0645\u0648\u0646"}),(0,a.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("inactive"===f?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700"),onClick:()=>x("inactive"),children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u064a\u0646"}),(0,a.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("all"===f?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700"),onClick:()=>x("all"),children:"\u0627\u0644\u0643\u0644"})]})]}),(0,a.jsx)("input",{className:"border rounded w-full px-3 py-1 mb-1 text-xs",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0627\u0633\u0645 / \u0627\u0644\u0647\u0627\u062a\u0641 / \u0627\u0644\u0628\u0637\u0627\u0642\u0629 / \u0627\u0644\u0625\u064a\u0645\u064a\u0644",value:g,onChange:e=>v(e.target.value)}),g&&G.length>0&&(0,a.jsx)("div",{className:"border rounded bg-white shadow text-xs max-h-40 overflow-auto mb-1",children:G.slice(0,12).map(e=>(0,a.jsxs)("div",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer flex justify-between items-center",onClick:()=>{M(t=>Le(Le({},t),{},{guest_id:e.id})),v(e.full_name||"")},children:[(0,a.jsxs)("span",{children:[e.full_name," ",(0,a.jsxs)("span",{className:"text-gray-500",children:["(",e.phone||e.national_id||e.email||String(e.id).slice(0,8),")"]})]}),(0,a.jsx)("span",{className:"text-[10px] text-gray-500 ml-1",children:e.is_inactive?"\u063a\u064a\u0631 \u0646\u0634\u0637":e.has_current_stay?"\u0645\u0642\u064a\u0645 \u062d\u0627\u0644\u064a\u0627\u064b":e.has_upcoming_reservation?"\u0644\u062f\u064a\u0647 \u062d\u062c\u0632 \u0642\u0627\u062f\u0645":""})]},e.id))}),(0,a.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:L.guest_id||"",onChange:e=>M(t=>Le(Le({},t),{},{guest_id:e.target.value||null})),children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0646\u0632\u064a\u0644"}),G.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.full_name,e.is_inactive?" \u2014 \u063a\u064a\u0631 \u0646\u0634\u0637":e.has_current_stay?" \u2014 \u0645\u0642\u064a\u0645 \u062d\u0627\u0644\u064a\u0627\u064b":e.has_upcoming_reservation?" \u2014 \u0644\u062f\u064a\u0647 \u062d\u062c\u0632 \u0642\u0627\u062f\u0645":""]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(()=>{const e=b.find(e=>String(e.id)===String(L.room_id));return e&&e.cleanliness&&"clean"!==e.cleanliness?(0,a.jsx)("div",{className:"mb-2 text-xs bg-yellow-50 text-yellow-800 border border-yellow-300 rounded px-2 py-1",children:"\u062a\u0646\u0628\u064a\u0647: \u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0646\u0638\u064a\u0641\u0629 \u062d\u0627\u0644\u064a\u0627\u064b. \u0644\u0648 \u0627\u0644\u062f\u062e\u0648\u0644 \u0627\u0644\u064a\u0648\u0645 \u0633\u064a\u0637\u0644\u0628 \u062a\u0623\u0643\u064a\u062f."}):null})(),d&&!i&&F.length>0&&(0,a.jsxs)("div",{className:"mb-1 border rounded px-2 py-1 bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("label",{className:"block text-[11px] text-gray-700",children:"\u062a\u062d\u062f\u064a\u062f \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u063a\u0631\u0641 \u0644\u0644\u062a\u0633\u0643\u064a\u0646"}),(0,a.jsx)("span",{className:"text-[10px] text-gray-500",children:"\u064a\u0645\u0643\u0646 \u0627\u062e\u062a\u064a\u0627\u0631 \u0623\u0643\u062b\u0631 \u0645\u0646 \u0646\u0648\u0639"})]}),(0,a.jsx)("div",{className:"max-h-28 overflow-y-auto space-y-0.5 text-xs",children:F.map(e=>{const t=P.some(t=>String(t)===String(e.id));return(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:t=>{const n=t.target.checked;I(t=>{const r=new Set((t||[]).map(e=>String(e))),s=String(e.id);return n?r.add(s):r.delete(s),Array.from(r)})}}),(0,a.jsxs)("span",{children:[e.name," \u2014 \u0645\u062a\u0627\u062d: ",e.count," \u063a\u0631\u0641\u0629"]})]},e.id)})}),(0,a.jsx)("div",{className:"text-[10px] text-gray-500 mt-1",children:"\u0625\u0646 \u0644\u0645 \u064a\u062a\u0645 \u0627\u062e\u062a\u064a\u0627\u0631 \u0623\u064a \u0646\u0648\u0639 \u0633\u064a\u062a\u0645 \u0627\u0633\u062a\u062e\u062f\u0627\u0645 \u0643\u0644 \u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u062a\u0627\u062d\u0629 \u0641\u064a \u0627\u0644\u0627\u0642\u062a\u0631\u0627\u062d."})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1 text-[11px] text-gray-600",children:[(0,a.jsx)("span",{children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629"}),!i&&!d&&(0,a.jsxs)("label",{className:"flex items-center gap-1 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:k,onChange:e=>{const t=e.target.checked;S(t),t&&(M(e=>Le(Le({},e),{},{payer_type:"guest"===e.payer_type?"agency":e.payer_type})),E(e=>{const t=new Set(e||[]);return L.room_id&&t.add(L.room_id),Array.from(t)}))}}),(0,a.jsx)("span",{children:"\u062d\u062c\u0632 \u0644\u0639\u062f\u0651\u0629 \u063a\u0631\u0641 (\u0634\u0631\u0643\u0629/\u0645\u062c\u0645\u0648\u0639\u0629)"})]})]}),(0,a.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:L.room_id||"",onChange:e=>M(t=>Le(Le({},t),{},{room_id:e.target.value||null})),children:[(0,a.jsx)("option",{value:"",children:w?"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644":"\u0627\u062e\u062a\u0631 \u0627\u0644\u063a\u0631\u0641\u0629"}),W.map(e=>{const t=e.cleanliness&&"clean"!==e.cleanliness?" - ".concat("in_cleaning"===e.cleanliness?"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641":"\u063a\u064a\u0631 \u0646\u0638\u064a\u0641\u0629"):"",n=e.room_type_name?" \u2014 ".concat(e.room_type_name):"",r=null!=e.base_price?" \u2014 ".concat(e.base_price," ").concat("EGP"===L.currency?"\u062c\u0646\u064a\u0647":L.currency):"";return(0,a.jsx)("option",{value:e.id,children:(e.room_label||e.room_code||e.id)+n+r+t},e.id)})]}),k&&!i&&(0,a.jsxs)("div",{className:"mt-2 border rounded p-2 bg-gray-50",children:[(0,a.jsx)("div",{className:"text-[11px] mb-1 text-gray-700",children:"\u0627\u062e\u062a\u0631 \u0643\u0644 \u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u0637\u0644\u0648\u0628 \u062d\u062c\u0632\u0647\u0627 \u0644\u0646\u0641\u0633 \u0627\u0644\u0634\u0631\u0643\u0629 \u0648\u0646\u0641\u0633 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e:"}),(0,a.jsx)("div",{className:"max-h-40 overflow-y-auto text-xs space-y-1",children:W.map(e=>{const t=C.some(t=>String(t)===String(e.id)),n=e.room_type_name?" \u2014 ".concat(e.room_type_name):"",r=null!=e.base_price?" \u2014 ".concat(e.base_price," ").concat("EGP"===L.currency?"\u062c\u0646\u064a\u0647":L.currency):"",s=null!=e.max_guests?" \u2014 \u0633\u0639\u0629: ".concat(e.max_guests):"";return(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:t=>{const n=t.target.checked;E(t=>{const r=new Set((t||[]).map(e=>String(e))),s=String(e.id);return n?r.add(s):r.delete(s),Array.from(r)})}}),(0,a.jsxs)("span",{children:[e.room_label||e.room_code||e.id,n,r,s]})]},e.id)})}),(0,a.jsx)("div",{className:"text-[10px] text-gray-500 mt-1",children:"\u0633\u064a\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u062d\u062c\u0632 \u0645\u0633\u062a\u0642\u0644 \u0644\u0643\u0644 \u063a\u0631\u0641\u0629 \u0645\u0639 \u0646\u0641\u0633 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e \u0648\u0646\u0641\u0633 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0634\u0631\u0643\u0629."})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:(()=>{const e=b.find(e=>String(e.id)===String(L.room_id));if(!e)return null;const t=null!=e.base_price?"".concat(e.base_price," ").concat("EGP"===L.currency?"\u062c\u0646\u064a\u0647":L.currency):"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f";return(0,a.jsxs)("span",{children:["\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629: ",(0,a.jsx)("b",{children:e.room_type_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"})," \u2014 \u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0623\u0633\u0627\u0633\u064a: ".concat(t),B?" \u2014 \u0623\u0642\u0635\u0649 \u0639\u062f\u062f: ".concat(B):""]})})()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644"}),(0,a.jsx)("input",{type:"date",className:"border rounded w-full px-3 py-2",value:L.check_in_date,onChange:e=>M(t=>Le(Le({},t),{},{check_in_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c"}),(0,a.jsx)("input",{type:"date",className:"border rounded w-full px-3 py-2",value:L.check_out_date,onChange:e=>M(t=>Le(Le({},t),{},{check_out_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("label",{className:"block text-xs",children:"\u0639\u062f\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),d&&!i&&(0,a.jsx)("button",{type:"button",className:"text-[11px] px-2 py-0.5 rounded border border-emerald-500 text-emerald-700 bg-white hover:bg-emerald-50",onClick:async()=>{if(!d||i)return;const e=Number(L.guests_count||0);if(!e||e<=0)return void alert("\u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0625\u062c\u0645\u0627\u0644\u064a \u0639\u062f\u062f \u0627\u0644\u0623\u0641\u0631\u0627\u062f \u0623\u0648\u0644\u0627\u064b.");if(!L.check_in_date||!L.check_out_date)return void alert("\u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644 \u0648\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u0642\u0628\u0644 \u0627\u0642\u062a\u0631\u0627\u062d \u0627\u0644\u062a\u0633\u0643\u064a\u0646.");try{b&&0!==b.length||await $()}catch(l){}const t=d&&P&&P.length>0?(b||[]).filter(e=>P.map(e=>String(e)).includes(String(e.room_type_id))):b||[];if(!t.length)return void alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641 \u0645\u062a\u0627\u062d\u0629 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0641\u062a\u0631\u0629 \u0644\u0627\u0642\u062a\u0631\u0627\u062d \u0627\u0644\u062a\u0633\u0643\u064a\u0646.");const n=t.map(e=>Le(Le({},e),{},{_capacity:null!=e.max_guests?Number(e.max_guests)||0:2})).filter(e=>e._capacity>0);if(!n.length)return void alert("\u0644\u0627 \u064a\u0648\u062c\u062f \u062a\u0639\u0631\u064a\u0641 \u0644\u0633\u0639\u0629 \u0627\u0644\u063a\u0631\u0641 (max_guests) \u0648\u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0642\u062a\u0631\u0627\u062d \u062a\u0648\u0632\u064a\u0639 \u062f\u0642\u064a\u0642.");n.sort((e,t)=>t._capacity-e._capacity);let r=e;const s={},a=[];for(const i of n){if(r<=0)break;const e=Math.min(i._capacity,r);if(e<=0)continue;s[String(i.id)]=e,a.push(i.id),r-=e}if(!a.length)return void alert("\u062a\u0639\u0630\u0651\u0631 \u0627\u0642\u062a\u0631\u0627\u062d \u062a\u0648\u0632\u064a\u0639: \u0627\u0644\u0633\u0639\u0629 \u0627\u0644\u0645\u062a\u0627\u062d\u0629 \u0644\u0627 \u062a\u0643\u0641\u064a \u0644\u0623\u064a \u062c\u0632\u0621 \u0645\u0646 \u0627\u0644\u0645\u062c\u0645\u0648\u0639\u0629.");O(s),E(a),S(!0);const o=Object.values(s).reduce((e,t)=>e+Number(t||0),0);!A&&o>0&&M(e=>Le(Le({},e),{},{guests_count:o})),r>0?alert("\u062a\u0645 \u0627\u0642\u062a\u0631\u0627\u062d \u0623\u0641\u0636\u0644 \u062a\u0648\u0632\u064a\u0639 \u0645\u0645\u0643\u0646\u060c \u0644\u0643\u0646 \u0627\u0644\u0633\u0639\u0629 \u0627\u0644\u0645\u062a\u0627\u062d\u0629 \u0623\u0642\u0644 \u0645\u0646 \u0627\u0644\u0639\u062f\u062f \u0627\u0644\u0645\u0637\u0644\u0648\u0628 \u0628\u0627\u0644\u0643\u0627\u0645\u0644."):alert("\u062a\u0645 \u0627\u0642\u062a\u0631\u0627\u062d \u062a\u0648\u0632\u064a\u0639 \u0627\u0644\u063a\u0631\u0641 \u0639\u0644\u0649 \u0627\u0644\u0623\u0641\u0631\u0627\u062f \u0628\u0646\u062c\u0627\u062d\u060c \u064a\u0645\u0643\u0646\u0643 \u0645\u0631\u0627\u062c\u0639\u0629 \u0627\u0644\u063a\u0631\u0641 \u0642\u0628\u0644 \u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632.")},children:"\u0627\u0642\u062a\u0631\u0627\u062d \u062a\u0648\u0632\u064a\u0639 \u0639\u0644\u0649 \u0627\u0644\u063a\u0631\u0641"})]}),(0,a.jsx)("input",{type:"number",min:1,className:"border rounded w-full px-3 py-2",value:L.guests_count,onChange:e=>{const t=Number(e.target.value)||1,n=Number(L.guests_count||0);t<n&&D(!0),M(e=>Le(Le({},e),{},{guests_count:t}))}}),d&&!i&&(0,a.jsx)("div",{className:"mt-1 text-[11px] text-gray-600",children:"\u0641\u064a \u062d\u062c\u0632 \u0627\u0644\u0634\u0631\u0643\u0627\u062a/\u0627\u0644\u0645\u062c\u0645\u0648\u0639\u0627\u062a \u064a\u0645\u062b\u0644 \u0647\u0630\u0627 \u0627\u0644\u0631\u0642\u0645 \u0625\u062c\u0645\u0627\u0644\u064a \u0639\u062f\u062f \u0627\u0644\u0623\u0641\u0631\u0627\u062f \u0627\u0644\u0645\u0637\u0644\u0648\u0628 \u062a\u0633\u0643\u064a\u0646\u0647\u0645."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("select",{className:"border rounded w-full px-3 py-2",value:L.status,onChange:e=>M(t=>Le(Le({},t),{},{status:e.target.value})),children:ws.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0633\u0639\u0631 \u0627\u0644\u0644\u064a\u0644\u0629"}),d&&k?(0,a.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2 bg-gray-100 text-gray-500",value:"",placeholder:"\u064a\u062a\u0645 \u0627\u0644\u062d\u0633\u0627\u0628 \u062a\u0644\u0642\u0627\u0626\u064a\u0627\u064b \u0645\u0646 \u0623\u0633\u0639\u0627\u0631 \u0643\u0644 \u063a\u0631\u0641\u0629",disabled:!0}):(0,a.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2",value:null!==(t=L.nightly_rate)&&void 0!==t?t:"",onChange:e=>M(t=>Le(Le({},t),{},{nightly_rate:""===e.target.value?null:Number(e.target.value)}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a"}),!d&&!k&&(0,a.jsxs)("label",{className:"flex items-center gap-1 text-[11px]",children:[(0,a.jsx)("input",{type:"checkbox",checked:j,onChange:e=>N(e.target.checked)}),(0,a.jsx)("span",{children:"\u062d\u0633\u0627\u0628 \u062a\u0644\u0642\u0627\u0626\u064a"})]})]}),(0,a.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2",value:null!==(n=L.total_amount)&&void 0!==n?n:"",onChange:e=>M(t=>Le(Le({},t),{},{total_amount:""===e.target.value?null:Number(e.target.value)})),disabled:j||d&&k})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639"}),(0,a.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2",value:null!==(s=L.amount_paid)&&void 0!==s?s:0,onChange:e=>M(t=>Le(Le({},t),{},{amount_paid:Number(e.target.value)||0}))})]})]}),d&&k&&null!=K&&(0,a.jsxs)("div",{className:"mt-1 text-[11px] text-emerald-700",children:["\u0625\u062c\u0645\u0627\u0644\u064a \u062a\u0642\u0631\u064a\u0628\u064a \u0644\u0643\u0644 \u0627\u0644\u063a\u0631\u0641 (\u062d\u0633\u0628 \u0623\u0633\u0639\u0627\u0631 \u0627\u0644\u0623\u0646\u0648\u0627\u0639 \u0648\u0639\u062f\u062f \u0627\u0644\u0644\u064a\u0627\u0644\u064a):"," ",(0,a.jsxs)("span",{className:"font-semibold",children:[K," ","EGP"===L.currency?"\u062c\u0646\u064a\u0647":L.currency]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a"}),(0,a.jsxs)("div",{className:"border rounded w-full px-3 py-2 bg-gray-50 text-red-700 font-semibold",children:[H," ","EGP"===L.currency?"\u062c\u0646\u064a\u0647":L.currency]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0639\u0645\u0644\u0629"}),(0,a.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:L.currency,onChange:e=>M(t=>Le(Le({},t),{},{currency:e.target.value})),children:[(0,a.jsx)("option",{value:"EGP",children:"\u062c\u0646\u064a\u0647"}),(0,a.jsx)("option",{value:"SAR",children:"\u0631\u064a\u0627\u0644"}),(0,a.jsx)("option",{value:"USD",children:"\u062f\u0648\u0644\u0627\u0631"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:L.payment_method,onChange:e=>M(t=>Le(Le({},t),{},{payment_method:e.target.value})),children:[(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629"}),(0,a.jsx)("option",{value:"other",children:"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 bg-emerald-50 rounded p-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0645\u0646 \u064a\u062f\u0641\u0639\u061f"}),(0,a.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:L.payer_type,onChange:e=>M(t=>Le(Le({},t),{},{payer_type:e.target.value})),children:[(0,a.jsx)("option",{value:"guest",children:"\u0627\u0644\u0646\u0632\u064a\u0644 \u0646\u0641\u0633\u0647"}),(0,a.jsx)("option",{value:"agency",children:"\u0634\u0631\u0643\u0629/\u0648\u0643\u0627\u0644\u0629"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u062c\u0647\u0629"}),(0,a.jsx)("input",{className:"border rounded w-full px-3 py-2",placeholder:"\u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629 \u0623\u0648 \u0627\u0644\u0648\u0643\u0627\u0644\u0629",value:L.agency_name,onChange:e=>M(t=>Le(Le({},t),{},{agency_name:e.target.value})),disabled:"agency"!==L.payer_type})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0645\u062f\u0641\u0648\u0639: ",(0,a.jsxs)("span",{className:"text-blue-700 font-semibold",children:[L.amount_paid||0," ","EGP"===L.currency?"\u062c\u0646\u064a\u0647":L.currency]})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0637\u0644\u0628\u0627\u062a \u062e\u0627\u0635\u0629"}),(0,a.jsx)("textarea",{className:"border rounded w-full px-3 py-2",rows:2,value:L.special_requests,onChange:e=>M(t=>Le(Le({},t),{},{special_requests:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),U?(0,a.jsx)("textarea",{className:"border rounded w-full px-3 py-2",rows:2,value:L.notes,onChange:e=>M(t=>Le(Le({},t),{},{notes:e.target.value}))}):(0,a.jsx)(a.Fragment,{children:(()=>{const e=String(L.notes||"").split("\n"),t=e.filter(e=>z.some(t=>e.trim().startsWith(t))),n=e.filter(e=>!z.some(t=>e.trim().startsWith(t)));return(0,a.jsxs)(a.Fragment,{children:[t.length>0&&(0,a.jsx)("div",{className:"border rounded w-full px-3 py-2 mb-2 bg-gray-50 text-xs text-gray-700 whitespace-pre-wrap",children:t.join("\n")}),(0,a.jsx)("textarea",{className:"border rounded w-full px-3 py-2",rows:2,placeholder:"\u0627\u0643\u062a\u0628 \u0645\u0644\u0627\u062d\u0638\u0627\u062a \u0625\u0636\u0627\u0641\u064a\u0629 (\u0644\u0627 \u064a\u0645\u0643\u0646 \u062a\u0639\u062f\u064a\u0644 \u0645\u0644\u0627\u062d\u0638\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645)",value:n.join("\n"),onChange:e=>{const n=e.target.value||"",r=[...t,...n?n.split("\n"):[]].join("\n").trim();M(e=>Le(Le({},e),{},{notes:r}))}})]})})()})]}),i&&i.id&&(0,a.jsxs)("div",{className:"border rounded p-3 bg-blue-50 space-y-2",children:[(0,a.jsx)("div",{className:"text-sm font-semibold mb-1",children:"\u0639\u0645\u0644\u064a\u0627\u062a \u0645\u062a\u0642\u062f\u0645\u0629 \u0639\u0644\u0649 \u0627\u0644\u062d\u062c\u0632"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 text-sm",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded border border-emerald-500 text-emerald-700 bg-white hover:bg-emerald-50",onClick:async()=>{if(!i||!i.id||!i.check_in_date||!i.check_out_date)return void alert("\u0647\u0630\u0647 \u0627\u0644\u0639\u0645\u0644\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0641\u0642\u0637 \u0644\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0645\u062d\u0641\u0648\u0638\u0629.");const e=new Date,t=e=>String(e).padStart(2,"0"),n="".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate())),r=i.check_in_date,s=i.check_out_date,a=String(n>r?n:r);a<s?(re(a),te(!0),await _e(a,s,!0)):alert("\u0644\u0627 \u064a\u0648\u062c\u062f \u0623\u064a\u0627\u0645 \u0645\u062a\u0628\u0642\u064a\u0629 \u064a\u0645\u0643\u0646 \u0646\u0642\u0644\u0647\u0627 \u0636\u0645\u0646 \u0647\u0630\u0627 \u0627\u0644\u062d\u062c\u0632.")},children:"\u0646\u0642\u0644 \u0628\u0627\u0642\u064a \u0627\u0644\u0623\u064a\u0627\u0645 \u0644\u063a\u0631\u0641\u0629 \u0623\u062e\u0631\u0649"}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded border border-indigo-500 text-indigo-700 bg-white hover:bg-indigo-50",onClick:async()=>{i&&i.id&&i.check_in_date&&i.check_out_date?(me(i.check_in_date),fe(i.check_out_date),ue(!0),await _e(i.check_in_date,i.check_out_date,!1)):alert("\u0647\u0630\u0647 \u0627\u0644\u0639\u0645\u0644\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0641\u0642\u0637 \u0644\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0645\u062d\u0641\u0648\u0638\u0629.")},children:"\u062a\u0642\u0633\u064a\u0645 \u0627\u0644\u062d\u062c\u0632 / \u0646\u0642\u0644 \u062c\u0632\u0621"})]}),ee&&(0,a.jsxs)("div",{className:"mt-2 border-t pt-2 space-y-2 text-xs",children:[(0,a.jsx)("div",{className:"font-semibold text-emerald-700 mb-1",children:"\u0646\u0642\u0644 \u062c\u0645\u064a\u0639 \u0627\u0644\u0644\u064a\u0627\u0644\u064a \u0627\u0644\u0645\u062a\u0628\u0642\u064a\u0629 \u0645\u0646 \u062a\u0627\u0631\u064a\u062e \u0645\u062d\u062f\u062f"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-0.5",children:"\u0645\u0646 \u062a\u0627\u0631\u064a\u062e"}),(0,a.jsx)("input",{type:"date",className:"border rounded w-full px-2 py-1",value:ne,min:i.check_in_date||"",max:i.check_out_date||"",onChange:async e=>{const t=e.target.value;re(t),t&&i.check_out_date&&t<i.check_out_date&&await _e(t,i.check_out_date,!0)}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-0.5",children:"\u0625\u0644\u0649 \u0623\u064a \u063a\u0631\u0641\u0629\u061f"}),(0,a.jsxs)("select",{className:"border rounded w-full px-2 py-1",value:ie,onChange:e=>oe(e.target.value||""),children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629"}),se.map(e=>(0,a.jsx)("option",{value:e.id,children:e.room_label||e.room_code||e.id},e.id))]}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500 mt-0.5",children:"\u064a\u062a\u0645 \u0627\u0633\u062a\u0628\u0639\u0627\u062f \u0627\u0644\u063a\u0631\u0641 \u0630\u0627\u062a \u0627\u0644\u062a\u0639\u0627\u0631\u0636 \u0627\u0644\u062a\u0627\u0645 \u0623\u0648 \u0627\u0644\u062c\u0632\u0626\u064a \u0645\u0639 \u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062a\u0628\u0642\u064a\u0629."})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-1 border rounded text-xs",onClick:()=>te(!1),disabled:le,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-700",onClick:async()=>{if(ne&&ie){if(i&&i.id&&i.check_out_date)try{ce(!0);const e=q&&q.id?q.id:null,{error:t}=await Or.rpc("move_reservation_remaining_from_date",{p_reservation_id:i.id,p_from_date:ne,p_target_room_id:ie,p_staff_user_id:e});if(t)throw t;alert("\u062a\u0645 \u0646\u0642\u0644 \u0628\u0627\u0642\u064a \u0627\u0644\u0623\u064a\u0627\u0645 \u0625\u0644\u0649 \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629 \u0628\u0646\u062c\u0627\u062d."),te(!1),c&&c(),o()}catch(e){console.error("Failed to move remaining nights",e);const t=String((null===e||void 0===e?void 0:e.message)||e||"").toLowerCase();let n="\u062a\u0639\u0630\u0631 \u062a\u0646\u0641\u064a\u0630 \u0639\u0645\u0644\u064a\u0629 \u0646\u0642\u0644 \u0628\u0627\u0642\u064a \u0627\u0644\u0623\u064a\u0627\u0645.";t.includes("overlapping reservation")?n="\u062a\u0639\u0630\u0631 \u0627\u0644\u062a\u0646\u0641\u064a\u0630: \u064a\u0648\u062c\u062f \u062a\u0639\u0627\u0631\u0636 \u0645\u0639 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0641\u064a \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629.":t.includes("check_out_date must be after check_in_date")&&(n="\u062a\u0639\u0630\u0631 \u0627\u0644\u062a\u0646\u0641\u064a\u0630: \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0628\u0639\u062f \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0628\u062f\u0627\u064a\u0629 \u0627\u0644\u0645\u062d\u062f\u062f\u0629."),alert(n)}finally{ce(!1)}}else alert("\u064a\u0631\u062c\u0649 \u0627\u062e\u062a\u064a\u0627\u0631 \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0628\u062f\u0627\u064a\u0629 \u0648\u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u0645\u0633\u062a\u0647\u062f\u0641\u0629.")},disabled:le,children:le?"\u062c\u0627\u0631\u064d \u0627\u0644\u062a\u0646\u0641\u064a\u0630...":"\u062a\u0623\u0643\u064a\u062f \u0646\u0642\u0644 \u0628\u0627\u0642\u064a \u0627\u0644\u0623\u064a\u0627\u0645"})]})]}),de&&(0,a.jsxs)("div",{className:"mt-2 border-t pt-2 space-y-2 text-xs",children:[(0,a.jsx)("div",{className:"font-semibold text-indigo-700 mb-1",children:"\u062a\u0642\u0633\u064a\u0645 \u0627\u0644\u062d\u062c\u0632 \u0648\u0646\u0642\u0644 \u062c\u0632\u0621 \u0641\u0642\u0637"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-0.5",children:"\u0628\u062f\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621"}),(0,a.jsx)("input",{type:"date",className:"border rounded w-full px-2 py-1",value:he,min:i.check_in_date||"",max:i.check_out_date||"",onChange:async e=>{const t=e.target.value;me(t),t&&pe&&t<pe&&await _e(t,pe,!1)}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-0.5",children:"\u0646\u0647\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621"}),(0,a.jsx)("input",{type:"date",className:"border rounded w-full px-2 py-1",value:pe,min:i.check_in_date||"",max:i.check_out_date||"",onChange:async e=>{const t=e.target.value;fe(t),t&&he&&he<t&&await _e(he,t,!1)}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-0.5",children:"\u0627\u0644\u063a\u0631\u0641\u0629 \u0644\u0644\u062c\u0632\u0621 \u0627\u0644\u0645\u0646\u0642\u0648\u0644"}),(0,a.jsxs)("select",{className:"border rounded w-full px-2 py-1",value:ve,onChange:e=>be(e.target.value||""),children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629"}),xe.map(e=>(0,a.jsx)("option",{value:e.id,children:e.room_label||e.room_code||e.id},e.id))]})]})]}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500",children:"\u064a\u062c\u0628 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062e\u062a\u0627\u0631\u0629 \u0628\u0627\u0644\u0643\u0627\u0645\u0644 \u062f\u0627\u062e\u0644 \u0641\u062a\u0631\u0629 \u0627\u0644\u062d\u062c\u0632 \u0627\u0644\u0623\u0635\u0644\u064a\u0629\u060c \u0648\u064a\u0645\u0643\u0646 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0641\u064a \u0627\u0644\u0628\u062f\u0627\u064a\u0629 \u0623\u0648 \u0627\u0644\u0648\u0633\u0637 \u0623\u0648 \u0627\u0644\u0646\u0647\u0627\u064a\u0629."}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-1 border rounded text-xs",onClick:()=>ue(!1),disabled:ye,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded bg-indigo-600 text-white text-xs hover:bg-indigo-700",onClick:async()=>{if(he&&pe&&ve){if(i&&i.id)if(he<pe)try{we(!0);const e=q&&q.id?q.id:null,{error:t}=await Or.rpc("split_and_move_reservation",{p_reservation_id:i.id,p_segment_start:he,p_segment_end:pe,p_target_room_id:ve,p_staff_user_id:e});if(t)throw t;alert("\u062a\u0645 \u0646\u0642\u0644 \u0627\u0644\u062c\u0632\u0621 \u0627\u0644\u0645\u062d\u062f\u062f \u0645\u0646 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629 \u0628\u0646\u062c\u0627\u062d."),ue(!1),c&&c(),o()}catch(e){console.error("Failed to split and move reservation",e);const t=String((null===e||void 0===e?void 0:e.message)||e||"").toLowerCase();let n="\u062a\u0639\u0630\u0631 \u062a\u0646\u0641\u064a\u0630 \u0639\u0645\u0644\u064a\u0629 \u062a\u0642\u0633\u064a\u0645 \u0627\u0644\u062d\u062c\u0632.";t.includes("overlapping reservation")?n="\u062a\u0639\u0630\u0631 \u0627\u0644\u062a\u0646\u0641\u064a\u0630: \u064a\u0648\u062c\u062f \u062a\u0639\u0627\u0631\u0636 \u0645\u0639 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0641\u064a \u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629.":t.includes("check_out_date must be after check_in_date")&&(n="\u062a\u0639\u0630\u0631 \u0627\u0644\u062a\u0646\u0641\u064a\u0630: \u062a\u0627\u0631\u064a\u062e \u0646\u0647\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621 \u064a\u062c\u0628 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0628\u0639\u062f \u0628\u062f\u0627\u064a\u062a\u0647."),alert(n)}finally{we(!1)}else alert("\u062a\u0627\u0631\u064a\u062e \u0646\u0647\u0627\u064a\u0629 \u0627\u0644\u062c\u0632\u0621 \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0628\u0639\u062f \u062a\u0627\u0631\u064a\u062e \u0628\u062f\u0627\u064a\u062a\u0647.")}else alert("\u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u0641\u062a\u0631\u0629 \u0627\u0644\u062c\u0632\u0621 \u0627\u0644\u0645\u0631\u0627\u062f \u0646\u0642\u0644\u0647 \u0648\u0627\u0644\u063a\u0631\u0641\u0629 \u0627\u0644\u062c\u062f\u064a\u062f\u0629.")},disabled:ye,children:ye?"\u062c\u0627\u0631\u064d \u0627\u0644\u062a\u0646\u0641\u064a\u0630...":"\u062a\u0623\u0643\u064a\u062f \u062a\u0642\u0633\u064a\u0645 \u0627\u0644\u062d\u062c\u0632"})]})]})]}),(0,a.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm font-semibold mb-2",children:"\u0636\u064a\u0648\u0641 \u0625\u0636\u0627\u0641\u064a\u0648\u0646 \u0644\u0644\u062d\u062c\u0632"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:0===(L.pending_guest_ids||[]).length?(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0636\u064a\u0648\u0641 \u0625\u0636\u0627\u0641\u064a\u0648\u0646 \u0645\u0636\u0627\u0641\u0648\u0646."}):(L.pending_guest_ids||[]).map(e=>{const t=m.find(t=>String(t.id)===String(e));return(0,a.jsxs)("span",{className:"px-2 py-1 text-xs rounded border bg-white",children:[(null===t||void 0===t?void 0:t.full_name)||e,(0,a.jsx)("button",{type:"button",className:"ml-2 text-red-600",onClick:()=>{return t=e,void M(e=>Le(Le({},e),{},{pending_guest_ids:(e.pending_guest_ids||[]).filter(e=>String(e)!==String(t))}));var t},children:"\u0625\u0632\u0627\u0644\u0629 \u2716"})]},e)})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{className:"border rounded px-3 py-2 w-full text-sm",placeholder:"\u0628\u062d\u062b \u0639\u0646 \u0636\u064a\u0641 \u0644\u0625\u0636\u0627\u0641\u062a\u0647 \u0644\u0644\u062d\u062c\u0632",value:Q,onChange:e=>Y(e.target.value)}),X.length>0&&(0,a.jsx)("div",{className:"absolute z-10 mt-1 bg-white border rounded shadow p-2 text-sm max-h-48 overflow-auto w-full",children:X.filter(e=>{if("all"===f)return!0;if("inactive"===f)return e.is_inactive;if("current"===f)return e.has_current_stay;if("upcoming"===f)return e.has_upcoming_reservation;if("today"===f){const t=e.created_at?String(e.created_at).slice(0,10):null,n=new Date,r=e=>String(e).padStart(2,"0");return t==="".concat(n.getFullYear(),"-").concat(r(n.getMonth()+1),"-").concat(r(n.getDate()))}return!0}).map(e=>(0,a.jsxs)("div",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onClick:()=>{return t=e.id,void(async()=>{const e=(new Date).toISOString().slice(0,10),{data:n}=await Or.from("reception_shifts").select("id,status").eq("staff_user_id",null===q||void 0===q?void 0:q.id).eq("shift_date",e).eq("status","open").limit(1);n&&n.length>0?(M(e=>Le(Le({},e),{},{pending_guest_ids:Array.from(new Set([...e.pending_guest_ids||[],t]))})),Y(""),Z([])):window.alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0625\u0636\u0627\u0641\u0629 \u0636\u064a\u0641 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0646\u0634\u0637\u0629. \u064a\u0631\u062c\u0649 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b.")})();var t},children:[e.full_name," ",(0,a.jsxs)("span",{className:"text-gray-500",children:["(",e.phone||e.email||String(e.id).slice(0,8),")"]}),(0,a.jsx)("span",{className:"ml-1 text-[10px] text-gray-500",children:e.is_inactive?"\u2014 \u063a\u064a\u0631 \u0646\u0634\u0637":e.has_current_stay?"\u2014 \u0645\u0642\u064a\u0645 \u062d\u0627\u0644\u064a\u0627\u064b":e.has_upcoming_reservation?"\u2014 \u0644\u062f\u064a\u0647 \u062d\u062c\u0632 \u0642\u0627\u062f\u0645":""})]},e.id))})]}),(0,a.jsx)("div",{className:"mt-2 text-[11px] text-gray-600",children:'\u0633\u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0636\u064a\u0648\u0641 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u064a\u0646 \u0645\u0639 \u0627\u0644\u062d\u062c\u0632\u060c \u0648\u064a\u0645\u0643\u0646 \u062a\u0648\u0632\u064a\u0639\u0647\u0645 \u0639\u0644\u0649 \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629 \u0645\u0646 \u0634\u0627\u0634\u0629 "\u0627\u0644\u062a\u0633\u0643\u064a\u0646".'})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between border-t pt-3 sticky bottom-0 bg-white px-3",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\u0644\u064a\u0627\u0644\u064a: ",V]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",className:"px-4 py-2 border rounded",onClick:o,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",disabled:u,children:u?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":i?"\u062a\u062d\u062f\u064a\u062b \u0627\u0644\u062d\u062c\u0632":"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632"})]})]})]})]})})}function js(e){let{status:t}=e;const n=xs(t);return(0,a.jsx)("div",{className:"h-1",style:{backgroundColor:n}})}function Ns(e){let{value:t}=e;const n={clean:{text:"\u0646\u0638\u064a\u0641\u0629",cls:"bg-green-100 text-green-700"},in_cleaning:{text:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",cls:"bg-amber-100 text-amber-700"},needs_cleaning:{text:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",cls:"bg-red-100 text-red-700"}},r=n[t]||n.clean;return(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(r.cls),children:r.text})}function ks(e){let{room:t,resv:n,date:s,onDropReservation:i}=e;const o=Number(t.max_guests||t.capacity||0),[l,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[x,g]=(0,r.useState)(""),[v,b]=(0,r.useState)([]),[y,w]=(0,r.useState)(!1),_=(0,r.useMemo)(()=>{if(!n)return 0;const e=Number(n.guests_count||0);return Math.max(0,Math.min(e,o||0))},[n,o]),j=(0,r.useCallback)(async()=>{try{const{data:e,error:n}=await Or.rpc("get_room_beds_status",{p_room_id:t.id,p_date:s});if(n)throw n;c(e||[])}catch(e){console.warn("get_room_beds_status failed, fallback to capacity squares",(null===e||void 0===e?void 0:e.message)||e),c([])}},[t.id,s]);(0,r.useEffect)(()=>{j()},[j]);const N=(0,r.useCallback)(async()=>{if(n&&n.id)try{m(!0);const{data:e,error:t}=await Or.rpc("list_reservation_guests",{p_reservation_id:n.id});if(t)throw t;u(e||[])}catch(e){console.warn("list_reservation_guests failed",(null===e||void 0===e?void 0:e.message)||e),u([])}finally{m(!1)}else u([])},[n]);(0,r.useEffect)(()=>{N()},[N]),(0,r.useEffect)(()=>{const e=(x||"").trim();if(!e)return void b([]);const t=setTimeout(async()=>{try{const{data:t,error:n}=await Or.from("guests").select("id, full_name, phone, email").or("full_name.ilike.%".concat(e,"%,phone.ilike.%").concat(e,"%,email.ilike.%").concat(e,"%")).limit(10);if(n)throw n;b(t||[])}catch(t){console.warn("guest search failed",(null===t||void 0===t?void 0:t.message)||t),b([])}},350);return()=>clearTimeout(t)},[x]);const k=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!n)return;const{error:r}=await Or.rpc("assign_bed_for_reservation",{p_reservation_id:n.id,p_room_bed_id:e.bed_id,p_guest_id:t||p||n.guest_id||null,p_start:n.check_in_date,p_end:n.check_out_date});if(r)throw r;await j(),await N()}catch(r){window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0633\u0646\u0627\u062f \u0627\u0644\u0633\u0631\u064a\u0631: "+(r.message||r))}},S=()=>{if(l.length>0)return(0,a.jsx)("div",{className:"flex flex-wrap gap-2","aria-label":"\u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629",children:l.map(e=>{const t=!!e.assignment_id;return(0,a.jsxs)("div",{className:"px-2 py-1 rounded border text-xs flex items-center gap-2 ".concat(t?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"),style:{borderColor:vs(t?"occupied":"empty")},title:t?"\u0645\u0634\u063a\u0648\u0644: ".concat(e.guest_name||"\u2014"):"\u0641\u0627\u0631\u063a",children:[(0,a.jsx)("button",{className:"underline",onClick:()=>{!t&&n&&k(e)},children:e.bed_code}),t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{children:["\u2013 ",e.guest_name||"\u0645\u062c\u0647\u0648\u0644"]}),(0,a.jsx)("button",{className:"ml-2 text-red-600 hover:text-red-700",title:"\u0625\u0644\u063a\u0627\u0621",onClick:()=>(async e=>{try{const{error:t}=await Or.rpc("unassign_bed",{p_assignment_id:e});if(t)throw t;await j(),await N()}catch(t){window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0644\u063a\u0627\u0621 \u0625\u0633\u0646\u0627\u062f \u0627\u0644\u0633\u0631\u064a\u0631: "+(t.message||t))}})(e.assignment_id),children:"\u0625\u0644\u063a\u0627\u0621 \u2716"})]})]},e.bed_id)})});const e=[];for(let t=0;t<(o||0);t++){const n=t<_;e.push((0,a.jsx)("div",{className:"w-5 h-3 rounded-sm border",style:{backgroundColor:vs(n?"occupied":"empty"),borderColor:vs(n?"occupied":"empty")},title:n?"\u0645\u0634\u063a\u0648\u0644":"\u0641\u0627\u0631\u063a"},t))}return(0,a.jsx)("div",{className:"flex flex-wrap gap-1","aria-label":"\u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629: ".concat(_,"/").concat(o),children:e})},C=!!n,E=gs(t.status);return(0,a.jsxs)("div",{onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();try{const n=JSON.parse(e.dataTransfer.getData("application/json"));if(!n||!n.id)return;if(String(n.room_id)===String(t.id))return;i&&i(n,t)}catch(n){}},className:"rounded-md shadow-sm border overflow-hidden text-xs transition-colors duration-150 ".concat(C?"bg-white border-gray-200":"bg-emerald-50 border-emerald-100"),dir:"rtl",children:[(0,a.jsx)(js,{status:t.status}),(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-800 text-sm",title:"\u0627\u0644\u063a\u0631\u0641\u0629",children:t.room_code||t.room_label}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-[11px] text-gray-500",title:"\u0627\u0644\u0646\u0648\u0639 \u0648\u0627\u0644\u062d\u0627\u0644\u0629",children:[(0,a.jsx)("span",{className:"truncate max-w-[80px]",children:t.room_type_name_ar||t.room_type_name}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded-full text-[10px] text-white",style:{backgroundColor:xs(t.status)},children:E})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify_between mb-1 text-[11px] text-gray-600",children:[(0,a.jsxs)("div",{className:"truncate max-w-[55%]",children:[t.floor_name," \u2013 ",t.building_name]}),(0,a.jsx)(Ns,{value:t.cleanliness})]}),(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsx)(S,{})}),n?(0,a.jsxs)("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.setData("application/json",JSON.stringify({id:n.id,room_id:n.room_id,check_in_date:n.check_in_date,check_out_date:n.check_out_date}))},className:"px-2 py-1 rounded text-[11px] bg-blue-50 border border-blue-200 text-blue-700 cursor-grab",title:"\u0627\u0644\u0646\u0632\u064a\u0644: ".concat(n.guest_name||"\u2014"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("span",{className:"truncate",children:n.guest_name||"\u0646\u0632\u064a\u0644"}),(0,a.jsxs)("span",{className:"text-[10px] text-gray-500",children:[_,"/",o]})]}),"agency"===n.payer_type&&n.agency_name&&(0,a.jsx)("div",{className:"mt-0.5",title:"\u0634\u0631\u0643\u0629/\u062c\u0647\u0629: ".concat(n.agency_name),children:(0,a.jsxs)("span",{className:"inline-flex max-w-full items-center px-2 py-0.5 rounded-full border border-emerald-300 bg-emerald-50 text-emerald-800 text-[9px] font-semibold truncate",children:[(0,a.jsx)("span",{className:"mr-1",children:"\u0634\u0631\u0643\u0629"}),(0,a.jsx)("span",{className:"truncate",children:n.agency_name})]})}),(0,a.jsxs)("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["\u0645\u0646 ",n.check_in_date," \u0625\u0644\u0649 ",n.check_out_date]}),(0,a.jsx)("button",{type:"button",className:"mt-1 text-[11px] text-blue-600 hover:text-blue-700 underline",onClick:()=>w(e=>!e),children:y?"\u0625\u062e\u0641\u0627\u0621 \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0636\u064a\u0648\u0641":"\u0625\u0638\u0647\u0627\u0631 \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0636\u064a\u0648\u0641 \u0648\u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629"}),y&&(0,a.jsxs)("div",{className:"mt-1 p-1.5 bg-gray-50 border border-gray-200 rounded",children:[(0,a.jsx)("div",{className:"text-[11px] font-semibold mb-1",children:"\u0636\u064a\u0648\u0641 \u0627\u0644\u062d\u062c\u0632"}),h?(0,a.jsx)("div",{className:"text-[11px] text-gray-500",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5 mb-2",children:0===d.length?(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0636\u064a\u0648\u0641 \u0625\u0636\u0627\u0641\u064a\u0648\u0646."}):d.map(e=>(0,a.jsxs)("label",{className:"px-2 py-0.5 rounded border text-[11px] cursor-pointer ".concat(p===e.guest_id?"bg-amber-50 border-amber-300 text-amber-800":"bg-white border-gray-300 text-gray-700"),children:[(0,a.jsx)("input",{type:"radio",name:"sel-".concat(n.id),className:"mr-1",checked:p===e.guest_id,onChange:()=>f(e.guest_id)}),e.full_name]},e.reservation_guest_id))}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("input",{value:x,onChange:e=>g(e.target.value),className:"border rounded px-2 py-0.5 text-[11px] flex-1",placeholder:"\u0628\u062d\u062b: \u0627\u0644\u0627\u0633\u0645/\u0627\u0644\u0647\u0627\u062a\u0641/\u0627\u0644\u0628\u0631\u064a\u062f"}),v.length>0&&(0,a.jsx)("div",{className:"absolute mt-8 bg-white border rounded shadow p-2 text-[11px] max-h-36 overflow-auto z-10",children:v.map(e=>(0,a.jsxs)("div",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onClick:()=>(async e=>{try{if(!n||!n.id||!e)return;const{error:t}=await Or.rpc("add_reservation_guest",{p_reservation_id:n.id,p_guest_id:e,p_role:"additional"});if(t)throw t;f(e),g(""),b([]),await N(),await j();const r=(l||[]).find(e=>!e.assignment_id);r?await k(r,e):window.alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u0623\u0633\u0650\u0631\u0651\u0629 \u0641\u0627\u0631\u063a\u0629 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645.")}catch(t){window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0636\u064a\u0641 \u0644\u0644\u062d\u062c\u0632: "+(t.message||t))}})(e.id),children:[e.full_name," ",(0,a.jsxs)("span",{className:"text-gray-500",children:["(",e.phone||e.email||e.id.slice(0,8),")"]})]},e.id))})]}),(0,a.jsx)("div",{className:"mt-1 text-[10px] text-gray-500",children:"\u0627\u062e\u062a\u0631 \u0636\u064a\u0641\u064b\u0627\u060c \u062b\u0645 \u0627\u0636\u063a\u0637 \u0639\u0644\u0649 \u0633\u0631\u064a\u0631 \u0641\u0627\u0631\u063a \u0644\u0625\u0633\u0646\u0627\u062f\u0647."})]})]}):(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u062d\u062c\u0632 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u062a\u0627\u0631\u064a\u062e"})]})]})}function Ss(e){let{selectedDate:t,onDateChange:n,searchQuery:s="",refreshTick:i=0}=e;const o=(0,r.useContext)(la),[l,c]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)([]),[p,f]=(0,r.useState)(!0),[x,g]=(0,r.useState)("all"),[v,b]=(0,r.useState)("all"),[y,w]=(0,r.useState)("all"),[_,j]=(0,r.useState)(null),N=(0,r.useCallback)(async()=>{try{const{data:e,error:t}=await Or.from("rooms_overview").select("id, room_code, room_label, status, cleanliness, max_guests, room_type_name_ar, room_type_name, building_id, building_name, floor_id, floor_name").order("room_code");if(t)throw t;if(e&&e.length>0)return void u(e)}catch(e){console.warn("rooms_overview unavailable, falling back to base tables:",(null===e||void 0===e?void 0:e.message)||e)}try{const[e,n,r,s]=await Promise.all([Or.from("rooms").select("id, room_code, status, cleanliness, room_type_id, building_id, floor_id").order("room_code"),Or.from("room_types_active").select("id, name, name_ar, max_guests").order("display_order"),Or.from("buildings").select("id, name").order("name"),Or.from("floors").select("id, name, floor_number, number, building_id").order("id")]);let a=n.data||[];if(n.error||0===a.length)try{const e=await Or.from("room_types").select("id, name, name_ar, max_guests").order("id");e.error||(a=e.data||[])}catch(t){}const i=new Map;a.forEach(e=>i.set(String(e.id),e));const o=new Map;(r.data||[]).forEach(e=>o.set(String(e.id),e));const l=new Map;(s.data||[]).forEach(e=>l.set(String(e.id),e));const c=(e.data||[]).map(e=>{const t=i.get(String(e.room_type_id)),n=o.get(String(e.building_id)),r=l.get(String(e.floor_id)),s=e.room_code||(e.id?"\u063a\u0631\u0641\u0629 #".concat(String(e.id).slice(0,8)):"\u063a\u0631\u0641\u0629"),a=(null===n||void 0===n?void 0:n.name)||"\u0645\u0628\u0646\u0649",c=(null===r||void 0===r?void 0:r.name)||(null!==r&&void 0!==r&&r.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(r.floor_number):null!==r&&void 0!==r&&r.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(r.number):"\u0637\u0627\u0628\u0642");return{id:e.id,room_code:e.room_code,room_label:s,status:e.status,cleanliness:e.cleanliness,max_guests:(null===t||void 0===t?void 0:t.max_guests)||0,room_type_name_ar:null===t||void 0===t?void 0:t.name_ar,room_type_name:null===t||void 0===t?void 0:t.name,building_id:e.building_id,building_name:a,floor_id:e.floor_id,floor_name:c}});u(c)}catch(n){console.error("Fallback loadRooms failed",n),u([])}},[]),k=(0,r.useCallback)(async e=>{try{const{data:t,error:n}=await Or.from("reservations").select("id, room_id, guest_id, guests_count, status, check_in_date, check_out_date, nightly_rate, total_amount, amount_paid, currency, payment_method, payer_type, agency_name, special_requests, notes, guests(full_name)").in("status",["pending","confirmed","checked_in"]).lte("check_in_date",e).gt("check_out_date",e);if(n)throw n;const r=(t||[]).map(e=>({id:e.id,room_id:e.room_id,guest_id:e.guest_id,guests_count:e.guests_count,status:e.status,check_in_date:e.check_in_date,check_out_date:e.check_out_date,nightly_rate:e.nightly_rate,total_amount:e.total_amount,amount_paid:e.amount_paid,currency:e.currency,payment_method:e.payment_method,payer_type:e.payer_type,agency_name:e.agency_name,special_requests:e.special_requests,notes:e.notes,guest_name:e.guests&&e.guests.full_name?e.guests.full_name:void 0}));m(r)}catch(t){console.error("loadResvsForDate failed",t),m([])}},[]),S=(0,r.useCallback)(async()=>{f(!0),await Promise.all([N(),k(l)]),f(!1)},[l,N,k]);(0,r.useEffect)(()=>{S()},[S]),(0,r.useEffect)(()=>{t&&t!==l&&c(t)},[t]),(0,r.useEffect)(()=>{S()},[i]),(0,r.useEffect)(()=>{const e=Or.channel("tashkeen-live").on("postgres_changes",{event:"*",schema:"public",table:"reservations"},()=>{k(l)}).on("postgres_changes",{event:"*",schema:"public",table:"rooms"},()=>{N()}).subscribe();return()=>{try{Or.removeChannel(e)}catch(t){}}},[l,N,k]);const C=(0,r.useMemo)(()=>{const e=new Map;return h.forEach(t=>{e.set(String(t.room_id),t)}),e},[h]),E=(0,r.useMemo)(()=>{let e=d;"all"!==x&&(e=e.filter(e=>String(e.building_id||e.building_name||"")===x)),"all"!==v&&(e=e.filter(e=>String(e.floor_id||e.floor_name||"")===v)),"all"!==y&&(e=e.filter(e=>String(e.status||"").toLowerCase()===y));const t=(s||"").trim().toLowerCase();if(!t)return e;const n=new Map;return h.forEach(e=>{n.set(String(e.room_id),e)}),e.filter(e=>{const r=(e.room_code||e.room_label||"").toLowerCase().includes(t),s=n.get(String(e.id)),a=!!s&&(s.guest_name||"").toLowerCase().includes(t);return r||a})},[d,h,s,x,v,y]),T=(0,r.useMemo)(()=>{const e=new Map;return d.forEach(t=>{const n=String(t.building_id||t.building_name||"");n&&(e.has(n)||e.set(n,t.building_name||"\u0645\u0628\u0646\u0649"))}),Array.from(e.entries()).map(e=>{let[t,n]=e;return{value:t,label:n}})},[d]),O=(0,r.useMemo)(()=>{const e=new Map;return d.forEach(t=>{const n=String(t.floor_id||t.floor_name||"");n&&(e.has(n)||e.set(n,t.floor_name||"\u0637\u0627\u0628\u0642"))}),Array.from(e.entries()).map(e=>{let[t,n]=e;return{value:t,label:n}})},[d]),R=(0,r.useMemo)(()=>{const e=d.length,t=new Set(h.map(e=>String(e.room_id))).size,n=d.reduce((e,t)=>e+Number(t.max_guests||0),0),r=h.reduce((e,t)=>e+Number(t.guests_count||0),0);return{totalRooms:e,roomsWithResv:t,totalBeds:n,occupiedBeds:r,emptyBeds:Math.max(0,n-r)}},[d,h]),P=(0,r.useMemo)(()=>{const e=new Map;return E.forEach(t=>{const n=String(t.building_id||t.building_name||"\u2014"),r=String(t.floor_id||t.floor_name||"\u2014");e.has(n)||e.set(n,{label:t.building_name||"\u0645\u0628\u0646\u0649",floors:new Map});const s=e.get(n);s.floors.has(r)||s.floors.set(r,{label:t.floor_name||"\u0637\u0627\u0628\u0642",rooms:[]}),s.floors.get(r).rooms.push(t)}),Array.from(e.values()).map(e=>({label:e.label,floors:Array.from(e.floors.values()).map(e=>({label:e.label,rooms:e.rooms}))}))},[E]),I=async(e,t)=>{try{const n=C.get(String(t.id)),r=o&&o.id?o.id:null;if(n&&String(n.id)!==String(e.id)){if(!window.confirm("\u0627\u0644\u063a\u0631\u0641\u0629 ".concat(t.room_code||t.room_label," \u062a\u062d\u062a\u0648\u064a \u0639\u0644\u0649 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645.\n")+"\u0647\u0644 \u062a\u0631\u064a\u062f \u062a\u0628\u062f\u064a\u0644 \u0627\u0644\u063a\u0631\u0641 \u0628\u064a\u0646 \u0627\u0644\u062d\u062c\u0632\u064a\u0646 \u0645\u0639 \u0627\u0644\u0627\u062d\u062a\u0641\u0627\u0638 \u0628\u0646\u0641\u0633 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e\u061f"))return;const{error:s}=await Or.rpc("swap_room_reservations",{p_reservation_id1:e.id,p_reservation_id2:n.id,p_staff_user_id:r});if(s)throw s;return await k(l),void window.alert("\u062a\u0645 \u062a\u0628\u062f\u064a\u0644 \u0627\u0644\u063a\u0631\u0641 \u0628\u064a\u0646 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0628\u0646\u062c\u0627\u062d.")}if(!window.confirm("\u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 ".concat(t.room_code||t.room_label," \u0644\u0646\u0641\u0633 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e\u061f")))return;const{error:s}=await Or.rpc("move_reservation",{p_reservation_id:e.id,p_new_room_id:t.id,p_new_check_in:e.check_in_date,p_new_check_out:e.check_out_date});if(s)throw s;await k(l),window.alert("\u062a\u0645 \u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0628\u0646\u062c\u0627\u062d.")}catch(n){console.error("move failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632: "+(n.message||n))}};return(0,a.jsxs)("div",{className:"p-4 md:p-6",dir:"rtl",children:[(0,a.jsxs)("div",{className:"mb-6 bg-white rounded-lg shadow border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 px-4 pt-4 pb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl md:text-2xl font-bold mb-1",children:"\u0627\u0644\u062a\u0633\u0643\u064a\u0646 (\u0639\u0631\u0636 \u0625\u0634\u063a\u0627\u0644 \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629)"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0639\u0631\u0636 \u0628\u0635\u0631\u064a \u0644\u0633\u0639\u0629 \u0627\u0644\u063a\u0631\u0641 \u0648\u0639\u062f\u062f \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629 \u0627\u0644\u0645\u0634\u063a\u0648\u0644\u0629 \u0641\u064a \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u062d\u062f\u062f\u060c \u0645\u0639 \u0625\u0645\u0643\u0627\u0646\u064a\u0629 \u062a\u0648\u0632\u064a\u0639 \u0627\u0644\u0636\u064a\u0648\u0641 \u0639\u0644\u0649 \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629 \u0628\u0633\u0647\u0648\u0644\u0629."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2 text-sm",value:l,onChange:e=>{c(e.target.value),n&&n(e.target.value)},title:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,a.jsx)("button",{className:"border rounded px-3 py-2 bg-white hover:bg-gray-50 text-sm",onClick:()=>{const e=(new Date).toISOString().slice(0,10);c(e),n&&n(e)},children:"\u0627\u0644\u064a\u0648\u0645"})]})]}),(0,a.jsx)("div",{className:"px-4 pb-3 border-t border-gray-100 bg-slate-50/80",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 text-xs md:text-sm text-gray-700 mt-3",children:[(0,a.jsxs)("div",{className:"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col",children:[(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641"}),(0,a.jsx)("span",{className:"text-base font-semibold",children:R.totalRooms})]}),(0,a.jsxs)("div",{className:"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col",children:[(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"\u063a\u0631\u0641 \u0628\u0647\u0627 \u062d\u062c\u0632 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{className:"text-base font-semibold",children:R.roomsWithResv})]}),(0,a.jsxs)("div",{className:"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col",children:[(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629"}),(0,a.jsx)("span",{className:"text-base font-semibold",children:R.totalBeds})]}),(0,a.jsxs)("div",{className:"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col",children:[(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"\u0623\u0633\u0650\u0631\u0651\u0629 \u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("span",{className:"text-base font-semibold text-blue-700",children:R.occupiedBeds})]}),(0,a.jsxs)("div",{className:"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col",children:[(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"\u0623\u0633\u0650\u0631\u0651\u0629 \u0641\u0627\u0631\u063a\u0629 \u062a\u0642\u0631\u064a\u0628\u064b\u0627"}),(0,a.jsx)("span",{className:"text-base font-semibold text-emerald-700",children:R.emptyBeds})]})]})}),(0,a.jsxs)("div",{className:"px-4 pb-4 border-t border-gray-100 bg-slate-50/60",children:[(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs sm:text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"\u0627\u0644\u0645\u0628\u0646\u0649:"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1 text-xs sm:text-sm",value:x,onChange:e=>{g(e.target.value),b("all")},children:[(0,a.jsx)("option",{value:"all",children:"\u0627\u0644\u0643\u0644"}),T.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"\u0627\u0644\u062f\u0648\u0631:"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1 text-xs sm:text-sm",value:v,onChange:e=>b(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u0627\u0644\u0643\u0644"}),O.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641\u0629:"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1 text-xs sm:text-sm",value:y,onChange:e=>w(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u0627\u0644\u0643\u0644"}),(0,a.jsx)("option",{value:"available",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("option",{value:"reserved",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("option",{value:"occupied",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]})]})]}),(0,a.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-xs sm:text-sm text-blue-800 leading-relaxed",children:[(0,a.jsx)("div",{children:"- \u0627\u0633\u062d\u0628 \u0628\u0637\u0627\u0642\u0629 \u0627\u0644\u0646\u0632\u064a\u0644 \u0645\u0646 \u063a\u0631\u0641\u0629 \u0625\u0644\u0649 \u0623\u062e\u0631\u0649 \u0644\u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0644\u0646\u0641\u0633 \u0627\u0644\u0645\u062f\u0629."}),(0,a.jsx)("div",{children:"- \u0643\u0644 \u0645\u0633\u062a\u0637\u064a\u0644 \u0635\u063a\u064a\u0631 \u064a\u0645\u062b\u0644 \u0633\u0631\u064a\u0631\u064b\u0627\u061b \u0627\u0644\u0645\u0645\u062a\u0644\u0626 \u064a\u0639\u0646\u064a \u0645\u0634\u063a\u0648\u0644 \u062d\u0633\u0628 \u0639\u062f\u062f \u0627\u0644\u0636\u064a\u0648\u0641 \u0641\u064a \u0627\u0644\u062d\u062c\u0632."}),(0,a.jsx)("div",{children:"- \u064a\u0645\u0643\u0646\u0643 \u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0645\u0646 \u0627\u0644\u0623\u0639\u0644\u0649 \u0644\u0645\u0634\u0627\u0647\u062f\u0629 \u0625\u0634\u063a\u0627\u0644 \u064a\u0648\u0645 \u0645\u0639\u064a\u0651\u0646."}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] sm:text-xs text-blue-900 flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-block w-4 h-4 rounded",style:{backgroundColor:vs("occupied")}})," ",(0,a.jsx)("span",{children:"\u0633\u0631\u064a\u0631 \u0645\u0634\u063a\u0648\u0644"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-block w-4 h-4 rounded",style:{backgroundColor:vs("empty")}})," ",(0,a.jsx)("span",{children:"\u0633\u0631\u064a\u0631 \u0641\u0627\u0631\u063a"})]})]})]})]})]}),p?(0,a.jsx)("div",{className:"text-gray-500",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):0===P.length?(0,a.jsx)("div",{className:"text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641."}):(0,a.jsx)("div",{className:"space-y-8",children:P.map((e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-bold text-gray-800 mb-3",children:e.label}),(0,a.jsx)("div",{className:"space-y-5",children:e.floors.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg bg-white/70",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-700",children:e.label}),(0,a.jsxs)("div",{className:"text-[11px] text-gray-500",children:["\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641: ",e.rooms.length]})]}),(0,a.jsx)("div",{className:"px-3 py-3",children:(0,a.jsx)("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5",children:e.rooms.map(e=>{const t=!!C.get(String(e.id));return(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)(ks,{room:e,resv:C.get(String(e.id)),date:l,onDropReservation:I}),t?(0,a.jsx)("button",{type:"button",className:"absolute top-1 left-1 text-[10px] bg-white/90 border border-blue-300 text-blue-700 rounded px-1.5 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(e=>{const t=h.find(t=>String(t.room_id)===String(e));t&&j(t)})(e.id),children:"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u062d\u062c\u0632"}):(0,a.jsx)("button",{type:"button",className:"absolute top-1 left-1 text-[10px] bg-white/90 border border-emerald-300 text-emerald-700 rounded px-1.5 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(e=>{e&&j({id:null,guest_id:null,room_id:e.id,check_in_date:l,check_out_date:l,guests_count:1,status:"confirmed",nightly_rate:null,total_amount:null,amount_paid:0,currency:"EGP",payment_method:"cash",payer_type:"guest",agency_name:"",special_requests:"",notes:"",pending_guest_ids:[]})})(e),children:"\u062d\u062c\u0632 \u062c\u062f\u064a\u062f"})]},e.id)})})})]},t))})]},t))}),_&&(0,a.jsx)(_s,{initialData:_,onClose:()=>j(null),onSave:async e=>{try{if(!e)return;const n=o&&o.id?o.id:null,{data:r,error:s}=await Or.from("reception_shifts").select("id").eq("user_id",n).eq("active",!0).single();if(s||!r||!r.id)return void window.alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062a\u0646\u0641\u064a\u0630 \u0623\u064a \u0639\u0645\u0644\u064a\u0629 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0646\u0634\u0637\u0629. \u064a\u0631\u062c\u0649 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b.");const a=Le({},e),i=Array.isArray(a.pending_guest_ids)?a.pending_guest_ids:[];if(delete a.pending_guest_ids,_&&_.id){const{error:e}=await Or.from("reservations").update(a).eq("id",_.id);if(e)throw e;if(_.id&&i.length>0)for(const n of i)try{await Or.rpc("add_reservation_guest",{p_reservation_id:_.id,p_guest_id:n,p_role:"additional"})}catch(t){}}else{const{data:e,error:n}=await Or.from("reservations").insert([a]).select("id").single();if(n)throw n;const r=null===e||void 0===e?void 0:e.id;if(r&&i.length>0)for(const s of i)try{await Or.rpc("add_reservation_guest",{p_reservation_id:r,p_guest_id:s,p_role:"additional"})}catch(t){}}await k(l),j(null)}catch(n){console.error("Failed to save reservation from Tashkeen",n);const e=String((null===n||void 0===n?void 0:n.message)||n||"").toLowerCase();let t="\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0627\u0644\u062d\u062c\u0632.";e.includes("overlapping reservation")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0647\u0646\u0627\u0643 \u062a\u0639\u0627\u0631\u0636 \u0641\u064a \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e \u0645\u0639 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0644\u0646\u0641\u0633 \u0627\u0644\u063a\u0631\u0641\u0629.":e.includes("check_out_date must be after check_in_date")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0628\u0639\u062f \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644.":e.includes("row-level security")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0644\u0627 \u062a\u0645\u0644\u0643 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0644\u062d\u0641\u0638 \u0627\u0644\u062d\u062c\u0632 (RLS).":e.includes("not-null")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0628\u0639\u0636 \u0627\u0644\u062d\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629 \u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644\u0629.":e.includes("invalid input syntax")&&(t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0645\u0634\u0643\u0644\u0629 \u0641\u064a \u0635\u064a\u063a\u0629 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u062f\u062e\u0644\u0629."),window.alert(t)}},onAfterAction:async()=>{await k(l)}})]})}function Cs(e){let{name:t,className:n}=e;const r={className:"w-4 h-4 ".concat(n||"")};switch(t){case"phone":return(0,a.jsx)("svg",Le(Le({},r),{},{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.11 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.9.32 1.77.59 2.61a2 2 0 0 1-.45 2.11L8 9a16 16 0 0 0 7 7l.56-.25a2 2 0 0 1 2.11-.45c.84.27 1.71.47 2.61.59A2 2 0 0 1 22 16.92z"})}));case"id":return(0,a.jsxs)("svg",Le(Le({},r),{},{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),(0,a.jsx)("circle",{cx:"8",cy:"12",r:"3"}),(0,a.jsx)("path",{d:"M14 10h6M14 14h6"})]}));case"email":return(0,a.jsxs)("svg",Le(Le({},r),{},{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M4 4h16a2 2 0 1 1 0 0v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"}),(0,a.jsx)("path",{d:"M22 6l-10 7L2 6"})]}));case"star":return(0,a.jsx)("svg",Le(Le({},r),{},{viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z"})}));default:return null}}function Es(e){let{label:t,active:n}=e;return(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(n?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:t})}function Ts(e){let{guest:t,onEdit:n,onDelete:r,onHistory:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow transform hover:-translate-y-0.5 border border-gray-200 overflow-hidden",dir:"rtl",children:[(0,a.jsx)("div",{className:"h-1 ".concat(t.is_vip?"bg-purple-500":"bg-blue-500")}),(0,a.jsx)("div",{className:"px-4 pt-4 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-700 font-bold ".concat(t.is_vip?"ring-2 ring-purple-300":""),children:[t.avatar_url?(0,a.jsx)("img",{src:t.avatar_url,alt:t.full_name||"",className:"w-full h-full object-cover"}):(0,a.jsx)("span",{children:String(t.full_name||"\u061f").trim().split(/\s+/).slice(0,2).map(e=>e[0]).join("").toUpperCase()||"\u061f"}),t.is_vip&&(0,a.jsx)("span",{className:"absolute -bottom-1 -left-1 bg-purple-600 text-white rounded-full p-0.5",title:"\u0646\u0632\u064a\u0644 VIP",children:(0,a.jsx)(Cs,{name:"star",className:"w-3 h-3"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"text-gray-800 font-bold",children:t.full_name}),t.is_vip&&(0,a.jsxs)("span",{className:"hidden md:inline-flex items-center gap-1 text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",title:"\u0646\u0632\u064a\u0644 VIP",children:[(0,a.jsx)(Cs,{name:"star",className:"text-purple-600"})," VIP"]})]})]})}),(0,a.jsxs)("div",{className:"px-4 py-3 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,a.jsx)(Cs,{name:"phone",className:"text-gray-500"}),(0,a.jsxs)("span",{children:["\u0647\u0627\u062a\u0641: ",t.phone||"\u2014"]})]}),(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,a.jsx)(Cs,{name:"id",className:"text-gray-500"}),(0,a.jsxs)("span",{children:["\u0647\u0648\u064a\u0629: ",t.national_id||"\u2014"]})]}),(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,a.jsx)(Cs,{name:"email",className:"text-gray-500"}),(0,a.jsxs)("span",{children:["\u0628\u0631\u064a\u062f: ",t.email||"\u2014"]})]}),t.id_doc_url&&(0,a.jsxs)("div",{className:"mb-1 text-xs",children:[(0,a.jsx)("a",{href:t.id_doc_url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"\u0639\u0631\u0636 \u0635\u0648\u0631\u0629 \u0627\u0644\u0647\u0648\u064a\u0629"}),t.id_doc_type&&(0,a.jsxs)("span",{className:"ml-2 text-gray-500",children:["(","passport"===t.id_doc_type?"\u062c\u0648\u0627\u0632 \u0633\u0641\u0631":"\u0628\u0637\u0627\u0642\u0629 \u0634\u062e\u0635\u064a\u0629",")"]})]}),(0,a.jsxs)("div",{className:"mb-1 text-xs text-gray-600",children:[(0,a.jsx)("span",{children:"\u0623\u064f\u0646\u0634\u0626 \u0628\u0648\u0627\u0633\u0637\u0629: "}),(0,a.jsx)("span",{className:"font-medium",children:t.created_by_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),t.created_at&&(0,a.jsxs)("span",{children:[" ","(",new Date(t.created_at).toLocaleDateString("ar-EG"),")"]})]}),(0,a.jsxs)("div",{className:"mb-2",children:["\u0622\u062e\u0631 \u0632\u064a\u0627\u0631\u0629: ",t.last_visit_at?new Date(t.last_visit_at).toLocaleDateString("ar-EG"):"\u2014"]}),(0,a.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,a.jsx)(Es,{label:"\u0632\u064a\u0627\u0631\u0627\u062a: ".concat(t.visits_count||0),active:(t.visits_count||0)>0}),(0,a.jsx)(Es,{label:t.has_current_stay?"\u062d\u062c\u0632 \u0642\u0627\u0626\u0645":"\u0644\u0627 \u064a\u0648\u062c\u062f \u062d\u062c\u0632 \u0642\u0627\u0626\u0645",active:t.has_current_stay}),(0,a.jsx)(Es,{label:t.has_upcoming_reservation?"\u0642\u0627\u062f\u0650\u0645":"\u063a\u064a\u0631 \u0642\u0627\u062f\u0650\u0645",active:t.has_upcoming_reservation})]})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-t bg-gray-50",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:s,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded text-sm flex-1",children:"\u0627\u0644\u0633\u062c\u0644 \ud83d\udcdc"}),(0,a.jsx)("button",{onClick:n,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062a\u0639\u062f\u064a\u0644 \u270d\ufe0f"}),(0,a.jsx)("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})})]})}function Os(e){let{initialData:t,onClose:n,onSave:s}=e;const i=e=>{const t=String(e||"").trim().split(/\s+/);return 0===t.length?{first:"",last:""}:1===t.length?{first:t[0],last:""}:{first:t[0],last:t.slice(1).join(" ")}},o=(()=>{const e=(null===t||void 0===t?void 0:t.first_name)||"",n=(null===t||void 0===t?void 0:t.last_name)||"";return e.trim().length+n.trim().length===0&&null!==t&&void 0!==t&&t.full_name?i(t.full_name):{first:e,last:n}})(),[l,c]=(0,r.useState)(o.first||""),[d,u]=(0,r.useState)(o.last||""),[h,m]=(0,r.useState)((null===t||void 0===t?void 0:t.email)||""),[p,f]=(0,r.useState)((null===t||void 0===t?void 0:t.phone)||""),[x,g]=(0,r.useState)((null===t||void 0===t?void 0:t.nationality)||""),[v,b]=(0,r.useState)((null===t||void 0===t?void 0:t.national_id)||""),[y,w]=(0,r.useState)((null===t||void 0===t?void 0:t.address)||""),[_,j]=(0,r.useState)((null===t||void 0===t?void 0:t.city)||""),[N,k]=(0,r.useState)((null===t||void 0===t?void 0:t.country)||""),[S,C]=(0,r.useState)(!(null===t||void 0===t||!t.is_vip)),[E,T]=(0,r.useState)((null===t||void 0===t?void 0:t.avatar_url)||""),[O,R]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_type)||"national_id"),[P,I]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_number)||""),[A,D]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_url)||""),[L,M]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_uploaded_at)||null),[q,U]=(0,r.useState)(!1),[z,B]=(0,r.useState)((null===t||void 0===t?void 0:t.notes)||""),[F,W]=(0,r.useState)(!1),[V,H]=(0,r.useState)({});r.useEffect(()=>{const e=(null===t||void 0===t?void 0:t.first_name)||"",n=(null===t||void 0===t?void 0:t.last_name)||"";let r={first:e,last:n};e.trim().length+n.trim().length===0&&null!==t&&void 0!==t&&t.full_name&&(r=i(t.full_name)),c(r.first||""),u(r.last||""),m((null===t||void 0===t?void 0:t.email)||""),f((null===t||void 0===t?void 0:t.phone)||""),g((null===t||void 0===t?void 0:t.nationality)||""),b((null===t||void 0===t?void 0:t.national_id)||""),w((null===t||void 0===t?void 0:t.address)||""),j((null===t||void 0===t?void 0:t.city)||""),k((null===t||void 0===t?void 0:t.country)||""),C(!(null===t||void 0===t||!t.is_vip)),T((null===t||void 0===t?void 0:t.avatar_url)||""),R((null===t||void 0===t?void 0:t.id_doc_type)||"national_id"),I((null===t||void 0===t?void 0:t.id_doc_number)||""),D((null===t||void 0===t?void 0:t.id_doc_url)||""),M((null===t||void 0===t?void 0:t.id_doc_uploaded_at)||null),B((null===t||void 0===t?void 0:t.notes)||""),H({})},[t]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg sm:max-w-xl md:max-w-2xl lg:max-w-3xl max-h-[90vh] flex flex-col",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b sticky top-0 bg-white z-10",children:(0,a.jsx)("h3",{className:"text-xl font-bold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0646\u0632\u064a\u0644":"\u0625\u0636\u0627\u0641\u0629 \u0646\u0632\u064a\u0644 \u062c\u062f\u064a\u062f"})}),(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={},t=String(l).trim().length+String(d).trim().length>0,n="".concat(String(l||"").trim()," ").concat(String(d||"").trim()).trim();return t||0!==n.length||(e.full_name="\u0627\u0643\u062a\u0628 \u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644 \u0648\u0627\u0644\u0623\u062e\u064a\u0631 \u0623\u0648 \u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644."),H(e),0===Object.keys(e).length})()){W(!0);try{await s({first_name:l,last_name:d,avatar_url:E,id_doc_type:O,id_doc_number:P,id_doc_url:A,id_doc_uploaded_at:L,email:h,phone:p,nationality:x,national_id:v,address:y,city:_,country:N,is_vip:S,notes:z})}finally{W(!1)}}},className:"px-6 py-4 flex-1 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644 *"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:l,onChange:e=>{c(e.target.value),H(e=>Le(Le({},e),{},{full_name:void 0}))},placeholder:"\u0623\u062d\u0645\u062f"}),V.full_name&&(0,a.jsx)("div",{className:"text-red-600 text-xs mt-1",children:V.full_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u062e\u064a\u0631 *"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:d,onChange:e=>{u(e.target.value),H(e=>Le(Le({},e),{},{full_name:void 0}))},placeholder:"\u0645\u062d\u0645\u062f"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0631\u0627\u0628\u0637 \u0627\u0644\u0635\u0648\u0631\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:E,onChange:e=>T(e.target.value),placeholder:"https://.../avatar.jpg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:h,onChange:e=>m(e.target.value),placeholder:"name@example.com"})]}),(0,a.jsx)("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:(0,a.jsxs)("details",{className:"group",children:[(0,a.jsxs)("summary",{className:"font-semibold text-sm cursor-pointer list-none flex items-center justify-between",children:[(0,a.jsx)("span",{children:"\u0647\u0648\u064a\u0629 \u0627\u0644\u0639\u0645\u064a\u0644"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 group-open:hidden",children:"\u0625\u0638\u0647\u0627\u0631"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 hidden group-open:inline",children:"\u0625\u062e\u0641\u0627\u0621"})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0646\u0648\u0639 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,a.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:O,onChange:e=>R(e.target.value),children:[(0,a.jsx)("option",{value:"national_id",children:"\u0628\u0637\u0627\u0642\u0629 \u0634\u062e\u0635\u064a\u0629"}),(0,a.jsx)("option",{value:"passport",children:"\u062c\u0648\u0627\u0632 \u0633\u0641\u0631"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:P,onChange:e=>I(e.target.value),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u062c\u0648\u0627\u0632/\u0627\u0644\u0628\u0637\u0627\u0642\u0629"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0631\u0641\u0639 \u0635\u0648\u0631\u0629 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,a.jsx)("input",{type:"file",accept:"image/*,application/pdf",className:"mt-1 w-full",onChange:async e=>{const t=e.target.files&&e.target.files[0];if(t)try{U(!0);const e="".concat(Date.now(),"_").concat(t.name.replace(/\s+/g,"_")),{error:n}=await Or.storage.from("guest-ids").upload(e,t,{upsert:!0,contentType:t.type});if(n)throw n;const{data:r}=Or.storage.from("guest-ids").getPublicUrl(e);null!==r&&void 0!==r&&r.publicUrl&&(D(r.publicUrl),M((new Date).toISOString()))}catch(n){console.error("Upload ID failed",n),alert("\u062a\u0639\u0630\u0651\u0631 \u0631\u0641\u0639 \u0627\u0644\u0647\u0648\u064a\u0629. \u062a\u0623\u0643\u062f \u0645\u0646 \u0635\u0644\u0627\u062d\u064a\u0627\u062a Storage \u062b\u0645 \u062d\u0627\u0648\u0644 \u0645\u062c\u062f\u062f\u064b\u0627.")}finally{U(!1)}}}),q&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"\u062c\u0627\u0631\u064d \u0627\u0644\u0631\u0641\u0639..."}),A&&(0,a.jsxs)("div",{className:"text-xs mt-1",children:[(0,a.jsx)("a",{href:A,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"\u0639\u0631\u0636 \u0627\u0644\u0647\u0648\u064a\u0629 \u0627\u0644\u0645\u0631\u0641\u0648\u0639\u0629"}),L&&(0,a.jsxs)("span",{className:"text-gray-500 ml-2",children:["(\u0645\u0631\u0641\u0648\u0639\u0629: ",new Date(L).toLocaleDateString("ar-EG"),")"]})]})]})]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641 *"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:p,onChange:e=>f(e.target.value),placeholder:"01234567890"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u062c\u0646\u0633\u064a\u0629"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:x,onChange:e=>g(e.target.value),placeholder:"\u0645\u0635\u0631\u064a"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:v,onChange:e=>b(e.target.value),placeholder:"29901011234567"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0639\u0646\u0648\u0627\u0646"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:y,onChange:e=>w(e.target.value),placeholder:"\u0627\u0644\u0642\u0627\u0647\u0631\u0629 - \u0645\u0635\u0631 \u0627\u0644\u062c\u062f\u064a\u062f\u0629"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u062f\u064a\u0646\u0629"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:_,onChange:e=>j(e.target.value),placeholder:"\u0627\u0644\u0642\u0627\u0647\u0631\u0629"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u062f\u0648\u0644\u0629"}),(0,a.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:N,onChange:e=>k(e.target.value),placeholder:"\u0645\u0635\u0631"})]}),(0,a.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:e=>C(e.target.checked)}),(0,a.jsx)("span",{className:"text-sm",children:"\u0646\u0632\u064a\u0644 VIP \u2b50"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),(0,a.jsx)("textarea",{className:"mt-1 border rounded w-full px-3 py-2",rows:3,value:z,onChange:e=>B(e.target.value),placeholder:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a \u0625\u0636\u0627\u0641\u064a\u0629..."})]})]}),(0,a.jsxs)("div",{className:"sticky bottom-0 -mx-6 px-6 pt-3 mt-6 bg-white border-t flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"submit",disabled:F,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:F?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"})]})]})]})})}function Rs(e){let{guest:t,onClose:n}=e;const[s,i]=(0,r.useState)([]),[o,l]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{l(!0);try{const{data:e,error:n}=await Or.from("reservations").select("id, check_in_date, check_out_date, status, created_at, room_id").eq("guest_id",t.id).order("check_in_date",{ascending:!1});if(n)throw n;i(e||[])}catch(e){console.error("Load guest history failed",e),i([])}finally{l(!1)}})()},[null===t||void 0===t?void 0:t.id]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold",children:["\u0633\u062c\u0644 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a: ",(null===t||void 0===t?void 0:t.full_name)||""]}),(0,a.jsx)("button",{onClick:n,className:"text-gray-600 hover:text-gray-900",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,a.jsx)("div",{className:"p-6",children:o?(0,a.jsx)("div",{className:"text-gray-500",children:"\u062c\u0627\u0631\u064d \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):0===s.length?(0,a.jsx)("div",{className:"text-gray-600",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0633\u0627\u0628\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u0646\u0632\u064a\u0644."}):(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>{var t;return(0,a.jsxs)("div",{className:"border rounded p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-semibold",children:[e.check_in_date?new Date(e.check_in_date).toLocaleDateString("ar-EG"):"\u2014"," \u2192 ",e.check_out_date?new Date(e.check_out_date).toLocaleDateString("ar-EG"):"\u2014"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["\u0627\u0644\u062d\u0627\u0644\u0629: ",e.status||"\u2014"," \u2022 \u0625\u0646\u0634\u0626\u062a: ",e.created_at?new Date(e.created_at).toLocaleDateString("ar-EG"):"\u2014"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0627\u0644\u063a\u0631\u0641\u0629: ",null!==(t=e.room_id)&&void 0!==t?t:"\u2014"]})]},e.id)})})})]})})}function Ps(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)(!1),s=async e=>{if(!e)return null;const t=(new Date).toISOString().slice(0,10),{data:n}=await Or.from("reception_shifts").select("id,status").eq("staff_user_id",e).eq("shift_date",t).eq("status","open").limit(1);return n&&n.length>0?n[0]:null};(0,r.useEffect)(()=>{!async function(){if(!e)return void n(!0);if("reception"!==e.role)return void n(!1);const t=(new Date).toISOString().slice(0,10),{data:r}=await Or.from("reception_shifts").select("id,status").eq("staff_user_id",e.id).eq("shift_date",t).eq("status","open").limit(1);n(!(r&&r.length>0))}()},[e]);const[i,o]=(0,r.useState)([]),[l,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[p,f]=(0,r.useState)(0),[x,g]=(0,r.useState)(12),[v,b]=(0,r.useState)(0),[y,w]=(0,r.useState)(0),[_,j]=(0,r.useState)(!1),[N,k]=(0,r.useState)(null),[S,C]=(0,r.useState)({current:!1,upcoming:!1,vip:!1,inactive:!1});(0,r.useEffect)(()=>{const e=setTimeout(()=>m(d),350);return()=>clearTimeout(e)},[d]);const E=(0,r.useCallback)(async()=>{c(!0);try{const e=Or.from("guests_overview").select("*",{count:"exact"}).order("full_name",{ascending:!0,nullsFirst:!1}),t=(h||"").trim();t&&e.or("full_name.ilike.%".concat(t,"%,phone.ilike.%").concat(t,"%,national_id.ilike.%").concat(t,"%,email.ilike.%").concat(t,"%")),S.current&&e.eq("has_current_stay",!0),S.upcoming&&e.eq("has_upcoming_reservation",!0),S.vip&&e.eq("is_vip",!0),S.inactive&&e.eq("is_inactive",!0);const n=p*x,r=n+x-1;e.range(n,r);const{data:s,error:a,count:i}=await e;if(a)throw a;o(s||[]),b(i||0)}catch(e){console.error("Load guests failed",e),o([]),b(0)}finally{c(!1)}},[h,S,p,x]),T=async()=>{try{const e=new Date;e.setHours(0,0,0,0);const t=e.toISOString(),{error:n,count:r}=await Or.from("guests").select("*",{count:"exact",head:!0}).gte("created_at",t);if(n)throw n;w(r||0)}catch(e){console.warn("Load new guests count failed",e),w(0)}};(0,r.useEffect)(()=>{E()},[E]),(0,r.useEffect)(()=>{T()},[]);const O=(0,r.useMemo)(()=>({total:i.length,current:i.filter(e=>e.has_current_stay).length,upcoming:i.filter(e=>e.has_upcoming_reservation).length,vip:i.filter(e=>e.is_vip).length,inactive:i.filter(e=>!e.has_current_stay&&!e.has_upcoming_reservation).length}),[i]),R=async()=>{if(e&&"reception"===e.role){if(!await s(null===e||void 0===e?void 0:e.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0625\u0636\u0627\u0641\u0629 \u0646\u0632\u064a\u0644 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.")}k(null),j(!0)},[P,I]=(0,r.useState)(!1),[A,D]=(0,r.useState)(null);return(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0628\u062d\u062b\u060c \u0641\u0644\u0627\u062a\u0631\u060c \u0648\u062a\u0631\u0642\u064a\u0645 \u0645\u0639 \u0639\u0631\u0636 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a"})]}),(0,a.jsx)("button",{onClick:R,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",disabled:t,children:"\u0646\u0632\u064a\u0644 \u062c\u062f\u064a\u062f +"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded border border-green-200 p-4 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-green-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M5 12h14M5 12a7 7 0 0 1 14 0M12 19a7 7 0 0 0 7-7"})}),(0,a.jsx)("span",{children:"\u062d\u0627\u0644\u064a\u0648\u0646"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-700",children:O.current})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded border border-amber-200 p-4 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-amber-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M3 12h18M12 3v18"})}),(0,a.jsx)("span",{children:"\u0642\u0627\u062f\u0650\u0645\u0648\u0646"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-700",children:O.upcoming})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded border border-purple-200 p-4 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-purple-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z"})}),(0,a.jsx)("span",{children:"VIP"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-700",children:O.vip})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 rounded border border-emerald-200 p-4 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-emerald-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M5 12l5 5L20 7"})}),(0,a.jsx)("span",{children:"\u0646\u0632\u0644\u0627\u0621 \u0627\u0644\u062c\u062f\u062f"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-emerald-700",children:y})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded border border-blue-200 p-4 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-blue-700",children:[(0,a.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M3 12h18"}),(0,a.jsx)("path",{d:"M7 12v8M17 12v8"})]}),(0,a.jsx)("span",{children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-700",children:v})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,a.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,a.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,a.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0627\u0644\u0647\u0627\u062a\u0641 \u0623\u0648 \u0627\u0644\u0647\u0648\u064a\u0629 \u0623\u0648 \u0627\u0644\u0628\u0631\u064a\u062f",value:d,onChange:e=>{u(e.target.value),f(0)}})]}),(0,a.jsx)("button",{onClick:()=>{C(e=>Le(Le({},e),{},{current:!e.current})),f(0)},className:"px-3 py-2 rounded text-sm border ".concat(S.current?"bg-green-600 text-white border-green-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u062d\u0627\u0644\u064a\u0648\u0646"}),(0,a.jsx)("button",{onClick:()=>{C(e=>Le(Le({},e),{},{upcoming:!e.upcoming})),f(0)},className:"px-3 py-2 rounded text-sm border ".concat(S.upcoming?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u0642\u0627\u062f\u0650\u0645\u0648\u0646"}),(0,a.jsx)("button",{onClick:()=>{C(e=>Le(Le({},e),{},{vip:!e.vip})),f(0)},className:"px-3 py-2 rounded text-sm border ".concat(S.vip?"bg-purple-600 text-white border-purple-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"VIP"}),(0,a.jsx)("button",{onClick:()=>{C(e=>Le(Le({},e),{},{inactive:!e.inactive})),f(0)},className:"px-3 py-2 rounded text-sm border ".concat(S.inactive?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u064a\u0646"}),(0,a.jsx)("button",{className:"border rounded px-3 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>{u(""),C({current:!1,upcoming:!1,vip:!1,inactive:!1}),f(0)},children:"\u0625\u0639\u0627\u062f\u0629 \u0636\u0628\u0637"})]}),l?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden animate-pulse",children:[(0,a.jsx)("div",{className:"h-1 bg-gray-200"}),(0,a.jsx)("div",{className:"px-4 pt-4 h-6 bg-gray-100 mb-2"}),(0,a.jsxs)("div",{className:"px-4 pb-4 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-100"}),(0,a.jsx)("div",{className:"h-4 bg-gray-100 w-2/3"}),(0,a.jsx)("div",{className:"h-4 bg-gray-100 w-1/2"})]})]},t))}):0===i.length?(0,a.jsxs)("div",{className:"p-6 bg-white rounded shadow flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold mb-1",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0646\u062a\u0627\u0626\u062c \u0645\u0637\u0627\u0628\u0642\u0629"}),(0,a.jsx)("div",{className:"text-gray-600",children:"\u062c\u0631\u0651\u0628 \u062a\u0639\u062f\u064a\u0644 \u0639\u0648\u0627\u0645\u0644 \u0627\u0644\u0628\u062d\u062b \u0623\u0648 \u0623\u0636\u0641 \u0646\u0632\u064a\u0644\u064b\u0627 \u062c\u062f\u064a\u062f\u064b\u0627."})]}),(0,a.jsx)("button",{onClick:R,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0646\u0632\u064a\u0644 \u062c\u062f\u064a\u062f"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:i.map(n=>(0,a.jsx)(Ts,{guest:n,onEdit:()=>(async t=>{if(e&&"reception"===e.role&&!await s(null===e||void 0===e?void 0:e.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0646\u0632\u064a\u0644 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.");k(t),j(!0)})(n),onDelete:()=>(async t=>{if(e&&"reception"===e.role&&!await s(null===e||void 0===e?void 0:e.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062d\u0630\u0641 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0646\u0632\u064a\u0644 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.");try{const n=window.prompt("\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641 \u0627\u0643\u062a\u0628: ok","");if(!n||"ok"!==String(n).trim().toLowerCase())return;e&&e.id&&await Or.from("guests").update({updated_by:e.id}).eq("id",t.id);const{error:r}=await Or.from("guests").delete().eq("id",t.id);if(r)throw r;await E(),await T()}catch(n){console.error("Delete guest failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u0646\u0632\u064a\u0644: "+(n.message||n))}})(n),onHistory:()=>(D(n),void I(!0)),readOnly:t},n.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",i.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",v]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>f(e=>Math.max(0,e-1)),disabled:0===p,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,a.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",p+1]}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>f(e=>e+1),disabled:(p+1)*x>=v,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:x,onChange:e=>{g(Number(e.target.value)),f(0)},children:[(0,a.jsx)("option",{value:6,children:"6"}),(0,a.jsx)("option",{value:12,children:"12"}),(0,a.jsx)("option",{value:24,children:"24"})]})]})]}),_&&(0,a.jsx)(Os,{initialData:N,onClose:()=>j(!1),onSave:async t=>{if(e&&"reception"===e.role){if(!await s(null===e||void 0===e?void 0:e.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062d\u0641\u0638 \u0623\u0648 \u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0646\u0632\u064a\u0644 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.")}try{if(!N||!N.id){const e=(t.phone||"").trim(),n=(t.national_id||"").trim();if(e||n){let t=[];e&&t.push("phone.eq.".concat(e)),n&&t.push("national_id.eq.".concat(n));const{data:r,error:s}=await Or.from("guests").select("id, full_name, phone, national_id, created_at").or(t.join(",")).limit(5);if(s)throw s;if(r&&r.length>0){if(window.confirm("\u064a\u0648\u062c\u062f \u0646\u0632\u064a\u0644 \u0645\u0633\u062c\u0644 \u0628\u0646\u0641\u0633 \u0627\u0644\u0647\u0627\u062a\u0641/\u0627\u0644\u0647\u0648\u064a\u0629:\n".concat(r[0].full_name||"\u0628\u062f\u0648\u0646 \u0627\u0633\u0645","\n\u062a\u0627\u0631\u064a\u062e: ").concat(r[0].created_at?new Date(r[0].created_at).toLocaleDateString("ar-EG"):"","\n\u0647\u0644 \u062a\u0631\u064a\u062f \u0641\u062a\u062d \u0628\u0637\u0627\u0642\u0629 \u0647\u0630\u0627 \u0627\u0644\u0646\u0632\u064a\u0644 \u0628\u062f\u0644\u0627\u064b \u0645\u0646 \u0625\u0646\u0634\u0627\u0621 \u062c\u062f\u064a\u062f\u061f")))return void k(r[0])}}}const n="".concat(String(t.first_name||"").trim()," ").concat(String(t.last_name||"").trim()).trim()||(t.full_name||"").trim(),r={first_name:(t.first_name||"").trim()||null,last_name:(t.last_name||"").trim()||null,full_name:n||null,avatar_url:(t.avatar_url||"").trim()||null,id_doc_type:(t.id_doc_type||"").trim()||null,id_doc_number:(t.id_doc_number||"").trim()||null,id_doc_url:(t.id_doc_url||"").trim()||null,id_doc_uploaded_at:t.id_doc_url?t.id_doc_uploaded_at||(new Date).toISOString():null,email:(t.email||"").trim()||null,phone:t.phone||null,nationality:(t.nationality||"").trim()||null,national_id:t.national_id||null,address:(t.address||"").trim()||null,city:(t.city||"").trim()||null,country:(t.country||"").trim()||null,is_vip:!!t.is_vip,notes:(t.notes||"").trim()||null};e&&e.id&&(N&&N.id?r.updated_by=e.id:r.created_by=e.id);const s=async()=>{const e={full_name:r.full_name,phone:r.phone,national_id:r.national_id};if(N&&N.id){const{error:t}=await Or.from("guests").update(e).eq("id",N.id);if(t)throw t}else{const{error:t}=await Or.from("guests").insert([e]);if(t)throw t}};if(N&&N.id){const{error:e}=await Or.from("guests").update(r).eq("id",N.id);if(e){if(!String(e.message||"").toLowerCase().includes("schema")&&!String(e.message||"").toLowerCase().includes("column"))throw e;await s()}}else{const{error:e}=await Or.from("guests").insert([r]);if(e){if(!String(e.message||"").toLowerCase().includes("schema")&&!String(e.message||"").toLowerCase().includes("column"))throw e;await s()}}j(!1),await E(),await T()}catch(n){console.error("Save guest failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0627\u0644\u0646\u0632\u064a\u0644: "+(n.message||n))}}}),P&&A&&(0,a.jsx)(Rs,{guest:A,onClose:()=>{I(!1),D(null)}})]})}function Is(e){let{rows:t,loading:n,onEdit:r,onDelete:s,onDeleteGroup:i}=e;return n?(0,a.jsx)("div",{className:"py-16 text-center text-gray-500",children:"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644"}):null!==t&&void 0!==t&&t.length?(0,a.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{className:"text-right",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0632\u064a\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062f\u062e\u0648\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062e\u0631\u0648\u062c"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0644\u064a\u0627\u0644\u064a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0645\u062f\u0641\u0648\u0639 (\u0645\u0624\u0643\u062f / \u0645\u0639\u0644\u0651\u0642)"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,a.jsx)("tbody",{children:t.map(e=>{var t,n,o,l;return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:e.guest_name}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.room_id}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.check_in_date}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.check_out_date}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.nights}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("confirmed"===e.status?"bg-green-100 text-green-700":"checked_in"===e.status?"bg-blue-100 text-blue-700":"checked_out"===e.status?"bg-gray-100 text-gray-700":"cancelled"===e.status?"bg-red-100 text-red-700":"no_show"===e.status?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"),children:"pending"===e.status?"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631":"confirmed"===e.status?"\u0645\u0624\u0643\u062f":"checked_in"===e.status?"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644":"checked_out"===e.status?"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c":"cancelled"===e.status?"\u0645\u0644\u063a\u064a":"no_show"===e.status?"\u0644\u0645 \u064a\u062d\u0636\u0631":e.status})}),(0,a.jsx)("td",{className:"px-3 py-2",children:null!==(t=e.total_amount)&&void 0!==t?t:"-"}),(0,a.jsx)("td",{className:"px-3 py-2",children:null!=e.confirmed_paid_amount||null!=e.pending_paid_amount?(0,a.jsxs)("span",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-green-700",children:["\u0645\u0624\u0643\u062f: ",Number(e.confirmed_paid_amount||0)]})," / ",(0,a.jsxs)("span",{className:"text-amber-700",children:["\u0645\u0639\u0644\u0651\u0642: ",Number(e.pending_paid_amount||0)]})]}):null!==(n=e.amount_paid)&&void 0!==n?n:"-"}),(0,a.jsx)("td",{className:"px-3 py-2",children:null!==(o=null!==(l=e.remaining_amount_from_tx)&&void 0!==l?l:e.remaining_amount)&&void 0!==o?o:0}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-2 py-1 border rounded text-xs hover:bg-gray-50",onClick:()=>r(e),children:"\u062a\u0639\u062f\u064a\u0644"}),(0,a.jsx)("button",{className:"px-2 py-1 border rounded text-xs text-red-700 hover:bg-red-50",onClick:()=>s(e),children:"\u062d\u0630\u0641"}),i&&"agency"===e.payer_type&&e.agency_name&&(0,a.jsx)("button",{className:"px-2 py-1 border rounded text-xs text-red-700 bg-red-50 hover:bg-red-100",onClick:()=>i(e),children:"\u062d\u0630\u0641 \u0645\u062c\u0645\u0648\u0639\u0629 \u0627\u0644\u0634\u0631\u0643\u0629"})]})})]},e.id)})})]})}):(0,a.jsx)("div",{className:"py-16 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629"})}function As(e){var t,n,r,s;let{r:i,onEdit:o,onDelete:l,onDeleteGroup:c,onExtend:d,onPay:u,onInvoice:h}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden transition-colors ".concat((m=i.status,"confirmed"===m?"border-l-4 border-green-400 hover:bg-green-50":"checked_in"===m?"border-l-4 border-blue-400 hover:bg-blue-50":"checked_out"===m?"border-l-4 border-gray-400 hover:bg-gray-50":"cancelled"===m?"border-l-4 border-red-400 hover:bg-red-50":"no_show"===m?"border-l-4 border-amber-400 hover:bg-amber-50":"border-l-4 border-yellow-400 hover:bg-yellow-50")),dir:"rtl",children:[(0,a.jsx)("div",{className:"confirmed"===i.status?"h-1 bg-green-400":"checked_in"===i.status?"h-1 bg-blue-400":"checked_out"===i.status?"h-1 bg-gray-400":"cancelled"===i.status?"h-1 bg-red-400":"no_show"===i.status?"h-1 bg-amber-400":"h-1 bg-yellow-400"}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:i.guest_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[i.guest_phone||"",i.guest_phone&&i.guest_email?" \u2022 ":"",i.guest_email||""]})]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat((e=>"confirmed"===e?"bg-green-100 text-green-700":"checked_in"===e?"bg-blue-100 text-blue-700":"checked_out"===e?"bg-gray-100 text-gray-700":"cancelled"===e?"bg-red-100 text-red-700":"no_show"===e?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700")(i.status)),children:(e=>"pending"===e?"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631":"confirmed"===e?"\u0645\u0624\u0643\u062f":"checked_in"===e?"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644":"checked_out"===e?"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c":"cancelled"===e?"\u0645\u0644\u063a\u064a":"no_show"===e?"\u0644\u0645 \u064a\u062d\u0636\u0631":e)(i.status)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.room_label||i.room_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.room_type_name||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:gs(i.room_status)||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0638\u0627\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:bs(i.room_cleanliness)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062f\u062e\u0648\u0644:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.check_in_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062e\u0631\u0648\u062c:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.check_out_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0639\u062f\u062f \u0627\u0644\u0644\u064a\u0627\u0644\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.nights})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0639\u062f\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.guests_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0633\u0639\u0631 \u0627\u0644\u0644\u064a\u0644\u0629:"})," ",(0,a.jsxs)("span",{className:"font-medium",children:[i.nightly_rate," ",i.currency||""]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.payment_method||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:null!==(t=i.total_amount)&&void 0!==t?t:"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639:"})," ",null!=i.confirmed_paid_amount||null!=i.pending_paid_amount?(0,a.jsxs)("span",{className:"font-medium text-blue-700",children:["\u0645\u0624\u0643\u062f ",Number(i.confirmed_paid_amount||0)," / \u0645\u0639\u0644\u0651\u0642 ",Number(i.pending_paid_amount||0)]}):(0,a.jsx)("span",{className:"font-medium text-blue-700",children:null!==(n=i.amount_paid)&&void 0!==n?n:"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium text-red-700",children:null!==(r=null!==(s=i.remaining_amount_from_tx)&&void 0!==s?s:i.remaining_amount)&&void 0!==r?r:0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062d\u0627\u0644\u0629 \u0627\u0644\u0632\u0645\u0646\u064a\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:i.is_current?"\u062d\u0627\u0644\u064a":i.is_upcoming?"\u0642\u0627\u062f\u0645":"\u0645\u0646\u062a\u0647\u064a"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u0645\u0646 \u062c\u0647\u0629:"})," ",(0,a.jsxs)("span",{className:"font-medium",children:[i.payer_type||"-"," ",i.agency_name?"(".concat(i.agency_name,")"):""]})]}),i.special_requests&&(0,a.jsxs)("div",{className:"col-span-2 text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1",children:["\u0637\u0644\u0628\u0627\u062a \u062e\u0627\u0635\u0629: ",i.special_requests]}),i.notes&&(0,a.jsxs)("div",{className:"col-span-2 text-gray-700 bg-gray-50 border border-gray-200 rounded px-2 py-1",children:["\u0645\u0644\u0627\u062d\u0638\u0627\u062a: ",i.notes]}),(0,a.jsxs)("div",{className:"col-span-2 text-xs text-gray-500",children:[(0,a.jsx)("span",{children:"\u0623\u064f\u0646\u0634\u0626 \u0628\u0648\u0627\u0633\u0637\u0629: "}),(0,a.jsx)("span",{className:"font-medium",children:i.created_by_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),i.created_at&&(0,a.jsxs)("span",{children:[" ","(",new Date(i.created_at).toLocaleString("ar-EG"),")"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-1",children:[(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-xs",onClick:()=>o(i),children:"\u062a\u0639\u062f\u064a\u0644"}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-xs",onClick:()=>d&&d(i),children:"\u062a\u0645\u062f\u064a\u062f"}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-xs",onClick:()=>h&&h(i),children:"\u0641\u0627\u062a\u0648\u0631\u0629"}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-xs bg-emerald-600 text-white hover:bg-emerald-700",onClick:()=>u&&u(i),children:"\u062f\u0641\u0639"}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-xs text-red-700",onClick:()=>l(i),children:"\u062d\u0630\u0641"}),c&&"agency"===i.payer_type&&i.agency_name&&(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-xs text-red-700 bg-red-50 hover:bg-red-100",onClick:()=>c(i),children:"\u062d\u0630\u0641 \u0645\u062c\u0645\u0648\u0639\u0629 \u0627\u0644\u0634\u0631\u0643\u0629"})]})]})]});var m}function Ds(e){let{row:t,onClose:n,onDone:s}=e;const i=(0,r.useContext)(la),[o,l]=(0,r.useState)((null===t||void 0===t?void 0:t.check_out_date)||""),[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(""),[m,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{l((null===t||void 0===t?void 0:t.check_out_date)||"")},[t]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,a.jsx)("div",{className:"font-bold",children:"\u062a\u0645\u062f\u064a\u062f \u0627\u0644\u062d\u062c\u0632"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"\u0627\u062e\u062a\u0631 \u062a\u0627\u0631\u064a\u062e \u0645\u063a\u0627\u062f\u0631\u0629 \u062c\u062f\u064a\u062f \u0648\u0633\u064a\u062a\u0645 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u0627\u0644\u062a\u0639\u0627\u0631\u0636"}),(0,a.jsxs)("div",{className:"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0632\u064a\u0644:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.guest_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.room_label})," \u2022 ",(0,a.jsx)("span",{className:"font-medium",children:t.room_type_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0641\u062a\u0631\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.check_in_date})," \u2192 ",(0,a.jsx)("span",{className:"font-medium",children:t.check_out_date})," (",(0,a.jsx)("span",{className:"font-medium",children:t.nights})," \u0644\u064a\u0627\u0644)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0633\u0639\u0631/\u0644\u064a\u0644\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.nightly_rate})," \u2022 ",(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.total_amount})," \u2022 ",(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.remaining_amount})]})]})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsx)("label",{className:"text-sm",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u0627\u0644\u062c\u062f\u064a\u062f"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2",value:o,onChange:e=>l(e.target.value)}),u&&(0,a.jsxs)("div",{className:"text-xs text-red-600",children:["\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062a\u0645\u062f\u064a\u062f: ",u]}),m&&m.length>0&&(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-3 text-xs",children:[(0,a.jsx)("div",{className:"font-semibold mb-2",children:"\u0628\u062f\u0627\u0626\u0644 \u0645\u0642\u062a\u0631\u062d\u0629 (Split Stay):"}),(0,a.jsx)("ul",{className:"list-disc pr-5",children:m.slice(0,5).map((e,t)=>(0,a.jsxs)("li",{children:[e.room_label,": ",e.available_from," \u2192 ",e.available_to," (",e.nights," \u0644\u064a\u0627\u0644)"]},t))})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{className:"px-3 py-2 border rounded",onClick:n,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-blue-600 text-white",disabled:c,onClick:async()=>{d(!0),h("");try{const{error:e}=await Or.rpc("extend_reservation",{p_reservation_id:t.id,p_new_check_out:o,p_staff_user_id:(null===i||void 0===i?void 0:i.id)||null});if(e)throw e;s&&s(),n&&n()}catch(e){const n=String((null===e||void 0===e?void 0:e.message)||e||"");h(n);try{const{data:e,error:n}=await Or.rpc("suggest_split_stay",{p_check_in:t.check_in_date,p_check_out:o,p_room_type_id:null});n||p(e||[])}catch(r){}}finally{d(!1)}},children:c?"\u062c\u0627\u0631\u064d...":"\u062a\u0645\u062f\u064a\u062f"})]})]})})}function Ls(e){let{row:t,onClose:n,onDone:s}=e;const i=(0,r.useContext)(la),[o,l]=(0,r.useState)(0),[c,d]=(0,r.useState)(()=>{const e=(null===t||void 0===t?void 0:t.payment_method)||"cash";return"card"===e||"transfer"===e||"bank"===e?"instapay":e}),[u,h]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[m,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{l(Number((null===t||void 0===t?void 0:t.remaining_amount)||0));const e=(null===t||void 0===t?void 0:t.payment_method)||"cash";d("card"===e||"transfer"===e||"bank"===e?"instapay":e);try{h((new Date).toISOString().slice(0,10))}catch(n){}},[t]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,a.jsx)("div",{className:"font-bold",children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u0641\u0639\u0629"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"\u0627\u062e\u062a\u0631 \u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639 \u0648\u0623\u062f\u062e\u0644 \u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsxs)("div",{className:"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0632\u064a\u0644:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.guest_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.room_label})," \u2022 ",(0,a.jsx)("span",{className:"font-medium",children:t.room_type_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0641\u062a\u0631\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.check_in_date})," \u2192 ",(0,a.jsx)("span",{className:"font-medium",children:t.check_out_date})," (",(0,a.jsx)("span",{className:"font-medium",children:t.nights})," \u0644\u064a\u0627\u0644)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.total_amount})," \u2022 ",(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.amount_paid})," \u2022 ",(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.remaining_amount})]})]})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("input",{type:"number",className:"border rounded px-3 py-2",value:o,onChange:e=>l(e.target.value),min:0}),(0,a.jsx)("label",{className:"text-sm",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2",value:u,onChange:e=>h(e.target.value)}),(0,a.jsx)("label",{className:"text-sm",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2",value:c,onChange:e=>d(e.target.value),children:[(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629"}),(0,a.jsx)("option",{value:"other",children:"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629"})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{className:"px-3 py-2 border rounded",onClick:n,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-emerald-600 text-white",disabled:m,onClick:async()=>{p(!0);try{const a={amount_paid:Number((null===t||void 0===t?void 0:t.amount_paid)||0)+Number(o||0),payment_method:c};i&&i.id&&(a.updated_by=i.id);const{error:l}=await Or.from("reservations").update(a).eq("id",t.id);if(l)throw l;const d=Number(o||0);if(d>0){let n=null;try{if(i&&i.id){const e=u||(new Date).toISOString().slice(0,10),{data:t}=await Or.from("reception_shifts").select("id,status,shift_date").eq("staff_user_id",i.id).eq("shift_date",e).eq("status","open").order("opened_at",{ascending:!1}).limit(1);t&&t.length>0&&(n=t[0].id)}}catch(e){}let s=null;try{const{data:e}=await Or.from("accounting_categories").select("id,name,type").eq("type","income").eq("name","\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u063a\u0631\u0641").limit(1);e&&e.length>0&&(s=e[0].id)}catch(e){}const a=["cash","instapay","other"].includes(c)?c:"other",o=[];null!==t&&void 0!==t&&t.guest_name&&o.push("\u0646\u0632\u064a\u0644: ".concat(t.guest_name)),null!==t&&void 0!==t&&t.room_label&&o.push("\u063a\u0631\u0641\u0629: ".concat(t.room_label));const l=o.length?"\u0633\u062f\u0627\u062f \u0645\u0646 \u062d\u062c\u0632 ".concat((null===t||void 0===t?void 0:t.code)||(null===t||void 0===t?void 0:t.id)||""," \u2014 ").concat(o.join(" / ")):"\u0633\u062f\u0627\u062f \u0645\u0646 \u062d\u062c\u0632",h={tx_date:u||(new Date).toISOString().slice(0,10),direction:"income",category_id:s,amount:d,payment_method:a,bank_account_id:null,source_type:"reservation",reservation_id:t.id,description:l,status:["cash","instapay"].includes(a)?"pending":"confirmed",reception_shift_id:n};i&&i.id&&(h.created_by=i.id);try{const{error:t}=await Or.from("accounting_transactions").insert(h);if(t)console.error("accounting insert error",t);else try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(e){}}catch(r){console.error("accounting insert exception",r)}}s&&s(),n&&n()}catch(r){alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u0641\u0639: "+(r.message||r))}finally{p(!1)}},children:m?"\u062c\u0627\u0631\u064d...":"\u062f\u0641\u0639"})]})]})})}function Ms(e){let{row:t,onClose:n}=e;const[s,i]=(0,r.useState)(.14),[o,l]=(0,r.useState)(0),[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),m=(0,r.useCallback)(async()=>{d(!0);try{const{data:e,error:n}=await Or.rpc("calculate_invoice",{p_reservation_id:t.id,p_tax_rate:s,p_deposit:o});if(n)throw n;const r=Array.isArray(e)?e[0]:e;h(r||null)}catch(e){alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629: "+(e.message||e))}finally{d(!1)}},[null===t||void 0===t?void 0:t.id,s,o]);return(0,r.useEffect)(()=>{m()},[m]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full md:max-w-lg rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,a.jsx)("div",{className:"font-bold",children:"\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u062d\u062c\u0632"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"\u0645\u0644\u062e\u0635 \u0627\u0644\u0636\u0631\u0627\u0626\u0628 \u0648\u0627\u0644\u0648\u062f\u064a\u0639\u0629 \u0648\u0627\u0644\u0645\u062a\u0628\u0642\u064a"}),(0,a.jsxs)("div",{className:"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0632\u064a\u0644:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.guest_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.room_label})," \u2022 ",(0,a.jsx)("span",{className:"font-medium",children:t.room_type_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0641\u062a\u0631\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:t.check_in_date})," \u2192 ",(0,a.jsx)("span",{className:"font-medium",children:t.check_out_date})," (",(0,a.jsx)("span",{className:"font-medium",children:t.nights})," \u0644\u064a\u0627\u0644)"]})]})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0646\u0633\u0628\u0629 \u0627\u0644\u0636\u0631\u064a\u0628\u0629"}),(0,a.jsx)("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:s,onChange:e=>i(Number(e.target.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0648\u062f\u064a\u0639\u0629"}),(0,a.jsx)("input",{type:"number",className:"border rounded px-3 py-2 w-full",value:o,onChange:e=>l(Number(e.target.value))})]})]}),(0,a.jsx)("button",{className:"px-3 py-2 border rounded text-sm w-fit",onClick:m,disabled:c,children:c?"\u062c\u0627\u0631\u064d...":"\u0625\u0639\u0627\u062f\u0629 \u0627\u0644\u062d\u0633\u0627\u0628"}),u&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0644\u064a\u0627\u0644\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.nights})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0633\u0639\u0631 \u0627\u0644\u0644\u064a\u0644\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.nightly_rate})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.subtotal})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0636\u0631\u064a\u0628\u0629:"})," ",(0,a.jsxs)("span",{className:"font-medium",children:[u.tax_amount," (",100*u.tax_rate,"%)"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0648\u062f\u064a\u0639\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.deposit})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.total})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.paid_amount})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.remaining})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0631\u0633\u0648\u0645 \u0627\u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0645\u062a\u0648\u0642\u0639\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:u.cancellation_fee})]})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{className:"px-3 py-2 border rounded",onClick:n,children:"\u0625\u063a\u0644\u0627\u0642"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-gray-700 text-white",onClick:()=>alert("\u0645\u064a\u0632\u0629 PDF \u0633\u0646\u0636\u064a\u0641\u0647\u0627 \u0644\u0627\u062d\u0642\u064b\u0627"),children:"\u0637\u0628\u0627\u0639\u0629 PDF"})]})]})})}function qs(){const e=async e=>{const r=await(async e=>{const t=await n(e);return t||(alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062a\u0646\u0641\u064a\u0630 \u0639\u0645\u0644\u064a\u0629 \u062f\u0641\u0639 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629. \u064a\u0631\u062c\u0649 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b."),null)})(null===t||void 0===t?void 0:t.id);r&&L(Le(Le({},e),{},{shift_id:r.id}))},t=(0,r.useContext)(la),n=async e=>{if(!e)return null;const t=(new Date).toISOString().slice(0,10),{data:n}=await Or.from("reception_shifts").select("id,status").eq("staff_user_id",e).eq("shift_date",t).eq("status","open").limit(1);return n&&n.length>0?n[0]:null},[s,i]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!async function(){if(!t)return void i(!0);if("reception"!==t.role)return void i(!1);const e=(new Date).toISOString().slice(0,10),{data:n}=await Or.from("reception_shifts").select("id,status").eq("staff_user_id",t.id).eq("shift_date",e).eq("status","open").limit(1);i(!(n&&n.length>0))}()},[t]);const[o,l]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[f,x]=(0,r.useState)(0),[g,v]=(0,r.useState)(10),[b,y]=(0,r.useState)(0),[w,_]=(0,r.useState)({current:!0,upcoming:!1,inactive:!1,status:""}),[j,N]=(0,r.useState)(!1),[k,S]=(0,r.useState)(null),[C,E]=(0,r.useState)(!1),[T,O]=(0,r.useState)("cards"),[I,A]=(0,r.useState)(null),[D,L]=(0,r.useState)(null),[M,q]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=setTimeout(()=>p(u),300);return()=>clearTimeout(e)},[u]);const U=r.useCallback(()=>{const e=Or.from("reservations_overview").select("*",{count:"exact"}).order("check_in_date",{ascending:!0,nullsFirst:!1}),t=(m||"").trim();t&&e.or("guest_name.ilike.%".concat(t,"%,guest_phone.ilike.%").concat(t,"%,room_label.ilike.%").concat(t,"%")),w.current&&e.eq("is_current",!0),w.upcoming&&e.eq("is_upcoming",!0),w.inactive&&e.eq("is_past",!0),w.status&&e.eq("status",w.status);const n=f*g,r=n+g-1;return e.range(n,r),e},[m,w,f,g]),z=r.useCallback(async()=>{d(!0);try{const{data:t,error:n,count:r}=await U();if(n)throw n;let s=t||[];const a=(s||[]).map(e=>e.id).filter(Boolean);if(a.length>0)try{const{data:e,error:t}=await Or.from("accounting_transactions").select("reservation_id, amount, status, direction, source_type").in("reservation_id",a);if(!t&&e){const t={};for(const n of e){const e=n.reservation_id;if(!e)continue;t[e]||(t[e]={confirmedIncome:0,pendingIncome:0,confirmedRefund:0,pendingRefund:0});const r=Number(n.amount||0)||0;r&&("income"===n.direction?"confirmed"===n.status?t[e].confirmedIncome+=r:"pending"===n.status&&(t[e].pendingIncome+=r):"expense"===n.direction&&"reservation"===n.source_type&&("confirmed"===n.status?t[e].confirmedRefund+=r:"pending"===n.status&&(t[e].pendingRefund+=r)))}s=s.map(e=>{const n=t[e.id]||{confirmedIncome:0,pendingIncome:0,confirmedRefund:0,pendingRefund:0},r=Math.max(0,(n.confirmedIncome||0)-(n.confirmedRefund||0)),s=Math.max(0,(n.pendingIncome||0)-(n.pendingRefund||0)),a=Number(e.total_amount||0)||0,i=r+s,o=Math.max(0,Math.round(100*(a-i))/100);return Le(Le({},e),{},{confirmed_paid_amount:r,pending_paid_amount:s,remaining_amount_from_tx:o})})}}catch(e){console.error("Load payment breakdown for reservations failed",e)}l(s),y(r||0)}catch(e){console.error("Load reservations failed",e),l([]),y(0)}finally{d(!1)}},[U]);(0,r.useEffect)(()=>{z()},[m,w,f,g,z]),(0,r.useEffect)(()=>{const e=Or.channel("reservations-live").on("postgres_changes",{event:"*",schema:"public",table:"reservations"},()=>{z()}).subscribe();return()=>{try{Or.removeChannel(e)}catch(t){}}},[z]);const B=(0,r.useMemo)(()=>({cur:o.filter(e=>e.is_current).length,upc:o.filter(e=>e.is_upcoming).length,past:o.filter(e=>e.is_past).length,tot:b}),[o,b]),F=async e=>{if(t&&"reception"===t.role){if(!await n(null===t||void 0===t?void 0:t.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u062d\u062c\u0632 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.")}S(e),N(!0)},W=async e=>{if(t&&"reception"===t.role){const r=await n(null===t||void 0===t?void 0:t.id);if(!r)return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062a\u0645\u062f\u064a\u062f \u0627\u0644\u062d\u062c\u0632 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.");A(Le(Le({},e),{},{shift_id:r.id}))}else A(e)},V=async e=>{if(t&&"reception"===t.role){const r=await n(null===t||void 0===t?void 0:t.id);if(!r)return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0625\u0635\u062f\u0627\u0631 \u0641\u0627\u062a\u0648\u0631\u0629 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.");q(Le(Le({},e),{},{shift_id:r.id}))}else q(e)},H=async e=>{try{if(!R(t)&&!P(t))return void alert("\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a. \u0647\u0630\u0647 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0644\u0644\u0645\u062f\u064a\u0631 \u0648\u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631 \u0641\u0642\u0637.");if(!e||"agency"!==e.payer_type||!e.agency_name)return void alert("\u062d\u0630\u0641 \u0645\u062c\u0645\u0648\u0639\u0629 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0645\u062a\u0627\u062d \u0641\u0642\u0637 \u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0634\u0631\u0643\u0627\u062a \u0630\u0627\u062a \u0627\u0633\u0645 \u062c\u0647\u0629 \u0645\u062d\u062f\u062f.");if(!window.confirm("\u062d\u0630\u0641 \u0643\u0644 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0644\u0647\u0630\u0647 \u0627\u0644\u062c\u0647\u0629 (".concat(e.agency_name,") \u0644\u0646\u0641\u0633 \u0641\u062a\u0631\u0629 \u0627\u0644\u0625\u0642\u0627\u0645\u0629\u061f")))return;t&&t.id&&await Or.from("reservations").update({updated_by:t.id}).match({payer_type:"agency",agency_name:e.agency_name,check_in_date:e.check_in_date,check_out_date:e.check_out_date});const{error:n}=await Or.from("reservations").delete().match({payer_type:"agency",agency_name:e.agency_name,check_in_date:e.check_in_date,check_out_date:e.check_out_date});if(n)throw n;await z()}catch(n){console.error("Delete group reservations failed",n),alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0645\u062c\u0645\u0648\u0639\u0629 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a: "+(n.message||n))}},K=async e=>{try{if(!R(t)&&!P(t))return void alert("\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a. \u0647\u0630\u0647 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0645\u062a\u0627\u062d\u0629 \u0644\u0644\u0645\u062f\u064a\u0631 \u0648\u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631 \u0641\u0642\u0637.");if(!window.confirm("\u062d\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u062d\u062c\u0632\u061f \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621 \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646\u0647."))return;if("\u0645\u0648\u0627\u0641\u0642"!==window.prompt('\u0644\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u0646\u0647\u0627\u0626\u064a \u0639\u0644\u0649 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0632\u060c \u0627\u0643\u062a\u0628 \u0643\u0644\u0645\u0629 "\u0645\u0648\u0627\u0641\u0642" \u0628\u0627\u0644\u062d\u0631\u0648\u0641 \u0627\u0644\u0639\u0631\u0628\u064a\u0629:',""))return void alert("\u0644\u0645 \u064a\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0632\u061b \u0644\u0645 \u064a\u062a\u0645 \u0625\u062f\u062e\u0627\u0644 \u0643\u0644\u0645\u0629 \u0627\u0644\u062a\u0623\u0643\u064a\u062f \u0628\u0634\u0643\u0644 \u0635\u062d\u064a\u062d.");t&&t.id&&await Or.from("reservations").update({updated_by:t.id}).eq("id",e.id);const{error:n}=await Or.from("reservations").delete().eq("id",e.id);if(n)throw n;await z()}catch(n){console.error("Delete reservation failed",n),alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0632: "+(n.message||n))}};return(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0646\u0638\u0627\u0645 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0630\u0643\u064a"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0634\u0627\u0645\u0644\u0629 \u0644\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0639 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a \u0648\u0627\u0644\u0625\u0644\u063a\u0627\u0621\u0627\u062a"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{onClick:async()=>{if(t&&"reception"===t.role){if(!await n(null===t||void 0===t?void 0:t.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u0625\u0646\u0634\u0627\u0621 \u062d\u062c\u0632 \u0645\u0646 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629.")}S(null),E(!1),N(!0)},disabled:s,style:s?{opacity:.5,cursor:"not-allowed"}:{},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded",children:"\u062d\u062c\u0632 \u0641\u0631\u062f\u064a (\u063a\u0631\u0641\u0629 \u0648\u0627\u062d\u062f\u0629) +"}),(0,a.jsx)("button",{onClick:()=>{S(null),E(!0),N(!0)},disabled:s,style:s?{opacity:.5,cursor:"not-allowed"}:{},className:"bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded",children:"\u062d\u062c\u0632 \u0634\u0631\u0643\u0627\u062a / \u0645\u062c\u0645\u0648\u0639\u0627\u062a \u2699"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-purple-700",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-700",children:B.cur})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-amber-700",children:"\u0627\u0644\u0642\u0627\u062f\u0645\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-700",children:B.upc})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-700",children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u0629 / \u0645\u0646\u062a\u0647\u064a\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:B.past})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,a.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,a.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,a.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0646\u0632\u064a\u0644 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u063a\u0631\u0641\u0629",value:u,onChange:e=>{h(e.target.value),x(0)}})]}),(0,a.jsx)("button",{onClick:()=>{_(e=>({current:!e.current,upcoming:!1,inactive:!1,status:e.status})),x(0)},className:"px-3 py-2 rounded text-sm border ".concat(w.current?"bg-purple-600 text-white border-purple-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,a.jsx)("button",{onClick:()=>{_(e=>({current:!1,upcoming:!e.upcoming,inactive:!1,status:e.status})),x(0)},className:"px-3 py-2 rounded text-sm border ".concat(w.upcoming?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u0627\u0644\u0642\u0627\u062f\u0645\u0629"}),(0,a.jsx)("button",{onClick:()=>{_(e=>({current:!1,upcoming:!1,inactive:!e.inactive,status:e.status})),x(0)},className:"px-3 py-2 rounded text-sm border ".concat(w.inactive?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u0629"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:w.status,onChange:e=>{_(t=>Le(Le({},t),{},{status:e.target.value})),x(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u062d\u0627\u0644\u0627\u062a"}),(0,a.jsx)("option",{value:"pending",children:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"}),(0,a.jsx)("option",{value:"confirmed",children:"\u0645\u0624\u0643\u062f"}),(0,a.jsx)("option",{value:"checked_in",children:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"}),(0,a.jsx)("option",{value:"checked_out",children:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"}),(0,a.jsx)("option",{value:"cancelled",children:"\u0645\u0644\u063a\u064a"}),(0,a.jsx)("option",{value:"no_show",children:"\u0644\u0645 \u064a\u062d\u0636\u0631"})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-2 rounded text-sm border ".concat("cards"===T?"bg-gray-800 text-white":"bg-white text-gray-700"),onClick:()=>O("cards"),children:"\u0639\u0631\u0636 \u0643\u0628\u0637\u0627\u0642\u0627\u062a"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded text-sm border ".concat("table"===T?"bg-gray-800 text-white":"bg-white text-gray-700"),onClick:()=>O("table"),children:"\u0639\u0631\u0636 \u0643\u062c\u062f\u0648\u0644"})]})]}),"table"===T?(0,a.jsx)(Is,{rows:o,loading:c,onEdit:F,onDelete:K,onDeleteGroup:H}):c?(0,a.jsx)("div",{className:"py-16 text-center text-gray-500",children:"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644"}):0===o.length?(0,a.jsx)("div",{className:"py-16 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:o.map(t=>(0,a.jsx)(As,{r:t,onEdit:F,onDelete:K,onDeleteGroup:H,onExtend:W,onPay:e,onInvoice:V},t.id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",o.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",b]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>x(e=>Math.max(0,e-1)),disabled:0===f,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,a.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",f+1]}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>x(e=>e+1),disabled:(f+1)*g>=b,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:g,onChange:e=>{v(Number(e.target.value)),x(0)},children:[(0,a.jsx)("option",{value:10,children:"10"}),(0,a.jsx)("option",{value:20,children:"20"})]})]})]}),j&&(0,a.jsx)(_s,{initialData:k,onClose:()=>{N(!1),E(!1)},onSave:async e=>{try{if(!await n(null===t||void 0===t?void 0:t.id))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646\u0643 \u062a\u0646\u0641\u064a\u0630 \u0623\u064a \u0639\u0645\u0644\u064a\u0629 (\u0625\u0646\u0634\u0627\u0621 \u0623\u0648 \u062a\u0639\u062f\u064a\u0644 \u0623\u0648 \u0625\u0636\u0627\u0641\u0629 \u0646\u0632\u064a\u0644) \u0628\u062f\u0648\u0646 \u0648\u062c\u0648\u062f \u0648\u0631\u062f\u064a\u0629 \u0645\u0641\u062a\u0648\u062d\u0629. \u064a\u0631\u062c\u0649 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0623\u0648\u0644\u0627\u064b.");if(e&&e.multi&&Array.isArray(e.reservations)&&!k){const n=e.reservations||[];if(!n.length)throw new Error("no reservations to save");for(let e=0;e<n.length;e++){const s=Le({},n[e]),a=Array.isArray(s.pending_guest_ids)?s.pending_guest_ids:[];delete s.pending_guest_ids,t&&t.id&&(s.created_by=t.id);const{data:i,error:o}=await Or.from("reservations").insert([s]).select("id").single();if(o)throw o;const l=null===i||void 0===i?void 0:i.id;if(0===e&&l&&a.length>0)for(const e of a)try{await Or.rpc("add_reservation_guest",{p_reservation_id:l,p_guest_id:e,p_role:"additional"})}catch(r){}}}else{const n=Le({},e),a=Array.isArray(n.pending_guest_ids)?n.pending_guest_ids:[];delete n.pending_guest_ids;const i=Number(n.amount_paid||0),o=k&&k.id?Number(k.amount_paid||0):0,l=i-o,c=k&&k.status?k.status:null,d=n&&n.status?n.status:c;if(k&&k.id){const e=[];if(k.check_in_date!==n.check_in_date||k.check_out_date!==n.check_out_date){const r=t&&(t.full_name||t.username)||"\u0645\u0633\u062a\u062e\u062f\u0645",s=(new Date).toLocaleString("ar-EG");e.push("[\u062a\u0639\u062f\u064a\u0644 \u062a\u0648\u0627\u0631\u064a\u062e \u0625\u0642\u0627\u0645\u0629] ".concat(k.check_in_date||"-"," \u2192 ").concat(n.check_in_date||"-"," / ").concat(k.check_out_date||"-"," \u2192 ").concat(n.check_out_date||"-"," \u2014 \u0628\u0648\u0627\u0633\u0637\u0629 ").concat(r," \u0641\u064a ").concat(s))}const r=Number(k.total_amount||0)||0,s=Number(n.total_amount||0)||0;if(r!==s){const n=t&&(t.full_name||t.username)||"\u0645\u0633\u062a\u062e\u062f\u0645",a=(new Date).toLocaleString("ar-EG");e.push("[\u062a\u0639\u062f\u064a\u0644 \u0625\u062c\u0645\u0627\u0644\u064a/\u0633\u0639\u0631] ".concat(r," \u2192 ").concat(s," \u2014 \u0628\u0648\u0627\u0633\u0637\u0629 ").concat(n," \u0641\u064a ").concat(a))}if(e.length>0){const t=(n.notes||"").trim(),r=e.join("\n");n.notes=t?"".concat(t,"\n").concat(r):r}}if(k&&k.id&&"cancelled"===c&&d&&"cancelled"!==d){if(!R(t)&&!P(t))return void alert("\u0644\u0627 \u064a\u0645\u0643\u0646 \u062a\u0639\u062f\u064a\u0644 \u062d\u0627\u0644\u0629 \u062d\u062c\u0632 \u0645\u0644\u063a\u064a \u0625\u0644\u0627 \u0628\u0648\u0627\u0633\u0637\u0629 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631.");if(!window.confirm("\u0647\u0630\u0627 \u0627\u0644\u062d\u062c\u0632 \u0645\u0644\u063a\u064a \u0628\u0627\u0644\u0641\u0639\u0644. \u0647\u0644 \u062a\u0631\u064a\u062f \u0628\u0627\u0644\u062a\u0623\u0643\u064a\u062f \u0625\u0639\u0627\u062f\u0629 \u062a\u0641\u0639\u064a\u0644\u0647 \u0623\u0648 \u062a\u063a\u064a\u064a\u0631 \u062d\u0627\u0644\u062a\u0647\u061f"))return}let u=null,h=0,m="";if(k&&k.id&&"cancelled"!==c&&"cancelled"===d){const e='\u062a\u0645 \u0627\u062e\u062a\u064a\u0627\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u062d\u062c\u0632 "\u0645\u0644\u063a\u064a". \u064a\u0631\u062c\u0649 \u062a\u062d\u062f\u064a\u062f \u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062a\u0639\u0627\u0645\u0644 \u0645\u0639 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u0645\u0627\u0644\u064a (\u0625\u0646 \u0648\u062c\u062f).'+'\n\u0627\u0643\u062a\u0628 1: \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0643\u0627\u0645\u0644 \u0644\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u062d\u062c\u0632 (\u062d\u0633\u0628 \u0627\u0644\u062d\u0642\u0644 "\u0627\u0644\u0645\u062f\u0641\u0648\u0639").\n\u0627\u0643\u062a\u0628 2: \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062c\u0632\u0626\u064a (\u0633\u062a\u0642\u0648\u0645 \u0628\u0625\u062f\u062e\u0627\u0644 \u0645\u0628\u0644\u063a \u064a\u062f\u0648\u064a\u064b\u0627).\n\u0627\u0643\u062a\u0628 3: \u0625\u0644\u063a\u0627\u0621 \u0628\u062f\u0648\u0646 \u0627\u0633\u062a\u0631\u062f\u0627\u062f.\n\u0627\u062a\u0631\u0643 \u0627\u0644\u062d\u0642\u0644 \u0641\u0627\u0631\u063a\u064b\u0627 \u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 \u0648\u0639\u062f\u0645 \u062a\u063a\u064a\u064a\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u062d\u062c\u0632.',t=window.prompt(e,"");if(!t)return void alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u060c \u0644\u0645 \u064a\u062a\u0645 \u062a\u063a\u064a\u064a\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u062d\u062c\u0632.");const r=String(t).trim();if("1"===r)u="full";else if("2"===r)u="partial";else{if("3"!==r)return void alert("\u0627\u062e\u062a\u064a\u0627\u0631 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d\u060c \u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644.");u="none"}const s=i||o||0;if("full"===u||"partial"===u){if("full"===u)h=Math.max(0,Number(s)||0);else{const e="\u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062c\u0632\u0626\u064a \u0628\u0627\u0644\u062c\u0646\u064a\u0647. \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u062d\u0633\u0628 \u0627\u0644\u062d\u062c\u0632 \u062d\u0627\u0644\u064a\u064b\u0627 \u0647\u0648 ".concat(s,".")+"\n\u0627\u062a\u0631\u0643 \u0627\u0644\u062d\u0642\u0644 \u0641\u0627\u0631\u063a\u064b\u0627 \u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064a\u0629.",t=window.prompt(e,s?String(s):"");if(!t)return void alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u060c \u0644\u0645 \u064a\u062a\u0645 \u062a\u063a\u064a\u064a\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u062d\u062c\u0632.");const n=Number(t);if(!n||n<=0)return void alert("\u0645\u0628\u0644\u063a \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u063a\u064a\u0631 \u0635\u0627\u0644\u062d\u060c \u0644\u0645 \u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644.");h=Math.round(100*n)/100}m="full"===u?"[\u0625\u0644\u063a\u0627\u0621 \u0645\u0639 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0643\u0627\u0645\u0644]":"[\u0625\u0644\u063a\u0627\u0621 \u0645\u0639 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062c\u0632\u0626\u064a]"}else h=0,m="[\u0625\u0644\u063a\u0627\u0621 \u0628\u062f\u0648\u0646 \u0627\u0633\u062a\u0631\u062f\u0627\u062f]";const a=(n.notes||"").trim();n.notes=a?"".concat(a,"\n").concat(m):m}if(t&&t.id&&(k&&k.id?n.updated_by=t.id:n.created_by=t.id),k&&k.id){const{error:e}=await Or.from("reservations").update(n).eq("id",k.id);if(e)throw e;for(const t of a)try{await Or.rpc("add_reservation_guest",{p_reservation_id:k.id,p_guest_id:t,p_role:"additional"})}catch(r){}if(u&&h>0&&k&&k.id)try{let e=null;try{if(t&&t.id){const n=(new Date).toISOString().slice(0,10),{data:r}=await Or.from("reception_shifts").select("id,status,shift_date").eq("staff_user_id",t.id).eq("shift_date",n).eq("status","open").order("opened_at",{ascending:!1}).limit(1);r&&r.length>0&&(e=r[0].id)}}catch(r){}let n=null;try{const{data:e}=await Or.from("accounting_categories").select("id,name,type").eq("type","expense").in("name",["\u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062d\u062c\u0648\u0632\u0627\u062a","\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0623\u062e\u0631\u0649"]);if(e&&e.length>0){n=(e.find(e=>"\u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062d\u062c\u0648\u0632\u0627\u062a"===e.name)||e[0]).id}}catch(r){}const s="\u0637\u0644\u0628 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0639\u0644\u0649 \u062d\u062c\u0632 ".concat(k.code||k.id||""," \u2014 ").concat(m||""),a={tx_date:(new Date).toISOString().slice(0,10),direction:"expense",category_id:n,amount:h,payment_method:"cash",bank_account_id:null,source_type:"reservation",reservation_id:k.id,description:s,status:"pending",reception_shift_id:e};t&&t.id&&(a.created_by=t.id);const{error:i}=await Or.from("accounting_transactions").insert(a);if(i)console.error("create refund request error",i),alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062d\u062c\u0632\u060c \u0644\u0643\u0646 \u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062a\u0644\u0642\u0627\u0626\u064a\u064b\u0627. \u064a\u0645\u0643\u0646 \u062a\u0633\u062c\u064a\u0644\u0647 \u064a\u062f\u0648\u064a\u064b\u0627 \u0645\u0646 \u0634\u0627\u0634\u0629 \u0627\u0644\u0645\u062d\u0627\u0633\u0628\u0629.");else try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(r){}}catch(s){console.error("create refund request exception",s),alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062d\u062c\u0632\u060c \u0644\u0643\u0646 \u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0646\u0634\u0627\u0621 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f. \u064a\u0645\u0643\u0646 \u062a\u0633\u062c\u064a\u0644\u0647 \u064a\u062f\u0648\u064a\u064b\u0627 \u0645\u0646 \u0634\u0627\u0634\u0629 \u0627\u0644\u0645\u062d\u0627\u0633\u0628\u0629.")}if(l>0&&n.payment_method)try{let e=null;try{if(t&&t.id){const n=(new Date).toISOString().slice(0,10),{data:r}=await Or.from("reception_shifts").select("id,status,shift_date").eq("staff_user_id",t.id).eq("shift_date",n).eq("status","open").order("opened_at",{ascending:!1}).limit(1);r&&r.length>0&&(e=r[0].id)}}catch(r){}let s=null;try{const{data:e}=await Or.from("accounting_categories").select("id,name,type").eq("type","income").eq("name","\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u063a\u0631\u0641").limit(1);e&&e.length>0&&(s=e[0].id)}catch(r){}const a=n.payment_method,i=["cash","bank","instapay","other"].includes(a)?a:"other",o="\u0632\u064a\u0627\u062f\u0629 \u062f\u0641\u0639\u0629 \u0639\u0644\u0649 \u062d\u062c\u0632 ".concat(k.code||k.id||""),c={tx_date:(new Date).toISOString().slice(0,10),direction:"income",category_id:s,amount:l,payment_method:i,bank_account_id:null,source_type:"reservation",reservation_id:k.id,description:o,status:["cash","instapay"].includes(i)?"pending":"confirmed",reception_shift_id:e};t&&t.id&&(c.created_by=t.id);const{error:d}=await Or.from("accounting_transactions").insert(c);if(d)console.error("accounting from reservation update error",d);else try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(r){}}catch(s){console.error("accounting from reservation update exception",s)}}else{const{data:e,error:o}=await Or.from("reservations").insert([n]).select("id").single();if(o)throw o;const l=null===e||void 0===e?void 0:e.id;if(l&&a.length>0)for(const t of a)try{await Or.rpc("add_reservation_guest",{p_reservation_id:l,p_guest_id:t,p_role:"additional"})}catch(r){}if(l&&i>0&&n.payment_method)try{let e=null;try{if(t&&t.id){const n=(new Date).toISOString().slice(0,10),{data:r}=await Or.from("reception_shifts").select("id,status,shift_date").eq("staff_user_id",t.id).eq("shift_date",n).eq("status","open").order("opened_at",{ascending:!1}).limit(1);r&&r.length>0&&(e=r[0].id)}}catch(r){}let s=null;try{const{data:e}=await Or.from("accounting_categories").select("id,name,type").eq("type","income").eq("name","\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u063a\u0631\u0641").limit(1);e&&e.length>0&&(s=e[0].id)}catch(r){}const a=n.payment_method,o=["cash","bank","instapay","other"].includes(a)?a:"other",c="\u062f\u0641\u0639\u0629 \u0645\u0642\u062f\u0651\u0645\u0629 \u0639\u0646\u062f \u0625\u0646\u0634\u0627\u0621 \u062d\u062c\u0632 ".concat(l),d={tx_date:(new Date).toISOString().slice(0,10),direction:"income",category_id:s,amount:i,payment_method:o,bank_account_id:null,source_type:"reservation",reservation_id:l,description:c,status:["cash","instapay"].includes(o)?"pending":"confirmed",reception_shift_id:e};t&&t.id&&(d.created_by=t.id);const{error:u}=await Or.from("accounting_transactions").insert(d);if(u)console.error("accounting from reservation create error",u);else try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(r){}}catch(s){console.error("accounting from reservation create exception",s)}}}N(!1),await z()}catch(s){console.error("Save reservation failed",s);const e=String((null===s||void 0===s?void 0:s.message)||s||"").toLowerCase();let t="\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0627\u0644\u062d\u062c\u0632.";e.includes("overlapping reservation")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0647\u0646\u0627\u0643 \u062a\u0639\u0627\u0631\u0636 \u0641\u064a \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e \u0645\u0639 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0644\u0646\u0641\u0633 \u0627\u0644\u063a\u0631\u0641\u0629.":e.includes("check_out_date must be after check_in_date")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0628\u0639\u062f \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644.":e.includes("row-level security")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0644\u0627 \u062a\u0645\u0644\u0643 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0644\u062d\u0641\u0638 \u0627\u0644\u062d\u062c\u0632 (RLS).":e.includes("not-null")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0628\u0639\u0636 \u0627\u0644\u062d\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629 \u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644\u0629.":e.includes("invalid input syntax")&&(t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0645\u0634\u0643\u0644\u0629 \u0641\u064a \u0635\u064a\u063a\u0629 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u062f\u062e\u0644\u0629."),alert(t)}},onAfterAction:z,groupMode:C}),I&&(0,a.jsx)(Ds,{row:I,onClose:()=>A(null),onDone:z}),D&&(0,a.jsx)(Ls,{row:D,onClose:()=>L(null),onDone:z}),M&&(0,a.jsx)(Ms,{row:M,onClose:()=>q(null)})]})}function Us(){const[e,t]=(0,r.useState)("reservations"),[n,s]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(0),d=(0,r.useRef)(null);(0,r.useEffect)(()=>{try{const e=new URL(window.location.href).searchParams.get("tab");e&&["reservations","tashkeen","calendar"].includes(e)&&t(e)}catch(e){}},[]);const u=e=>{t(e);try{const t=new URL(window.location.href);t.searchParams.set("tab",e),window.history.replaceState({},"",t.toString())}catch(n){}},h=t=>{let{id:n,label:r}=t;return(0,a.jsx)("button",{onClick:()=>u(n),className:"px-4 py-2 text-sm rounded-t ".concat(e===n?"bg-white text-gray-900 border border-b-0":"bg-[#1f2a48] text-white hover:bg-[#223459]"," "),children:r})};return(0,r.useEffect)(()=>{const e=e=>{var t;if(!e.altKey)return;const n=e.key.toLowerCase(),r=e.target&&e.target.tagName?e.target.tagName.toLowerCase():"";if(!("input"===r||"textarea"===r||"select"===r||(null===(t=e.target)||void 0===t?void 0:t.isContentEditable))||["t","r"].includes(n))if("1"===n)u("reservations"),e.preventDefault();else if("2"===n)u("tashkeen"),e.preventDefault();else if("3"===n)u("calendar"),e.preventDefault();else if("t"===n)s((new Date).toISOString().slice(0,10)),e.preventDefault();else if("r"===n)c(e=>e+1),e.preventDefault();else if("f"===n){try{var a;null===(a=d.current)||void 0===a||a.focus()}catch(i){}e.preventDefault()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,a.jsxs)("div",{className:"p-0",dir:"rtl",children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 bg-[#15203a] border-b border-[#1f2a48]",children:[(0,a.jsx)("div",{className:"px-6 pt-4",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0634\u0627\u0645\u0644\u0629"})}),(0,a.jsxs)("div",{className:"px-6 flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(h,{id:"reservations",label:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsx)(h,{id:"tashkeen",label:"\u0627\u0644\u062a\u0633\u0643\u064a\u0646"}),(0,a.jsx)(h,{id:"calendar",label:"\u0627\u0644\u062a\u0642\u0648\u064a\u0645"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-auto my-2",children:[(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2 text-sm",value:n,onChange:e=>s(e.target.value),title:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062a\u0627\u0631\u064a\u062e (Alt+T: \u0627\u0644\u064a\u0648\u0645)"}),(0,a.jsx)("button",{className:"border rounded px-3 py-2 text-sm bg-white hover:bg-gray-50",title:"\u0627\u0644\u064a\u0648\u0645 (Alt+T)",onClick:()=>s((new Date).toISOString().slice(0,10)),children:"\u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("button",{className:"border rounded px-3 py-2 text-sm bg-white hover:bg-gray-50",title:"\u062a\u062d\u062f\u064a\u062b (Alt+R)",onClick:()=>c(e=>e+1),children:"\u062a\u062d\u062f\u064a\u062b"}),(0,a.jsx)("input",{ref:d,type:"text",className:"border rounded px-3 py-2 text-sm w-56",placeholder:"\u0628\u062d\u062b: \u0627\u0644\u0627\u0633\u0645/\u0627\u0644\u0647\u0627\u062a\u0641/\u0627\u0644\u063a\u0631\u0641\u0629 (Alt+F)",value:i,onChange:e=>o(e.target.value)})]})]})]}),(0,a.jsxs)("div",{className:"bg-white border rounded m-6 p-2",children:["reservations"===e&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(qs,{})}),"tashkeen"===e&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(Ss,{selectedDate:n,onDateChange:s,searchQuery:i,refreshTick:l})}),"calendar"===e&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(ys,{selectedDate:n,onDateChange:s,searchQuery:i,refreshTick:l})})]})]})}function zs(e){var t;let{initialData:n,onClose:s,onSaved:i,currentUser:o}=e;const l=!!n,[c,d]=(0,r.useState)((null===n||void 0===n?void 0:n.username)||""),[u,h]=(0,r.useState)((null===n||void 0===n?void 0:n.full_name)||(null===n||void 0===n?void 0:n.name)||""),[m,p]=(0,r.useState)((null===n||void 0===n?void 0:n.role)||"reception"),[f,x]=(0,r.useState)(null===(t=null===n||void 0===n?void 0:n.is_active)||void 0===t||t),[g,v]=(0,r.useState)(""),[b,y]=(0,r.useState)(!1),[w,_]=(0,r.useState)("");return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-40",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:l?"\u062a\u0639\u062f\u064a\u0644 \u0645\u0633\u062a\u062e\u062f\u0645":"\u0645\u0633\u062a\u062e\u062f\u0645 \u062c\u062f\u064a\u062f"}),(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),_(""),u&&(l||c)){try{if(y(!0),l){const e=n.id,{error:t}=await Or.rpc("update_staff_user",{p_id:e,p_full_name:u,p_role:m,p_is_active:f,p_updated_by:(null===o||void 0===o?void 0:o.id)||null});if(t)throw t;if(g){const{error:t}=await Or.rpc("set_staff_user_password",{p_id:e,p_password:g,p_updated_by:(null===o||void 0===o?void 0:o.id)||null});if(t)throw t}i&&i()}else{if(!g)return _("\u064a\u062c\u0628 \u062a\u0639\u064a\u064a\u0646 \u0643\u0644\u0645\u0629 \u0645\u0631\u0648\u0631 \u0644\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0627\u0644\u062c\u062f\u064a\u062f."),void y(!1);const{data:e,error:t}=await Or.rpc("create_staff_user",{p_username:c,p_full_name:u,p_role:m,p_password:g,p_created_by:(null===o||void 0===o?void 0:o.id)||null});if(t)throw t;i&&i(e&&e[0])}}catch(t){console.error("Save staff user failed",t);const e=String((null===t||void 0===t?void 0:t.message)||t||"").toLowerCase();return void(e.includes("duplicate")||e.includes("already exists")?_("\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0645\u0633\u062a\u062e\u062f\u0645 \u0628\u0627\u0644\u0641\u0639\u0644\u060c \u0627\u062e\u062a\u0631 \u0627\u0633\u0645\u064b\u0627 \u0622\u062e\u0631."):e.includes("role")&&e.includes("check")?_("\u0642\u064a\u0645\u0629 \u0627\u0644\u062f\u0648\u0631 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d\u0629."):_("\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645."))}finally{y(!1)}s&&s()}else _("\u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0648\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644.")},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-700 mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 (\u0641\u0631\u064a\u062f)"}),(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 text-sm",disabled:l,value:c,onChange:e=>d(e.target.value),placeholder:"\u0645\u062b\u0627\u0644: receptionist01 \u0623\u0648 \u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-700 mb-1",children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644"}),(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 text-sm",value:u,onChange:e=>h(e.target.value),placeholder:"\u0627\u0644\u0627\u0633\u0645 \u0643\u0645\u0627 \u0633\u064a\u0638\u0647\u0631 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-700 mb-1",children:"\u0627\u0644\u062f\u0648\u0631"}),(0,a.jsx)("select",{className:"w-full border rounded px-3 py-2 text-sm",value:m,onChange:e=>p(e.target.value),children:C.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))})]}),l&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{id:"active",type:"checkbox",className:"h-4 w-4",checked:!!f,onChange:e=>x(e.target.checked)}),(0,a.jsx)("label",{htmlFor:"active",className:"text-sm text-slate-700",children:"\u0645\u0633\u062a\u062e\u062f\u0645 \u0645\u0641\u0639\u0644"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-700 mb-1",children:l?"\u062a\u0639\u064a\u064a\u0646 \u0643\u0644\u0645\u0629 \u0645\u0631\u0648\u0631 \u062c\u062f\u064a\u062f\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)":"\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631 \u0644\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0627\u0644\u062c\u062f\u064a\u062f"}),(0,a.jsx)("input",{type:"password",className:"w-full border rounded px-3 py-2 text-sm",value:g,onChange:e=>v(e.target.value),placeholder:l?"\u0627\u062a\u0631\u0643\u0647\u0627 \u0641\u0627\u0631\u063a\u0629 \u0644\u0644\u0625\u0628\u0642\u0627\u0621 \u0639\u0644\u0649 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631 \u0627\u0644\u062d\u0627\u0644\u064a\u0629":"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"})]}),w&&(0,a.jsx)("div",{className:"text-xs text-red-600 bg-red-50 border border-red-100 rounded px-3 py-2",children:w}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-3 py-2 text-sm rounded border border-slate-300 hover:bg-slate-50",children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"px-4 py-2 text-sm rounded bg-indigo-600 hover:bg-indigo-700 text-white disabled:opacity-70",children:b?"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638"})]})]})]})})}function Bs(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[o,l]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),m=async()=>{i(!0),l("");try{const{data:t,error:r}=await Or.from("staff_users_overview").select("*").order("created_at",{ascending:!1});if(r)throw r;const s=t||[];try{const e=(new Date).toISOString().slice(0,10),{data:t}=await Or.from("reception_shifts").select("id,staff_user_id,status,shift_date,closed_at").eq("shift_date",e),r=(t||[]).reduce((e,t)=>(e[t.staff_user_id]=t,e),{}),a=s.map(e=>Le(Le({},e),{},{today_shift:r[e.id]||null}));n(a)}catch(e){console.warn("Could not load today shifts",e),n(s)}}catch(e){console.error("Failed loading staff users",e),l("\u062a\u0639\u0630\u0651\u0631 \u062a\u062d\u0645\u064a\u0644 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646.")}finally{i(!1)}};return(0,r.useEffect)(()=>{R(e)&&m()},[e]),R(e)?(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0645\u0633\u062a\u062e\u062f\u0645\u064a \u0627\u0644\u0646\u0638\u0627\u0645"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646 \u0648\u062a\u0639\u064a\u064a\u0646 \u0627\u0644\u0623\u062f\u0648\u0627\u0631 \u0648\u0643\u0644\u0645\u0627\u062a \u0627\u0644\u0645\u0631\u0648\u0631 \u0644\u0644\u0645\u0633\u0624\u0648\u0644\u064a\u0646 \u0648\u0627\u0644\u0645\u0648\u0638\u0641\u064a\u0646."})]}),(0,a.jsx)("button",{onClick:()=>{h(null),d(!0)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm",children:"\u0625\u0636\u0627\u0641\u0629 \u0645\u0633\u062a\u062e\u062f\u0645 \u062c\u062f\u064a\u062f +"})]}),o&&(0,a.jsx)("div",{className:"mb-4 text-sm text-red-600 bg-red-50 border border-red-100 rounded px-3 py-2",children:o}),s?(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646..."}):0===t.length?(0,a.jsx)("div",{className:"bg-white rounded shadow p-4 text-sm text-gray-600",children:'\u0644\u0627 \u064a\u0648\u062c\u062f \u0645\u0633\u062a\u062e\u062f\u0645\u0648\u0646 \u0628\u0639\u062f. \u0627\u0636\u063a\u0637 "\u0625\u0636\u0627\u0641\u0629 \u0645\u0633\u062a\u062e\u062f\u0645 \u062c\u062f\u064a\u062f" \u0644\u0625\u0646\u0634\u0627\u0621 \u0623\u0648\u0644 \u062d\u0633\u0627\u0628.'}):(0,a.jsx)("div",{className:"bg-white rounded shadow overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-slate-100 text-slate-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u062f\u0648\u0631"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0646\u0634\u0627\u0621"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0623\u0646\u0634\u0623\u0647"}),(0,a.jsx)("th",{className:"px-3 py-2"})]})}),(0,a.jsx)("tbody",{children:t.map(t=>(0,a.jsxs)("tr",{className:"border-t border-slate-100 hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-mono text-xs",children:t.username}),(0,a.jsx)("td",{className:"px-3 py-2",children:t.full_name}),(0,a.jsx)("td",{className:"px-3 py-2",children:E(t.role)}),(0,a.jsx)("td",{className:"px-3 py-2",children:t.is_active?(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-emerald-50 text-emerald-700 border border-emerald-200",children:"\u0645\u0641\u0639\u0644"}):(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-slate-50 text-slate-500 border border-slate-200",children:"\u0645\u0648\u0642\u0648\u0641"})}),(0,a.jsx)("td",{className:"px-3 py-2 text-xs",children:t.today_shift?"open"===t.today_shift.status?(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-yellow-50 text-yellow-800 border border-yellow-100",children:"\u0645\u0641\u062a\u0648\u062d"}):(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-gray-50 text-gray-700 border border-gray-100",children:"\u0645\u063a\u0644\u0642"}):(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-slate-50 text-slate-500 border border-slate-100",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0648\u0631\u062f\u064a\u0629"})}),(0,a.jsx)("td",{className:"px-3 py-2 text-xs text-slate-600",children:t.created_by_name||t.created_by_username||"\u2014"}),(0,a.jsx)("td",{className:"px-3 py-2 text-xs text-slate-500",children:t.created_at?new Date(t.created_at).toLocaleString():"\u2014"}),(0,a.jsxs)("td",{className:"px-3 py-2 text-left flex items-center gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{h(t),d(!0)},className:"text-xs text-indigo-600 hover:text-indigo-800 underline",children:"\u062a\u0639\u062f\u064a\u0644"}),R(e)&&"reception"===t.role&&(0,a.jsxs)("div",{className:"flex gap-2",children:[t.today_shift&&"open"===t.today_shift.status&&(0,a.jsx)("button",{type:"button",onClick:async()=>{if(window.confirm("\u0623\u063a\u0644\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0645\u0641\u062a\u0648\u062d\u0629 \u0644\u0645\u0648\u0638\u0641 ".concat(t.full_name,"\u061f")))try{const e=(new Date).toISOString().slice(0,10),{error:n}=await Or.from("reception_shifts").update({status:"closed",closed_at:(new Date).toISOString()}).match({staff_user_id:t.id,shift_date:e,status:"open"});if(n)throw n;alert("\u062a\u0645 \u0625\u063a\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0628\u0646\u062c\u0627\u062d."),m()}catch(e){console.error("close shift error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u063a\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062f\u064a\u0629: "+(e.message||e))}},className:"text-xs px-2 py-1 rounded bg-orange-500 text-white hover:bg-orange-600",children:"\u0625\u063a\u0644\u0627\u0642"}),t.today_shift&&"closed"===t.today_shift.status&&(0,a.jsx)("button",{type:"button",onClick:async()=>{if(window.confirm("\u0625\u0639\u0627\u062f\u0629 \u0641\u062a\u062d \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0645\u0648\u0638\u0641 ".concat(t.full_name,"\u061f")))try{const e=(new Date).toISOString().slice(0,10),{error:n}=await Or.from("reception_shifts").update({status:"open",closed_at:null}).match({staff_user_id:t.id,shift_date:e,status:"closed"});if(n)throw n;alert("\u062a\u0645 \u0625\u0639\u0627\u062f\u0629 \u0641\u062a\u062d \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0628\u0646\u062c\u0627\u062d."),m()}catch(e){console.error("reopen shift error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0639\u0627\u062f\u0629 \u0641\u062a\u062d \u0627\u0644\u0648\u0631\u062f\u064a\u0629: "+(e.message||e))}},className:"text-xs px-2 py-1 rounded bg-emerald-600 text-white hover:bg-emerald-700",children:"\u0625\u0639\u0627\u062f\u0629 \u0641\u062a\u062d"}),t.today_shift&&"open"===t.today_shift.status&&(0,a.jsx)("button",{type:"button",onClick:async()=>{if(window.confirm("\u0625\u0646\u0647\u0627\u0621 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0645\u0641\u062a\u0648\u062d\u0629 (\u062d\u0627\u0644\u0629 \u0637\u0648\u0627\u0631\u0626) \u0644\u0645\u0648\u0638\u0641 ".concat(t.full_name,"\u061f")))try{const e=(new Date).toISOString().slice(0,10),{error:n}=await Or.from("reception_shifts").update({status:"closed",closed_at:(new Date).toISOString()}).match({staff_user_id:t.id,shift_date:e,status:"open"});if(n)throw n;alert("\u062a\u0645 \u0625\u0646\u0647\u0627\u0621 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 (\u0637\u0648\u0627\u0631\u0626) \u0628\u0646\u062c\u0627\u062d."),m()}catch(e){console.error("force end shift error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0646\u0647\u0627\u0621 \u0627\u0644\u0648\u0631\u062f\u064a\u0629: "+(e.message||e))}},className:"text-xs px-2 py-1 rounded bg-red-600 text-white hover:bg-red-700",children:"\u0625\u0646\u0647\u0627\u0621 \u0637\u0648\u0627\u0631\u0626"})]})]})]},t.id))})]})}),c&&(0,a.jsx)(zs,{initialData:u,currentUser:e,onClose:()=>d(!1),onSaved:()=>{d(!1),m()}})]}):(0,a.jsx)("div",{className:"p-8",dir:"rtl",children:(0,a.jsx)("div",{className:"max-w-lg mx-auto bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 text-sm",children:"\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u0627\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0635\u0641\u062d\u0629 \u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u064a\u0646. \u0647\u0630\u0647 \u0627\u0644\u0635\u0641\u062d\u0629 \u0645\u062e\u0635\u0635\u0629 \u0644\u0644\u0645\u062f\u064a\u0631 \u0641\u0642\u0637."})})}const Fs={building:"\u0645\u0628\u0646\u0649",reservation:"\u062d\u062c\u0632",guest:"\u0646\u0632\u064a\u0644",room:"\u063a\u0631\u0641\u0629",floor:"\u0637\u0627\u0628\u0642"},Ws={create:"\u0625\u0636\u0627\u0641\u0629",update:"\u062a\u0639\u062f\u064a\u0644",delete:"\u062d\u0630\u0641",status_change:"\u062a\u063a\u064a\u064a\u0631 \u062d\u0627\u0644\u0629",check_in:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644",check_out:"\u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c"};function Vs(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[o,l]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[f,x]=(0,r.useState)(0),[g,v]=(0,r.useState)(20),[b,y]=(0,r.useState)(0);(0,r.useEffect)(()=>{const e=setTimeout(()=>d(o),350);return()=>clearTimeout(e)},[o]);const w=(0,r.useCallback)(async()=>{i(!0);try{const e=Or.from("staff_activity_overview").select("*",{count:"exact"}).order("created_at",{ascending:!1});u&&e.eq("entity_type",u),m&&e.eq("action",m);const t=(c||"").trim();t&&e.or("details.ilike.%".concat(t,"%,staff_name.ilike.%").concat(t,"%,staff_username.ilike.%").concat(t,"%"));const r=f*g,s=r+g-1;e.range(r,s);const{data:a,error:i,count:o}=await e;if(i)throw i;n(a||[]),y(o||0)}catch(e){console.error("Load activity log failed",e),n([]),y(0)}finally{i(!1)}},[c,u,m,f,g]);(0,r.useEffect)(()=>{w()},[w]);return(0,r.useMemo)(()=>R(e)||P(e),[e])?(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0633\u062c\u0644 \u0646\u0634\u0627\u0637\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0645\u062a\u0627\u0628\u0639\u0629 \u0645\u0646 \u0623\u0636\u0627\u0641\u060c \u0639\u062f\u0651\u0644\u060c \u0623\u0648 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0648\u0627\u0644\u0646\u0632\u0644\u0627\u0621 \u0648\u0627\u0644\u0645\u0628\u0627\u0646\u064a"})]})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,a.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,a.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,a.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full",placeholder:"\u0628\u062d\u062b \u0641\u064a \u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644 \u0623\u0648 \u0627\u0633\u0645 \u0627\u0644\u0645\u0648\u0638\u0641",value:o,onChange:e=>{l(e.target.value),x(0)}})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:u,onChange:e=>{h(e.target.value),x(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u0643\u064a\u0627\u0646\u0627\u062a"}),(0,a.jsx)("option",{value:"building",children:"\u0627\u0644\u0645\u0628\u0627\u0646\u064a"}),(0,a.jsx)("option",{value:"reservation",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsx)("option",{value:"guest",children:"\u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:m,onChange:e=>{p(e.target.value),x(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a"}),(0,a.jsx)("option",{value:"create",children:"\u0625\u0636\u0627\u0641\u0629"}),(0,a.jsx)("option",{value:"update",children:"\u062a\u0639\u062f\u064a\u0644"}),(0,a.jsx)("option",{value:"delete",children:"\u062d\u0630\u0641"}),(0,a.jsx)("option",{value:"status_change",children:"\u062a\u063a\u064a\u064a\u0631 \u062d\u0627\u0644\u0629"})]})]}),s?(0,a.jsx)("div",{className:"py-16 text-center text-gray-500",children:"...\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0633\u062c\u0644 \u0627\u0644\u0646\u0634\u0627\u0637\u0627\u062a"}):0===t.length?(0,a.jsx)("div",{className:"py-16 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0633\u062c\u0644\u0627\u062a \u0646\u0634\u0627\u0637 \u0645\u0637\u0627\u0628\u0642\u0629"}):(0,a.jsx)("div",{className:"overflow-x-auto border rounded bg-white",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{className:"text-right",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0648\u0627\u0644\u0648\u0642\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0648\u0638\u0641"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0643\u064a\u0627\u0646"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0639\u0645\u0644\u064a\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0631\u0642\u0645 \u0627\u0644\u0633\u062c\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644"})]})}),(0,a.jsx)("tbody",{children:t.map(e=>{const t=Fs[e.entity_type]||e.entity_type,n=Ws[e.action]||e.action,r=e.created_at?new Date(e.created_at):null,s=r?r.toLocaleString("ar-EG",{dateStyle:"short",timeStyle:"short"}):"";return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-xs text-gray-600",children:s}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.staff_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.staff_username||""})]}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm",children:t}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm",children:n}),(0,a.jsx)("td",{className:"px-3 py-2 text-xs text-gray-500",children:e.entity_id||"-"}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm max-w-xl whitespace-normal break-words",children:e.details})]},e.id)})})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",t.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",b]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-sm",onClick:()=>x(e=>Math.max(0,e-1)),disabled:0===f,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,a.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",f+1]}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-sm",onClick:()=>x(e=>e+1),disabled:(f+1)*g>=b,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:g,onChange:e=>{v(Number(e.target.value)),x(0)},children:[(0,a.jsx)("option",{value:20,children:"20"}),(0,a.jsx)("option",{value:50,children:"50"})]})]})]})]}):(0,a.jsx)("div",{className:"p-8",dir:"rtl",children:(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:"\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u0639\u0631\u0636 \u0633\u062c\u0644 \u0627\u0644\u0646\u0634\u0627\u0637\u0627\u062a. \u0647\u0630\u0647 \u0627\u0644\u0635\u0641\u062d\u0629 \u0645\u062e\u0635\u0635\u0629 \u0644\u0644\u0625\u062f\u0627\u0631\u0629 \u0641\u0642\u0637."})})}function Hs(e){let{status:t}=e;const n={pending:{text:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631",cls:"bg-yellow-100 text-yellow-800"},confirmed:{text:"\u0645\u0624\u0643\u062f",cls:"bg-green-100 text-green-800"},checked_in:{text:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644",cls:"bg-blue-100 text-blue-800"},checked_out:{text:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c",cls:"bg-gray-100 text-gray-800"},cancelled:{text:"\u0645\u0644\u063a\u064a",cls:"bg-red-100 text-red-800"},no_show:{text:"\u0644\u0645 \u064a\u062d\u0636\u0631",cls:"bg-orange-100 text-orange-800"}}[t]||{text:t,cls:"bg-slate-100 text-slate-700"};return(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium ".concat(n.cls),children:n.text})}function Ks(e){var t;let{res:n,type:r,onCheckIn:s,onCheckOut:i}=e;const o="arrival"===r,l="departure"===r,c="inhouse"===r;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3 flex flex-col gap-2 text-sm",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"font-semibold truncate",children:n.guest_name||"\u0646\u0632\u064a\u0644 \u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 truncate",children:[n.guest_phone||"",n.guest_phone&&n.guest_email?" \u2022 ":"",n.guest_email||""]})]}),(0,a.jsx)(Hs,{status:n.status})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs md:text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:n.room_label||n.room_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,a.jsx)("span",{className:"font-medium",children:n.room_type_name||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062f\u062e\u0648\u0644 \u0627\u0644\u0645\u062d\u062c\u0648\u0632:"})," ",(0,a.jsx)("span",{className:"font-medium",children:n.check_in_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062e\u0631\u0648\u062c \u0627\u0644\u0645\u062d\u062c\u0648\u0632:"})," ",(0,a.jsx)("span",{className:"font-medium",children:n.check_out_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0639\u062f\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621:"})," ",(0,a.jsx)("span",{className:"font-medium",children:n.guests_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,a.jsx)("span",{className:"font-medium text-red-700",children:null!==(t=n.remaining_amount)&&void 0!==t?t:0})]})]}),n.special_requests&&(0,a.jsxs)("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-100 rounded px-2 py-1",children:["\u0637\u0644\u0628\u0627\u062a \u062e\u0627\u0635\u0629: ",n.special_requests]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-1",children:[o&&("pending"===n.status||"confirmed"===n.status)&&(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded text-xs bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>s&&s(n),children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644"}),l&&"checked_in"===n.status&&(0,a.jsx)("button",{type:"button",className:"px-3 py-1 rounded text-xs bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>i&&i(n),children:"\u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c"}),c&&"checked_in"===n.status&&(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0645\u0642\u064a\u0645 \u062d\u0627\u0644\u064a\u0627\u064b"})]})]})}function Gs(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[s,i]=(0,r.useState)([]),[o,l]=(0,r.useState)(!0),[c,d]=(0,r.useState)(""),[u,h]=(0,r.useState)([]),[m,p]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{l(!0);try{const{data:e,error:n}=await Or.from("reservations_overview").select("*").or("check_in_date.eq.".concat(t,",check_out_date.eq.").concat(t,",and(is_current.eq.true,status.eq.checked_in)"));if(n)throw n;i(e||[])}catch(e){console.error("Load check-in/out overview failed",e),i([])}finally{l(!1)}})()},[t]),(0,r.useEffect)(()=>{(async()=>{p(!0);try{const e=new Date(t);if(Number.isNaN(e.getTime()))return void h([]);const n=new Date(e);n.setHours(0,0,0,0);const r=new Date(n);r.setDate(r.getDate()+1);const{data:s,error:a}=await Or.from("staff_activity_overview").select("*").eq("entity_type","reservation").eq("action","status_change").gte("created_at",n.toISOString()).lt("created_at",r.toISOString());if(a)throw a;const i=(s||[]).filter(e=>{var t,n;const r=null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(n=t.new)||void 0===n?void 0:n.status;return"checked_in"===r||"checked_out"===r});h(i)}catch(e){console.error("Load check-in/out activity log failed",e),h([])}finally{p(!1)}})()},[t]);const f=(0,r.useMemo)(()=>{const e=(c||"").trim().toLowerCase();return e?s.filter(t=>{const n=(t.guest_name||"").toLowerCase(),r=(t.guest_phone||"").toLowerCase(),s=(t.room_label||String(t.room_id||"")).toLowerCase();return n.includes(e)||r.includes(e)||s.includes(e)}):s},[s,c]),x=(0,r.useMemo)(()=>f.filter(e=>e.check_in_date===t&&["pending","confirmed"].includes(e.status)),[f,t]),g=(0,r.useMemo)(()=>f.filter(e=>e.is_current&&"checked_in"===e.status),[f]),v=(0,r.useMemo)(()=>f.filter(e=>e.check_out_date===t&&"checked_in"===e.status),[f,t]),b=async n=>{try{if(!window.confirm("\u062a\u0623\u0643\u064a\u062f \u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644 \u0627\u0644\u0646\u0632\u064a\u0644 ".concat(n.guest_name||""," \u0625\u0644\u0649 \u0627\u0644\u063a\u0631\u0641\u0629 ").concat(n.room_label||n.room_id,"\u061f")))return;const r={status:"checked_in"};e&&e.id&&(r.updated_by=e.id);const{error:s}=await Or.from("reservations").update(r).eq("id",n.id);if(s)throw s;const{data:a,error:o}=await Or.from("reservations_overview").select("*").or("check_in_date.eq.".concat(t,",check_out_date.eq.").concat(t,",and(is_current.eq.true,status.eq.checked_in)"));o||i(a||[]),window.alert("\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644 \u0628\u0646\u062c\u0627\u062d.")}catch(r){console.error("Check-in failed",r),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644 \u0644\u0644\u062d\u062c\u0632: "+(r.message||r))}},y=async n=>{try{if(!window.confirm("\u062a\u0623\u0643\u064a\u062f \u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c \u0627\u0644\u0646\u0632\u064a\u0644 ".concat(n.guest_name||""," \u0645\u0646 \u0627\u0644\u063a\u0631\u0641\u0629 ").concat(n.room_label||n.room_id,"\u061f")))return;const r={status:"checked_out"},s=(new Date).toISOString().slice(0,10);if(n.check_out_date&&s<String(n.check_out_date)){const e=window.prompt("\u062a\u0646\u0628\u064a\u0647: \u0647\u0630\u0627 \u062e\u0631\u0648\u062c \u0645\u0628\u0643\u0631 \u0642\u0628\u0644 \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u063a\u0627\u062f\u0631\u0629 \u0627\u0644\u0645\u062d\u062c\u0648\u0632 (".concat(n.check_out_date,").\n")+"\u0627\u0643\u062a\u0628 1: \u062e\u0631\u0648\u062c \u0645\u0628\u0643\u0631 \u0645\u0639 \u0627\u0633\u062a\u0631\u062f\u0627\u062f\n\u0627\u0643\u062a\u0628 2: \u062e\u0631\u0648\u062c \u0645\u0628\u0643\u0631 \u0628\u062f\u0648\u0646 \u0627\u0633\u062a\u0631\u062f\u0627\u062f\n\u0627\u062a\u0631\u0643 \u0627\u0644\u062d\u0642\u0644 \u0641\u0627\u0631\u063a\u064b\u0627 \u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064a\u0629.");if(!e)return void window.alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c.");const t=String(e).trim();let s="";if("1"===t)s="[\u062e\u0631\u0648\u062c \u0645\u0628\u0643\u0631 - \u0645\u0639 \u0627\u0633\u062a\u0631\u062f\u0627\u062f]";else{if("2"!==t)return void window.alert("\u0627\u062e\u062a\u064a\u0627\u0631 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d\u060c \u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064a\u0629.");s="[\u062e\u0631\u0648\u062c \u0645\u0628\u0643\u0631 - \u0628\u062f\u0648\u0646 \u0627\u0633\u062a\u0631\u062f\u0627\u062f]"}const a=(n.notes||"").trim();r.notes=a?"".concat(a,"\n").concat(s):s}e&&e.id&&(r.updated_by=e.id);const{error:a}=await Or.from("reservations").update(r).eq("id",n.id);if(a)throw a;const{data:o,error:l}=await Or.from("reservations_overview").select("*").or("check_in_date.eq.".concat(t,",check_out_date.eq.").concat(t,",and(is_current.eq.true,status.eq.checked_in)"));l||i(o||[]),window.alert("\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c \u0628\u0646\u062c\u0627\u062d.")}catch(r){console.error("Check-out failed",r),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062e\u0631\u0648\u062c \u0644\u0644\u062d\u062c\u0632: "+(r.message||r))}};return O(e,"checkin-out")?(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-1",children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644/\u062e\u0631\u0648\u062c \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0634\u0627\u0634\u0629 \u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u0645\u062e\u0635\u0635\u0629 \u0644\u0648\u0635\u0648\u0644 \u0648\u0645\u063a\u0627\u062f\u0631\u0629 \u0627\u0644\u0646\u0632\u0644\u0627\u0621 \u0645\u0639 \u0631\u0628\u0637 \u0645\u0628\u0627\u0634\u0631 \u0628\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2 text-sm",value:t,onChange:e=>n(e.target.value)}),(0,a.jsx)("button",{type:"button",className:"border rounded px-3 py-2 bg-white hover:bg-gray-50 text-sm",onClick:()=>n((new Date).toISOString().slice(0,10)),children:"\u0627\u0644\u064a\u0648\u0645"})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:(0,a.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,a.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,a.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,a.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full text-sm",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0627\u0633\u0645 / \u0627\u0644\u0647\u0627\u062a\u0641 / \u0627\u0644\u063a\u0631\u0641\u0629",value:c,onChange:e=>d(e.target.value)})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-sm",children:[(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs text-blue-700",children:"\u0648\u0635\u0648\u0644 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-blue-700",children:x.length})]}),(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-200 rounded p-3 flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs text-emerald-700",children:"\u0645\u0642\u064a\u0645\u0648\u0646 \u0627\u0644\u0622\u0646"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-emerald-700",children:g.length})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-3 flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs text-amber-700",children:"\u0645\u063a\u0627\u062f\u0631\u0648\u0646 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-amber-700",children:v.length})]})]}),o?(0,a.jsx)("div",{className:"py-12 text-center text-gray-500",children:"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644"}):(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\u0648\u0635\u0648\u0644 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0645\u0624\u0643\u062f\u0629 / \u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631 \u0628\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u064a\u0648\u0645"})]}),0===x.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 bg-white rounded border border-dashed border-gray-200 p-4",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0648\u0635\u0648\u0644\u0627\u062a \u0645\u062c\u062f\u0648\u0644\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645."}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:x.map(e=>(0,a.jsx)(Ks,{res:e,type:"arrival",onCheckIn:b},e.id))})]}),(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\u0645\u0642\u064a\u0645\u0648\u0646 \u0627\u0644\u0622\u0646"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0643\u0644 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0628\u062d\u0627\u0644\u0629 \u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644 \u0648\u062d\u0627\u0644\u064a\u0629"})]}),0===g.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 bg-white rounded border border-dashed border-gray-200 p-4",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0646\u0632\u0644\u0627\u0621 \u0645\u0642\u064a\u0645\u0648\u0646 \u062d\u0627\u0644\u064a\u064b\u0627 \u062d\u0633\u0628 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e."}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:g.map(e=>(0,a.jsx)(Ks,{res:e,type:"inhouse"},e.id))})]}),(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\u0645\u063a\u0627\u062f\u0631\u0648\u0646 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u062a\u064a \u062a\u0627\u0631\u064a\u062e \u062e\u0631\u0648\u062c\u0647\u0627 \u0627\u0644\u064a\u0648\u0645"})]}),0===v.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 bg-white rounded border border-dashed border-gray-200 p-4",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u063a\u0627\u062f\u0631\u0627\u062a \u0645\u062c\u062f\u0648\u0644\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645."}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:v.map(e=>(0,a.jsx)(Ks,{res:e,type:"departure",onCheckOut:y},e.id))})]}),(0,a.jsxs)("section",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\u0633\u062c\u0644 \u0627\u0644\u062f\u062e\u0648\u0644 \u0648\u0627\u0644\u062e\u0631\u0648\u062c \u0644\u0644\u064a\u0648\u0645"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u064a\u0639\u0631\u0636 \u0643\u0644 \u0639\u0645\u0644\u064a\u0627\u062a \u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u062d\u0627\u0644\u0629 \u0625\u0644\u0649 \u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644 / \u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645"})]}),m?(0,a.jsx)("div",{className:"text-sm text-gray-500 bg-white rounded border border-dashed border-gray-200 p-4",children:"...\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0633\u062c\u0644 \u0627\u0644\u062f\u062e\u0648\u0644/\u0627\u0644\u062e\u0631\u0648\u062c"}):0===u.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 bg-white rounded border border-dashed border-gray-200 p-4",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0639\u0645\u0644\u064a\u0627\u062a \u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644/\u062e\u0631\u0648\u062c \u0645\u0633\u062c\u0651\u064e\u0644\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645."}):(0,a.jsx)("div",{className:"bg-white rounded border border-gray-200 overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full text-xs md:text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50 text-right",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0648\u0642\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0648\u0638\u0641"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0648\u0639"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644"})]})}),(0,a.jsx)("tbody",{children:u.map(e=>{var t,n;const r=e.created_at?new Date(e.created_at):null,s=r?r.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"}):"",i="checked_in"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(n=t.new)||void 0===n?void 0:n.status)?"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644":"\u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c";return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1 whitespace-nowrap text-gray-600",children:s}),(0,a.jsxs)("td",{className:"px-3 py-1",children:[(0,a.jsx)("div",{className:"text-xs md:text-sm font-medium",children:e.staff_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),(0,a.jsx)("div",{className:"text-[10px] md:text-xs text-gray-500",children:e.staff_username||""})]}),(0,a.jsx)("td",{className:"px-3 py-1 text-xs md:text-sm",children:i}),(0,a.jsx)("td",{className:"px-3 py-1 text-xs md:text-sm max-w-xl whitespace-normal break-words",children:e.details})]},e.id)})})]})})]})]})]}):(0,a.jsx)("div",{className:"p-8",dir:"rtl",children:(0,a.jsx)("div",{className:"max-w-lg mx-auto bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 text-sm",children:"\u0644\u0627 \u062a\u0645\u0644\u0643 \u0635\u0644\u0627\u062d\u064a\u0629 \u0627\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0635\u0641\u062d\u0629 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644/\u0627\u0644\u062e\u0631\u0648\u062c. \u0647\u0630\u0647 \u0627\u0644\u0635\u0641\u062d\u0629 \u0645\u062e\u0635\u0635\u0629 \u0644\u0644\u0625\u062f\u0627\u0631\u0629 \u0648\u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644."})})}function Js(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)([]),[s,i]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[o,l]=(0,r.useState)(!0),[c,d]=(0,r.useState)([]),[u,h]=(0,r.useState)(""),[m,p]=(0,r.useState)("all"),[f,x]=(0,r.useState)("all"),[g,v]=(0,r.useState)("all"),[b,y]=(0,r.useState)([]),w="housekeeping"===(null===e||void 0===e?void 0:e.role),_=(0,r.useCallback)(async()=>{l(!0);try{const{data:e,error:t}=await Or.rpc("housekeeping_overview",{p_date:s});if(t)throw t;d(e||[])}catch(e){console.error("Failed to load housekeeping overview",e),d([])}finally{l(!1)}},[s]),j=(0,r.useCallback)(async()=>{try{const{data:e,error:t}=await Or.from("staff_users_overview").select("id, full_name, role, is_active").order("full_name");if(t)throw t;n((e||[]).filter(e=>e.is_active))}catch(e){console.error("Failed to load staff for housekeeping",e),n([])}},[]),N=(0,r.useCallback)(async()=>{try{const{data:e,error:t}=await Or.from("laundry_items").select("id, code, name").order("code");if(t)throw t;y(e||[])}catch(e){console.error("Failed to load laundry items for housekeeping",e),y([])}},[]);(0,r.useEffect)(()=>{_()},[_]),(0,r.useEffect)(()=>{j(),N()},[j,N]);const k=(0,r.useMemo)(()=>{const e=(u||"").trim().toLowerCase();return(c||[]).filter(t=>{if("all"!==m&&t.status!==m)return!1;if("all"!==f&&t.cleanliness!==f)return!1;if("with_task"===g&&!t.task_id)return!1;if("without_task"===g&&t.task_id)return!1;if(e){if(![t.room_code,t.building_name,t.floor_name,t.current_guest_name,t.assigned_to_name].join(" ").toLowerCase().includes(e))return!1}return!0})},[c,u,m,f,g]),S=(0,r.useMemo)(()=>w?(c||[]).filter(t=>t.task_id&&t.assigned_to_id===(null===e||void 0===e?void 0:e.id)).sort((e,t)=>{var n,r;const s=null!==(n=e.task_priority)&&void 0!==n?n:0;return(null!==(r=t.task_priority)&&void 0!==r?r:0)-s}):[],[c,w,e]),C=async(t,n,r)=>{try{const a={p_room_id:t.room_id,p_task_date:s,p_task_type:n,p_created_by:(null===e||void 0===e?void 0:e.id)||null,p_assigned_to:r||(null===e||void 0===e?void 0:e.id)||null},{error:i}=await Or.rpc("upsert_housekeeping_task",a);if(i)throw i;await _()}catch(a){console.error("Update task failed",a),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u062d\u062f\u064a\u062b \u0645\u0647\u0645\u0629 \u0627\u0644\u062a\u0646\u0638\u064a\u0641: "+(a.message||a))}},E=async(t,n)=>{try{if(!t.task_id)return void window.alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0647\u0645\u0629 \u0645\u0631\u062a\u0628\u0637\u0629 \u0628\u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629.");const r={p_task_id:t.task_id,p_status:n,p_staff_user_id:(null===e||void 0===e?void 0:e.id)||null},{error:s}=await Or.rpc("set_housekeeping_task_status",r);if(s)throw s;await _()}catch(r){console.error("Set task status failed",r),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0645\u0647\u0645\u0629 \u0627\u0644\u062a\u0646\u0638\u064a\u0641: "+(r.message||r))}};if(w){const e=S.length,t=S.filter(e=>!e.task_status||"pending"===e.task_status).length,n=S.filter(e=>"in_progress"===e.task_status).length,r=S.filter(e=>"done"===e.task_status).length;return(0,a.jsxs)("div",{className:"p-6",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold",children:["\u0645\u0647\u0627\u0645 \u0627\u0644\u062a\u0646\u0638\u064a\u0641 \u0627\u0644\u064a\u0648\u0645 (",s,")"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0647\u0630\u0647 \u0627\u0644\u0634\u0627\u0634\u0629 \u0645\u062e\u0635\u0651\u0635\u0629 \u0644\u0645\u0648\u0638\u0641\u064a \u0627\u0644\u0647\u0648\u0633 \u0643\u064a\u067e\u0646\u062c \u0644\u0639\u0631\u0636 \u0648\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0647\u0627\u0645 \u0627\u0644\u0645\u0648\u0643\u0644\u0629 \u0644\u0647\u0645 \u0641\u0642\u0637."})]}),(0,a.jsxs)("div",{className:"text-sm text-right",children:[(0,a.jsxs)("div",{children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0647\u0627\u0645: ",(0,a.jsx)("span",{className:"font-semibold",children:e})]}),(0,a.jsxs)("div",{children:["\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631: ",(0,a.jsx)("span",{className:"font-semibold text-amber-600",children:t})]}),(0,a.jsxs)("div",{children:["\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u0646\u0641\u064a\u0630: ",(0,a.jsx)("span",{className:"font-semibold text-blue-600",children:n})]}),(0,a.jsxs)("div",{children:["\u0645\u0646\u062c\u0632\u0629: ",(0,a.jsx)("span",{className:"font-semibold text-green-600",children:r})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2",value:s,onChange:e=>i(e.target.value)}),(0,a.jsx)("input",{className:"border rounded px-3 py-2 flex-1 min-w-[200px]",placeholder:"\u0628\u062d\u062b \u0639\u0646 \u063a\u0631\u0641\u0629 \u0623\u0648 \u0646\u0632\u064a\u0644",value:u,onChange:e=>h(e.target.value)})]}),(0,a.jsx)("div",{className:"bg-white rounded shadow overflow-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0645\u0628\u0646\u0649 / \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0646\u0648\u0639 \u0627\u0644\u0645\u0647\u0645\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0623\u0648\u0644\u0648\u064a\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0646\u0632\u064a\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,a.jsx)("tbody",{children:o?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-3 py-6 text-center text-gray-500",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0645\u0647\u0627\u0645\u0643 \u0644\u0644\u064a\u0648\u0645..."})}):0===S.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-3 py-6 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0647\u0627\u0645 \u0645\u0643\u0644\u0651\u064e\u0641\u0629 \u0644\u0643 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645."})}):S.filter(e=>{const t=(u||"").trim().toLowerCase();if(!t)return!0;return[e.room_code,e.building_name,e.floor_name,e.current_guest_name].join(" ").toLowerCase().includes(t)}).map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-semibold",children:e.room_code}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[e.building_name," / ",e.floor_name]}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.task_type||"\u2014"}),(0,a.jsxs)("td",{className:"px-3 py-2",children:["done"===e.task_status&&(0,a.jsx)("span",{className:"text-green-700 bg-green-50 px-2 py-1 rounded text-xs",children:"\u0645\u0646\u062c\u0632\u0629"}),"in_progress"===e.task_status&&(0,a.jsx)("span",{className:"text-blue-700 bg-blue-50 px-2 py-1 rounded text-xs",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u0646\u0641\u064a\u0630"}),e.task_status&&"pending"!==e.task_status?null:(0,a.jsx)("span",{className:"text-amber-700 bg-amber-50 px-2 py-1 rounded text-xs",children:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"})]}),(0,a.jsx)("td",{className:"px-3 py-2",children:null!==(t=e.task_priority)&&void 0!==t?t:"\u2014"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.current_guest_name||"\u2014"}),(0,a.jsxs)("td",{className:"px-3 py-2 space-x-1 space-x-reverse",children:[(0,a.jsx)("button",{className:"inline-block mb-1 bg-blue-50 text-blue-700 border border-blue-200 rounded px-2 py-1 text-xs",onClick:()=>E(e,"in_progress"),children:"\u0628\u062f\u0621 \u0627\u0644\u0645\u0647\u0645\u0629"}),(0,a.jsx)("button",{className:"inline-block mb-1 bg-green-50 text-green-700 border border-green-200 rounded px-2 py-1 text-xs",onClick:()=>E(e,"done"),children:"\u0625\u0646\u0647\u0627\u0621 \u0627\u0644\u0645\u0647\u0645\u0629"})]})]},e.room_id)})})]})})]})}return(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062a\u0646\u0638\u064a\u0641 / \u0627\u0644\u0647\u0648\u0633 \u0643\u064a\u067e\u0646\u062c"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0645\u062a\u0627\u0628\u0639\u0629 \u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641\u060c \u0627\u0644\u0645\u0647\u0627\u0645 \u0627\u0644\u064a\u0648\u0645\u064a\u0629\u060c \u0648\u062d\u0631\u0643\u0629 \u0627\u0644\u0645\u0644\u0627\u064a\u0627\u062a \u0648\u0627\u0644\u0641\u0648\u0637 \u0639\u0628\u0631 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a \u0627\u0644\u062e\u0627\u0631\u062c\u064a (\u0627\u0644\u062c\u0632\u0621 \u0627\u0644\u062b\u0627\u0646\u064a \u0639\u0628\u0631 \u0635\u0641\u062d\u0629 \u0645\u0633\u062a\u0642\u0644\u0629 \u0644\u0627\u062d\u0642\u064b\u0627)."})]}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2",value:s,onChange:e=>i(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,a.jsx)("input",{className:"border rounded px-3 py-2 min-w-[200px] flex-1",placeholder:"\u0628\u062d\u062b: \u0631\u0642\u0645 \u0627\u0644\u063a\u0631\u0641\u0629 / \u0627\u0644\u0645\u0628\u0646\u0649 / \u0627\u0644\u0646\u0632\u064a\u0644 / \u0627\u0644\u0645\u0648\u0638\u0641",value:u,onChange:e=>h(e.target.value)}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2",value:m,onChange:e=>p(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u0643\u0644 \u062d\u0627\u0644\u0627\u062a \u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("option",{value:"available",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("option",{value:"reserved",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("option",{value:"occupied",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2",value:f,onChange:e=>x(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u0643\u0644 \u062d\u0627\u0644\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0641\u0629"}),(0,a.jsx)("option",{value:"clean",children:"\u0646\u0638\u064a\u0641\u0629"}),(0,a.jsx)("option",{value:"in_cleaning",children:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641"}),(0,a.jsx)("option",{value:"needs_cleaning",children:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629"})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2",value:g,onChange:e=>v(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u0643\u0644 \u0627\u0644\u063a\u0631\u0641"}),(0,a.jsx)("option",{value:"with_task",children:"\u0628\u0647\u0627 \u0645\u0647\u0645\u0629 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("option",{value:"without_task",children:"\u0628\u062f\u0648\u0646 \u0645\u0647\u0645\u0629"})]})]}),(0,a.jsx)("div",{className:"bg-white rounded shadow overflow-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0645\u0628\u0646\u0649 / \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0646\u0638\u0627\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0646\u0632\u064a\u0644 \u0627\u0644\u062d\u0627\u0644\u064a"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0645\u0647\u0645\u0629 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0645\u0633\u0624\u0648\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a \u0633\u0631\u064a\u0639\u0629"})]})}),(0,a.jsx)("tbody",{children:o?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"px-3 py-6 text-center text-gray-500",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u062a\u0646\u0638\u064a\u0641..."})}):0===k.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"px-3 py-6 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641 \u0645\u0637\u0627\u0628\u0642\u0629 \u0644\u0644\u0645\u0639\u0627\u064a\u064a\u0631 \u0627\u0644\u062d\u0627\u0644\u064a\u0629."})}):k.map(n=>(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-semibold",children:n.room_code}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[n.building_name," / ",n.floor_name]}),(0,a.jsx)("td",{className:"px-3 py-2",children:gs(n.status)}),(0,a.jsx)("td",{className:"px-3 py-2",children:bs(n.cleanliness)}),(0,a.jsx)("td",{className:"px-3 py-2",children:n.current_guest_name||"\u2014"}),(0,a.jsx)("td",{className:"px-3 py-2",children:n.task_type?n.task_type:"\u0644\u0627 \u064a\u0648\u062c\u062f"}),(0,a.jsx)("td",{className:"px-3 py-2",children:n.assigned_to_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),(0,a.jsxs)("td",{className:"px-3 py-2 space-y-1",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 items-center",children:[(0,a.jsxs)("select",{className:"border rounded px-1 py-1 text-xs max-w-[140px]",defaultValue:(null===e||void 0===e?void 0:e.id)||"",onChange:e=>{n._assignedDraft=e.target.value||null},children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0645\u0648\u0638\u0641\u064b\u0627"}),t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.full_name},e.id))]}),(0,a.jsx)("button",{className:"inline-block bg-blue-50 text-blue-700 border border-blue-200 rounded px-2 py-1 text-xs",onClick:()=>C(n,"stayover_clean",n._assignedDraft),children:"\u062a\u0646\u0638\u064a\u0641 \u0625\u0642\u0627\u0645\u0629"}),(0,a.jsx)("button",{className:"inline-block bg-amber-50 text-amber-700 border border-amber-200 rounded px-2 py-1 text-xs",onClick:()=>C(n,"checkout_clean",n._assignedDraft),children:"\u062a\u0646\u0638\u064a\u0641 \u062e\u0631\u0648\u062c"}),(0,a.jsx)("button",{className:"inline-block bg-green-50 text-green-700 border border-green-200 rounded px-2 py-1 text-xs",onClick:()=>C(n,"linen_change",n._assignedDraft),children:"\u062a\u063a\u064a\u064a\u0631 \u0645\u0641\u0631\u0648\u0634\u0627\u062a"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 items-center text-xs",children:[(0,a.jsxs)("select",{className:"border rounded px-1 py-1 max-w-[140px]",defaultValue:"",onChange:e=>{n._laundryItemDraft=e.target.value||null},children:[(0,a.jsx)("option",{value:"",children:"\u0635\u0646\u0641 \u0644\u0627\u0646\u062f\u0631\u064a"}),b.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]}),(0,a.jsx)("input",{type:"number",min:"1",className:"border rounded px-1 py-1 w-16",placeholder:"\u0643\u0645\u064a\u0629",onChange:e=>{n._laundryQtyDraft=e.target.value}}),(0,a.jsx)("button",{className:"inline-block bg-purple-50 text-purple-700 border border-purple-200 rounded px-2 py-1 text-xs",onClick:()=>(async t=>{try{const n=t._laundryItemDraft,r=parseInt(t._laundryQtyDraft||"0",10);if(!n||!r||r<=0)return void window.alert("\u0627\u062e\u062a\u0631 \u0635\u0646\u0641\u064b\u0627 \u0648\u062d\u062f\u062f \u0643\u0645\u064a\u0629 \u0635\u062d\u064a\u062d\u0629 \u0642\u0628\u0644 \u0625\u0631\u0633\u0627\u0644 \u0644\u0644\u0627\u0646\u062f\u0631\u064a.");const s={p_item_id:n,p_direction:"out",p_quantity:r,p_room_id:t.room_id,p_reservation_id:t.current_reservation_id||null,p_note:"\u0625\u0631\u0633\u0627\u0644 \u0645\u0641\u0631\u0648\u0634\u0627\u062a \u0645\u0646 \u0627\u0644\u063a\u0631\u0641\u0629 ".concat(t.room_code," \u0644\u0644\u0627\u0646\u062f\u0631\u064a"),p_staff_user_id:(null===e||void 0===e?void 0:e.id)||null},{error:a}=await Or.rpc("create_laundry_movement",s);if(a)throw a;window.alert("\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u062d\u0631\u0643\u0629 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a \u0644\u0644\u063a\u0631\u0641\u0629 \u0628\u0646\u062c\u0627\u062d.")}catch(n){console.error("Laundry movement from housekeeping failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u062d\u0631\u0643\u0629 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a \u0645\u0646 \u0634\u0627\u0634\u0629 \u0627\u0644\u062a\u0646\u0638\u064a\u0641: "+(n.message||n))}})(n),children:"\u0625\u0631\u0633\u0627\u0644 \u0644\u0644\u0627\u0646\u062f\u0631\u064a"})]})]})]},n.room_id))})]})})]})}function $s(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[s,i]=(0,r.useState)([]),[o,l]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(!0),[m,p]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[f,x]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[g,v]=(0,r.useState)("all"),[b,y]=(0,r.useState)([]),[w,_]=(0,r.useState)({code:"",name:"",unit:"\u0642\u0637\u0639\u0629"}),[j,N]=(0,r.useState)({item_id:"",direction:"out",quantity:1,note:""}),k=R(e)||P(e),S=(0,r.useCallback)(async()=>{d(!0);try{const{data:e,error:n}=await Or.rpc("laundry_items_overview",{p_date:t});if(n)throw n;i(e||[])}catch(e){console.error("Failed to load laundry items overview",e),i([])}finally{d(!1)}},[t]),C=(0,r.useCallback)(async()=>{h(!0);try{const e={p_from:m,p_to:f};g&&"all"!==g&&(e.p_item_id=g);const{data:t,error:n}=await Or.rpc("laundry_movements_overview",e);if(n)throw n;l(t||[])}catch(e){console.error("Failed to load laundry movements",e),l([])}finally{h(!1)}},[m,f,g]);(0,r.useEffect)(()=>{S()},[S]),(0,r.useEffect)(()=>{C()},[C]),(0,r.useEffect)(()=>{(async()=>{try{const{data:e,error:t}=await Or.from("staff_users_overview").select("id, full_name, role, is_active").order("full_name");if(t)throw t;y((e||[]).filter(e=>e.is_active))}catch(e){console.error("Failed to load staff for laundry",e),y([])}})()},[]);return(0,a.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a / \u0627\u0644\u0645\u062e\u0632\u0648\u0646"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u062a\u0639\u0631\u064a\u0641 \u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a\u060c \u0645\u062a\u0627\u0628\u0639\u0629 \u0627\u0644\u0631\u0635\u064a\u062f\u060c \u0648\u062a\u0633\u062c\u064a\u0644 \u062d\u0631\u0643\u0627\u062a \u0627\u0644\u062e\u0631\u0648\u062c \u0644\u0644\u0627\u0646\u062f\u0631\u064a \u0648\u0627\u0644\u0631\u062c\u0648\u0639 \u0645\u0646\u0647."})]})}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between mb-3 gap-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:"\u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0648\u0627\u0644\u0631\u0635\u064a\u062f \u0627\u0644\u062d\u0627\u0644\u064a"}),k&&(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),k){if(w.code&&w.name)try{const{error:e}=await Or.from("laundry_items").insert([{code:w.code.trim(),name:w.name.trim(),unit:(w.unit||"\u0642\u0637\u0639\u0629").trim()}]);if(e)throw e;_({code:"",name:"",unit:"\u0642\u0637\u0639\u0629"}),await S()}catch(t){console.error("Failed to add laundry item",t),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0635\u0646\u0641: "+(t.message||t))}}else window.alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0646\u0627\u0626\u0628 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647\u0645\u0627 \u0625\u0636\u0627\u0641\u0629 \u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a.")},className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsx)("input",{className:"border rounded px-2 py-1 w-28",placeholder:"\u0643\u0648\u062f",value:w.code,onChange:e=>_(t=>Le(Le({},t),{},{code:e.target.value}))}),(0,a.jsx)("input",{className:"border rounded px-2 py-1 w-40",placeholder:"\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641",value:w.name,onChange:e=>_(t=>Le(Le({},t),{},{name:e.target.value}))}),(0,a.jsx)("input",{className:"border rounded px-2 py-1 w-24",placeholder:"\u0627\u0644\u0648\u062d\u062f\u0629",value:w.unit,onChange:e=>_(t=>Le(Le({},t),{},{unit:e.target.value}))}),(0,a.jsxs)("label",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{children:"\u062a\u0627\u0631\u064a\u062e \u0645\u0644\u062e\u0635 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:t,onChange:e=>n(e.target.value)})]}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u0635\u0646\u0641"})]})]}),(0,a.jsx)("div",{className:"bg-white rounded shadow overflow-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0643\u0648\u062f"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0627\u0633\u0645"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0648\u062d\u062f\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0631\u0635\u064a\u062f \u0627\u0644\u062d\u0627\u0644\u064a"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u062e\u0631\u062c \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u062f\u062e\u0644 \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,a.jsx)("tbody",{children:c?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-3 py-6 text-center text-gray-500",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0623\u0635\u0646\u0627\u0641..."})}):0===s.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-3 py-6 text-center text-gray-500",children:'\u0644\u0627 \u062a\u0648\u062c\u062f \u0623\u0635\u0646\u0627\u0641 \u0645\u0633\u062c\u0644\u0629. \u0627\u0633\u062a\u062e\u062f\u0645 \u0632\u0631 "\u0625\u0636\u0627\u0641\u0629 \u0635\u0646\u0641 \u0644\u0627\u0646\u062f\u0631\u064a" \u0623\u0639\u0644\u0627\u0647.'})}):s.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-semibold",children:e.code}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.unit}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.stock_quantity}),(0,a.jsx)("td",{className:"px-3 py-2 text-red-600",children:e.out_today}),(0,a.jsx)("td",{className:"px-3 py-2 text-green-600",children:e.in_today}),(0,a.jsx)("td",{className:"px-3 py-2 text-xs text-gray-400",children:k&&(0,a.jsx)("button",{type:"button",className:"text-red-600 hover:underline",onClick:()=>(async e=>{if(!k)return void window.alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0646\u0627\u0626\u0628 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647\u0645\u0627 \u062d\u0630\u0641 \u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a.");if(window.confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u0635\u0646\u0641\u061f \u0633\u064a\u062a\u0645 \u0641\u0642\u062f\u0627\u0646 \u0631\u0635\u064a\u062f\u0647 \u0627\u0644\u0645\u0631\u062a\u0628\u0637."))try{const{error:t}=await Or.from("laundry_items").delete().eq("id",e);if(t)throw t;await S()}catch(t){console.error("Failed to delete laundry item",t),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u0635\u0646\u0641: "+(t.message||t))}})(e.item_id),children:"\u062d\u0630\u0641"})})]},e.item_id))})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3 gap-4 flex-wrap",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg",children:"\u062d\u0631\u0643\u0627\u062a \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a"}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["\u0645\u0646",(0,a.jsx)("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:m,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("label",{className:"text-sm text-gray-600 flex items-center gap-1",children:["\u0625\u0644\u0649",(0,a.jsx)("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:f,onChange:e=>x(e.target.value)})]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:g,onChange:e=>v(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"\u0643\u0644 \u0627\u0644\u0623\u0635\u0646\u0627\u0641"}),(s||[]).map(e=>(0,a.jsxs)("option",{value:e.item_id,children:[e.code," - ",e.name]},e.item_id))]})]}),(0,a.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),j.item_id&&j.quantity)try{if(!k&&("in"===j.direction||"adjust"===j.direction))return void window.alert('\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0646\u0627\u0626\u0628 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647\u0645\u0627 \u062a\u0633\u062c\u064a\u0644 \u062d\u0631\u0643\u0627\u062a "\u062f\u062e\u0648\u0644" \u0623\u0648 "\u062a\u0633\u0648\u064a\u0629 \u0645\u062e\u0632\u0648\u0646". \u064a\u0645\u0643\u0646\u0643 \u0641\u0642\u0637 \u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c \u0623\u0648 \u0625\u0647\u0644\u0627\u0643.');const t={p_item_id:j.item_id,p_direction:j.direction,p_quantity:Number(j.quantity),p_note:j.note||null,p_staff_user_id:(null===e||void 0===e?void 0:e.id)||null},{error:n}=await Or.rpc("create_laundry_movement",t);if(n)throw n;N(e=>Le(Le({},e),{},{quantity:1,note:""})),await Promise.all([S(),C()])}catch(n){console.error("Failed to create laundry movement",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u062d\u0631\u0643\u0629 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a: "+(n.message||n))}},className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsxs)("select",{className:"border rounded px-2 py-1 min-w-[160px]",value:j.item_id,onChange:e=>N(t=>Le(Le({},t),{},{item_id:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0635\u0646\u0641\u064b\u0627"}),(s||[]).map(e=>(0,a.jsxs)("option",{value:e.item_id,children:[e.code," - ",e.name]},e.item_id))]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:j.direction,onChange:e=>N(t=>Le(Le({},t),{},{direction:e.target.value})),children:[(0,a.jsx)("option",{value:"out",children:"\u062e\u0631\u0648\u062c \u0625\u0644\u0649 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a"}),(0,a.jsx)("option",{value:"in",children:"\u0631\u062c\u0648\u0639 \u0645\u0646 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a"}),(0,a.jsx)("option",{value:"discard",children:"\u0625\u0647\u0644\u0627\u0643"}),k&&(0,a.jsx)("option",{value:"adjust",children:"\u062a\u0633\u0648\u064a\u0629 \u0645\u062e\u0632\u0648\u0646"})]}),(0,a.jsx)("input",{type:"number",min:"1",className:"border rounded px-2 py-1 w-20",value:j.quantity,onChange:e=>N(t=>Le(Le({},t),{},{quantity:e.target.value}))}),(0,a.jsx)("input",{className:"border rounded px-2 py-1 w-40",placeholder:"\u0645\u0644\u0627\u062d\u0638\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)",value:j.note,onChange:e=>N(t=>Le(Le({},t),{},{note:e.target.value}))}),(0,a.jsx)("button",{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1.5 rounded",children:"\u062a\u0633\u062c\u064a\u0644 \u062d\u0631\u0643\u0629 \u0644\u0627\u0646\u062f\u0631\u064a"})]})]}),(0,a.jsx)("div",{className:"bg-white rounded shadow overflow-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e/\u0627\u0644\u0648\u0642\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0635\u0646\u0641"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0627\u062a\u062c\u0627\u0647"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0643\u0645\u064a\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0646\u0638\u0627\u0645/\u0627\u0644\u0645\u0644\u0627\u062d\u0638\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0627\u0644\u0645\u0648\u0638\u0641"}),(0,a.jsx)("th",{className:"px-3 py-2 text-right",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,a.jsx)("tbody",{children:u?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-3 py-6 text-center text-gray-500",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u062d\u0631\u0643\u0627\u062a \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a..."})}):0===o.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-3 py-6 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u0631\u0643\u0627\u062a \u0641\u064a \u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062e\u062a\u0627\u0631\u0629."})}):o.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:new Date(e.created_at).toLocaleString()}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[e.item_code," - ",e.item_name]}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.direction}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.quantity}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.room_code||"\u2014"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.note||"\u2014"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.staff_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"}),(0,a.jsx)("td",{className:"px-3 py-2",children:k&&(0,a.jsx)("button",{type:"button",className:"text-red-600 hover:underline text-xs",onClick:()=>(async e=>{if(!k)return void window.alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0646\u0627\u0626\u0628 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647\u0645\u0627 \u062d\u0630\u0641 \u062d\u0631\u0643\u0627\u062a \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a.");if(window.confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u062d\u0631\u0643\u0629 \u0627\u0644\u0644\u0627\u0646\u062f\u0631\u064a \u0647\u0630\u0647\u061f"))try{const{error:t}=await Or.from("laundry_movements").delete().eq("id",e);if(t)throw t;await Promise.all([S(),C()])}catch(t){console.error("Failed to delete laundry movement",t),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u062d\u0631\u0643\u0629: "+(t.message||t))}})(e.id),children:"\u062d\u0630\u0641"})})]},e.id))})]})})]})]})}function Qs(e){let{onClose:t,onDone:n}=e;const s=(0,r.useContext)(la),[i,o]=(0,r.useState)("deposit"),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(!1),[p,f]=(0,r.useState)({cash:0,instapay:0,ecash:0}),[x,g]=(0,r.useState)(0),[v,b]=(0,r.useState)(0),[y,w]=(0,r.useState)(null),[_,j]=(0,r.useState)("cash"),[N,k]=(0,r.useState)("instapay"),[S,C]=(0,r.useState)(""),[E,T]=(0,r.useState)(""),[O,P]=(0,r.useState)(!1),I=R(s),A=async()=>{try{const{data:e,error:t}=await Or.from("accounting_transactions").select("direction,amount,payment_method,status").in("payment_method",["cash","instapay","other"]);if(t)throw t;let n=0,r=0,s=0,a=0,i=0;(e||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const o="income"===e.direction?t:-t;"cash"===e.payment_method?n+=o:"instapay"===e.payment_method?r+=o:s+=o,"pending"===e.status?a+=1:"confirmed"===e.status&&(i+=1)}),f({cash:n,instapay:r,ecash:s}),g(a),b(i);const{data:o,error:l}=await Or.from("accounting_transactions").select("id,tx_date,description,created_at").eq("source_type","transfer").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(l&&"PGRST116"!==l.code)throw l;w(o||null)}catch(e){console.error("load cashbox dashboard error",e)}};(0,r.useEffect)(()=>{A()},[]);const D=e=>"cash"===e?"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)":"instapay"===e?"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a":"\u0643\u0627\u0634 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a",L=e=>"cash"===e?"cash":"instapay"===e?"instapay":"other";return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-2 sm:p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-3xl max-h-[90vh] rounded-xl shadow-lg overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-amber-50 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-amber-900",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062e\u0632\u0646\u0629 \u0648\u0627\u0644\u0645\u062d\u0627\u0641\u0638"}),(0,a.jsx)("div",{className:"text-xs text-amber-700",children:"\u0639\u0631\u0636 \u0623\u0631\u0635\u062f\u0629 \u0627\u0644\u0643\u0627\u0634 \u0648 Instapay \u0648\u0627\u0644\u0643\u0627\u0634 \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u060c \u0648\u062a\u0633\u062c\u064a\u0644 \u0625\u064a\u062f\u0627\u0639/\u0633\u062d\u0628 \u0648\u062a\u062d\u0648\u064a\u0644\u0627\u062a \u062f\u0627\u062e\u0644\u064a\u0629"})]}),(0,a.jsx)("button",{type:"button",className:"text-sm text-gray-500",onClick:t,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsxs)("div",{className:"p-4 flex-1 overflow-y-auto flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-1",children:[(0,a.jsxs)("div",{className:"bg-amber-100 border border-amber-200 rounded-lg px-4 py-3 text-center md:col-span-2",children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0631\u0635\u064a\u062f \u0627\u0644\u0643\u0644\u064a"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-amber-900",children:[p.cash+p.instapay+p.ecash," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-sky-50 border border-sky-100 rounded-lg px-4 py-3 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-sky-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0639\u0644\u0651\u0642\u0629"}),(0,a.jsx)("div",{className:"text-xl font-semibold text-sky-900",children:x})]}),(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-100 rounded-lg px-4 py-3 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-emerald-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0624\u0643\u0651\u064e\u062f\u0629"}),(0,a.jsx)("div",{className:"text-xl font-semibold text-emerald-900",children:v})]})]}),y&&(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-lg px-4 py-3 text-xs text-purple-800",children:[(0,a.jsx)("div",{className:"font-semibold mb-1",children:"\u0622\u062e\u0631 \u0639\u0645\u0644\u064a\u0629 \u062a\u062d\u0648\u064a\u0644 \u062a\u0645\u062a"}),(0,a.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,a.jsx)("span",{children:y.description}),(0,a.jsxs)("span",{className:"text-[11px] text-purple-600",children:["\u0628\u062a\u0627\u0631\u064a\u062e ",y.tx_date," \u2013 \u062a\u0645 \u062a\u0633\u062c\u064a\u0644\u0647\u0627 \u0641\u064a ",y.created_at?new Date(y.created_at).toLocaleString("ar-EG"):""]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-100 rounded-lg px-4 py-3 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-amber-900",children:[p.cash," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-sky-50 border border-sky-100 rounded-lg px-4 py-3 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-sky-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-sky-900",children:[p.instapay," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-lg px-4 py-3 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-purple-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0643\u0627\u0634 \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-purple-900",children:[p.ecash," \u062c\u0646\u064a\u0647"]})]})]}),(0,a.jsxs)("div",{className:"mt-2 border-t pt-3 flex flex-col gap-2",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-amber-900 mb-1",children:"\u0639\u0645\u0644\u064a\u0629 \u0639\u0644\u0649 \u0627\u0644\u062e\u0632\u0646\u0629 \u0627\u0644\u0646\u0642\u062f\u064a\u0629 (\u0625\u064a\u062f\u0627\u0639 / \u0633\u062d\u0628)"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0646\u0648\u0639 \u0627\u0644\u0639\u0645\u0644\u064a\u0629"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:i,onChange:e=>o(e.target.value),children:[(0,a.jsx)("option",{value:"deposit",children:"\u0625\u064a\u062f\u0627\u0639 (+)"}),(0,a.jsx)("option",{value:"withdraw",children:"\u0633\u062d\u0628 (\u2212)"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("input",{type:"number",min:"0",className:"border rounded px-3 py-2 text-sm",value:l,onChange:e=>c(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0648\u0635\u0641 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,a.jsx)("textarea",{rows:3,className:"border rounded px-3 py-2 text-sm resize-none",value:d,onChange:e=>u(e.target.value)})]})]}),I&&(0,a.jsxs)("div",{className:"mt-3 border-t pt-3 flex flex-col gap-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("div",{className:"text-sm font-semibold text-purple-900",children:"\u062a\u062d\u0648\u064a\u0644 \u0631\u0635\u064a\u062f \u0628\u064a\u0646 \u0627\u0644\u0645\u062d\u0627\u0641\u0638 (\u0645\u062f\u064a\u0631 \u0641\u0642\u0637)"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-medium",children:"\u0645\u0646 \u0627\u0644\u0645\u062d\u0641\u0638\u0629"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:_,onChange:e=>j(e.target.value),children:[(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a"}),(0,a.jsx)("option",{value:"ecash",children:"\u0643\u0627\u0634 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-medium",children:"\u0625\u0644\u0649 \u0627\u0644\u0645\u062d\u0641\u0638\u0629"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:N,onChange:e=>k(e.target.value),children:[(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a"}),(0,a.jsx)("option",{value:"ecash",children:"\u0643\u0627\u0634 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-medium",children:"\u0645\u0628\u0644\u063a \u0627\u0644\u062a\u062d\u0648\u064a\u0644"}),(0,a.jsx)("input",{type:"number",min:"0",className:"border rounded px-3 py-2 text-sm",value:S,onChange:e=>C(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-medium",children:"\u0645\u0644\u0627\u062d\u0638\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a\u0629)"}),(0,a.jsx)("textarea",{rows:2,className:"border rounded px-3 py-2 text-sm resize-none",value:E,onChange:e=>T(e.target.value)})]}),(0,a.jsx)("div",{className:"flex justify-end mt-1",children:(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded text-sm text-white bg-purple-600 hover:bg-purple-700 disabled:opacity-60",onClick:async()=>{const e=Number(S||0);if(I)if(!e||e<=0)alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a \u062a\u062d\u0648\u064a\u0644 \u0635\u0627\u0644\u062d\u0627\u064b");else if(_!==N){P(!0);try{const t=(new Date).toISOString().slice(0,10),r="\u062a\u062d\u0648\u064a\u0644 \u062f\u0627\u062e\u0644\u064a \u0645\u0646 ".concat(D(_)," \u0625\u0644\u0649 ").concat(D(N)),a=E?"".concat(r," - ").concat(E):r,i=L(_),o=L(N),l={tx_date:t,category_id:null,bank_account_id:null,source_type:"transfer",reservation_id:null,description:a,status:"confirmed"};s&&s.id&&(l.created_by=s.id);const c=[Le(Le({},l),{},{direction:"expense",amount:e,payment_method:i}),Le(Le({},l),{},{direction:"income",amount:e,payment_method:o})],{error:d}=await Or.from("accounting_transactions").insert(c);if(d)throw d;C(""),T(""),await A(),n&&n()}catch(t){console.error("wallet transfer error",t),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0646\u0641\u064a\u0630 \u0639\u0645\u0644\u064a\u0629 \u0627\u0644\u062a\u062d\u0648\u064a\u0644: "+(t.message||t))}finally{P(!1)}}else alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0627\u062e\u062a\u0631 \u0645\u062d\u0641\u0638\u062a\u064a\u0646 \u0645\u062e\u062a\u0644\u0641\u062a\u064a\u0646 (\u0645\u0646 / \u0625\u0644\u0649).");else alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u062a\u0646\u0641\u064a\u0630 \u062a\u062d\u0648\u064a\u0644\u0627\u062a \u0627\u0644\u0623\u0631\u0635\u062f\u0629.")},disabled:O,children:O?"\u062c\u0627\u0631\u064d \u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u062a\u062d\u0648\u064a\u0644...":"\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u062a\u062d\u0648\u064a\u0644"})})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-2 border rounded text-sm",onClick:t,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded text-sm text-white bg-amber-600 hover:bg-amber-700 disabled:opacity-60",onClick:async()=>{const e=Number(l||0);if(!e||e<=0)alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a\u064b\u0627 \u0635\u0627\u0644\u062d\u064b\u0627");else{m(!0);try{const r="deposit"===i?"income":"expense";let a=null;try{const e="income"===r?"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0623\u062e\u0631\u0649":"\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0623\u062e\u0631\u0649",{data:t}=await Or.from("accounting_categories").select("id,name,type").eq("type","income"===r?"income":"expense").eq("name",e).limit(1);t&&t.length>0&&(a=t[0].id)}catch(t){}const o={tx_date:(new Date).toISOString().slice(0,10),direction:r,category_id:a,amount:e,payment_method:"cash",bank_account_id:null,source_type:"manual",reservation_id:null,description:d||("deposit"===i?"\u0639\u0645\u0644\u064a\u0629 \u0625\u064a\u062f\u0627\u0639 \u0641\u064a \u0627\u0644\u062e\u0632\u0646\u0629":"\u0639\u0645\u0644\u064a\u0629 \u0633\u062d\u0628 \u0645\u0646 \u0627\u0644\u062e\u0632\u0646\u0629"),status:"confirmed"};s&&s.id&&(o.created_by=s.id);const{error:l}=await Or.from("accounting_transactions").insert(o);if(l)throw l;await A(),n&&n()}catch(r){console.error("cashbox submit error",r),alert("\u062a\u0639\u0630\u0631 \u062d\u0641\u0638 \u0639\u0645\u0644\u064a\u0629 \u0627\u0644\u062e\u0632\u0646\u0629: "+(r.message||r))}finally{m(!1)}}},disabled:h,children:h?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638 \u0639\u0645\u0644\u064a\u0629 \u0627\u0644\u062e\u0632\u0646\u0629"})]})]})})}function Ys(e){let{onClose:t,onDone:n}=e;const s=(0,r.useContext)(la),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)("cash"),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(null),[p,f]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[v,b]=(0,r.useState)(""),[y,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{const[{data:e},{data:t}]=await Promise.all([Or.from("accounting_categories").select("id,name,type").eq("type","income").eq("active",!0),Or.from("bank_accounts").select("id,bank_name,account_name,active").eq("active",!0)]);f(e||[]),g(t||[]);const n=(e||[]).find(e=>"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0623\u062e\u0631\u0649"===e.name);n&&m(n.id)}catch(e){console.error("load income lookups error",e)}})()},[]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-md rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-emerald-50 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-emerald-900",children:"\u062a\u0633\u062c\u064a\u0644 \u0625\u064a\u0631\u0627\u062f \u062c\u062f\u064a\u062f"}),(0,a.jsx)("div",{className:"text-xs text-emerald-700",children:"\u0633\u062c\u0644 \u0623\u064a \u0625\u064a\u0631\u0627\u062f \u062e\u0627\u0631\u062c \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0628\u0627\u0634\u0631\u0629"})]}),(0,a.jsx)("button",{type:"button",className:"text-sm text-gray-500",onClick:t,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("input",{type:"number",min:"0",className:"border rounded px-3 py-2 text-sm",value:i,onChange:e=>o(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:l,onChange:e=>c(e.target.value),children:[(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"bank",children:"\u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629"}),(0,a.jsx)("option",{value:"other",children:"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629"})]})]}),"bank"===l&&(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:v,onChange:e=>b(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u062d\u0633\u0627\u0628\u064b\u0627"}),x.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.bank_name," - ",e.account_name]},e.id))]})]}),p.length>0&&(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0641\u0626\u0629 \u0627\u0644\u0625\u064a\u0631\u0627\u062f"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:h||"",onChange:e=>m(e.target.value||null),children:[(0,a.jsx)("option",{value:"",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0639\u0627\u0645\u0629"}),p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0648\u0635\u0641 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,a.jsx)("textarea",{rows:3,className:"border rounded px-3 py-2 text-sm resize-none",value:d,onChange:e=>u(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-2 border rounded text-sm",onClick:t,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded text-sm text-white bg-emerald-600 hover:bg-emerald-700 disabled:opacity-60",onClick:async()=>{const e=Number(i||0);if(!e||e<=0)alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a\u064b\u0627 \u0635\u0627\u0644\u062d\u064b\u0627");else if("bank"!==l||v){w(!0);try{const t={tx_date:(new Date).toISOString().slice(0,10),direction:"income",category_id:h||null,amount:e,payment_method:l,bank_account_id:"bank"===l?v:null,source_type:"manual",reservation_id:null,description:d||"\u0625\u064a\u0631\u0627\u062f \u064a\u062f\u0648\u064a",status:"confirmed"};s&&s.id&&(t.created_by=s.id);const{error:r}=await Or.from("accounting_transactions").insert(t);if(r)throw r;n&&n()}catch(t){console.error("save income error",t),alert("\u062a\u0639\u0630\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0625\u064a\u0631\u0627\u062f: "+(t.message||t))}finally{w(!1)}}else alert("\u0627\u062e\u062a\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643 \u0644\u0647\u0630\u0647 \u0627\u0644\u0639\u0645\u0644\u064a\u0629")},disabled:y,children:y?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0625\u064a\u0631\u0627\u062f"})]})]})})}function Xs(e){let{onClose:t,onSaved:n}=e;const s=(0,r.useContext)(la),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[x,g]=(0,r.useState)("EGP"),[v,b]=(0,r.useState)("0"),[y,w]=(0,r.useState)(""),[_,j]=(0,r.useState)(!1);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-md rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-sky-50 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sky-900",children:"\u0625\u0636\u0627\u0641\u0629 \u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a"}),(0,a.jsx)("div",{className:"text-xs text-sky-700",children:"\u0633\u062c\u0644 \u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0628\u0646\u0648\u0643 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u0629 \u0641\u064a \u0627\u0644\u0641\u0646\u062f\u0642"})]}),(0,a.jsx)("button",{type:"button",className:"text-sm text-gray-500",onClick:t,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0633\u0645 \u0627\u0644\u0628\u0646\u0643 *"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:i,onChange:e=>o(e.target.value),placeholder:"\u0645\u062b\u0627\u0644: \u0627\u0644\u0628\u0646\u0643 \u0627\u0644\u0623\u0647\u0644\u064a \u0627\u0644\u0645\u0635\u0631\u064a"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0633\u0645 \u0627\u0644\u062d\u0633\u0627\u0628 *"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:l,onChange:e=>c(e.target.value),placeholder:"\u0645\u062b\u0627\u0644: \u062d\u0633\u0627\u0628 \u0641\u0646\u062f\u0642 \u0627\u0644\u0643\u064a\u0644\u0627\u0646\u064a"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0631\u0642\u0645 \u0627\u0644\u062d\u0633\u0627\u0628 *"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:d,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"IBAN"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:h,onChange:e=>m(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Swift Code"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:p,onChange:e=>f(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0639\u0645\u0644\u0629"}),(0,a.jsx)("input",{type:"text",className:"border rounded px-3 py-2 text-sm",value:x,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0627\u0644\u0631\u0635\u064a\u062f \u0627\u0644\u0627\u0641\u062a\u062a\u0627\u062d\u064a"}),(0,a.jsx)("input",{type:"number",min:"0",className:"border rounded px-3 py-2 text-sm",value:v,onChange:e=>b(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),(0,a.jsx)("textarea",{rows:3,className:"border rounded px-3 py-2 text-sm resize-none",value:y,onChange:e=>w(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-2 border rounded text-sm",onClick:t,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded text-sm text-white bg-sky-600 hover:bg-sky-700 disabled:opacity-60",onClick:async()=>{if(!i||!l||!d)return void alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0623\u062f\u062e\u0644 \u0627\u0633\u0645 \u0627\u0644\u0628\u0646\u0643\u060c \u0627\u0633\u0645 \u0627\u0644\u062d\u0633\u0627\u0628\u060c \u0648\u0631\u0642\u0645 \u0627\u0644\u062d\u0633\u0627\u0628");const e=Number(v||0);if(Number.isNaN(e)||e<0)alert("\u0631\u0635\u064a\u062f \u0627\u0641\u062a\u062a\u0627\u062d\u064a \u063a\u064a\u0631 \u0635\u0627\u0644\u062d");else{j(!0);try{const t={bank_name:i,account_name:l,account_number:d,iban:h||null,swift_code:p||null,currency:x||"EGP",opening_balance:e,notes:y||null};s&&s.id&&(t.created_by=s.id);const{error:r}=await Or.from("bank_accounts").insert(t);if(r)throw r;n&&n()}catch(t){console.error("create bank account error",t),alert("\u062a\u0639\u0630\u0631 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a: "+(t.message||t))}finally{j(!1)}}},disabled:_,children:_?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u062d\u0633\u0627\u0628"})]})]})})}function Zs(e){let{onClose:t}=e;const[n,s]=(0,r.useState)([]),[i,o]=(0,r.useState)(!0),[l,c]=(0,r.useState)(!1),d=async()=>{o(!0);try{const{data:e,error:t}=await Or.from("bank_accounts_overview").select("*").order("created_at",{ascending:!0});if(t)throw t;s(e||[])}catch(e){console.error("load bank accounts error",e)}finally{o(!1)}};(0,r.useEffect)(()=>{d()},[]);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-sky-50 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sky-900",children:"\u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0628\u0646\u0648\u0643"}),(0,a.jsx)("div",{className:"text-xs text-sky-700",children:"\u0625\u062f\u0627\u0631\u0629 \u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0628\u0646\u0648\u0643 \u0627\u0644\u0645\u0631\u062a\u0628\u0637\u0629 \u0628\u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0627\u0644\u0645\u0627\u0644\u064a\u0629"})]}),(0,a.jsx)("button",{type:"button",className:"text-sm text-gray-500",onClick:t,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,a.jsx)("div",{className:"p-4 flex justify-between items-center",children:(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded text-sm text-white bg-sky-600 hover:bg-sky-700",onClick:()=>c(!0),children:"+ \u0625\u0636\u0627\u0641\u0629 \u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a"})}),(0,a.jsx)("div",{className:"px-4 pb-4",children:i?(0,a.jsx)("div",{className:"text-center text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a..."}):0===n.length?(0,a.jsx)("div",{className:"text-center text-gray-400 text-sm",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u0633\u0627\u0628\u0627\u062a \u0628\u0646\u0643\u064a\u0629 \u0645\u0633\u062c\u0644\u0629 \u0628\u0639\u062f."}):(0,a.jsx)("div",{className:"flex flex-col gap-3 max-h-[420px] overflow-y-auto",children:n.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-800",children:e.bank_name}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.account_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0631\u0642\u0645 \u0627\u0644\u062d\u0633\u0627\u0628: ",e.account_number]}),e.iban&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["IBAN: ",e.iban]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-1 min-w-[130px]",children:[(0,a.jsxs)("div",{className:"text-sm font-bold text-emerald-700",children:[Number(e.current_balance||0)," ",e.currency||"EGP"]}),(0,a.jsx)("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>(async e=>{if(window.confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a\u061f"))try{const{error:t}=await Or.from("bank_accounts").delete().eq("id",e);if(t)throw t;await d()}catch(t){console.error("delete bank account error",t),alert("\u062a\u0639\u0630\u0631 \u062d\u0630\u0641 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a (\u0631\u0628\u0645\u0627 \u0645\u0631\u062a\u0628\u0637 \u0628\u062d\u0631\u0643\u0627\u062a \u0645\u0627\u0644\u064a\u0629).")}})(e.id),children:"\u062d\u0630\u0641"})]})]},e.id))})}),l&&(0,a.jsx)(Xs,{onClose:()=>c(!1),onSaved:()=>{c(!1),d()}})]})})}function ea(){const[e,t]=(0,r.useState)("dashboard"),[n,s]=(0,r.useState)(!0),[i,o]=(0,r.useState)({todayIncome:0,todayExpense:0,todayNet:0,monthIncome:0,monthExpense:0,monthNet:0,receptionPending:0}),[l,c]=(0,r.useState)({cashConfirmed:0,cashPending:0,instapayConfirmed:0,instapayPending:0,eCashConfirmed:0,eCashPending:0}),[d,u]=(0,r.useState)(!1),[h,m]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),[x,g]=(0,r.useState)(!1),v=(0,r.useContext)(la),b=R(v),y=P(v),w=b||y,_=b||y||"reception"===(null===v||void 0===v?void 0:v.role),j=(0,r.useMemo)(()=>{try{return(new Date).toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}catch(e){return""}},[]);(0,r.useEffect)(()=>{!async function(){s(!0);try{const e=new Date,t=e.toISOString().slice(0,10),n=new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10),{data:r}=await Or.from("accounting_transactions").select("tx_date,direction,amount").eq("status","confirmed").neq("source_type","transfer").gte("tx_date",n).lte("tx_date",t);let s=0,a=0,i=0,l=0;(r||[]).forEach(e=>{const n=Number(e.amount||0);if(!n)return;const r="income"===e.direction;e.tx_date===t&&(r?s+=n:a+=n),r?i+=n:l+=n});const{data:d}=await Or.from("accounting_transactions").select("direction,amount,payment_method,status").eq("status","pending").in("payment_method",["cash","instapay","other"]);let u=0;(d||[]).forEach(e=>{const t=Number(e.amount||0);t&&("income"===e.direction?u+=t:u-=t)});const{data:h}=await Or.from("accounting_transactions").select("direction,amount,payment_method").eq("status","confirmed").in("payment_method",["cash","instapay","other"]);let m=0,p=0,f=0;(h||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n="income"===e.direction?t:-t;"cash"===e.payment_method?m+=n:"instapay"===e.payment_method?p+=n:f+=n});let x=0,g=0,v=0;(d||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n="income"===e.direction?t:-t;"cash"===e.payment_method?x+=n:"instapay"===e.payment_method?g+=n:v+=n}),o({todayIncome:s,todayExpense:a,todayNet:s-a,monthIncome:i,monthExpense:l,monthNet:i-l,receptionPending:u}),c({cashConfirmed:m,cashPending:x,instapayConfirmed:p,instapayPending:g,eCashConfirmed:f,eCashPending:v})}catch(e){console.error("loadStats error",e)}finally{s(!1)}}()},[]);const N=()=>{try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(e){}};(0,r.useEffect)(()=>{const e=()=>{(async()=>{try{const e=new Date,t=e.toISOString().slice(0,10),n=new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10),{data:r}=await Or.from("accounting_transactions").select("tx_date,direction,amount").eq("status","confirmed").neq("source_type","transfer").gte("tx_date",n).lte("tx_date",t);let s=0,a=0,i=0,l=0;(r||[]).forEach(e=>{const n=Number(e.amount||0);if(!n)return;const r="income"===e.direction;e.tx_date===t&&(r?s+=n:a+=n),r?i+=n:l+=n});const{data:d}=await Or.from("accounting_transactions").select("direction,amount,payment_method,status").eq("status","pending").in("payment_method",["cash","instapay","other"]);let u=0;(d||[]).forEach(e=>{const t=Number(e.amount||0);t&&("income"===e.direction?u+=t:u-=t)});const{data:h}=await Or.from("accounting_transactions").select("direction,amount,payment_method").eq("status","confirmed").in("payment_method",["cash","instapay","other"]);let m=0,p=0,f=0;(h||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n="income"===e.direction?t:-t;"cash"===e.payment_method?m+=n:"instapay"===e.payment_method?p+=n:f+=n});let x=0,g=0,v=0;(d||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n="income"===e.direction?t:-t;"cash"===e.payment_method?x+=n:"instapay"===e.payment_method?g+=n:v+=n}),o({todayIncome:s,todayExpense:a,todayNet:s-a,monthIncome:i,monthExpense:l,monthNet:i-l,receptionPending:u}),c({cashConfirmed:m,cashPending:x,instapayConfirmed:p,instapayPending:g,eCashConfirmed:f,eCashPending:v})}catch(e){console.error("reload stats error",e)}})()};try{window.addEventListener("accounting-tx-updated",e)}catch(t){}return()=>{try{window.removeEventListener("accounting-tx-updated",e)}catch(t){}}},[]);const k=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-emerald-700 mb-1",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-emerald-900",children:[i.todayIncome," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-rose-50 border border-rose-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-rose-700 mb-1",children:"\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-rose-900",children:[i.todayExpense," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-blue-700 mb-1",children:"\u0635\u0627\u0641\u064a \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-blue-900",children:[i.todayNet," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-indigo-700 mb-1",children:"\u0635\u0627\u0641\u064a \u0627\u0644\u0634\u0647\u0631 \u0627\u0644\u062d\u0627\u0644\u064a"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-indigo-900",children:[i.monthNet," \u062c\u0646\u064a\u0647"]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-4 text-center md:col-span-2",children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0645\u0628\u0627\u0644\u063a \u0627\u0644\u0645\u062c\u0645\u0651\u0639\u0629 \u0644\u062f\u0649 \u0627\u0644\u0631\u064a\u0633\u0628\u0634\u0646 (\u0641\u064a \u0627\u0646\u062a\u0638\u0627\u0631 \u0627\u0644\u062a\u0623\u0643\u064a\u062f)"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-amber-900",children:[i.receptionPending," \u062c\u0646\u064a\u0647"]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl mb-1",children:"\ud83d\udcb0"}),(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0643\u0627\u0634 (\u062e\u0632\u0646\u0629)"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:["\u0645\u0624\u0643\u0651\u064e\u062f: ",(0,a.jsxs)("span",{className:"font-semibold text-amber-900",children:[l.cashConfirmed," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0645\u0639\u0644\u0651\u0642: ",l.cashPending," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-sky-50 border border-sky-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl mb-1",children:"\ud83d\udcf2"}),(0,a.jsx)("div",{className:"text-xs text-sky-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:["\u0645\u0624\u0643\u0651\u064e\u062f: ",(0,a.jsxs)("span",{className:"font-semibold text-sky-900",children:[l.instapayConfirmed," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0645\u0639\u0644\u0651\u0642: ",l.instapayPending," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl mb-1",children:"\ud83d\udcb3"}),(0,a.jsx)("div",{className:"text-xs text-purple-700 mb-1",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0643\u0627\u0634 \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a (\u0641\u0648\u062f\u0627\u0641\u0648\u0646/\u0627\u062a\u0635\u0627\u0644\u0627\u062a/\u0623\u062e\u0631\u0649)"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-1",children:["\u0645\u0624\u0643\u0651\u064e\u062f: ",(0,a.jsxs)("span",{className:"font-semibold text-purple-900",children:[l.eCashConfirmed," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0645\u0639\u0644\u0651\u0642: ",l.eCashPending," \u062c\u0646\u064a\u0647"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[w&&(0,a.jsxs)("button",{type:"button",onClick:()=>u(!0),className:"bg-amber-50 hover:bg-amber-100 border border-amber-200 rounded-lg p-4 flex flex-col items-center justify-center gap-2 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"}),(0,a.jsx)("span",{className:"font-semibold text-amber-900",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062e\u0632\u0646\u0629"})]}),w&&(0,a.jsxs)("button",{type:"button",onClick:()=>m(!0),className:"bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg p-4 flex flex-col items-center justify-center gap-2 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc8"}),(0,a.jsx)("span",{className:"font-semibold text-emerald-900",children:"\u062a\u0633\u062c\u064a\u0644 \u0625\u064a\u0631\u0627\u062f"})]}),_&&(0,a.jsxs)("button",{type:"button",onClick:()=>f(!0),className:"bg-rose-50 hover:bg-rose-100 border border-rose-200 rounded-lg p-4 flex flex-col items-center justify-center gap-2 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc9"}),(0,a.jsx)("span",{className:"font-semibold text-rose-900",children:"\u062a\u0633\u062c\u064a\u0644 \u0645\u0635\u0631\u0648\u0641"})]}),w&&(0,a.jsxs)("button",{type:"button",onClick:()=>g(!0),className:"bg-sky-50 hover:bg-sky-100 border border-sky-200 rounded-lg p-4 flex flex-col items-center justify-center gap-2 transition",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83c\udfe6"}),(0,a.jsx)("span",{className:"font-semibold text-sky-900",children:"\u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0628\u0646\u0648\u0643"})]})]})]});return(0,a.jsxs)("div",{className:"flex flex-col gap-6 p-6 bg-gray-50 min-h-screen",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"bg-yellow-400 text-white px-4 py-2 rounded",children:"\u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629"}),(0,a.jsx)("button",{className:"bg-white border rounded p-2",title:"\u0627\u0644\u0625\u0634\u0639\u0627\u0631\u0627\u062a",children:(0,a.jsx)("span",{role:"img","aria-label":"\u062a\u0646\u0628\u064a\u0647",children:"\ud83d\udd14"})})]}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:j})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-1",children:"\u0627\u0644\u0646\u0638\u0627\u0645 \u0627\u0644\u0645\u062d\u0627\u0633\u0628\u064a \u0627\u0644\u0630\u0643\u064a"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0643\u0627\u0645\u0644\u0629 \u0644\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0627\u0644\u0645\u0627\u0644\u064a\u0629 \u0648\u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0627\u0644\u064a\u0648\u0645\u064a\u0629 \u0644\u0644\u0641\u0646\u062f\u0642."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 bg-white rounded-lg p-2 border",children:[(0,a.jsx)("button",{type:"button",onClick:()=>t("dashboard"),className:"px-4 py-2 rounded text-sm ".concat("dashboard"===e?"bg-blue-600 text-white":"bg-gray-50 text-gray-700 hover:bg-gray-100"),children:"\u0644\u0648\u062d\u0629 \u0627\u0644\u0645\u0639\u0644\u0648\u0645\u0627\u062a"}),w&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{type:"button",onClick:()=>t("transactions"),className:"px-4 py-2 rounded text-sm ".concat("transactions"===e?"bg-blue-600 text-white":"bg-gray-50 text-gray-700 hover:bg-gray-100"),children:"\u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a"}),(0,a.jsx)("button",{type:"button",onClick:()=>t("accounts-tree"),className:"px-4 py-2 rounded text-sm ".concat("accounts-tree"===e?"bg-blue-600 text-white":"bg-gray-50 text-gray-700 hover:bg-gray-100"),children:"\u0634\u062c\u0631\u0629 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a"}),(0,a.jsx)("button",{type:"button",onClick:()=>t("reports"),className:"px-4 py-2 rounded text-sm ".concat("reports"===e?"bg-blue-600 text-white":"bg-gray-50 text-gray-700 hover:bg-gray-100"),children:"\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631"})]})]}),n?(0,a.jsx)("div",{className:"bg-white rounded-lg p-6 text-center text-gray-500 border",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0645\u0644\u062e\u0635 \u0627\u0644\u0645\u062d\u0627\u0633\u0628\u0629..."}):(()=>{switch(e){case"dashboard":default:return k();case"transactions":return w?(0,a.jsx)(ta,{}):k();case"accounts-tree":return w?(0,a.jsx)(na,{}):k();case"reports":return w?(0,a.jsx)(ra,{}):k()}})(),d&&(0,a.jsx)(Qs,{onClose:()=>u(!1),onDone:()=>{u(!1),N()}}),h&&(0,a.jsx)(Ys,{onClose:()=>m(!1),onDone:()=>{m(!1),N()}}),p&&(0,a.jsx)(Pr,{onClose:()=>f(!1),onDone:()=>{f(!1),N()}}),x&&(0,a.jsx)(Zs,{onClose:()=>g(!1)})]})}function ta(){const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[v,b]=(0,r.useState)(0),[y,w]=(0,r.useState)(20),[_,j]=(0,r.useState)(0),[N,k]=(0,r.useState)([]),[S,C]=(0,r.useState)(""),[E,T]=(0,r.useState)([]),[O,I]=(0,r.useState)(""),[A,D]=(0,r.useState)(!1),L=r.useContext(la),M=R(L)||P(L),q=R(L);(0,r.useEffect)(()=>{const e=setTimeout(()=>c(i),350);return()=>clearTimeout(e)},[i]),(0,r.useEffect)(()=>{(async()=>{try{const{data:e}=await Or.from("accounting_categories").select("id,name,type").eq("active",!0).order("type",{ascending:!0});k(e||[])}catch(e){console.error("load accounting categories error",e)}})()},[]),(0,r.useEffect)(()=>{(async()=>{try{const{data:e}=await Or.from("staff_users_overview").select("id,full_name,username");T(e||[])}catch(e){console.error("load staff users for accounting error",e)}})()},[]);const U=r.useCallback(()=>{const e=Or.from("accounting_transactions").select("id,tx_date,direction,amount,payment_method,description,source_type,reservation_id,category_id,status,created_at,created_by,confirmed_at,confirmed_by",{count:"exact"}).order("tx_date",{ascending:!1}).order("created_at",{ascending:!1});A?(e.eq("direction","expense"),e.eq("status","pending"),e.eq("source_type","reservation")):(d&&e.eq("direction",d),h&&e.eq("payment_method",h),S&&e.eq("status",S),O&&e.eq("source_type",O)),p&&e.gte("tx_date",p),x&&e.lte("tx_date",x);const t=(l||"").trim();t&&e.ilike("description","%".concat(t,"%"));const n=v*y,r=n+y-1;return e.range(n,r),e},[l,d,h,S,O,p,x,v,y,A]),z=r.useCallback(async()=>{s(!0);try{const{data:e,error:n,count:r}=await U();if(n)throw n;t(e||[]),j(r||0)}catch(e){console.error("load accounting transactions error",e),t([]),j(0)}finally{s(!1)}},[U]);(0,r.useEffect)(()=>{z()},[z]),(0,r.useEffect)(()=>{const e=()=>{z()};try{window.addEventListener("accounting-tx-updated",e)}catch(t){}return()=>{try{window.removeEventListener("accounting-tx-updated",e)}catch(t){}}},[z]);const B=e=>{if(!e)return"-";const t=N.find(t=>t.id===e);return t?t.name:"-"},F=e=>{const t="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium";return"income"===e?(0,a.jsx)("span",{className:"".concat(t," bg-emerald-50 text-emerald-700 border border-emerald-200"),children:"\u0625\u064a\u0631\u0627\u062f"}):"expense"===e?(0,a.jsx)("span",{className:"".concat(t," bg-rose-50 text-rose-700 border border-rose-200"),children:"\u0645\u0635\u0631\u0648\u0641"}):null},W=e=>{if(!e)return"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f";const t=E.find(t=>t.id===e);return t?t.full_name||t.username||"\u0645\u0633\u062a\u062e\u062f\u0645":"\u0645\u0633\u062a\u062e\u062f\u0645 \u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"},V=e=>{const t="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium";return"confirmed"===e?(0,a.jsx)("span",{className:"".concat(t," bg-emerald-50 text-emerald-700 border border-emerald-200"),children:"\u0645\u0624\u0643\u0651\u064e\u062f"}):"pending"===e?(0,a.jsx)("span",{className:"".concat(t," bg-amber-50 text-amber-700 border border-amber-200"),children:"\u0645\u0639\u0644\u0651\u0642"}):"rejected"===e?(0,a.jsx)("span",{className:"".concat(t," bg-rose-50 text-rose-700 border border-rose-200"),children:"\u0645\u0631\u0641\u0648\u0636"}):null},H=e=>e&&"expense"===e.direction&&"reservation"===e.source_type;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-4",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,a.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,a.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,a.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full text-sm",placeholder:"\u0628\u062d\u062b \u0641\u064a \u0627\u0644\u0648\u0635\u0641",value:i,onChange:e=>{o(e.target.value),b(0)}})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:d,onChange:e=>{u(e.target.value),b(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u0623\u0646\u0648\u0627\u0639"}),(0,a.jsx)("option",{value:"income",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a"}),(0,a.jsx)("option",{value:"expense",children:"\u0645\u0635\u0631\u0648\u0641\u0627\u062a"})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:h,onChange:e=>{m(e.target.value),b(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0637\u0631\u0642 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"bank",children:"\u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629"}),(0,a.jsx)("option",{value:"other",children:"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629"})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:O,onChange:e=>{I(e.target.value),b(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u0645\u0635\u0627\u062f\u0631"}),(0,a.jsx)("option",{value:"reservation",children:"\u062d\u062c\u0648\u0632\u0627\u062a \u0641\u0642\u0637"}),(0,a.jsx)("option",{value:"manual",children:"\u0639\u0645\u0644\u064a\u0627\u062a \u064a\u062f\u0648\u064a\u0629"})]}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:S,onChange:e=>{C(e.target.value),b(0)},children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u062d\u0627\u0644\u0627\u062a"}),(0,a.jsx)("option",{value:"pending",children:"\u0645\u0639\u0644\u0651\u0642\u0629"}),(0,a.jsx)("option",{value:"confirmed",children:"\u0645\u0624\u0643\u0651\u064e\u062f\u0629"}),(0,a.jsx)("option",{value:"rejected",children:"\u0645\u0631\u0641\u0648\u0636\u0629"})]}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2 text-sm",value:p,onChange:e=>{f(e.target.value),b(0)}}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-2 text-sm",value:x,onChange:e=>{g(e.target.value),b(0)}}),(0,a.jsx)("button",{type:"button",onClick:()=>{D(e=>!e),b(0)},className:"px-3 py-2 rounded text-xs border whitespace-nowrap ".concat(A?"bg-sky-600 text-white border-sky-600":"bg-white text-sky-700 border-sky-300 hover:bg-sky-50"),children:"\u0637\u0644\u0628\u0627\u062a \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"})]}),n?(0,a.jsx)("div",{className:"py-12 text-center text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0627\u0644\u0645\u0627\u0644\u064a\u0629..."}):0===e.length?(0,a.jsx)("div",{className:"py-12 text-center text-gray-400 text-sm",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629 \u0644\u0644\u0628\u062d\u062b \u0627\u0644\u062d\u0627\u0644\u064a."}):(0,a.jsx)("div",{className:"overflow-x-auto border rounded bg-white",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{className:"text-right",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0648\u0639"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0641\u0626\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u062a\u0628\u0651\u0639"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>{return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-2 text-xs text-gray-600 whitespace-nowrap",children:e.tx_date}),(0,a.jsx)("td",{className:"px-3 py-2",children:F(e.direction)}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm",children:(0,a.jsxs)("div",{className:"flex flex-col items-start gap-0.5",children:[(0,a.jsx)("span",{children:B(e.category_id)}),H(e)&&(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-sky-50 text-sky-700 border border-sky-200",children:"\u0627\u0633\u062a\u0631\u062f\u0627\u062f \u062d\u062c\u0632"})]})}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm font-semibold ".concat("income"===e.direction?"text-emerald-700":"text-rose-700"),children:Number(e.amount||0)}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm text-gray-700",children:(t=e.payment_method,"cash"===t?"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)":"bank"===t?"\u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a":"instapay"===t?"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629":"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629")}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm",children:V(e.status)}),(0,a.jsxs)("td",{className:"px-3 py-2 text-[11px] text-gray-600 whitespace-nowrap",children:[(0,a.jsxs)("div",{children:["\u062a\u062d\u0635\u064a\u0644: ",W(e.created_by)]}),(0,a.jsx)("div",{className:"text-[10px] text-gray-400",children:e.created_at?new Date(e.created_at).toLocaleString("ar-EG"):""}),"confirmed"===e.status&&(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsxs)("div",{children:["\u062a\u0623\u0643\u064a\u062f: ",W(e.confirmed_by)]}),(0,a.jsx)("div",{className:"text-[10px] text-gray-400",children:e.confirmed_at?new Date(e.confirmed_at).toLocaleString("ar-EG"):""})]}),"rejected"===e.status&&(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsxs)("div",{children:["\u0631\u0641\u0636: ",W(e.confirmed_by)]}),(0,a.jsx)("div",{className:"text-[10px] text-gray-400",children:e.confirmed_at?new Date(e.confirmed_at).toLocaleString("ar-EG"):""})]})]}),(0,a.jsx)("td",{className:"px-3 py-2 text-sm max-w-xl whitespace-normal break-words",children:e.description}),(0,a.jsx)("td",{className:"px-3 py-2 text-xs text-right",children:"pending"===e.status&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[(0,a.jsx)("button",{type:"button",className:"px-2 py-1 rounded border text-xs bg-emerald-50 text-emerald-700 border-emerald-300 disabled:opacity-50",onClick:()=>(async e=>{if("expense"===e.direction&&!q)return void alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u0627\u0639\u062a\u0645\u0627\u062f \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a.");if("income"===e.direction&&!M)return void alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062a\u062d\u0635\u064a\u0644.");let t=null,n=null;if(H(e)){const e=window.prompt("\u0627\u0639\u062a\u0645\u0627\u062f \u0637\u0644\u0628 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062d\u062c\u0632:\n\n\u0627\u062e\u062a\u0631 \u0645\u0635\u062f\u0631 \u0635\u0631\u0641 \u0645\u0628\u0644\u063a \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f (\u0627\u0643\u062a\u0628 \u0631\u0642\u0645 \u0627\u0644\u062e\u064a\u0627\u0631):\n1) \u062e\u0632\u0646\u0629 \u0646\u0642\u062f\u064a\u0629 (cash)\n2) \u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629 (instapay)\n3) \u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629 (other)\n4) \u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a \u0645\u062d\u062f\u062f (bank)\n\n\u0627\u062a\u0631\u0643 \u0627\u0644\u062d\u0642\u0644 \u0641\u0627\u0631\u063a\u064b\u0627 \u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064a\u0629.","1");if(!e)return void alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0639\u062a\u0645\u0627\u062f \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f\u061b \u0644\u0645 \u064a\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629.");const s=String(e).trim();if("1"===s)t="cash";else if("2"===s)t="instapay";else if("3"===s)t="other";else{if("4"!==s)return void alert("\u0627\u062e\u062a\u064a\u0627\u0631 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d\u061b \u0644\u0645 \u064a\u062a\u0645 \u0627\u0639\u062a\u0645\u0627\u062f \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f.");try{const{data:e,error:r}=await Or.from("bank_accounts").select("id,bank_name,account_name,active").eq("active",!0);if(r)throw r;const s=e||[];if(0===s.length)return void alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u0633\u0627\u0628\u0627\u062a \u0628\u0646\u0643\u064a\u0629 \u0645\u0641\u0639\u0651\u0644\u0629 \u062d\u0627\u0644\u064a\u064b\u0627 \u0644\u0627\u062e\u062a\u064a\u0627\u0631\u0647\u0627 \u0643\u0645\u0635\u062f\u0631 \u0644\u0644\u0635\u0631\u0641.");const a=s.map((e,t)=>"".concat(t+1,") ").concat(e.bank_name," \u2014 ").concat(e.account_name)).join("\n"),i=window.prompt("\u0627\u062e\u062a\u0631 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a \u0627\u0644\u0630\u064a \u0633\u064a\u062a\u0645 \u0645\u0646\u0647 \u0635\u0631\u0641 \u0645\u0628\u0644\u063a \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f (\u0627\u0643\u062a\u0628 \u0631\u0642\u0645 \u0627\u0644\u0633\u0637\u0631):\n\n"+a+"\n\n\u0627\u062a\u0631\u0643 \u0627\u0644\u062d\u0642\u0644 \u0641\u0627\u0631\u063a\u064b\u0627 \u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064a\u0629.");if(!i)return void alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0639\u062a\u0645\u0627\u062f \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f\u061b \u0644\u0645 \u064a\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629.");const o=parseInt(i,10);if(!Number.isFinite(o)||o<1||o>s.length)return void alert("\u0627\u062e\u062a\u064a\u0627\u0631 \u063a\u064a\u0631 \u0635\u0627\u0644\u062d \u0644\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0628\u0646\u0643\u064a\u061b \u0644\u0645 \u064a\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629.");const l=s[o-1];t="bank",n=l.id}catch(r){return console.error("load bank accounts for refund confirm error",r),void alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u062d\u0645\u064a\u0644 \u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0628\u0646\u0643\u064a\u0629\u061b \u0644\u0645 \u064a\u062a\u0645 \u0627\u0639\u062a\u0645\u0627\u062f \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f.")}}}else if(!window.confirm("\u062a\u0623\u0643\u064a\u062f \u0627\u0633\u062a\u0644\u0627\u0645 \u0647\u0630\u0627 \u0627\u0644\u0645\u0628\u0644\u063a \u0648\u0627\u0639\u062a\u0645\u0627\u062f\u0647 \u0641\u064a \u0627\u0644\u062e\u0632\u0646\u0629 \u0648\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631\u061f"))return;try{const r={status:"confirmed",confirmed_at:(new Date).toISOString()};H(e)&&t&&(r.payment_method=t,r.bank_account_id="bank"===t&&n||null),L&&L.id&&(r.confirmed_by=L.id);const{error:a}=await Or.from("accounting_transactions").update(r).eq("id",e.id);if(a)throw a;try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(s){}await z()}catch(r){console.error("confirm transaction error",r),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0623\u0643\u064a\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0629: "+(r.message||r))}})(e),disabled:"expense"===e.direction?!q:!M,children:"income"===e.direction?"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u0627\u0633\u062a\u0644\u0627\u0645":H(e)?"\u0627\u0639\u062a\u0645\u0627\u062f \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f":"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u0645\u0635\u0631\u0648\u0641"}),(0,a.jsx)("button",{type:"button",className:"px-2 py-1 rounded border text-xs bg-rose-50 text-rose-700 border-rose-300 disabled:opacity-50",onClick:()=>(async e=>{if("expense"===e.direction&&!q)return void alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u0631\u0641\u0636 \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a.");if("income"===e.direction&&!M)return void alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u0623\u0648 \u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u0631\u0641\u0636 \u0647\u0630\u0647 \u0627\u0644\u0639\u0645\u0644\u064a\u0629.");if(window.confirm("\u0631\u0641\u0636 \u0647\u0630\u0647 \u0627\u0644\u0639\u0645\u0644\u064a\u0629 \u0648\u0639\u062f\u0645 \u0627\u062d\u062a\u0633\u0627\u0628\u0647\u0627 \u0641\u064a \u0627\u0644\u062e\u0632\u0646\u0629 \u0623\u0648 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631\u061f"))try{const n={status:"rejected",confirmed_at:(new Date).toISOString()};L&&L.id&&(n.confirmed_by=L.id);const{error:r}=await Or.from("accounting_transactions").update(n).eq("id",e.id);if(r)throw r;try{const e=new Event("accounting-tx-updated");window.dispatchEvent(e)}catch(t){}await z()}catch(n){console.error("reject transaction error",n),alert("\u062a\u0639\u0630\u0651\u0631 \u0631\u0641\u0636 \u0627\u0644\u0639\u0645\u0644\u064a\u0629: "+(n.message||n))}})(e),disabled:"expense"===e.direction?!q:!M,children:"income"===e.direction?"\u0631\u0641\u0636 \u0627\u0644\u062a\u062d\u0635\u064a\u0644":H(e)?"\u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062a\u0631\u062f\u0627\u062f":"\u0631\u0641\u0636 \u0627\u0644\u0645\u0635\u0631\u0648\u0641"})]})})]},e.id);var t})})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",e.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",_]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-sm",onClick:()=>b(e=>Math.max(0,e-1)),disabled:0===v,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,a.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",v+1]}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded text-sm",onClick:()=>b(e=>e+1),disabled:(v+1)*y>=_,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:y,onChange:e=>{w(Number(e.target.value)),b(0)},children:[(0,a.jsx)("option",{value:20,children:"20"}),(0,a.jsx)("option",{value:50,children:"50"})]})]})]})]})}function na(){const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)("income"),[d,u]=(0,r.useState)("#16a34a"),[h,m]=(0,r.useState)(!1),p=async()=>{s(!0);try{const{data:e,error:n}=await Or.from("accounting_categories").select("id,type,name,color,active").order("type",{ascending:!0}).order("name",{ascending:!0});if(n)throw n;t(e||[])}catch(e){console.error("load accounting categories error",e),t([])}finally{s(!1)}};(0,r.useEffect)(()=>{p()},[]);const f=async e=>{try{const{error:t}=await Or.from("accounting_categories").update({active:!e.active}).eq("id",e.id);if(t)throw t;await p()}catch(t){console.error("toggle accounting category error",t),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0641\u0626\u0629.")}},x=e.filter(e=>"income"===e.type),g=e.filter(e=>"expense"===e.type);return(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-4",dir:"rtl",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"\u0634\u062c\u0631\u0629 \u0627\u0644\u062d\u0633\u0627\u0628\u0627\u062a \u0627\u0644\u0645\u0628\u0633\u0651\u0637\u0629"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0641\u0626\u0627\u062a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0648\u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0627\u0644\u062a\u064a \u062a\u064f\u0633\u062a\u062e\u062f\u0645 \u0641\u064a \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0648\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631."})]}),(0,a.jsxs)("form",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-5",onSubmit:async e=>{e.preventDefault();const t=(i||"").trim();if(t){m(!0);try{const e={name:t,type:l,color:d||null,active:!0},{error:n}=await Or.from("accounting_categories").insert(e);if(n)throw n;o(""),await p()}catch(e){console.error("add accounting category error",e),alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0641\u0626\u0629.")}finally{m(!1)}}else alert("\u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0641\u0626\u0629.")},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0646\u0648\u0639 \u0627\u0644\u0641\u0626\u0629"}),(0,a.jsxs)("select",{className:"border rounded px-3 py-2 text-sm w-full",value:l,onChange:e=>c(e.target.value),children:[(0,a.jsx)("option",{value:"income",children:"\u0625\u064a\u0631\u0627\u062f"}),(0,a.jsx)("option",{value:"expense",children:"\u0645\u0635\u0631\u0648\u0641"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0641\u0626\u0629"}),(0,a.jsx)("input",{className:"border rounded px-3 py-2 text-sm w-full",value:i,onChange:e=>o(e.target.value),placeholder:"\u0645\u062b\u0627\u0644: \u0625\u064a\u062c\u0627\u0631 \u0642\u0627\u0639\u0629 / \u0643\u0647\u0631\u0628\u0627\u0621"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs mb-1",children:"\u0644\u0648\u0646 \u062a\u0648\u0636\u064a\u062d\u064a (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,a.jsx)("input",{type:"color",className:"border rounded px-2 py-2 text-sm w-full h-[38px]",value:d,onChange:e=>u(e.target.value)})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-emerald-600 text-white text-sm w-full",disabled:h,children:h?"\u062c\u0627\u0631\u064d \u0627\u0644\u0625\u0636\u0627\u0641\u0629...":"\u0625\u0636\u0627\u0641\u0629 \u0641\u0626\u0629"})})]}),n?(0,a.jsx)("div",{className:"py-10 text-center text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0641\u0626\u0627\u062a..."}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsx)("h3",{className:"text-sm font-semibold text-emerald-800",children:"\u0641\u0626\u0627\u062a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"})}),0===x.length?(0,a.jsx)("div",{className:"text-xs text-gray-400 py-3",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0641\u0626\u0627\u062a \u0625\u064a\u0631\u0627\u062f \u0628\u0639\u062f."}):(0,a.jsx)("div",{className:"border rounded divide-y bg-white",children:x.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:e.color||"#16a34a"}}),(0,a.jsx)("span",{className:"text-sm text-gray-800",children:e.name})]}),(0,a.jsx)("button",{type:"button",onClick:()=>f(e),className:"text-xs px-2 py-1 rounded border ".concat(e.active?"border-emerald-400 text-emerald-700 bg-emerald-50":"border-gray-300 text-gray-500 bg-gray-50"),children:e.active?"\u0645\u0641\u0639\u0651\u0644":"\u0645\u0648\u0642\u0648\u0641"})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsx)("h3",{className:"text-sm font-semibold text-rose-800",children:"\u0641\u0626\u0627\u062a \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a"})}),0===g.length?(0,a.jsx)("div",{className:"text-xs text-gray-400 py-3",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0641\u0626\u0627\u062a \u0645\u0635\u0631\u0648\u0641 \u0628\u0639\u062f."}):(0,a.jsx)("div",{className:"border rounded divide-y bg-white",children:g.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:e.color||"#ef4444"}}),(0,a.jsx)("span",{className:"text-sm text-gray-800",children:e.name})]}),(0,a.jsx)("button",{type:"button",onClick:()=>f(e),className:"text-xs px-2 py-1 rounded border ".concat(e.active?"border-emerald-400 text-emerald-700 bg-emerald-50":"border-gray-300 text-gray-500 bg-gray-50"),children:e.active?"\u0645\u0641\u0639\u0651\u0644":"\u0645\u0648\u0642\u0648\u0641"})]},e.id))})]})]})]})}function ra(){const[e,t]=(0,r.useState)(""),[n,s]=(0,r.useState)(""),[i,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)({income:0,expense:0,net:0}),[d,u]=(0,r.useState)([]),[h,m]=(0,r.useState)([]),[p,f]=(0,r.useState)([]),[x,g]=(0,r.useState)("overview"),[v,b]=(0,r.useState)({totalIn:0,totalOut:0,net:0,confirmedCount:0,pendingCount:0,transferCount:0}),[y,w]=(0,r.useState)([]),[_,j]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[S,C]=(0,r.useState)({confirmedTotal:0,pendingTotal:0,confirmedCount:0,pendingCount:0}),[E,T]=(0,r.useState)([]);(0,r.useEffect)(()=>{const e=new Date,n=e.toISOString().slice(0,10),r=new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10);t(r),s(n)},[]),(0,r.useEffect)(()=>{(async()=>{try{const{data:e}=await Or.from("accounting_categories").select("id,name,type").order("type",{ascending:!0}).order("name",{ascending:!0});f(e||[])}catch(e){console.error("load categories for reports error",e)}})()},[]);(0,r.useEffect)(()=>{e&&n&&("income-expense"===x?(async()=>{if(e&&n){o(!0);try{const{data:t,error:r}=await Or.from("accounting_transactions").select("direction,amount,payment_method,category_id,tx_date,status,source_type").eq("status","confirmed").neq("source_type","transfer").gte("tx_date",e).lte("tx_date",n);if(r)throw r;let s=0,a=0;const i=new Map,o=new Map;(t||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n="income"===e.direction;n?s+=t:a+=t;const r=e.category_id||"none";i.has(r)||i.set(r,{category_id:e.category_id,income:0,expense:0});const l=i.get(r);n?l.income+=t:l.expense+=t;const c=e.payment_method||"other";o.has(c)||o.set(c,{payment_method:c,income:0,expense:0});const d=o.get(c);n?d.income+=t:d.expense+=t}),c({income:s,expense:a,net:s-a}),u(Array.from(i.values())),m(Array.from(o.values()))}catch(t){console.error("load accounting reports error",t),c({income:0,expense:0,net:0}),u([]),m([])}finally{o(!1)}}})():"wallets"===x?(async()=>{if(e&&n){o(!0);try{let t=Or.from("accounting_transactions").select("id,tx_date,direction,amount,payment_method,status,source_type,description,created_at").gte("tx_date",e).lte("tx_date",n).in("payment_method",["cash","instapay","other"]).order("tx_date",{ascending:!1}).order("created_at",{ascending:!1});_&&(t=t.eq("payment_method",_)),N&&(t=t.eq("status",N));const{data:r,error:s}=await t;if(s)throw s;let a=0,i=0,o=0,l=0,c=0;(r||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n="income"===e.direction?t:-t;n>=0?a+=n:i+=-n,"confirmed"===e.status?o+=1:"pending"===e.status&&(l+=1),"transfer"===e.source_type&&(c+=1)}),b({totalIn:a,totalOut:i,net:a-i,confirmedCount:o,pendingCount:l,transferCount:c}),w(r||[])}catch(t){console.error("load wallet movements report error",t),b({totalIn:0,totalOut:0,net:0,confirmedCount:0,pendingCount:0,transferCount:0}),w([])}finally{o(!1)}}})():"refunds"===x&&(async()=>{if(e&&n){o(!0);try{const{data:t,error:r}=await Or.from("accounting_transactions").select("id,tx_date,amount,payment_method,status,source_type,direction,category_id,reservation_id,description").eq("direction","expense").eq("source_type","reservation").gte("tx_date",e).lte("tx_date",n).order("tx_date",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;let s=0,a=0,i=0,o=0;(t||[]).forEach(e=>{const t=Number(e.amount||0)||0;t&&("confirmed"===e.status?(s+=t,i+=1):"pending"===e.status&&(a+=t,o+=1))}),C({confirmedTotal:s,pendingTotal:a,confirmedCount:i,pendingCount:o}),T(t||[])}catch(t){console.error("load refund report error",t),C({confirmedTotal:0,pendingTotal:0,confirmedCount:0,pendingCount:0}),T([])}finally{o(!1)}}})())},[e,n,x,_,N]);const O=e=>{if(!e)return"\u0628\u062f\u0648\u0646 \u0641\u0626\u0629 \u0645\u062d\u062f\u062f\u0629";const t=p.find(t=>t.id===e);return t?t.name:"\u0641\u0626\u0629 \u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641\u0629"},R=e=>"cash"===e?"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)":"bank"===e?"\u062d\u0633\u0627\u0628 \u0628\u0646\u0643\u064a":"instapay"===e?"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629":"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629";return(0,a.jsx)("div",{className:"bg-white rounded-lg border p-4",dir:"rtl",children:"overview"===x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4 flex flex-col gap-2",children:(0,a.jsx)("div",{className:"flex items-center justify-between flex-wrap gap-2",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"\u0645\u0631\u0643\u0632 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u0645\u062d\u0627\u0633\u0628\u064a\u0629"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u0627\u062e\u062a\u0631 \u0646\u0648\u0639 \u0627\u0644\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0630\u064a \u062a\u0631\u064a\u062f \u0639\u0631\u0636\u0647 \u0645\u0646 \u0627\u0644\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062a\u0627\u0644\u064a\u0629."})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"border rounded-lg bg-gray-50 p-4 flex flex-col gap-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:"\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u0645\u0627\u0644\u064a\u0629"})}),(0,a.jsxs)("button",{type:"button",className:"w-full flex items-center justify-between px-3 py-2 rounded border bg-white text-sm hover:bg-emerald-50 hover:border-emerald-300 transition",onClick:()=>g("income-expense"),children:[(0,a.jsx)("span",{children:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0623\u0631\u0628\u0627\u062d \u0648\u0627\u0644\u062e\u0633\u0627\u0626\u0631 \u0644\u0644\u0641\u062a\u0631\u0629"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0648\u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a"})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg bg-gray-50 p-4 flex flex-col gap-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:"\u062a\u0642\u0627\u0631\u064a\u0631 \u062a\u0634\u063a\u064a\u0644\u064a\u0629 (\u0645\u062d\u0627\u0633\u0628\u0629)"})}),(0,a.jsxs)("button",{type:"button",className:"w-full flex items-center justify-between px-3 py-2 rounded border bg-white text-sm hover:bg-sky-50 hover:border-sky-300 transition",onClick:()=>g("wallets"),children:[(0,a.jsx)("span",{children:"\u062a\u0642\u0631\u064a\u0631 \u062d\u0631\u0643\u0629 \u0627\u0644\u062e\u0632\u0646\u0629 \u0648\u0627\u0644\u0645\u062d\u0627\u0641\u0638"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"\u062a\u062d\u0644\u064a\u0644 \u0627\u0644\u062a\u062d\u0635\u064a\u0644 \u0648\u0627\u0644\u0635\u0631\u0641 \u0648\u0627\u0644\u062a\u062d\u0648\u064a\u0644\u0627\u062a \u062d\u0633\u0628 \u0627\u0644\u0645\u062d\u0641\u0638\u0629"})]}),(0,a.jsxs)("button",{type:"button",className:"w-full flex items-center justify-between px-3 py-2 rounded border bg-white text-sm hover:bg-rose-50 hover:border-rose-300 transition",onClick:()=>g("refunds"),children:[(0,a.jsx)("span",{children:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"\u0645\u0644\u062e\u0635 \u0628\u0645\u0628\u0627\u0644\u063a \u0648\u0639\u062f\u062f \u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"})]})]})]})]}):"income-expense"===x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0623\u0631\u0628\u0627\u062d \u0648\u0627\u0644\u062e\u0633\u0627\u0626\u0631 \u0644\u0644\u0641\u062a\u0631\u0629"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u0645\u0644\u062e\u0635 \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0648\u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0644\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062e\u062a\u0627\u0631\u0629\u060c \u0645\u0639 \u062a\u0642\u0633\u064a\u0645 \u062d\u0633\u0628 \u0627\u0644\u0641\u0626\u0629 \u0648\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0645\u0646"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-1.5 text-sm",value:e,onChange:e=>t(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0625\u0644\u0649"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-1.5 text-sm",value:n,onChange:e=>s(e.target.value)})]}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded border text-xs bg-white hover:bg-gray-50",onClick:()=>g("overview"),children:"\u0627\u0644\u0631\u062c\u0648\u0639 \u0644\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631"})]})]}),i?(0,a.jsx)("div",{className:"py-10 text-center text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u062a\u0642\u0631\u064a\u0631..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-emerald-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-emerald-900",children:[l.income," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-rose-50 border border-rose-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-rose-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062a"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-rose-900",children:[l.expense," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-indigo-700 mb-1",children:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0628\u062d / \u0627\u0644\u062e\u0633\u0627\u0631\u0629"}),(0,a.jsxs)("div",{className:"text-xl font-bold ".concat(l.net>=0?"text-indigo-900":"text-rose-900"),children:[l.net," \u062c\u0646\u064a\u0647"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-700",children:"\u062d\u0633\u0628 \u0627\u0644\u0641\u0626\u0629"}),0===d.length?(0,a.jsx)("div",{className:"py-6 text-center text-xs text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0641\u062a\u0631\u0629."}):(0,a.jsxs)("table",{className:"min-w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-white",children:(0,a.jsxs)("tr",{className:"text-right text-gray-600",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0641\u0626\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0645\u0635\u0631\u0648\u0641\u0627\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0635\u0627\u0641\u064a"})]})}),(0,a.jsx)("tbody",{children:d.map(e=>{const t=(e.income||0)-(e.expense||0);return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-800",children:O(e.category_id)}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-emerald-700 font-semibold",children:e.income||0}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-rose-700 font-semibold",children:e.expense||0}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] font-semibold ".concat(t>=0?"text-indigo-800":"text-rose-800"),children:t})]},e.category_id||"none")})})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-700",children:"\u062d\u0633\u0628 \u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),0===h.length?(0,a.jsx)("div",{className:"py-6 text-center text-xs text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0641\u062a\u0631\u0629."}):(0,a.jsxs)("table",{className:"min-w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-white",children:(0,a.jsxs)("tr",{className:"text-right text-gray-600",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0645\u0635\u0631\u0648\u0641\u0627\u062a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0635\u0627\u0641\u064a"})]})}),(0,a.jsx)("tbody",{children:h.map(e=>{const t=(e.income||0)-(e.expense||0);return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-800",children:R(e.payment_method)}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-emerald-700 font-semibold",children:e.income||0}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-rose-700 font-semibold",children:e.expense||0}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] font-semibold ".concat(t>=0?"text-indigo-800":"text-rose-800"),children:t})]},e.payment_method)})})]})]})]})]})]}):"wallets"===x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"\u062a\u0642\u0631\u064a\u0631 \u062d\u0631\u0643\u0629 \u0627\u0644\u062e\u0632\u0646\u0629 \u0648\u0627\u0644\u0645\u062d\u0627\u0641\u0638"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u062d\u0631\u0643\u0629 \u0627\u0644\u062a\u062d\u0635\u064a\u0644 \u0648\u0627\u0644\u0635\u0631\u0641 \u0648\u0627\u0644\u062a\u062d\u0648\u064a\u0644\u0627\u062a \u0639\u0644\u0649 \u0627\u0644\u0643\u0627\u0634 \u0648 Instapay \u0648\u0627\u0644\u0643\u0627\u0634 \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a \u062e\u0644\u0627\u0644 \u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062e\u062a\u0627\u0631\u0629."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0645\u0646"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-1.5 text-sm",value:e,onChange:e=>t(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0625\u0644\u0649"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-1.5 text-sm",value:n,onChange:e=>s(e.target.value)})]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1.5 text-xs",value:_,onChange:e=>j(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u0645\u062d\u0627\u0641\u0638"}),(0,a.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a (\u062e\u0632\u0646\u0629)"}),(0,a.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a / \u0628\u0637\u0627\u0642\u0629 \u0628\u0646\u0643\u064a\u0629"}),(0,a.jsx)("option",{value:"other",children:"\u0645\u062d\u0641\u0638\u0629 \u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a\u0629"})]}),(0,a.jsxs)("select",{className:"border rounded px-2 py-1.5 text-xs",value:N,onChange:e=>k(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u062d\u0627\u0644\u0627\u062a"}),(0,a.jsx)("option",{value:"pending",children:"\u0645\u0639\u0644\u0651\u0642\u0629"}),(0,a.jsx)("option",{value:"confirmed",children:"\u0645\u0624\u0643\u062f\u0629"}),(0,a.jsx)("option",{value:"rejected",children:"\u0645\u0631\u0641\u0648\u0636\u0629"})]}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded border text-xs bg-white hover:bg-gray-50",onClick:()=>g("overview"),children:"\u0627\u0644\u0631\u062c\u0648\u0639 \u0644\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631"})]})]}),i?(0,a.jsx)("div",{className:"py-10 text-center text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u062a\u0642\u0631\u064a\u0631..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-emerald-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0628\u0627\u0644\u063a \u0627\u0644\u062f\u0627\u062e\u0644\u0629"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-emerald-900",children:[v.totalIn," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-rose-50 border border-rose-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-rose-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0628\u0627\u0644\u063a \u0627\u0644\u062e\u0627\u0631\u062c\u0629"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-rose-900",children:[v.totalOut," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-indigo-700 mb-1",children:"\u0635\u0627\u0641\u064a \u0627\u0644\u062d\u0631\u0643\u0629"}),(0,a.jsxs)("div",{className:"text-xl font-bold ".concat(v.net>=0?"text-indigo-900":"text-rose-900"),children:[v.net," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-purple-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u062a\u062d\u0648\u064a\u0644\u0627\u062a \u0627\u0644\u062f\u0627\u062e\u0644\u064a\u0629"}),(0,a.jsx)("div",{className:"text-xl font-bold text-purple-900",children:v.transferCount})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-sky-50 border border-sky-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-sky-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0624\u0643\u062f\u0629"}),(0,a.jsx)("div",{className:"text-xl font-bold text-sky-900",children:v.confirmedCount})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0639\u0644\u0651\u0642\u0629"}),(0,a.jsx)("div",{className:"text-xl font-bold text-amber-900",children:v.pendingCount})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-gray-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0639\u062f\u062f \u0627\u0644\u062d\u0631\u0643\u0627\u062a"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:y.length})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-700 flex items-center justify-between",children:[(0,a.jsx)("span",{children:"\u062a\u0641\u0627\u0635\u064a\u0644 \u062d\u0631\u0643\u0627\u062a \u0627\u0644\u062e\u0632\u0646\u0629 \u0648\u0627\u0644\u0645\u062d\u0627\u0641\u0638"}),(0,a.jsxs)("span",{className:"text-[11px] text-gray-400",children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0633\u062c\u0644\u0627\u062a: ",y.length]})]}),0===y.length?(0,a.jsx)("div",{className:"py-6 text-center text-xs text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u0631\u0643\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629 \u0644\u0644\u0641\u0644\u0627\u062a\u0631 \u0627\u0644\u062d\u0627\u0644\u064a\u0629."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-white",children:(0,a.jsxs)("tr",{className:"text-right text-gray-600",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0648\u0639"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u062d\u0641\u0638\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0635\u062f\u0631"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0648\u0635\u0641"})]})}),(0,a.jsx)("tbody",{children:y.map(e=>(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1.5 whitespace-nowrap text-[11px] text-gray-700",children:e.tx_date}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] font-semibold ".concat("income"===e.direction?"text-emerald-700":"text-rose-700"),children:"income"===e.direction?"\u062f\u062e\u0648\u0644":"\u062e\u0631\u0648\u062c"}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-800 font-semibold",children:Number(e.amount||0)}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700",children:R(e.payment_method)}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700",children:"confirmed"===e.status?"\u0645\u0624\u0643\u062f\u0629":"pending"===e.status?"\u0645\u0639\u0644\u0651\u0642\u0629":"\u0645\u0631\u0641\u0648\u0636\u0629"}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700",children:"transfer"===e.source_type?"\u062a\u062d\u0648\u064a\u0644 \u062f\u0627\u062e\u0644\u064a":"reservation"===e.source_type?"\u0645\u0646 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a":"\u0639\u0645\u0644\u064a\u0629 \u064a\u062f\u0648\u064a\u0629"}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700 max-w-xs whitespace-normal break-words",children:e.description})]},e.id))})]})})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"\u062a\u0642\u0631\u064a\u0631 \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u0645\u0644\u062e\u0635 \u0627\u0633\u062a\u0631\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a (\u0645\u0635\u0631\u0648\u0641\u0627\u062a \u0645\u0631\u062a\u0628\u0637\u0629 \u0628\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a) \u062e\u0644\u0627\u0644 \u0627\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062e\u062a\u0627\u0631\u0629."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0645\u0646"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-1.5 text-sm",value:e,onChange:e=>t(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"\u0625\u0644\u0649"}),(0,a.jsx)("input",{type:"date",className:"border rounded px-3 py-1.5 text-sm",value:n,onChange:e=>s(e.target.value)})]}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded border text-xs bg-white hover:bg-gray-50",onClick:()=>g("overview"),children:"\u0627\u0644\u0631\u062c\u0648\u0639 \u0644\u0642\u0627\u0626\u0645\u0629 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631"})]})]}),i?(0,a.jsx)("div",{className:"py-10 text-center text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u062a\u0642\u0631\u064a\u0631..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"bg-rose-50 border border-rose-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-rose-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0633\u062a\u0631\u062f\u0627\u062f\u0627\u062a \u0645\u0624\u0643\u062f\u0629"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-rose-900",children:[S.confirmedTotal," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0633\u062a\u0631\u062f\u0627\u062f\u0627\u062a \u0645\u0639\u0644\u0651\u0642\u0629"}),(0,a.jsxs)("div",{className:"text-xl font-bold text-amber-900",children:[S.pendingTotal," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-rose-50 border border-rose-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-rose-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0624\u0643\u062f\u0629"}),(0,a.jsx)("div",{className:"text-xl font-bold text-rose-900",children:S.confirmedCount})]}),(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-4 text-center",children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0644\u0645\u0639\u0644\u0651\u0642\u0629"}),(0,a.jsx)("div",{className:"text-xl font-bold text-amber-900",children:S.pendingCount})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold text-gray-700 flex items-center justify-between",children:[(0,a.jsx)("span",{children:"\u062a\u0641\u0627\u0635\u064a\u0644 \u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsxs)("span",{className:"text-[11px] text-gray-400",children:["\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0633\u062c\u0644\u0627\u062a: ",E.length]})]}),0===E.length?(0,a.jsx)("div",{className:"py-6 text-center text-xs text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0639\u0645\u0644\u064a\u0627\u062a \u0627\u0633\u062a\u0631\u062f\u0627\u062f \u0645\u0637\u0627\u0628\u0642\u0629 \u0644\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062e\u062a\u0627\u0631\u0629."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-white",children:(0,a.jsxs)("tr",{className:"text-right text-gray-600",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639 / \u0627\u0644\u0645\u062d\u0641\u0638\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0648\u0635\u0641"})]})}),(0,a.jsx)("tbody",{children:E.map(e=>(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-1.5 whitespace-nowrap text-[11px] text-gray-700",children:e.tx_date}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-rose-700 font-semibold",children:Number(e.amount||0)}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700",children:R(e.payment_method)}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700",children:"confirmed"===e.status?"\u0645\u0624\u0643\u062f\u0629":"pending"===e.status?"\u0645\u0639\u0644\u0651\u0642\u0629":"\u0645\u0631\u0641\u0648\u0636\u0629"}),(0,a.jsx)("td",{className:"px-3 py-1.5 text-[11px] text-gray-700 max-w-xs whitespace-normal break-words",children:e.description})]},e.id))})]})})]})]})]})})}function sa(){const[e,t]=(0,r.useState)(!0),[n,s]=(0,r.useState)({total:0,month:0,week:0,today:0}),[i,o]=(0,r.useState)({total:0,available:0,reserved:0,occupied:0,maintenance:0,occupancyRate:0}),[l,c]=(0,r.useState)({guestsCount:0,currentGuests:0,totalReservations:0}),[d,u]=(0,r.useState)({name:"-",count:0}),[h,m]=(0,r.useState)([]);(0,r.useEffect)(()=>{!async function(){t(!0);try{const t=new Date,a=t.toISOString().slice(0,10),i=new Date(t.getFullYear(),t.getMonth(),1),l=new Date(t);l.setDate(l.getDate()-6);const d=i.toISOString().slice(0,10),h=l.toISOString().slice(0,10);let p=0,f=0,x=0,g=0;try{const{data:e,error:t}=await Or.from("accounting_transactions").select("tx_date,amount").eq("direction","income").eq("status","confirmed").neq("source_type","transfer");if(t)throw t;(e||[]).forEach(e=>{const t=Number(e.amount||0);if(!t)return;const n=e.tx_date;p+=t,n>=d&&n<=a&&(f+=t),n>=h&&n<=a&&(x+=t),n===a&&(g+=t)})}catch(e){console.error("load revenue stats error",e)}s({total:p,month:f,week:x,today:g});let v=[];try{const{data:e,error:t}=await Or.from("rooms_overview").select("status,room_type_name_ar");if(t)throw t;v=e||[]}catch(n){console.warn("rooms_overview not available, fallback to rooms",(null===n||void 0===n?void 0:n.message)||n);try{const{data:e,error:t}=await Or.from("rooms").select("status");if(t)throw t;v=e||[]}catch(r){console.error("fallback rooms load failed",r),v=[]}}const b=v.length,y=v.filter(e=>"available"===e.status||"\u0645\u062a\u0627\u062d\u0629"===e.status).length,w=v.filter(e=>"reserved"===e.status||"\u0645\u062d\u062c\u0648\u0632\u0629"===e.status).length,_=v.filter(e=>"occupied"===e.status||"\u0645\u0634\u063a\u0648\u0644\u0629"===e.status).length,j=v.filter(e=>"maintenance"===e.status||"\u0635\u064a\u0627\u0646\u0629"===e.status).length,N=b&&_?Math.round(_/b*100):0;o({total:b,available:y,reserved:w,occupied:_,maintenance:j,occupancyRate:N});const k=new Map;(v||[]).forEach(e=>{const t=e.room_type_name_ar||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f";k.set(t,(k.get(t)||0)+1)});let S={name:"-",count:0};k.forEach((e,t)=>{e>S.count&&(S={name:t,count:e})}),u(S);let C=0;try{const{count:e}=await Or.from("guests").select("*",{count:"exact",head:!0});C=e||0}catch(e){console.error("load guests count error",e)}let E=0;try{const{count:e}=await Or.from("reservations").select("*",{count:"exact",head:!0});E=e||0}catch(e){console.error("load reservations count error",e)}let T=0;try{const{data:e}=await Or.from("reservations_overview").select("id,is_current");T=(e||[]).filter(e=>e.is_current).length}catch(e){console.error("load current guests error",e)}c({guestsCount:C,currentGuests:T,totalReservations:E});try{const{data:e}=await Or.from("reservations_overview").select("id,guest_name,room_label,check_in_date,total_amount").order("check_in_date",{ascending:!1}).limit(5);m(e||[])}catch(e){console.error("load latest reservations error",e),m([])}}catch(e){console.error("load reports dashboard error",e)}finally{t(!1)}}()},[]);const p=(()=>{try{return(new Date).toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}catch(e){return""}})();return e?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",dir:"rtl",children:(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0648\u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a..."})}):(0,a.jsxs)("div",{className:"flex flex-col gap-6 p-6 bg-gray-50 min-h-screen",dir:"rtl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"bg-yellow-400 text-white px-4 py-2 rounded",children:"\u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629"}),(0,a.jsx)("button",{className:"bg-white border rounded p-2",title:"\u0627\u0644\u0625\u0634\u0639\u0627\u0631\u0627\u062a",children:(0,a.jsx)("span",{role:"img","aria-label":"\u062a\u0646\u0628\u064a\u0647",children:"\ud83d\udd14"})})]}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:p})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-800 mb-1 flex items-center gap-2 justify-end",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\ud83d\udcca"}),(0,a.jsx)("span",{children:"\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0648\u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0646\u0638\u0631\u0629 \u0634\u0627\u0645\u0644\u0629 \u0639\u0644\u0649 \u0623\u062f\u0627\u0621 \u0627\u0644\u0641\u0646\u062f\u0642 \u0645\u0646 \u062d\u064a\u062b \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a\u060c \u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641\u060c \u0648\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"}),(0,a.jsx)("div",{className:"text-2xl",children:"\ud83d\udc8e"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[n.total," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-xl p-4 text-white shadow flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u0634\u0647\u0631"}),(0,a.jsx)("div",{className:"text-2xl",children:"\ud83d\udcc5"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[n.month," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-4 text-white shadow flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u0623\u0633\u0628\u0648\u0639"}),(0,a.jsx)("div",{className:"text-2xl",children:"\ud83d\udcca"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[n.week," \u062c\u0646\u064a\u0647"]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl p-4 text-white shadow flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u064a\u0648\u0645"}),(0,a.jsx)("div",{className:"text-2xl",children:"\ud83d\udd25"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[n.today," \u062c\u0646\u064a\u0647"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border border-amber-100 rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-amber-700 mb-1",children:"\u063a\u0631\u0641 \u0641\u064a \u0627\u0644\u0635\u064a\u0627\u0646\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-900",children:i.maintenance})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83d\udee0\ufe0f"})]}),(0,a.jsxs)("div",{className:"bg-white border border-purple-100 rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-purple-700 mb-1",children:"\u063a\u0631\u0641 \u0645\u062d\u062c\u0648\u0632\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-900",children:i.reserved})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83d\udcc6"})]}),(0,a.jsxs)("div",{className:"bg-white border border-rose-100 rounded-xl p-4 flex flex-col justify-between shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-rose-700 mb-1",children:"\u063a\u0631\u0641 \u0645\u0634\u063a\u0648\u0644\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-rose-900",children:i.occupied})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83d\udd34"})]}),(0,a.jsxs)("div",{className:"text-[11px] text-rose-600 mt-1",children:["\u0646\u0633\u0628\u0629 \u0627\u0644\u0625\u0634\u063a\u0627\u0644: ",i.occupancyRate,"% \u0645\u0646 ",i.total," \u063a\u0631\u0641\u0629"]})]}),(0,a.jsxs)("div",{className:"bg-white border border-emerald-100 rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-emerald-700 mb-1",children:"\u063a\u0631\u0641 \u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-emerald-900",children:i.available})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\u2705"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"\u0627\u0644\u0646\u0632\u0644\u0627\u0621 \u0627\u0644\u0645\u0633\u062c\u0651\u0644\u0648\u0646 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:l.guestsCount})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83d\udc65"})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"\u0627\u0644\u0646\u0632\u0644\u0627\u0621 \u0627\u0644\u062d\u0627\u0644\u064a\u0648\u0646 (\u062d\u062c\u0648\u0632\u0627\u062a \u0646\u0634\u0637\u0629)"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:l.currentGuests})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83d\udece\ufe0f"})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:l.totalReservations})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83d\udcd1"})]}),(0,a.jsxs)("div",{className:"bg-white border rounded-xl p-4 flex items-center justify-between shadow-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:i.total})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\ud83c\udfe8"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-6 flex flex-col md:flex-row items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"\u062a\u0648\u0632\u064a\u0639 \u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u063a\u0631\u0641"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\u0623\u0643\u062b\u0631 \u0646\u0648\u0639 \u063a\u0631\u0641 \u0645\u062a\u0648\u0641\u0631 \u062d\u0627\u0644\u064a\u064b\u0627 \u0641\u064a \u0627\u0644\u0641\u0646\u062f\u0642."})]}),(0,a.jsxs)("div",{className:"text-center md:text-right",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"\u0627\u0644\u0646\u0648\u0639 \u0627\u0644\u0623\u0643\u062b\u0631 \u0627\u0646\u062a\u0634\u0627\u0631\u064b\u0627"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-800",children:d.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641: ",d.count]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-800",children:"\u0622\u062e\u0631 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"\u0623\u062d\u062f\u062b 5 \u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0633\u062c\u0651\u0644\u0629 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645"})]}),0===h.length?(0,a.jsx)("div",{className:"py-6 text-center text-xs text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0633\u062c\u0651\u0644\u0629 \u0644\u0639\u0631\u0636\u0647\u0627."}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-xs",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{className:"text-right text-gray-600",children:[(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0631\u0642\u0645 \u0627\u0644\u062d\u062c\u0632"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0632\u064a\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644"}),(0,a.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0628\u0644\u063a"})]})}),(0,a.jsx)("tbody",{children:h.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-[11px] text-gray-700",children:e.id}),(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-[11px] text-gray-700",children:e.guest_name}),(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-[11px] text-gray-700",children:e.room_label}),(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-[11px] text-gray-700",children:e.check_in_date}),(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap text-[11px] text-gray-700",children:null!==(t=e.total_amount)&&void 0!==t?t:"-"})]},e.id)})})]})})]}),(0,a.jsxs)("div",{className:"text-center text-[11px] text-gray-400 mt-4 pb-2",children:["\u0646\u0638\u0627\u0645 \u0625\u062f\u0627\u0631\u0629 \u0641\u0646\u062f\u0642 \u0627\u0644\u0643\u064a\u0644\u0627\u0646\u064a \xa9 ",(new Date).getFullYear()]})]})}function aa(){const e=(0,r.useContext)(la),[t,n]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!0),[o,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)([]),[u,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{i(!0);try{const[{data:e,error:t},{data:r,error:s}]=await Promise.all([Or.from("system_settings").select("value").eq("key","auto_reception_shifts").maybeSingle(),Or.from("reception_shifts").select("id,shift_date,staff_user_id,expected_cash,counted_cash,difference,status,closed_at").eq("status","closed").order("shift_date",{ascending:!1}).order("closed_at",{ascending:!1}).limit(10)]);if(t&&"PGRST116"!==t.code)throw t;if(s&&"PGRST116"!==s.code)throw s;const a=!(!e||!e.value||!0!==e.value.enabled);n(a),d(r||[])}catch(e){console.error("load system settings/shift summary error",e)}finally{i(!1)}})()},[]);return R(e)?(0,a.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",dir:"rtl",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\u0625\u0639\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-4 flex flex-col gap-3 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold text-gray-800 text-sm",children:"\u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u062a\u0644\u0642\u0627\u0626\u064a\u064b\u0627"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"\u0639\u0646\u062f \u062a\u0641\u0639\u064a\u0644 \u0647\u0630\u0627 \u0627\u0644\u062e\u064a\u0627\u0631 \u0633\u064a\u062a\u0645 \u0641\u062a\u062d \u0648\u0631\u062f\u064a\u0629 \u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u062a\u0644\u0642\u0627\u0626\u064a\u064b\u0627 \u0644\u0645\u0648\u0638\u0641 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u0639\u0646\u062f \u0627\u0644\u062f\u062e\u0648\u0644 \u0644\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645 \u0636\u0645\u0646 \u0641\u062a\u0631\u0627\u062a \u0627\u0644\u0648\u0631\u062f\u064a\u0629: 8 \u0635 \u2013 4 \u0645\u060c 4 \u0645 \u2013 12 \u0635\u060c 12 \u0635 \u2013 8 \u0635."})]}),(0,a.jsx)("button",{type:"button",onClick:async()=>{if(!R(e))return void alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u062a\u0639\u062f\u064a\u0644 \u0625\u0639\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645.");const r=!t;l(!0);try{const t={key:"auto_reception_shifts",value:{enabled:r}};e&&e.id&&(t.updated_by=e.id);const{error:s}=await Or.from("system_settings").upsert(t);if(s)throw s;n(r)}catch(s){console.error("save system settings error",s),alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0627\u0644\u0625\u0639\u062f\u0627\u062f: "+(s.message||s))}finally{l(!1)}},disabled:s||o,className:"relative inline-flex h-6 w-11 items-center rounded-full border transition-colors ".concat(t?"bg-emerald-600 border-emerald-600":"bg-gray-200 border-gray-300"," ").concat(s||o?"opacity-60 cursor-not-allowed":"cursor-pointer"),children:(0,a.jsx)("span",{className:"inline-block h-5 w-5 transform rounded-full bg-white shadow transition-transform ".concat(t?"translate-x-5":"translate-x-1")})})]}),(s||o)&&(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"\u062c\u0627\u0631\u064d \u062a\u062d\u0645\u064a\u0644/\u062d\u0641\u0638 \u0627\u0644\u0625\u0639\u062f\u0627\u062f\u0627\u062a..."})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border p-4 flex flex-col gap-3",children:[R(e)&&(0,a.jsx)("div",{className:"mb-3 flex justify-end",children:(0,a.jsx)("button",{type:"button",className:"bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-700 transition text-sm",title:"\u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645",onClick:async()=>{const e=(new Date).toISOString().slice(0,10);if(window.confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645\u061f"))try{const{error:t}=await Or.from("reception_shifts").delete().eq("shift_date",e).eq("status","closed");if(t)throw t;alert("\u062a\u0645 \u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645 \u0628\u0646\u062c\u0627\u062d.")}catch(t){alert("\u062a\u0639\u0630\u0631 \u062d\u0630\u0641 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629: "+(t.message||t))}},children:"\u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-800 text-sm",children:"\u062a\u0633\u0644\u064a\u0645 \u0648\u0631\u062f\u064a\u0627\u062a \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u0646\u0642\u062f\u064a\u064b\u0627 \u0644\u0644\u0625\u062f\u0627\u0631\u0629"}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500",children:"\u0627\u0633\u062a\u062e\u062f\u0645 \u0647\u0630\u0647 \u0627\u0644\u0642\u0627\u0626\u0645\u0629 \u0644\u062a\u0633\u062c\u064a\u0644 \u0623\u0646 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0633\u0644\u0651\u0645\u062a \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0644\u0644\u0625\u062f\u0627\u0631\u0629."})]}),s?(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"\u062c\u0627\u0631\u064d \u062a\u062d\u0645\u064a\u0644 \u0622\u062e\u0631 \u0627\u0644\u0648\u0631\u062f\u0627\u062a \u0627\u0644\u0645\u063a\u0644\u0642\u0629..."}):0===c.length?(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0648\u0631\u062f\u064a\u0627\u062a \u0645\u063a\u0644\u0642\u0629 \u0645\u0624\u062e\u0631\u064b\u0627."}):(0,a.jsx)("div",{className:"overflow-x-auto max-h-64 text-xs",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 text-right text-gray-600",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0645\u0639\u0631\u0651\u0641 \u0627\u0644\u0648\u0631\u062f\u064a\u0629"}),(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0648\u0638\u0641"}),(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0627\u0644\u0645\u062a\u0648\u0642\u0651\u064e\u0639"}),(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0627\u0644\u0639\u062f\u0651 \u0627\u0644\u0641\u0639\u0644\u064a"}),(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0627\u0644\u0641\u0631\u0642"}),(0,a.jsx)("th",{className:"px-2 py-1.5",children:"\u0625\u062c\u0631\u0627\u0621"})]})}),(0,a.jsx)("tbody",{children:c.map(t=>{var n,r,s;return(0,a.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-2 py-1.5 whitespace-nowrap",children:t.shift_date}),(0,a.jsxs)("td",{className:"px-2 py-1.5 whitespace-nowrap text-[11px] text-gray-700",children:[t.id.slice(0,8),"..."]}),(0,a.jsx)("td",{className:"px-2 py-1.5 whitespace-nowrap text-[11px] text-blue-700 font-bold",children:t.staff_user_id}),(0,a.jsx)("td",{className:"px-2 py-1.5 whitespace-nowrap",children:Number(null!==(n=t.expected_cash)&&void 0!==n?n:0)}),(0,a.jsx)("td",{className:"px-2 py-1.5 whitespace-nowrap",children:Number(null!==(r=t.counted_cash)&&void 0!==r?r:0)}),(0,a.jsx)("td",{className:"px-2 py-1.5 whitespace-nowrap",children:Number(null!==(s=t.difference)&&void 0!==s?s:0)}),(0,a.jsxs)("td",{className:"px-2 py-1.5 whitespace-nowrap flex gap-2",children:[(0,a.jsx)("button",{type:"button",disabled:u,onClick:()=>(async t=>{var n,r;if(!R(e))return void alert("\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u062a\u0633\u062c\u064a\u0644 \u062a\u0633\u0644\u064a\u0645 \u0646\u0642\u062f\u064a \u0645\u0646 \u0627\u0644\u0648\u0631\u062f\u064a\u0629.");const s=Number(null!==(n=null!==(r=t.counted_cash)&&void 0!==r?r:t.expected_cash)&&void 0!==n?n:0)||0,a=window.prompt("\u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a \u0627\u0644\u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0646\u0642\u062f\u064a \u0645\u0646 \u0647\u0630\u0647 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0644\u0644\u0625\u062f\u0627\u0631\u0629 (\u062c\u0646\u064a\u0647).\n\u0627\u0644\u0642\u064a\u0645\u0629 \u0627\u0644\u0627\u0641\u062a\u0631\u0627\u0636\u064a\u0629 \u0628\u0646\u0627\u0621\u064b \u0639\u0644\u0649 \u0639\u062f\u0651 \u0627\u0644\u0648\u0631\u062f\u064a\u0629: ".concat(s),s?String(s):"");if(null===a)return;const i=String(a).replace(",","."),o=Number(i||0);if(o>=0){h(!0);try{const n={from_shift_id:t.id,to_manager_id:e.id,amount:o,tx_date:t.shift_date,note:"\u062a\u0633\u0644\u064a\u0645 \u0646\u0642\u062f\u064a \u0645\u0646 \u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644 \u0625\u0644\u0649 \u0627\u0644\u0625\u062f\u0627\u0631\u0629"};e&&e.id&&(n.created_by=e.id);const{error:r}=await Or.from("reception_shift_handovers").insert(n);if(r)throw r;alert("\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u062a\u0633\u0644\u064a\u0645 \u0627\u0644\u0646\u0642\u062f\u064a\u0629 \u0645\u0646 \u0647\u0630\u0647 \u0627\u0644\u0648\u0631\u062f\u064a\u0629 \u0644\u0644\u0625\u062f\u0627\u0631\u0629 \u0628\u0646\u062c\u0627\u062d.")}catch(l){console.error("save shift handover error",l),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062a\u0633\u0644\u064a\u0645: "+(l.message||l))}finally{h(!1)}}else alert("\u0645\u0646 \u0641\u0636\u0644\u0643 \u0623\u062f\u062e\u0644 \u0645\u0628\u0644\u063a\u064b\u0627 \u0631\u0642\u0645\u064a\u064b\u0627 \u0635\u0627\u0644\u062d\u064b\u0627.")})(t),className:"px-2 py-1 rounded bg-emerald-600 hover:bg-emerald-700 text-white text-[11px] disabled:opacity-60",children:"\u062a\u0633\u062c\u064a\u0644 \u062a\u0633\u0644\u064a\u0645 \u0644\u0644\u0625\u062f\u0627\u0631\u0629"}),R(e)&&(0,a.jsx)("button",{type:"button",className:"px-2 py-1 rounded bg-red-600 hover:bg-red-700 text-white text-[11px] disabled:opacity-60",title:"\u062d\u0630\u0641 \u0648\u0631\u062f\u064a\u0629 \u0647\u0630\u0627 \u0627\u0644\u0645\u0648\u0638\u0641 \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0627\u0644\u064a\u0648\u0645",onClick:async()=>{if(window.confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0645\u0648\u0638\u0641 (".concat(t.staff_user_id,") \u0627\u0644\u0645\u063a\u0644\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645\u061f")))try{const e=(new Date).toISOString().slice(0,10),{error:n}=await Or.from("reception_shifts").delete().eq("shift_date",e).eq("status","closed").eq("staff_user_id",t.staff_user_id);if(n)throw n;alert("\u062a\u0645 \u062d\u0630\u0641 \u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0645\u0648\u0638\u0641 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645 \u0628\u0646\u062c\u0627\u062d."),d(n=>n.filter(n=>!(n.shift_date===e&&"closed"===n.status&&n.staff_user_id===t.staff_user_id)))}catch(e){alert("\u062a\u0639\u0630\u0631 \u062d\u0630\u0641 \u0648\u0631\u062f\u064a\u0629 \u0627\u0644\u0645\u0648\u0638\u0641: "+(e.message||e))}},children:"\u062d\u0630\u0641 \u0648\u0631\u062f\u064a\u0629 \u0647\u0630\u0627 \u0627\u0644\u0645\u0648\u0638\u0641"})]})]},t.id)})})]})})]})]}):(0,a.jsxs)("div",{className:"p-6",dir:"rtl",children:[(0,a.jsx)("h1",{className:"text-xl font-bold mb-2",children:"\u0625\u0639\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\u0641\u0642\u0637 \u0627\u0644\u0645\u062f\u064a\u0631 \u064a\u0645\u0643\u0646\u0647 \u0627\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0647\u0630\u0647 \u0627\u0644\u0635\u0641\u062d\u0629."})]})}function ia(e){let{currentUser:t,onLogout:n}=e;const[s,i]=(0,r.useState)("dashboard");try{console.log("MainLayout mounted")}catch(o){}(0,r.useEffect)(()=>{const e=e=>(e||"").replace(/^\/+/,"").replace(/\/+$/,"").split("?")[0].split("#")[0],t="undefined"!==typeof window&&window.location&&window.location.pathname?window.location.pathname:"/dashboard",n=e(t)||"dashboard";n&&i(n);const r=()=>{try{const t=e(window.location.pathname)||"dashboard";console.log("popstate ->",t),i(t)}catch(o){}};try{window.addEventListener("popstate",r)}catch(o){}return()=>{try{window.removeEventListener("popstate",r)}catch(o){}}},[]);return(0,r.useEffect)(()=>{try{window.__hotelNavigate=e=>{try{console.log("__hotelNavigate ->",e)}catch(o){}i(e);try{window.history.pushState({},"","/".concat(e))}catch(o){}}}catch(o){}},[]),(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100 overflow-hidden",children:[(0,a.jsx)(A,{onNavigate:e=>{try{console.log("handleNavigate ->",e)}catch(o){}i(e)},currentUser:t,onLogout:n}),(0,a.jsx)("main",{className:"flex-1 h-screen overflow-y-auto",children:(()=>{try{console.log("Render page:",s)}catch(o){}switch(s){case"dashboard":return t&&"reception"===t.role?(0,a.jsx)(Xr,{}):(0,a.jsx)(Rr,{});case"buildings":return(0,a.jsx)(ns,{});case"floors":return(0,a.jsx)(is,{});case"room-types":return(0,a.jsx)(os,{});case"rooms":return(0,a.jsx)(cs,{});case"schedules":case"calendar":return(0,a.jsx)(ys,{});case"tashkeen":return(0,a.jsx)(Ss,{});case"guests":return(0,a.jsx)(Ps,{});case"reservations":return(0,a.jsx)(Us,{});case"checkin-out":return(0,a.jsx)(Gs,{});case"activity-log":return(0,a.jsx)(Vs,{});case"housekeeping":return(0,a.jsx)(Js,{});case"laundry":return(0,a.jsx)($s,{});case"accounting":return(0,a.jsx)(ea,{});case"reports":return(0,a.jsx)(sa,{});case"users":return(0,a.jsx)(Bs,{});case"settings":return(0,a.jsx)(aa,{});default:return(0,a.jsx)(Rr,{})}})()})]})}function oa(e){let{onLogin:t}=e;const[n,s]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1);return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center px-4",dir:"rtl",children:(0,a.jsxs)("div",{className:"max-w-5xl w-full grid grid-cols-1 md:grid-cols-2 bg-white/95 rounded-2xl shadow-2xl overflow-hidden border border-slate-200",children:[(0,a.jsxs)("div",{className:"hidden md:flex flex-col justify-between bg-gradient-to-b from-indigo-700 via-indigo-800 to-slate-900 text-white p-8 relative",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center text-2xl",children:"\ud83c\udfe8"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"\u0641\u0646\u062f\u0642 \u0627\u0644\u0643\u064a\u0644\u0627\u0646\u064a"}),(0,a.jsx)("div",{className:"text-xs text-indigo-100/80",children:"\u0646\u0638\u0627\u0645 \u0625\u062f\u0627\u0631\u0629 \u0648\u062a\u0634\u063a\u064a\u0644 \u0645\u062a\u0643\u0627\u0645\u0644 \u0644\u0644\u0641\u0646\u0627\u062f\u0642"})]})]}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-3",children:"\u0645\u0631\u062d\u0628\u064b\u0627 \u0628\u0643 \u0641\u064a \u0644\u0648\u062d\u0629 \u062a\u062d\u0643\u0645 \u0627\u0644\u0641\u0646\u062f\u0642"}),(0,a.jsx)("p",{className:"text-sm text-indigo-100/90 mb-6 leading-relaxed",children:"\u0642\u0645 \u0628\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644 \u0644\u0627\u0633\u062a\u062e\u062f\u0627\u0645 \u0646\u0638\u0627\u0645 \u0627\u0644\u062d\u062c\u0632\u060c \u062a\u0648\u0632\u064a\u0639 \u0627\u0644\u063a\u0631\u0641\u060c \u0645\u062a\u0627\u0628\u0639\u0629 \u0627\u0644\u0646\u0632\u0644\u0627\u0621\u060c \u0648\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631 \u0627\u0644\u064a\u0648\u0645\u064a\u0629\u060c \u0645\u0639 \u0635\u0644\u0627\u062d\u064a\u0627\u062a \u0645\u062e\u0635\u0651\u0635\u0629 \u0644\u0643\u0644 \u062f\u0648\u0631 \u0641\u064a \u0627\u0644\u0641\u0631\u064a\u0642."}),(0,a.jsxs)("div",{className:"space-y-3 text-xs text-indigo-100/90",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"mt-0.5",children:"\u2022"}),(0,a.jsx)("span",{children:"\u0645\u062a\u0627\u0628\u0639\u0629 \u0627\u0644\u0625\u0634\u063a\u0627\u0644 \u0627\u0644\u064a\u0648\u0645\u064a \u0644\u0644\u063a\u0631\u0641 \u0648\u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629 \u0645\u0646 \u0634\u0627\u0634\u0629 \u0627\u0644\u062a\u0633\u0643\u064a\u0646."})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"mt-0.5",children:"\u2022"}),(0,a.jsx)("span",{children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a\u060c \u0627\u0644\u0641\u0648\u0627\u062a\u064a\u0631\u060c \u0648\u0627\u0644\u0645\u062f\u0641\u0648\u0639\u0627\u062a \u0645\u0646 \u0645\u0643\u0627\u0646 \u0648\u0627\u062d\u062f."})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"mt-0.5",children:"\u2022"}),(0,a.jsx)("span",{children:"\u0635\u0644\u0627\u062d\u064a\u0627\u062a \u0645\u062e\u062a\u0644\u0641\u0629 \u0644\u0644\u0645\u062f\u064a\u0631\u060c \u0645\u0633\u0627\u0639\u062f \u0627\u0644\u0645\u062f\u064a\u0631\u060c \u0627\u0644\u0627\u0633\u062a\u0642\u0628\u0627\u0644\u060c \u0648\u062e\u062f\u0645\u0629 \u0627\u0644\u063a\u0631\u0641."})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 text-[11px] text-indigo-100/70",children:["\xa9 ",(new Date).getFullYear()," \u0641\u0646\u062f\u0642 \u0627\u0644\u0643\u064a\u0644\u0627\u0646\u064a \u2013 \u0646\u0638\u0627\u0645 \u0625\u062f\u0627\u0631\u0629 \u062f\u0627\u062e\u0644\u064a"]})]}),(0,a.jsxs)("div",{className:"p-6 sm:p-8 bg-white",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 mb-1",children:"\u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-slate-500",children:"\u0627\u062e\u062a\u0631 \u062f\u0648\u0631\u0643 \u0641\u064a \u0627\u0644\u0641\u0646\u062f\u0642 \u062b\u0645 \u0623\u062f\u062e\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u062f\u062e\u0648\u0644."})]}),(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),c(""),n&&i)try{u(!0);const{data:e,error:r}=await Or.rpc("login_staff_user",{p_username:n,p_password:i});if(r)return console.error("login_staff_user error",r),void c(r.message||"\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644\u060c \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.");const s=Array.isArray(e)&&e.length>0?e[0]:null;if(!s)return void c("\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0623\u0648 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d\u0629.");const a={id:s.id,username:s.username,name:s.full_name,role:s.role,loggedAt:(new Date).toISOString()};t&&t(a)}catch(r){c("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u062e\u0648\u0644\u060c \u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.")}finally{u(!1)}else c("\u064a\u0631\u062c\u0649 \u0625\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0648\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631.")},className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm text-slate-700 mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 / \u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"}),(0,a.jsx)("input",{type:"text",className:"w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"\u0645\u062b\u0627\u0644: x2008666@gmail.com \u0623\u0648 receptionist01",value:n,onChange:e=>s(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm text-slate-700 mb-1",children:"\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"}),(0,a.jsx)("input",{type:"password",className:"w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",value:i,onChange:e=>o(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs sm:text-sm text-slate-700 mb-2",children:"\u0623\u062f\u0648\u0627\u0631 \u0627\u0644\u0646\u0638\u0627\u0645 \u0627\u0644\u0645\u062a\u0627\u062d\u0629"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:C.map(e=>(0,a.jsxs)("div",{className:"text-right border rounded-lg px-3 py-2 text-xs sm:text-sm bg-slate-50 text-slate-700 shadow-sm",children:[(0,a.jsx)("div",{className:"font-semibold mb-0.5",children:e.label}),(0,a.jsx)("div",{className:"text-[11px] text-slate-500 leading-relaxed",children:e.description})]},e.id))}),(0,a.jsx)("p",{className:"mt-2 text-[11px] text-slate-500",children:"\u064a\u062a\u0645 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u062f\u0648\u0631 \u062a\u0644\u0642\u0627\u0626\u064a\u064b\u0627 \u062d\u0633\u0628 \u0627\u0644\u062d\u0633\u0627\u0628 \u0627\u0644\u0645\u0633\u062c\u0651\u064e\u0644 \u0641\u064a \u0627\u0644\u0646\u0638\u0627\u0645\u060c \u0648\u0644\u0627 \u064a\u0645\u0643\u0646 \u062a\u063a\u064a\u064a\u0631\u0647 \u0645\u0646 \u0634\u0627\u0634\u0629 \u0627\u0644\u062f\u062e\u0648\u0644."})]}),l&&(0,a.jsx)("div",{className:"text-xs text-red-600 bg-red-50 border border-red-100 rounded px-3 py-2",children:l}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"w-full inline-flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-70 disabled:cursor-not-allowed text-white text-sm font-semibold rounded-lg px-4 py-2.5 shadow-sm mt-1",children:d?"\u062c\u0627\u0631\u064a \u0627\u0644\u062f\u062e\u0648\u0644...":"\u062f\u062e\u0648\u0644 \u0625\u0644\u0649 \u0627\u0644\u0646\u0638\u0627\u0645"})]}),(0,a.jsx)("div",{className:"mt-6 text-[11px] text-slate-400 leading-relaxed",children:"\u0645\u0644\u0627\u062d\u0638\u0629: \u064a\u062a\u0645 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0648\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631 \u0645\u0646 \u0642\u0627\u0639\u062f\u0629 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0648\u0638\u0641\u064a\u0646 \u0627\u0644\u062f\u0627\u062e\u0644\u064a\u0629. \u062d\u0633\u0627\u0628 \u0627\u0644\u0645\u062f\u064a\u0631 \u0627\u0644\u0631\u0626\u064a\u0633\u064a \u0647\u0648 \u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a \u0627\u0644\u0645\u062e\u0635\u0635 \u0644\u0647 \u0641\u0642\u0637."})]})]})})}const la=(0,r.createContext)(null);function ca(){const[e,t]=(0,r.useState)(()=>{try{const e=window.localStorage.getItem("kelany_staff_user");return e?JSON.parse(e):null}catch(e){return null}});(0,r.useEffect)(()=>{try{e?window.localStorage.setItem("kelany_staff_user",JSON.stringify(e)):window.localStorage.removeItem("kelany_staff_user")}catch(t){}},[e]);const n=e=>{t(e);try{window.history.pushState({},"","/dashboard")}catch(n){}};return e?(0,a.jsx)(la.Provider,{value:e,children:(0,a.jsx)("div",{className:"font-sans",dir:"rtl",children:(0,a.jsx)(ia,{currentUser:e,onLogout:()=>{t(null);try{window.history.pushState({},"","/")}catch(e){}}})})}):(0,a.jsx)(la.Provider,{value:null,children:(0,a.jsx)(oa,{onLogin:n})})}s.createRoot(document.getElementById("root")).render((0,a.jsx)(r.StrictMode,{children:(0,a.jsx)(ca,{})}))})();
//# sourceMappingURL=main.d142a7d1.js.map