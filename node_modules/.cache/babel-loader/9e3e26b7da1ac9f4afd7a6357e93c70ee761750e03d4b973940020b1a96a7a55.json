{"ast":null,"code":"import _objectSpread from\"F:/kelany/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{supabase}from'../supabaseClient';import RoomCard from'../components/RoomCard';import FloorModal from'../components/FloorModal';import{HotelIcon,RoomsTotalIcon,RoomsAvailableIcon,RoomsReservedIcon,RoomsOccupiedIcon,RoomsMaintenanceIcon,MaintenanceIcon}from'../components/Icons';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Floors(){const[buildings,setBuildings]=useState([]);const[selectedBuilding,setSelectedBuilding]=useState(null);const[floors,setFloors]=useState([]);const[rooms,setRooms]=useState([]);const[loading,setLoading]=useState(true);const[showFloorModal,setShowFloorModal]=useState(false);const[editingFloor,setEditingFloor]=useState(null);const loadBuildings=async()=>{const{data,error}=await supabase.from('buildings').select('*').order('created_at',{ascending:false});if(!error){setBuildings(data||[]);if(!selectedBuilding&&data&&data.length)setSelectedBuilding(data[0]);}};const loadData=async buildingId=>{setLoading(true);try{const{data:fdata,error:ferr}=await supabase.from('building_floor_overview').select('*').eq('building_id',buildingId).order('floor_number',{ascending:true});let mergedFloors=fdata||[];// Also fetch the raw floors rows to get any new columns (name, maintenance_note, capacity, needs_inspection)\ntry{const{data:tableFloors,error:tfErr}=await supabase.from('floors').select('*').eq('building_id',buildingId);if(!tfErr&&tableFloors){// build map by id and by floor_number\nconst byId=new Map(tableFloors.map(r=>[String(r.id),r]));const byNumber=new Map(tableFloors.map(r=>[String(r.floor_number),r]));mergedFloors=(mergedFloors||[]).map(f=>{const tableRow=f.floor_id&&byId.has(String(f.floor_id))?byId.get(String(f.floor_id)):byNumber.has(String(f.floor_number))?byNumber.get(String(f.floor_number)):null;if(tableRow){var _tableRow$floor_numbe,_ref,_tableRow$floor_name,_tableRow$name,_tableRow$status,_tableRow$description,_tableRow$maintenance,_tableRow$capacity,_tableRow$needs_inspe;return _objectSpread(_objectSpread({},f),{},{// prefer table values for new fields\nfloor_id:tableRow.id||f.floor_id,floor_number:(_tableRow$floor_numbe=tableRow.floor_number)!==null&&_tableRow$floor_numbe!==void 0?_tableRow$floor_numbe:f.floor_number,floor_name:(_ref=(_tableRow$floor_name=tableRow.floor_name)!==null&&_tableRow$floor_name!==void 0?_tableRow$floor_name:tableRow.name)!==null&&_ref!==void 0?_ref:f.floor_name,name:(_tableRow$name=tableRow.name)!==null&&_tableRow$name!==void 0?_tableRow$name:f.name,status:(_tableRow$status=tableRow.status)!==null&&_tableRow$status!==void 0?_tableRow$status:f.status,description:(_tableRow$description=tableRow.description)!==null&&_tableRow$description!==void 0?_tableRow$description:f.description,maintenance_note:(_tableRow$maintenance=tableRow.maintenance_note)!==null&&_tableRow$maintenance!==void 0?_tableRow$maintenance:f.maintenance_note,capacity:(_tableRow$capacity=tableRow.capacity)!==null&&_tableRow$capacity!==void 0?_tableRow$capacity:f.capacity,needs_inspection:(_tableRow$needs_inspe=tableRow.needs_inspection)!==null&&_tableRow$needs_inspe!==void 0?_tableRow$needs_inspe:f.needs_inspection});}return f;});// include any table rows that are not present in the view\nconst existingIds=new Set((mergedFloors||[]).map(x=>String(x.floor_id||x.id)));for(const tr of tableFloors){if(!existingIds.has(String(tr.id))){var _tr$floor_name;mergedFloors.push({floor_id:tr.id,building_id:tr.building_id,floor_number:tr.floor_number,floor_name:(_tr$floor_name=tr.floor_name)!==null&&_tr$floor_name!==void 0?_tr$floor_name:tr.name,name:tr.name,status:tr.status,description:tr.description,maintenance_note:tr.maintenance_note,capacity:tr.capacity,needs_inspection:tr.needs_inspection});}}}}catch(e){console.warn('Failed fetching raw floors rows',e);}if(!ferr)setFloors(mergedFloors||[]);const{data:rdata,error:rerr}=await supabase.from('rooms_by_floor').select('*').eq('building_id',buildingId).order('room_code',{ascending:true});if(!rerr)setRooms(rdata||[]);}catch(e){console.error(e);setFloors([]);setRooms([]);}finally{setLoading(false);}};useEffect(()=>{loadBuildings();},[]);useEffect(()=>{if(selectedBuilding)loadData(selectedBuilding.id);},[selectedBuilding]);const goToAddRooms=(buildingId,floorNumber)=>{const url=\"/rooms?building=\".concat(buildingId,\"&floor=\").concat(floorNumber);try{window.location.href=url;}catch(e){console.log('navigate',url);}};const handleEditFloor=async floor=>{console.log('handleEditFloor - floor:',floor);// fetch full row from floors table to populate modal with all fields\ntry{if(floor.floor_id){const{data:full,error:fullErr}=await supabase.from('floors').select('*').eq('id',floor.floor_id).single();if(!fullErr&&full){setEditingFloor(_objectSpread(_objectSpread({},floor),full));}else{console.warn('Could not fetch full floor row, using view row',fullErr);setEditingFloor(floor);}}else{setEditingFloor(floor);}}catch(e){console.warn('Error fetching full floor row',e);setEditingFloor(floor);}setShowFloorModal(true);};const handleSaveFloor=async payload=>{console.group('handleSaveFloor');console.log('payload:',payload);try{const id=payload.id;if(!id)throw new Error('Missing floor id');// Build a bulk update payload with all editable fields\nconst updatePayload={};if(payload.status!==undefined)updatePayload.status=payload.status;if(payload.description!==undefined)updatePayload.description=payload.description;if(payload.name!==undefined)updatePayload.name=payload.name;if(payload.maintenance_note!==undefined)updatePayload.maintenance_note=payload.maintenance_note;if(payload.capacity!==undefined&&payload.capacity!==null)updatePayload.capacity=Number(payload.capacity);if(payload.needs_inspection!==undefined)updatePayload.needs_inspection=Boolean(payload.needs_inspection);console.log('Attempting bulk update with payload:',updatePayload);// Try updating; if the DB complains about a missing column, remove it from payload and retry.\nlet attempts=0;let lastResult=null;while(attempts<6){attempts+=1;const res=await supabase.from('floors').update(updatePayload).eq('id',id);console.log('bulk update attempt',attempts,res);if(!res.error){lastResult=res;break;}lastResult=res;const em=(res.error.message||'').toLowerCase();const colMatch=em.match(/column \\\"([^\\\"]+)\\\"/);if(colMatch&&colMatch[1]){const col=colMatch[1];if(updatePayload.hasOwnProperty(col)){console.warn('Removing column from payload and retrying:',col);delete updatePayload[col];continue;}}// try other message format\nconst m2=em.match(/could not find the '([^']+)'/);if(m2&&m2[1]&&updatePayload.hasOwnProperty(m2[1])){console.warn('Removing column (alt message) from payload and retrying:',m2[1]);delete updatePayload[m2[1]];continue;}// otherwise cannot recover\nthrow res.error;}// fetch the updated floor row for verification\ntry{const{data:refData,error:refErr}=await supabase.from('floors').select('*').eq('id',id).single();console.log('Refetched floor row:',{refData,refErr});if(!refErr&&refData){setFloors(prev=>prev.map(fl=>{// view rows use `floor_id` whereas table has `id`\nif(fl.floor_id&&String(fl.floor_id)===String(refData.id)||fl.id&&String(fl.id)===String(refData.id)){var _refData$floor_number,_ref2,_refData$floor_name,_refData$name,_refData$status,_refData$description,_refData$maintenance_,_refData$capacity,_refData$needs_inspec;return _objectSpread(_objectSpread({},fl),{},{floor_id:refData.id,floor_number:(_refData$floor_number=refData.floor_number)!==null&&_refData$floor_number!==void 0?_refData$floor_number:fl.floor_number,floor_name:(_ref2=(_refData$floor_name=refData.floor_name)!==null&&_refData$floor_name!==void 0?_refData$floor_name:refData.name)!==null&&_ref2!==void 0?_ref2:fl.floor_name,name:(_refData$name=refData.name)!==null&&_refData$name!==void 0?_refData$name:fl.name,status:(_refData$status=refData.status)!==null&&_refData$status!==void 0?_refData$status:fl.status,description:(_refData$description=refData.description)!==null&&_refData$description!==void 0?_refData$description:fl.description,maintenance_note:(_refData$maintenance_=refData.maintenance_note)!==null&&_refData$maintenance_!==void 0?_refData$maintenance_:fl.maintenance_note,capacity:(_refData$capacity=refData.capacity)!==null&&_refData$capacity!==void 0?_refData$capacity:fl.capacity,needs_inspection:(_refData$needs_inspec=refData.needs_inspection)!==null&&_refData$needs_inspec!==void 0?_refData$needs_inspec:fl.needs_inspection});}return fl;}));}}catch(re){console.warn('Failed refetching floor row',re);}setShowFloorModal(false);if(selectedBuilding)loadData(selectedBuilding.id);}catch(e){console.error('Failed saving floor',e);// show more details to the user so they can paste the error\ntry{const msg=e&&e.message?e.message:JSON.stringify(e);window.alert('حصل خطأ أثناء حفظ الطابق: '+msg);}catch(ae){window.alert('حصل خطأ أثناء حفظ الطابق. فتح الـ Console لمزيد من التفاصيل.');}}console.groupEnd();};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-400\",children:/*#__PURE__*/_jsx(HotelIcon,{className:\"w-12 h-12\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"\\u0625\\u062F\\u0627\\u0631\\u0629 \\u0627\\u0644\\u0637\\u0648\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"\\u0639\\u0631\\u0636 \\u0648\\u0637\\u0628\\u0627\\u0639\\u0629 \\u0637\\u0648\\u0627\\u0628\\u0642 \\u0648\\u063A\\u0631\\u0641 \\u0627\\u0644\\u0645\\u0628\\u0646\\u0649\",selectedBuilding?\" \\u2014 \".concat(selectedBuilding.name):'']})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-4 overflow-auto\",children:buildings.map(b=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setSelectedBuilding(b),className:\"min-w-[160px] p-4 rounded shadow flex flex-col items-start justify-center \".concat(selectedBuilding&&selectedBuilding.id===b.id?'border-2 border-blue-400 bg-white':'bg-white/80'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"\\u0645\\u0628\\u0646\\u0649 \",b.code]}),/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:b.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mt-2 inline-flex items-center gap-2\",children:b.status==='maintenance'?/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded text-yellow-800 bg-yellow-100\",children:\"\\u0635\\u064A\\u0627\\u0646\\u0629\"}):b.status==='inactive'?/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded text-gray-700 bg-gray-100\",children:\"\\u063A\\u064A\\u0631 \\u0646\\u0634\\u0637\"}):/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded text-white bg-green-500\",children:\"\\u0646\\u0634\\u0637\"})})]},b.id))}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4\",children:(()=>{// aggregate counts from floors\nconst totals=floors.reduce((acc,f)=>{acc.total+=Number(f.total_rooms||0);acc.available+=Number(f.available_rooms||0);acc.occupied+=Number(f.occupied_rooms||0);acc.reserved+=Number(f.reserved_rooms||0);acc.maintenance+=Number(f.maintenance_rooms||0);return acc;},{total:0,available:0,occupied:0,reserved:0,maintenance:0});return[{key:'total',label:'إجمالي الغرف',value:totals.total,color:'bg-white',iconBg:'bg-indigo-100 text-indigo-700',icon:/*#__PURE__*/_jsx(RoomsTotalIcon,{className:\"w-8 h-8\"})},{key:'available',label:'متاحة',value:totals.available,color:'bg-green-50',iconBg:'bg-green-100 text-green-700',icon:/*#__PURE__*/_jsx(RoomsAvailableIcon,{className:\"w-8 h-8\"})},{key:'reserved',label:'محجوزة',value:totals.reserved,color:'bg-amber-50',iconBg:'bg-amber-100 text-amber-700',icon:/*#__PURE__*/_jsx(RoomsReservedIcon,{className:\"w-8 h-8\"})},{key:'occupied',label:'مشغولة',value:totals.occupied,color:'bg-rose-50',iconBg:'bg-rose-100 text-rose-700',icon:/*#__PURE__*/_jsx(RoomsOccupiedIcon,{className:\"w-8 h-8\"})},{key:'maintenance',label:'صيانة',value:totals.maintenance,color:'bg-yellow-50',iconBg:'bg-yellow-100 text-yellow-700',icon:/*#__PURE__*/_jsx(RoomsMaintenanceIcon,{className:\"w-8 h-8\"})}].map(box=>/*#__PURE__*/_jsx(\"div\",{className:\"p-4 rounded shadow \".concat(box.color),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:box.label}),/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold mt-1\",children:box.value})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-2 rounded-full \".concat(box.iconBg),children:box.icon})]})},box.key));})()})]}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"\\u062A\\u062D\\u0645\\u064A\\u0644...\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[floors.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"p-6 bg-white rounded shadow\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0637\\u0648\\u0627\\u0628\\u0642 \\u0644\\u0639\\u0631\\u0636\\u0647\\u0627 \\u0641\\u064A \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0645\\u0628\\u0646\\u0649.\"}):floors.map(f=>/*#__PURE__*/_jsxs(\"section\",{className:\"bg-white rounded shadow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 flex items-center justify-between\",style:f.status==='maintenance'?{background:'linear-gradient(90deg,#ff416c,#ff4b2b)'}:f.status==='inactive'?{background:'linear-gradient(90deg,#757f9a,#d7dde8)'}:{background:'linear-gradient(90deg,#6a11cb,#2575fc)'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-white\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-semibold\",children:f.floor_name||f.name||\"\\u0627\\u0644\\u0637\\u0627\\u0628\\u0642 \".concat(f.floor_number)}),f.status==='maintenance'&&/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs\",children:[/*#__PURE__*/_jsx(MaintenanceIcon,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0635\\u064A\\u0627\\u0646\\u0629\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm opacity-90\",children:[f.total_rooms,\" \\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\xB7 \",f.available_rooms,\" \\u0645\\u062A\\u0627\\u062D\\u0629 \\xB7 \",f.occupied_rooms,\" \\u0645\\u0634\\u063A\\u0648\\u0644\\u0629\"]}),f.description&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs opacity-90 mt-1\",children:f.description}),f.maintenance_note&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs opacity-90 mt-1\",children:[\"\\u0645\\u0644\\u0627\\u062D\\u0638\\u0629: \",f.maintenance_note]}),f.capacity!==undefined&&f.capacity!==null&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs opacity-90 mt-1\",children:[\"\\u0633\\u0639\\u0629: \",f.capacity]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-white text-sm flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEditFloor(f),className:\"bg-white/20 px-3 py-1 rounded text-white\",children:\"\\u062A\\u0639\\u062F\\u064A\\u0644 \\u0627\\u0644\\u0637\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsx(\"div\",{children:selectedBuilding&&selectedBuilding.name})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-4 overflow-x-auto\",children:rooms.filter(r=>r.floor_id===f.floor_id).length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"w-full py-8 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-400 mb-4\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u063A\\u0631\\u0641 \\u0641\\u064A \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0637\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>goToAddRooms(f.building_id,f.floor_number),className:\"bg-blue-600 text-white px-4 py-2 rounded\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u063A\\u0631\\u0641\"})]}):rooms.filter(r=>r.floor_id===f.floor_id).map(r=>/*#__PURE__*/_jsx(RoomCard,{room:r},r.id))})})]},f.floor_id)),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded shadow p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"\\u0645\\u062E\\u0637\\u0637 \\u0627\\u0644\\u0645\\u0628\\u0646\\u0649 \\u0627\\u0644\\u0643\\u0627\\u0645\\u0644\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-sm\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-left text-gray-500\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0627\\u0644\\u0637\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0639\\u062F\\u062F \\u0627\\u0644\\u063A\\u0631\\u0641\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0645\\u062A\\u0627\\u062D\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0645\\u0634\\u063A\\u0648\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0645\\u062D\\u062C\\u0648\\u0632\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0635\\u064A\\u0627\\u0646\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2\",children:\"\\u0645\\u0639\\u062F\\u0644 \\u0627\\u0644\\u0627\\u0634\\u063A\\u0627\\u0644\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:floors.map(f=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsxs(\"td\",{className:\"p-2\",children:[\"\\u0627\\u0644\\u0637\\u0627\\u0628\\u0642 \",f.floor_number]}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:f.total_rooms}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-green-600\",children:f.available_rooms}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-red-600\",children:f.occupied_rooms}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-yellow-600\",children:f.reserved_rooms}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:f.maintenance_rooms}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2\",children:[Math.round((f.occupancy_rate||0)*100),\"%\"]})]},f.floor_id))})]})})]})]}),showFloorModal&&/*#__PURE__*/_jsx(FloorModal,{initialData:editingFloor,onClose:()=>setShowFloorModal(false),onSave:handleSaveFloor})]});}","map":{"version":3,"names":["React","useEffect","useState","supabase","RoomCard","FloorModal","HotelIcon","RoomsTotalIcon","RoomsAvailableIcon","RoomsReservedIcon","RoomsOccupiedIcon","RoomsMaintenanceIcon","MaintenanceIcon","jsx","_jsx","jsxs","_jsxs","Floors","buildings","setBuildings","selectedBuilding","setSelectedBuilding","floors","setFloors","rooms","setRooms","loading","setLoading","showFloorModal","setShowFloorModal","editingFloor","setEditingFloor","loadBuildings","data","error","from","select","order","ascending","length","loadData","buildingId","fdata","ferr","eq","mergedFloors","tableFloors","tfErr","byId","Map","map","r","String","id","byNumber","floor_number","f","tableRow","floor_id","has","get","_tableRow$floor_numbe","_ref","_tableRow$floor_name","_tableRow$name","_tableRow$status","_tableRow$description","_tableRow$maintenance","_tableRow$capacity","_tableRow$needs_inspe","_objectSpread","floor_name","name","status","description","maintenance_note","capacity","needs_inspection","existingIds","Set","x","tr","_tr$floor_name","push","building_id","e","console","warn","rdata","rerr","goToAddRooms","floorNumber","url","concat","window","location","href","log","handleEditFloor","floor","full","fullErr","single","handleSaveFloor","payload","group","Error","updatePayload","undefined","Number","Boolean","attempts","lastResult","res","update","em","message","toLowerCase","colMatch","match","col","hasOwnProperty","m2","refData","refErr","prev","fl","_refData$floor_number","_ref2","_refData$floor_name","_refData$name","_refData$status","_refData$description","_refData$maintenance_","_refData$capacity","_refData$needs_inspec","re","msg","JSON","stringify","alert","ae","groupEnd","className","children","b","onClick","code","totals","reduce","acc","total","total_rooms","available","available_rooms","occupied","occupied_rooms","reserved","reserved_rooms","maintenance","maintenance_rooms","key","label","value","color","iconBg","icon","box","style","background","filter","room","Math","round","occupancy_rate","initialData","onClose","onSave"],"sources":["F:/kelany/src/pages/Floors.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\nimport RoomCard from '../components/RoomCard';\r\nimport FloorModal from '../components/FloorModal';\r\nimport { HotelIcon, RoomsTotalIcon, RoomsAvailableIcon, RoomsReservedIcon, RoomsOccupiedIcon, RoomsMaintenanceIcon, MaintenanceIcon } from '../components/Icons';\r\n\r\nexport default function Floors() {\r\n  const [buildings, setBuildings] = useState([]);\r\n  const [selectedBuilding, setSelectedBuilding] = useState(null);\r\n  const [floors, setFloors] = useState([]);\r\n  const [rooms, setRooms] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showFloorModal, setShowFloorModal] = useState(false);\r\n  const [editingFloor, setEditingFloor] = useState(null);\r\n\r\n  const loadBuildings = async () => {\r\n    const { data, error } = await supabase.from('buildings').select('*').order('created_at', { ascending: false });\r\n    if (!error) {\r\n      setBuildings(data || []);\r\n      if (!selectedBuilding && data && data.length) setSelectedBuilding(data[0]);\r\n    }\r\n  };\r\n\r\n  const loadData = async (buildingId) => {\r\n    setLoading(true);\r\n    try {\r\n      const { data: fdata, error: ferr } = await supabase\r\n        .from('building_floor_overview')\r\n        .select('*')\r\n        .eq('building_id', buildingId)\r\n        .order('floor_number', { ascending: true });\r\n      let mergedFloors = fdata || [];\r\n\r\n      // Also fetch the raw floors rows to get any new columns (name, maintenance_note, capacity, needs_inspection)\r\n      try {\r\n        const { data: tableFloors, error: tfErr } = await supabase.from('floors').select('*').eq('building_id', buildingId);\r\n        if (!tfErr && tableFloors) {\r\n          // build map by id and by floor_number\r\n          const byId = new Map(tableFloors.map(r => [String(r.id), r]));\r\n          const byNumber = new Map(tableFloors.map(r => [String(r.floor_number), r]));\r\n\r\n          mergedFloors = (mergedFloors || []).map(f => {\r\n            const tableRow = (f.floor_id && byId.has(String(f.floor_id))) ? byId.get(String(f.floor_id)) : (byNumber.has(String(f.floor_number)) ? byNumber.get(String(f.floor_number)) : null);\r\n            if (tableRow) {\r\n              return {\r\n                ...f,\r\n                // prefer table values for new fields\r\n                floor_id: tableRow.id || f.floor_id,\r\n                floor_number: tableRow.floor_number ?? f.floor_number,\r\n                floor_name: tableRow.floor_name ?? tableRow.name ?? f.floor_name,\r\n                name: tableRow.name ?? f.name,\r\n                status: tableRow.status ?? f.status,\r\n                description: tableRow.description ?? f.description,\r\n                maintenance_note: tableRow.maintenance_note ?? f.maintenance_note,\r\n                capacity: tableRow.capacity ?? f.capacity,\r\n                needs_inspection: tableRow.needs_inspection ?? f.needs_inspection,\r\n              };\r\n            }\r\n            return f;\r\n          });\r\n\r\n          // include any table rows that are not present in the view\r\n          const existingIds = new Set((mergedFloors || []).map(x => String(x.floor_id || x.id)));\r\n          for (const tr of tableFloors) {\r\n            if (!existingIds.has(String(tr.id))) {\r\n              mergedFloors.push({\r\n                floor_id: tr.id,\r\n                building_id: tr.building_id,\r\n                floor_number: tr.floor_number,\r\n                floor_name: tr.floor_name ?? tr.name,\r\n                name: tr.name,\r\n                status: tr.status,\r\n                description: tr.description,\r\n                maintenance_note: tr.maintenance_note,\r\n                capacity: tr.capacity,\r\n                needs_inspection: tr.needs_inspection,\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed fetching raw floors rows', e);\r\n      }\r\n\r\n      if (!ferr) setFloors(mergedFloors || []);\r\n\r\n      const { data: rdata, error: rerr } = await supabase\r\n        .from('rooms_by_floor')\r\n        .select('*')\r\n        .eq('building_id', buildingId)\r\n        .order('room_code', { ascending: true });\r\n      if (!rerr) setRooms(rdata || []);\r\n    } catch (e) {\r\n      console.error(e);\r\n      setFloors([]);\r\n      setRooms([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadBuildings();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedBuilding) loadData(selectedBuilding.id);\r\n  }, [selectedBuilding]);\r\n\r\n  const goToAddRooms = (buildingId, floorNumber) => {\r\n    const url = `/rooms?building=${buildingId}&floor=${floorNumber}`;\r\n    try { window.location.href = url; } catch (e) { console.log('navigate', url); }\r\n  };\r\n\r\n  const handleEditFloor = async (floor) => {\r\n    console.log('handleEditFloor - floor:', floor);\r\n    // fetch full row from floors table to populate modal with all fields\r\n    try {\r\n      if (floor.floor_id) {\r\n        const { data: full, error: fullErr } = await supabase.from('floors').select('*').eq('id', floor.floor_id).single();\r\n        if (!fullErr && full) {\r\n          setEditingFloor({ ...floor, ...full });\r\n        } else {\r\n          console.warn('Could not fetch full floor row, using view row', fullErr);\r\n          setEditingFloor(floor);\r\n        }\r\n      } else {\r\n        setEditingFloor(floor);\r\n      }\r\n    } catch (e) {\r\n      console.warn('Error fetching full floor row', e);\r\n      setEditingFloor(floor);\r\n    }\r\n    setShowFloorModal(true);\r\n  };\r\n\r\n  const handleSaveFloor = async (payload) => {\r\n    console.group('handleSaveFloor');\r\n    console.log('payload:', payload);\r\n    try {\r\n      const id = payload.id;\r\n      if (!id) throw new Error('Missing floor id');\r\n\r\n      // Build a bulk update payload with all editable fields\r\n      const updatePayload = {};\r\n      if (payload.status !== undefined) updatePayload.status = payload.status;\r\n      if (payload.description !== undefined) updatePayload.description = payload.description;\r\n      if (payload.name !== undefined) updatePayload.name = payload.name;\r\n      if (payload.maintenance_note !== undefined) updatePayload.maintenance_note = payload.maintenance_note;\r\n      if (payload.capacity !== undefined && payload.capacity !== null) updatePayload.capacity = Number(payload.capacity);\r\n      if (payload.needs_inspection !== undefined) updatePayload.needs_inspection = Boolean(payload.needs_inspection);\r\n\r\n      console.log('Attempting bulk update with payload:', updatePayload);\r\n\r\n      // Try updating; if the DB complains about a missing column, remove it from payload and retry.\r\n      let attempts = 0;\r\n      let lastResult = null;\r\n      while (attempts < 6) {\r\n        attempts += 1;\r\n        const res = await supabase.from('floors').update(updatePayload).eq('id', id);\r\n        console.log('bulk update attempt', attempts, res);\r\n        if (!res.error) {\r\n          lastResult = res;\r\n          break;\r\n        }\r\n        lastResult = res;\r\n        const em = (res.error.message || '').toLowerCase();\r\n        const colMatch = em.match(/column \\\"([^\\\"]+)\\\"/);\r\n        if (colMatch && colMatch[1]) {\r\n          const col = colMatch[1];\r\n          if (updatePayload.hasOwnProperty(col)) {\r\n            console.warn('Removing column from payload and retrying:', col);\r\n            delete updatePayload[col];\r\n            continue;\r\n          }\r\n        }\r\n        // try other message format\r\n        const m2 = em.match(/could not find the '([^']+)'/);\r\n        if (m2 && m2[1] && updatePayload.hasOwnProperty(m2[1])) {\r\n          console.warn('Removing column (alt message) from payload and retrying:', m2[1]);\r\n          delete updatePayload[m2[1]];\r\n          continue;\r\n        }\r\n        // otherwise cannot recover\r\n        throw res.error;\r\n      }\r\n\r\n      // fetch the updated floor row for verification\r\n      try {\r\n        const { data: refData, error: refErr } = await supabase.from('floors').select('*').eq('id', id).single();\r\n        console.log('Refetched floor row:', { refData, refErr });\r\n        if (!refErr && refData) {\r\n          setFloors(prev => prev.map(fl => {\r\n            // view rows use `floor_id` whereas table has `id`\r\n            if ((fl.floor_id && String(fl.floor_id) === String(refData.id)) || (fl.id && String(fl.id) === String(refData.id))) {\r\n                return {\r\n                  ...fl,\r\n                  floor_id: refData.id,\r\n                  floor_number: refData.floor_number ?? fl.floor_number,\r\n                  floor_name: refData.floor_name ?? refData.name ?? fl.floor_name,\r\n                  name: refData.name ?? fl.name,\r\n                  status: refData.status ?? fl.status,\r\n                  description: refData.description ?? fl.description,\r\n                  maintenance_note: refData.maintenance_note ?? fl.maintenance_note,\r\n                  capacity: refData.capacity ?? fl.capacity,\r\n                  needs_inspection: refData.needs_inspection ?? fl.needs_inspection,\r\n                };\r\n            }\r\n            return fl;\r\n          }));\r\n        }\r\n      } catch (re) {\r\n        console.warn('Failed refetching floor row', re);\r\n      }\r\n\r\n      setShowFloorModal(false);\r\n      if (selectedBuilding) loadData(selectedBuilding.id);\r\n    } catch (e) {\r\n      console.error('Failed saving floor', e);\r\n      // show more details to the user so they can paste the error\r\n      try {\r\n        const msg = e && e.message ? e.message : JSON.stringify(e);\r\n        window.alert('حصل خطأ أثناء حفظ الطابق: ' + msg);\r\n      } catch (ae) {\r\n        window.alert('حصل خطأ أثناء حفظ الطابق. فتح الـ Console لمزيد من التفاصيل.');\r\n      }\r\n    }\r\n    console.groupEnd();\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-8\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <div className=\"p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-400\">\r\n            <HotelIcon className=\"w-12 h-12\" />\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold\">إدارة الطوابق</h2>\r\n            <p className=\"text-sm text-gray-500\">عرض وطباعة طوابق وغرف المبنى{selectedBuilding ? ` — ${selectedBuilding.name}` : ''}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex gap-4 overflow-auto\">\r\n          {buildings.map((b) => (\r\n            <button key={b.id}\r\n              onClick={() => setSelectedBuilding(b)}\r\n              className={`min-w-[160px] p-4 rounded shadow flex flex-col items-start justify-center ${selectedBuilding && selectedBuilding.id === b.id ? 'border-2 border-blue-400 bg-white' : 'bg-white/80'}`}>\r\n              <div className=\"text-sm text-gray-500\">مبنى {b.code}</div>\r\n              <div className=\"font-semibold\">{b.name}</div>\r\n              <div className=\"text-xs mt-2 inline-flex items-center gap-2\">\r\n                {b.status === 'maintenance' ? (\r\n                  <span className=\"px-2 py-1 rounded text-yellow-800 bg-yellow-100\">صيانة</span>\r\n                ) : b.status === 'inactive' ? (\r\n                  <span className=\"px-2 py-1 rounded text-gray-700 bg-gray-100\">غير نشط</span>\r\n                ) : (\r\n                  <span className=\"px-2 py-1 rounded text-white bg-green-500\">نشط</span>\r\n                )}\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Summary boxes */}\r\n        <div className=\"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n          {(() => {\r\n            // aggregate counts from floors\r\n            const totals = floors.reduce((acc, f) => {\r\n              acc.total += Number(f.total_rooms || 0);\r\n              acc.available += Number(f.available_rooms || 0);\r\n              acc.occupied += Number(f.occupied_rooms || 0);\r\n              acc.reserved += Number(f.reserved_rooms || 0);\r\n              acc.maintenance += Number(f.maintenance_rooms || 0);\r\n              return acc;\r\n            }, { total: 0, available: 0, occupied: 0, reserved: 0, maintenance: 0 });\r\n            return [\r\n              { key: 'total', label: 'إجمالي الغرف', value: totals.total, color: 'bg-white', iconBg: 'bg-indigo-100 text-indigo-700', icon: <RoomsTotalIcon className=\"w-8 h-8\" /> },\r\n              { key: 'available', label: 'متاحة', value: totals.available, color: 'bg-green-50', iconBg: 'bg-green-100 text-green-700', icon: <RoomsAvailableIcon className=\"w-8 h-8\" /> },\r\n              { key: 'reserved', label: 'محجوزة', value: totals.reserved, color: 'bg-amber-50', iconBg: 'bg-amber-100 text-amber-700', icon: <RoomsReservedIcon className=\"w-8 h-8\" /> },\r\n              { key: 'occupied', label: 'مشغولة', value: totals.occupied, color: 'bg-rose-50', iconBg: 'bg-rose-100 text-rose-700', icon: <RoomsOccupiedIcon className=\"w-8 h-8\" /> },\r\n              { key: 'maintenance', label: 'صيانة', value: totals.maintenance, color: 'bg-yellow-50', iconBg: 'bg-yellow-100 text-yellow-700', icon: <RoomsMaintenanceIcon className=\"w-8 h-8\" /> },\r\n            ].map(box => (\r\n              <div key={box.key} className={`p-4 rounded shadow ${box.color}`}>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-sm text-gray-500\">{box.label}</div>\r\n                    <div className=\"text-2xl font-bold mt-1\">{box.value}</div>\r\n                  </div>\r\n                  <div className={`p-2 rounded-full ${box.iconBg}`}>\r\n                    {box.icon}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ));\r\n          })()}\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div>تحميل...</div>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {floors.length === 0 ? (\r\n            <div className=\"p-6 bg-white rounded shadow\">لا توجد طوابق لعرضها في هذا المبنى.</div>\r\n          ) : (\r\n            floors.map((f) => (\r\n              <section key={f.floor_id} className=\"bg-white rounded shadow\">\r\n                <div\r\n                  className=\"p-4 flex items-center justify-between\"\r\n                  style={\r\n                    f.status === 'maintenance'\r\n                      ? { background: 'linear-gradient(90deg,#ff416c,#ff4b2b)' }\r\n                      : f.status === 'inactive'\r\n                      ? { background: 'linear-gradient(90deg,#757f9a,#d7dde8)' }\r\n                      : { background: 'linear-gradient(90deg,#6a11cb,#2575fc)' }\r\n                  }\r\n                >\r\n                  <div className=\"text-white\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"text-lg font-semibold\">{f.floor_name || f.name || `الطابق ${f.floor_number}`}</div>\r\n                      {f.status === 'maintenance' && (\r\n                        <div className=\"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs\">\r\n                          <MaintenanceIcon className=\"w-4 h-4\" />\r\n                          <span>صيانة</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-sm opacity-90\">{f.total_rooms} إجمالي · {f.available_rooms} متاحة · {f.occupied_rooms} مشغولة</div>\r\n                    { (f.description) && (\r\n                      <div className=\"text-xs opacity-90 mt-1\">{f.description}</div>\r\n                    ) }\r\n                    { (f.maintenance_note) && (\r\n                      <div className=\"text-xs opacity-90 mt-1\">ملاحظة: {f.maintenance_note}</div>\r\n                    ) }\r\n                    { (f.capacity !== undefined && f.capacity !== null) && (\r\n                      <div className=\"text-xs opacity-90 mt-1\">سعة: {f.capacity}</div>\r\n                    ) }\r\n                  </div>\r\n                  <div className=\"text-white text-sm flex items-center gap-3\">\r\n                    <button onClick={() => handleEditFloor(f)} className=\"bg-white/20 px-3 py-1 rounded text-white\">تعديل الطابق</button>\r\n                    <div>{selectedBuilding && selectedBuilding.name}</div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                  <div className=\"flex gap-4 overflow-x-auto\">\r\n                    {rooms.filter(r => r.floor_id === f.floor_id).length === 0 ? (\r\n                      <div className=\"w-full py-8 text-center\">\r\n                        <div className=\"text-gray-400 mb-4\">لا توجد غرف في هذا الطابق</div>\r\n                        <button onClick={() => goToAddRooms(f.building_id, f.floor_number)} className=\"bg-blue-600 text-white px-4 py-2 rounded\">إضافة غرف</button>\r\n                      </div>\r\n                    ) : (\r\n                      rooms.filter(r => r.floor_id === f.floor_id).map((r) => (\r\n                        <RoomCard key={r.id} room={r} />\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </section>\r\n            ))\r\n          )}\r\n\r\n          <div className=\"bg-white rounded shadow p-4\">\r\n            <h3 className=\"font-semibold mb-3\">مخطط المبنى الكامل</h3>\r\n            <div className=\"overflow-auto\">\r\n              <table className=\"w-full text-sm\">\r\n                <thead>\r\n                  <tr className=\"text-left text-gray-500\">\r\n                    <th className=\"p-2\">الطابق</th>\r\n                    <th className=\"p-2\">عدد الغرف</th>\r\n                    <th className=\"p-2\">متاحة</th>\r\n                    <th className=\"p-2\">مشغولة</th>\r\n                    <th className=\"p-2\">محجوزة</th>\r\n                    <th className=\"p-2\">صيانة</th>\r\n                    <th className=\"p-2\">معدل الاشغال</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {floors.map((f) => (\r\n                    <tr key={f.floor_id} className=\"border-t\">\r\n                      <td className=\"p-2\">الطابق {f.floor_number}</td>\r\n                      <td className=\"p-2\">{f.total_rooms}</td>\r\n                      <td className=\"p-2 text-green-600\">{f.available_rooms}</td>\r\n                      <td className=\"p-2 text-red-600\">{f.occupied_rooms}</td>\r\n                      <td className=\"p-2 text-yellow-600\">{f.reserved_rooms}</td>\r\n                      <td className=\"p-2\">{f.maintenance_rooms}</td>\r\n                      <td className=\"p-2\">{Math.round((f.occupancy_rate || 0) * 100)}%</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      )}\r\n\r\n      {showFloorModal && (\r\n        <FloorModal\r\n          initialData={editingFloor}\r\n          onClose={() => setShowFloorModal(false)}\r\n          onSave={handleSaveFloor}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}