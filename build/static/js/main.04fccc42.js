/*! For license information please see main.04fccc42.js.LICENSE.txt */
(()=>{"use strict";var e={43(e,t,n){e.exports=n(202)},153(e,t,n){var r=n(43),a=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},202(e,t){var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var x=y.prototype=new b;x.constructor=y,m(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,_=Object.prototype.hasOwnProperty,j={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,r){var a,s={},i=null,o=null;if(null!=t)for(a in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(i=""+t.key),t)_.call(t,a)&&!k.hasOwnProperty(a)&&(s[a]=t[a]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===s[a]&&(s[a]=l[a]);return{$$typeof:n,type:e,key:i,ref:o,props:s,_owner:j.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,a,s,i){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return i=i(l=e),e=""===s?"."+C(l,0):s,w(i)?(a="",null!=e&&(a=e.replace(E,"$&/")+"/"),T(i,t,a,"",function(e){return e})):null!=i&&(S(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,a+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(E,"$&/")+"/")+e)),t.push(i)),1;if(l=0,s=""===s?".":s+":",w(e))for(var c=0;c<e.length;c++){var u=s+C(o=e[c],c);l+=T(o,t,a,u,i)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=T(o=o.value,t,a,u=s+C(o,c++),i);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function O(e,t,n){if(null==e)return e;var r=[],a=0;return T(e,r,"","",function(e){return t.call(n,e,a++)}),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},A={transition:null},I={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:A,ReactCurrentOwner:j};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:O,forEach:function(e,t,n){O(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return O(e,function(){t++}),t},toArray:function(e){return O(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=a,t.Profiler=i,t.PureComponent=y,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,t.act=D,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=m({},e.props),s=e.key,i=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,o=j.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!k.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}return{$$typeof:n,type:e.type,key:s,ref:i,props:a,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=N,t.createFactory=function(e){var t=N.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=A.transition;A.transition={};try{e()}finally{A.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},234(e,t){function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<s(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,i=a>>>1;r<i;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<a&&0>s(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<a&&0>s(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(g=!1,x(e),!m)if(null!==r(c))m=!0,A(_);else{var t=r(u);null!==t&&I(w,t.startTime-e)}}function _(e,n){m=!1,g&&(g=!1,b(S),S=-1),p=!0;var s=f;try{for(x(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!T());){var i=h.callback;if("function"===typeof i){h.callback=null,f=h.priorityLevel;var o=i(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&a(c),x(n)}else a(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&I(w,d.startTime-n),l=!1}return l}finally{h=null,f=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var j,k=!1,N=null,S=-1,E=5,C=-1;function T(){return!(t.unstable_now()-C<E)}function O(){if(null!==N){var e=t.unstable_now();C=e;var n=!0;try{n=N(!0,e)}finally{n?j():(k=!1,N=null)}}else k=!1}if("function"===typeof y)j=function(){y(O)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,P=R.port2;R.port1.onmessage=O,j=function(){P.postMessage(null)}}else j=function(){v(O,0)};function A(e){N=e,k||(k=!0,j())}function I(e,n){S=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,A(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,s){var i=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?i+s:i:s=i,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>i?(e.sortIndex=s,n(u,e),null===r(c)&&e===r(u)&&(g?(b(S),S=-1):g=!0,I(w,s-i))):(e.sortIndex=o,n(c,e),m||p||(m=!0,A(_))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},391(e,t,n){var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},579(e,t,n){e.exports=n(153)},730(e,t,n){var r=n(43),a=n(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)i.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,a,s,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=i}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,n,r){var a=g.hasOwnProperty(t)?g[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,b);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),_=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),E=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var A=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var I=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var L,U=Object.assign;function M(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var z=!1;function B(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),s=r.stack.split("\n"),i=a.length-1,o=s.length-1;1<=i&&0<=o&&a[i]!==s[o];)o--;for(;1<=i&&0<=o;i--,o--)if(a[i]!==s[o]){if(1!==i||1!==o)do{if(i--,0>--o||a[i]!==s[o]){var l="\n"+a[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=i&&0<=o);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?M(e):""}function F(e){switch(e.tag){case 5:return M(e.type);case 16:return M("Lazy");case 13:return M("Suspense");case 19:return M("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case j:return"Fragment";case _:return"Portal";case N:return"Profiler";case k:return"StrictMode";case T:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return q(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function se(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,je=null,ke=null;function Ne(e){if(e=ya(e)){if("function"!==typeof _e)throw Error(s(280));var t=e.stateNode;t&&(t=wa(t),_e(e.stateNode,e.type,t))}}function Se(e){je?ke?ke.push(e):ke=[e]:je=e}function Ee(){if(je){var e=je,t=ke;if(ke=je=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Ce(e,t){return e(t)}function Te(){}var Oe=!1;function Re(e,t,n){if(Oe)return e(t,n);Oe=!0;try{return Ce(e,t,n)}finally{Oe=!1,(null!==je||null!==ke)&&(Te(),Ee())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=wa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Ae=!1;if(u)try{var Ie={};Object.defineProperty(Ie,"passive",{get:function(){Ae=!0}}),window.addEventListener("test",Ie,Ie),window.removeEventListener("test",Ie,Ie)}catch(ue){Ae=!1}function De(e,t,n,r,a,s,i,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Le=!1,Ue=null,Me=!1,ze=null,Be={onError:function(e){Le=!0,Ue=e}};function Fe(e,t,n,r,a,s,i,o,l){Le=!1,Ue=null,De.apply(Be,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(qe(e)!==e)throw Error(s(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return Ve(a),e;if(i===r)return Ve(a),t;i=i.sibling}throw Error(s(188))}if(n.return!==r.return)n=a,r=i;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var Ge=a.unstable_scheduleCallback,Je=a.unstable_cancelCallback,$e=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Ye=a.unstable_now,Xe=a.unstable_getCurrentPriorityLevel,Ze=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,st=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,s=e.pingedLanes,i=268435455&n;if(0!==i){var o=i&~a;0!==o?r=dt(o):0!==(s&=i)&&(r=dt(s))}else 0!==(i=n&~a)?r=dt(i):0!==s&&(r=dt(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(s=t&-t)||16===a&&0!==(4194240&s)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-it(t)),r|=e[n],t&=~a;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var yt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,_t,jt,kt,Nt,St=!1,Et=[],Ct=null,Tt=null,Ot=null,Rt=new Map,Pt=new Map,At=[],It="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Ot=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Lt(e,t,n,r,a,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[a]},null!==t&&(null!==(t=ya(t))&&_t(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Ut(e){var t=ba(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void Nt(e.priority,function(){jt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Mt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ya(n))&&_t(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function zt(e,t,n){Mt(e)&&n.delete(t)}function Bt(){St=!1,null!==Ct&&Mt(Ct)&&(Ct=null),null!==Tt&&Mt(Tt)&&(Tt=null),null!==Ot&&Mt(Ot)&&(Ot=null),Rt.forEach(zt),Pt.forEach(zt)}function Ft(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Bt)))}function qt(e){function t(t){return Ft(t,e)}if(0<Et.length){Ft(Et[0],e);for(var n=1;n<Et.length;n++){var r=Et[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ct&&Ft(Ct,e),null!==Tt&&Ft(Tt,e),null!==Ot&&Ft(Ot,e),Rt.forEach(t),Pt.forEach(t),n=0;n<At.length;n++)(r=At[n]).blockedOn===e&&(r.blockedOn=null);for(;0<At.length&&null===(n=At[0]).blockedOn;)Ut(n),null===n.blockedOn&&At.shift()}var Wt=x.ReactCurrentBatchConfig,Vt=!0;function Ht(e,t,n,r){var a=yt,s=Wt.transition;Wt.transition=null;try{yt=1,Gt(e,t,n,r)}finally{yt=a,Wt.transition=s}}function Kt(e,t,n,r){var a=yt,s=Wt.transition;Wt.transition=null;try{yt=4,Gt(e,t,n,r)}finally{yt=a,Wt.transition=s}}function Gt(e,t,n,r){if(Vt){var a=$t(e,t,n,r);if(null===a)Vr(e,t,r,Jt,n),Dt(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Ct=Lt(Ct,e,t,n,r,a),!0;case"dragenter":return Tt=Lt(Tt,e,t,n,r,a),!0;case"mouseover":return Ot=Lt(Ot,e,t,n,r,a),!0;case"pointerover":var s=a.pointerId;return Rt.set(s,Lt(Rt.get(s)||null,e,t,n,r,a)),!0;case"gotpointercapture":return s=a.pointerId,Pt.set(s,Lt(Pt.get(s)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Dt(e,r),4&t&&-1<It.indexOf(e)){for(;null!==a;){var s=ya(a);if(null!==s&&wt(s),null===(s=$t(e,t,n,r))&&Vr(e,t,r,Jt,n),s===a)break;a=s}null!==a&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Jt=null;function $t(e,t,n,r){if(Jt=null,null!==(e=ba(e=we(r))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Jt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,a="value"in Yt?Yt.value:Yt.textContent,s=a.length;for(e=0;e<r&&n[e]===a[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===a[s-t];t++);return Zt=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,s){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(a):a[i]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),dn=U({},cn,{view:0,detail:0}),hn=an(dn),fn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=an(fn),mn=an(U({},fn,{dataTransfer:0})),gn=an(U({},dn,{relatedTarget:0})),vn=an(U({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=U({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=an(bn),xn=an(U({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=jn[e])&&!!t[e]}function Nn(){return kn}var Sn=U({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=an(Sn),Cn=an(U({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=an(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nn})),On=an(U({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=U({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=an(Rn),An=[9,13,27,32],In=u&&"CompositionEvent"in window,Dn=null;u&&"documentMode"in document&&(Dn=document.documentMode);var Ln=u&&"TextEvent"in window&&!Dn,Un=u&&(!In||Dn&&8<Dn&&11>=Dn),Mn=String.fromCharCode(32),zn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==An.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Hn(e,t,n,r){Se(r),0<(t=Kr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Kn=null,Gn=null;function Jn(e){Mr(e,0)}function $n(e){if(G(xa(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(u){var Xn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Kn&&(Kn.detachEvent("onpropertychange",nr),Gn=Kn=null)}function nr(e){if("value"===e.propertyName&&$n(Gn)){var t=[];Hn(t,Gn,e,we(e)),Re(Jn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Kn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $n(Gn)}function sr(e,t){if("click"===e)return $n(t)}function ir(e,t){if("input"===e||"change"===e)return $n(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!d.call(t,a)||!or(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,s=Math.min(r.start,a);r=void 0===r.end?s:Math.min(r.end,a),!e.extend&&s>r&&(a=r,r=s,s=a),a=ur(n,s);var i=ur(n,r);a&&i&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,br=null,yr=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==gr||gr!==J(r)||("selectionStart"in(r=gr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&lr(br,r)||(br=r,0<(r=Kr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _r={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},jr={},kr={};function Nr(e){if(jr[e])return jr[e];if(!_r[e])return e;var t,n=_r[e];for(t in n)if(n.hasOwnProperty(t)&&t in kr)return jr[e]=n[t];return e}u&&(kr=document.createElement("div").style,"AnimationEvent"in window||(delete _r.animationend.animation,delete _r.animationiteration.animation,delete _r.animationstart.animation),"TransitionEvent"in window||delete _r.transitionend.transition);var Sr=Nr("animationend"),Er=Nr("animationiteration"),Cr=Nr("animationstart"),Tr=Nr("transitionend"),Or=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Or.set(e,t),l(t,[e])}for(var Ar=0;Ar<Rr.length;Ar++){var Ir=Rr[Ar];Pr(Ir.toLowerCase(),"on"+(Ir[0].toUpperCase()+Ir.slice(1)))}Pr(Sr,"onAnimationEnd"),Pr(Er,"onAnimationIteration"),Pr(Cr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Tr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dr));function Ur(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,i,o,l,c){if(Fe.apply(this,arguments),Le){if(!Le)throw Error(s(198));var u=Ue;Le=!1,Ue=null,Me||(Me=!0,ze=u)}}(r,t,void 0,e),e.currentTarget=null}function Mr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var i=r.length-1;0<=i;i--){var o=r[i],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&a.isPropagationStopped())break e;Ur(a,o,c),s=l}else for(i=0;i<r.length;i++){if(l=(o=r[i]).instance,c=o.currentTarget,o=o.listener,l!==s&&a.isPropagationStopped())break e;Ur(a,o,c),s=l}}}if(Me)throw e=ze,Me=!1,ze=null,e}function zr(e,t){var n=t[ma];void 0===n&&(n=t[ma]=new Set);var r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),Wr(n,e,r,t)}var Fr="_reactListening"+Math.random().toString(36).slice(2);function qr(e){if(!e[Fr]){e[Fr]=!0,i.forEach(function(t){"selectionchange"!==t&&(Lr.has(t)||Br(t,!1,e),Br(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Fr]||(t[Fr]=!0,Br("selectionchange",!1,t))}}function Wr(e,t,n,r){switch(Qt(t)){case 1:var a=Ht;break;case 4:a=Kt;break;default:a=Gt}n=a.bind(null,t,n,e),a=void 0,!Ae||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,a){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var o=r.stateNode.containerInfo;if(o===a||8===o.nodeType&&o.parentNode===a)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&((l=i.stateNode.containerInfo)===a||8===l.nodeType&&l.parentNode===a))return;i=i.return}for(;null!==o;){if(null===(i=ba(o)))return;if(5===(l=i.tag)||6===l){r=s=i;continue e}o=o.parentNode}}r=r.return}Re(function(){var r=s,a=we(n),i=[];e:{var o=Or.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=En;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case Sr:case Er:case Cr:l=vn;break;case Tr:l=On;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=Pe(p,h))&&u.push(Hr(p,m,f)))),d)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,a),i.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ba(c)&&!c[pa])&&(l||o)&&(o=a.window===a?a:(o=a.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?ba(c):null)&&(c!==(d=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Cn,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?o:xa(l),f=null==c?o:xa(c),(o=new u(m,p+"leave",l,n,a)).target=d,o.relatedTarget=f,m=null,ba(a)===r&&((u=new u(h,p+"enter",c,n,a)).target=f,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,p=0,f=u=l;f;f=Gr(f))p++;for(f=0,m=h;m;m=Gr(m))f++;for(;0<p-f;)u=Gr(u),p--;for(;0<f-p;)h=Gr(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Gr(u),h=Gr(h)}u=null}else u=null;null!==l&&Jr(i,o,l,u,!1),null!==c&&null!==d&&Jr(i,d,c,u,!0)}if("select"===(l=(o=r?xa(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Qn;else if(Vn(o))if(Yn)g=ir;else{g=ar;var v=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sr);switch(g&&(g=g(e,r))?Hn(i,g,n,a):(v&&v(e,o,r),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=r?xa(r):window,e){case"focusin":(Vn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,br=null);break;case"focusout":br=vr=gr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,xr(i,n,a);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(i,n,a)}var b;if(In)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else qn?Bn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Un&&"ko"!==n.locale&&(qn||"onCompositionStart"!==y?"onCompositionEnd"===y&&qn&&(b=en()):(Xt="value"in(Yt=a)?Yt.value:Yt.textContent,qn=!0)),0<(v=Kr(r,y)).length&&(y=new xn(y,e,null,n,a),i.push({event:y,listeners:v}),b?y.data=b:null!==(b=Fn(n))&&(y.data=b))),(b=Ln?function(e,t){switch(e){case"compositionend":return Fn(t);case"keypress":return 32!==t.which?null:(zn=!0,Mn);case"textInput":return(e=t.data)===Mn&&zn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!In&&Bn(e,t)?(e=en(),Zt=Xt=Yt=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),i.push({event:a,listeners:r}),a.data=b))}Mr(i,t)})}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,s=a.stateNode;5===a.tag&&null!==s&&(a=s,null!=(s=Pe(e,n))&&r.unshift(Hr(e,s,a)),null!=(s=Pe(e,t))&&r.push(Hr(e,s,a))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Jr(e,t,n,r,a){for(var s=t._reactName,i=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,a?null!=(l=Pe(n,s))&&i.unshift(Hr(n,l,o)):a||null!=(l=Pe(n,s))&&i.push(Hr(n,l,o))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var $r=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace($r,"\n").replace(Qr,"")}function Xr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(s(425))}function Zr(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,sa="function"===typeof Promise?Promise:void 0,ia="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sa?function(e){return sa.resolve(null).then(e).catch(oa)}:ra;function oa(e){setTimeout(function(){throw e})}function la(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void qt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);qt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ua(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var da=Math.random().toString(36).slice(2),ha="__reactFiber$"+da,fa="__reactProps$"+da,pa="__reactContainer$"+da,ma="__reactEvents$"+da,ga="__reactListeners$"+da,va="__reactHandles$"+da;function ba(e){var t=e[ha];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[ha]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ua(e);null!==e;){if(n=e[ha])return n;e=ua(e)}return t}n=(e=n).parentNode}return null}function ya(e){return!(e=e[ha]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function wa(e){return e[fa]||null}var _a=[],ja=-1;function ka(e){return{current:e}}function Na(e){0>ja||(e.current=_a[ja],_a[ja]=null,ja--)}function Sa(e,t){ja++,_a[ja]=e.current,e.current=t}var Ea={},Ca=ka(Ea),Ta=ka(!1),Oa=Ea;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ea;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,s={};for(a in n)s[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Pa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Aa(){Na(Ta),Na(Ca)}function Ia(e,t,n){if(Ca.current!==Ea)throw Error(s(168));Sa(Ca,t),Sa(Ta,n)}function Da(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(s(108,W(e)||"Unknown",a));return U({},n,r)}function La(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ea,Oa=Ca.current,Sa(Ca,e),Sa(Ta,Ta.current),!0}function Ua(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=Da(e,t,Oa),r.__reactInternalMemoizedMergedChildContext=e,Na(Ta),Na(Ca),Sa(Ca,e)):Na(Ta),Sa(Ta,n)}var Ma=null,za=!1,Ba=!1;function Fa(e){null===Ma?Ma=[e]:Ma.push(e)}function qa(){if(!Ba&&null!==Ma){Ba=!0;var e=0,t=yt;try{var n=Ma;for(yt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ma=null,za=!1}catch(a){throw null!==Ma&&(Ma=Ma.slice(e+1)),Ge(Ze,qa),a}finally{yt=t,Ba=!1}}return null}var Wa=[],Va=0,Ha=null,Ka=0,Ga=[],Ja=0,$a=null,Qa=1,Ya="";function Xa(e,t){Wa[Va++]=Ka,Wa[Va++]=Ha,Ha=e,Ka=t}function Za(e,t,n){Ga[Ja++]=Qa,Ga[Ja++]=Ya,Ga[Ja++]=$a,$a=e;var r=Qa;e=Ya;var a=32-it(r)-1;r&=~(1<<a),n+=1;var s=32-it(t)+a;if(30<s){var i=a-a%5;s=(r&(1<<i)-1).toString(32),r>>=i,a-=i,Qa=1<<32-it(t)+a|n<<a|r,Ya=s+e}else Qa=1<<s|n<<a|r,Ya=e}function es(e){null!==e.return&&(Xa(e,1),Za(e,1,0))}function ts(e){for(;e===Ha;)Ha=Wa[--Va],Wa[Va]=null,Ka=Wa[--Va],Wa[Va]=null;for(;e===$a;)$a=Ga[--Ja],Ga[Ja]=null,Ya=Ga[--Ja],Ga[Ja]=null,Qa=Ga[--Ja],Ga[Ja]=null}var ns=null,rs=null,as=!1,ss=null;function is(e,t){var n=Oc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,rs=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,rs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==$a?{id:Qa,overflow:Ya}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Oc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,rs=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(as){var t=rs;if(t){var n=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=ca(n.nextSibling);var r=ns;t&&os(e,t)?is(r,n):(e.flags=-4097&e.flags|2,as=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,as=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function ds(e){if(e!==ns)return!1;if(!as)return us(e),as=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=rs)){if(ls(e))throw hs(),Error(s(418));for(;t;)is(e,t),t=ca(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rs=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rs=null}}else rs=ns?ca(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=rs;e;)e=ca(e.nextSibling)}function fs(){rs=ns=null,as=!1}function ps(e){null===ss?ss=[e]:ss.push(e)}var ms=x.ReactCurrentBatchConfig;function gs(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var a=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=a.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function vs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bs(e){return(0,e._init)(e._payload)}function ys(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Lc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var s=n.type;return s===j?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===P&&bs(s)===t.type)?((r=a(t,n.props)).ref=gs(e,t,n),r.return=e,r):((r=Ac(n.type,n.key,n.props,null,e.mode,r)).ref=gs(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Uc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,s){return null===t||7!==t.tag?((t=Ic(n,e.mode,r,s)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Lc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Ac(t.type,t.key,t.props,null,e.mode,n)).ref=gs(e,null,t),n.return=e,n;case _:return(t=Uc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||D(t))return(t=Ic(t,e.mode,n,null)).return=e,t;vs(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?c(e,t,n,r):null;case _:return n.key===a?u(e,t,n,r):null;case P:return f(e,t,(a=n._init)(n._payload),r)}if(te(n)||D(n))return null!==a?null:d(e,t,n,r,null);vs(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case _:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case P:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||D(r))return d(t,e=e.get(n)||null,r,a,null);vs(t,r)}return null}function m(a,s,o,l){for(var c=null,u=null,d=s,m=s=0,g=null;null!==d&&m<o.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=f(a,d,o[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(a,d),s=i(v,s,m),null===u?c=v:u.sibling=v,u=v,d=g}if(m===o.length)return n(a,d),as&&Xa(a,m),c;if(null===d){for(;m<o.length;m++)null!==(d=h(a,o[m],l))&&(s=i(d,s,m),null===u?c=d:u.sibling=d,u=d);return as&&Xa(a,m),c}for(d=r(a,d);m<o.length;m++)null!==(g=p(d,a,m,o[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),s=i(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(a,e)}),as&&Xa(a,m),c}function g(a,o,l,c){var u=D(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,m=o,g=o=0,v=null,b=l.next();null!==m&&!b.done;g++,b=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=f(a,m,b.value,c);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(a,m),o=i(y,o,g),null===d?u=y:d.sibling=y,d=y,m=v}if(b.done)return n(a,m),as&&Xa(a,g),u;if(null===m){for(;!b.done;g++,b=l.next())null!==(b=h(a,b.value,c))&&(o=i(b,o,g),null===d?u=b:d.sibling=b,d=b);return as&&Xa(a,g),u}for(m=r(a,m);!b.done;g++,b=l.next())null!==(b=p(m,a,g,b.value,c))&&(e&&null!==b.alternate&&m.delete(null===b.key?g:b.key),o=i(b,o,g),null===d?u=b:d.sibling=b,d=b);return e&&m.forEach(function(e){return t(a,e)}),as&&Xa(a,g),u}return function e(r,s,i,l){if("object"===typeof i&&null!==i&&i.type===j&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,u=s;null!==u;){if(u.key===c){if((c=i.type)===j){if(7===u.tag){n(r,u.sibling),(s=a(u,i.props.children)).return=r,r=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&bs(c)===u.type){n(r,u.sibling),(s=a(u,i.props)).ref=gs(r,u,i),s.return=r,r=s;break e}n(r,u);break}t(r,u),u=u.sibling}i.type===j?((s=Ic(i.props.children,r.mode,l,i.key)).return=r,r=s):((l=Ac(i.type,i.key,i.props,null,r.mode,l)).ref=gs(r,s,i),l.return=r,r=l)}return o(r);case _:e:{for(u=i.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===i.containerInfo&&s.stateNode.implementation===i.implementation){n(r,s.sibling),(s=a(s,i.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=Uc(i,r.mode,l)).return=r,r=s}return o(r);case P:return e(r,s,(u=i._init)(i._payload),l)}if(te(i))return m(r,s,i,l);if(D(i))return g(r,s,i,l);vs(r,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==s&&6===s.tag?(n(r,s.sibling),(s=a(s,i)).return=r,r=s):(n(r,s),(s=Lc(i,r.mode,l)).return=r,r=s),o(r)):n(r,s)}}var xs=ys(!0),ws=ys(!1),_s=ka(null),js=null,ks=null,Ns=null;function Ss(){Ns=ks=js=null}function Es(e){var t=_s.current;Na(_s),e._currentValue=t}function Cs(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ts(e,t){js=e,Ns=ks=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(yo=!0),e.firstContext=null)}function Os(e){var t=e._currentValue;if(Ns!==e)if(e={context:e,memoizedValue:t,next:null},null===ks){if(null===js)throw Error(s(308));ks=e,js.dependencies={lanes:0,firstContext:e}}else ks=ks.next=e;return t}var Rs=null;function Ps(e){null===Rs?Rs=[e]:Rs.push(e)}function As(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ps(t)):(n.next=a.next,a.next=n),t.interleaved=n,Is(e,r)}function Is(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ds=!1;function Ls(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Us(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ms(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zs(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&El)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Is(e,n)}return null===(a=r.interleaved)?(t.next=t,Ps(r)):(t.next=a.next,a.next=t),r.interleaved=t,Is(e,n)}function Bs(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,bt(e,n)}}function Fs(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?a=s=i:s=s.next=i,n=n.next}while(null!==n);null===s?a=s=t:s=s.next=t}else a=s=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function qs(e,t,n,r){var a=e.updateQueue;Ds=!1;var s=a.firstBaseUpdate,i=a.lastBaseUpdate,o=a.shared.pending;if(null!==o){a.shared.pending=null;var l=o,c=l.next;l.next=null,null===i?s=c:i.next=c,i=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=a.baseState;for(i=0,u=c=l=null,o=s;;){var h=o.lane,f=o.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,m=o;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=m.payload)?p.call(f,d,h):p)||void 0===h)break e;d=U({},d,h);break e;case 2:Ds=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=a.effects)?a.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,i|=h;if(null===(o=o.next)){if(null===(o=a.shared.pending))break;o=(h=o).next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}if(null===u&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null!==(t=a.shared.interleaved)){a=t;do{i|=a.lane,a=a.next}while(a!==t)}else null===s&&(a.shared.lanes=0);Dl|=i,e.lanes=i,e.memoizedState=d}}function Ws(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(s(191,a));a.call(r)}}}var Vs={},Hs=ka(Vs),Ks=ka(Vs),Gs=ka(Vs);function Js(e){if(e===Vs)throw Error(s(174));return e}function $s(e,t){switch(Sa(Gs,t),Sa(Ks,e),Sa(Hs,Vs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Na(Hs),Sa(Hs,t)}function Qs(){Na(Hs),Na(Ks),Na(Gs)}function Ys(e){Js(Gs.current);var t=Js(Hs.current),n=le(t,e.type);t!==n&&(Sa(Ks,e),Sa(Hs,n))}function Xs(e){Ks.current===e&&(Na(Hs),Na(Ks))}var Zs=ka(0);function ei(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ti=[];function ni(){for(var e=0;e<ti.length;e++)ti[e]._workInProgressVersionPrimary=null;ti.length=0}var ri=x.ReactCurrentDispatcher,ai=x.ReactCurrentBatchConfig,si=0,ii=null,oi=null,li=null,ci=!1,ui=!1,di=0,hi=0;function fi(){throw Error(s(321))}function pi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function mi(e,t,n,r,a,i){if(si=i,ii=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ri.current=null===e||null===e.memoizedState?Xi:Zi,e=n(r,a),ui){i=0;do{if(ui=!1,di=0,25<=i)throw Error(s(301));i+=1,li=oi=null,t.updateQueue=null,ri.current=eo,e=n(r,a)}while(ui)}if(ri.current=Yi,t=null!==oi&&null!==oi.next,si=0,li=oi=ii=null,ci=!1,t)throw Error(s(300));return e}function gi(){var e=0!==di;return di=0,e}function vi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===li?ii.memoizedState=li=e:li=li.next=e,li}function bi(){if(null===oi){var e=ii.alternate;e=null!==e?e.memoizedState:null}else e=oi.next;var t=null===li?ii.memoizedState:li.next;if(null!==t)li=t,oi=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oi=e).memoizedState,baseState:oi.baseState,baseQueue:oi.baseQueue,queue:oi.queue,next:null},null===li?ii.memoizedState=li=e:li=li.next=e}return li}function yi(e,t){return"function"===typeof t?t(e):t}function xi(e){var t=bi(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=oi,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var o=a.next;a.next=i.next,i.next=o}r.baseQueue=a=i,n.pending=null}if(null!==a){i=a.next,r=r.baseState;var l=o=null,c=null,u=i;do{var d=u.lane;if((si&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,ii.lanes|=d,Dl|=d}u=u.next}while(null!==u&&u!==i);null===c?o=r:c.next=l,or(r,t.memoizedState)||(yo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{i=a.lane,ii.lanes|=i,Dl|=i,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wi(e){var t=bi(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var o=a=a.next;do{i=e(i,o.action),o=o.next}while(o!==a);or(i,t.memoizedState)||(yo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function _i(){}function ji(e,t){var n=ii,r=bi(),a=t(),i=!or(r.memoizedState,a);if(i&&(r.memoizedState=a,yo=!0),r=r.queue,Di(Si.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==li&&1&li.memoizedState.tag){if(n.flags|=2048,Oi(9,Ni.bind(null,n,r,a,t),void 0,null),null===Cl)throw Error(s(349));0!==(30&si)||ki(n,t,a)}return a}function ki(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ni(e,t,n,r){t.value=n,t.getSnapshot=r,Ei(t)&&Ci(e)}function Si(e,t,n){return n(function(){Ei(t)&&Ci(e)})}function Ei(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ci(e){var t=Is(e,1);null!==t&&tc(t,e,1,-1)}function Ti(e){var t=vi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yi,lastRenderedState:e},t.queue=e,e=e.dispatch=Gi.bind(null,ii,e),[t.memoizedState,e]}function Oi(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ri(){return bi().memoizedState}function Pi(e,t,n,r){var a=vi();ii.flags|=e,a.memoizedState=Oi(1|t,n,void 0,void 0===r?null:r)}function Ai(e,t,n,r){var a=bi();r=void 0===r?null:r;var s=void 0;if(null!==oi){var i=oi.memoizedState;if(s=i.destroy,null!==r&&pi(r,i.deps))return void(a.memoizedState=Oi(t,n,s,r))}ii.flags|=e,a.memoizedState=Oi(1|t,n,s,r)}function Ii(e,t){return Pi(8390656,8,e,t)}function Di(e,t){return Ai(2048,8,e,t)}function Li(e,t){return Ai(4,2,e,t)}function Ui(e,t){return Ai(4,4,e,t)}function Mi(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zi(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ai(4,4,Mi.bind(null,t,e),n)}function Bi(){}function Fi(e,t){var n=bi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&pi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function qi(e,t){var n=bi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&pi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Wi(e,t,n){return 0===(21&si)?(e.baseState&&(e.baseState=!1,yo=!0),e.memoizedState=n):(or(n,t)||(n=mt(),ii.lanes|=n,Dl|=n,e.baseState=!0),t)}function Vi(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var r=ai.transition;ai.transition={};try{e(!1),t()}finally{yt=n,ai.transition=r}}function Hi(){return bi().memoizedState}function Ki(e,t,n){var r=ec(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ji(e))$i(t,n);else if(null!==(n=As(e,t,n,r))){tc(n,e,r,Zl()),Qi(n,t,r)}}function Gi(e,t,n){var r=ec(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ji(e))$i(t,a);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var i=t.lastRenderedState,o=s(i,n);if(a.hasEagerState=!0,a.eagerState=o,or(o,i)){var l=t.interleaved;return null===l?(a.next=a,Ps(t)):(a.next=l.next,l.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=As(e,t,a,r))&&(tc(n,e,r,a=Zl()),Qi(n,t,r))}}function Ji(e){var t=e.alternate;return e===ii||null!==t&&t===ii}function $i(e,t){ui=ci=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qi(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,bt(e,n)}}var Yi={readContext:Os,useCallback:fi,useContext:fi,useEffect:fi,useImperativeHandle:fi,useInsertionEffect:fi,useLayoutEffect:fi,useMemo:fi,useReducer:fi,useRef:fi,useState:fi,useDebugValue:fi,useDeferredValue:fi,useTransition:fi,useMutableSource:fi,useSyncExternalStore:fi,useId:fi,unstable_isNewReconciler:!1},Xi={readContext:Os,useCallback:function(e,t){return vi().memoizedState=[e,void 0===t?null:t],e},useContext:Os,useEffect:Ii,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pi(4194308,4,Mi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pi(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pi(4,2,e,t)},useMemo:function(e,t){var n=vi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=vi();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ki.bind(null,ii,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},vi().memoizedState=e},useState:Ti,useDebugValue:Bi,useDeferredValue:function(e){return vi().memoizedState=e},useTransition:function(){var e=Ti(!1),t=e[0];return e=Vi.bind(null,e[1]),vi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ii,a=vi();if(as){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Cl)throw Error(s(349));0!==(30&si)||ki(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,Ii(Si.bind(null,r,i,e),[e]),r.flags|=2048,Oi(9,Ni.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=vi(),t=Cl.identifierPrefix;if(as){var n=Ya;t=":"+t+"R"+(n=(Qa&~(1<<32-it(Qa)-1)).toString(32)+n),0<(n=di++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=hi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Zi={readContext:Os,useCallback:Fi,useContext:Os,useEffect:Di,useImperativeHandle:zi,useInsertionEffect:Li,useLayoutEffect:Ui,useMemo:qi,useReducer:xi,useRef:Ri,useState:function(){return xi(yi)},useDebugValue:Bi,useDeferredValue:function(e){return Wi(bi(),oi.memoizedState,e)},useTransition:function(){return[xi(yi)[0],bi().memoizedState]},useMutableSource:_i,useSyncExternalStore:ji,useId:Hi,unstable_isNewReconciler:!1},eo={readContext:Os,useCallback:Fi,useContext:Os,useEffect:Di,useImperativeHandle:zi,useInsertionEffect:Li,useLayoutEffect:Ui,useMemo:qi,useReducer:wi,useRef:Ri,useState:function(){return wi(yi)},useDebugValue:Bi,useDeferredValue:function(e){var t=bi();return null===oi?t.memoizedState=e:Wi(t,oi.memoizedState,e)},useTransition:function(){return[wi(yi)[0],bi().memoizedState]},useMutableSource:_i,useSyncExternalStore:ji,useId:Hi,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zl(),a=ec(e),s=Ms(r,a);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=zs(e,s,a))&&(tc(t,e,a,r),Bs(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zl(),a=ec(e),s=Ms(r,a);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=zs(e,s,a))&&(tc(t,e,a,r),Bs(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zl(),r=ec(e),a=Ms(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=zs(e,a,r))&&(tc(t,e,r,n),Bs(t,e,r))}};function ao(e,t,n,r,a,s,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,i):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(a,s))}function so(e,t,n){var r=!1,a=Ea,s=t.contextType;return"object"===typeof s&&null!==s?s=Os(s):(a=Pa(t)?Oa:Ca.current,s=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ea),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=s),t}function io(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},Ls(e);var s=t.contextType;"object"===typeof s&&null!==s?a.context=Os(s):(s=Pa(t)?Oa:Ca.current,a.context=Ra(e,s)),a.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(no(e,t,s,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&ro.enqueueReplaceState(a,a.state,null),qs(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=F(r),r=r.return}while(r);var a=n}catch(s){a="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:a,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(e,t,n){(n=Ms(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wl||(Wl=!0,Vl=r),uo(0,t)},n}function po(e,t,n){(n=Ms(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function mo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=kc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ms(-1,1)).tag=2,zs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bo=x.ReactCurrentOwner,yo=!1;function xo(e,t,n,r){t.child=null===e?ws(t,null,n,r):xs(t,e.child,n,r)}function wo(e,t,n,r,a){n=n.render;var s=t.ref;return Ts(t,a),r=mi(e,t,n,r,s,a),n=gi(),null===e||yo?(as&&n&&es(t),t.flags|=1,xo(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Wo(e,t,a))}function _o(e,t,n,r,a){if(null===e){var s=n.type;return"function"!==typeof s||Rc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ac(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,jo(e,t,s,r,a))}if(s=e.child,0===(e.lanes&a)){var i=s.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(i,r)&&e.ref===t.ref)return Wo(e,t,a)}return t.flags|=1,(e=Pc(s,r)).ref=t.ref,e.return=t,t.child=e}function jo(e,t,n,r,a){if(null!==e){var s=e.memoizedProps;if(lr(s,r)&&e.ref===t.ref){if(yo=!1,t.pendingProps=r=s,0===(e.lanes&a))return t.lanes=e.lanes,Wo(e,t,a);0!==(131072&e.flags)&&(yo=!0)}}return So(e,t,n,r,a)}function ko(e,t,n){var r=t.pendingProps,a=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Sa(Pl,Rl),Rl|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Sa(Pl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,Sa(Pl,Rl),Rl|=r}else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,Sa(Pl,Rl),Rl|=r;return xo(e,t,a,n),t.child}function No(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function So(e,t,n,r,a){var s=Pa(n)?Oa:Ca.current;return s=Ra(t,s),Ts(t,a),n=mi(e,t,n,r,s,a),r=gi(),null===e||yo?(as&&r&&es(t),t.flags|=1,xo(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Wo(e,t,a))}function Eo(e,t,n,r,a){if(Pa(n)){var s=!0;La(t)}else s=!1;if(Ts(t,a),null===t.stateNode)qo(e,t),so(t,n,r),oo(t,n,r,a),r=!0;else if(null===e){var i=t.stateNode,o=t.memoizedProps;i.props=o;var l=i.context,c=n.contextType;"object"===typeof c&&null!==c?c=Os(c):c=Ra(t,c=Pa(n)?Oa:Ca.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof i.getSnapshotBeforeUpdate;d||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o!==r||l!==c)&&io(t,i,r,c),Ds=!1;var h=t.memoizedState;i.state=h,qs(t,r,i,a),l=t.memoizedState,o!==r||h!==l||Ta.current||Ds?("function"===typeof u&&(no(t,n,u,r),l=t.memoizedState),(o=Ds||ao(t,n,o,r,h,l,c))?(d||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),i.props=r,i.state=l,i.context=c,r=o):("function"===typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Us(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),i.props=c,d=t.pendingProps,h=i.context,"object"===typeof(l=n.contextType)&&null!==l?l=Os(l):l=Ra(t,l=Pa(n)?Oa:Ca.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o!==d||h!==l)&&io(t,i,r,l),Ds=!1,h=t.memoizedState,i.state=h,qs(t,r,i,a);var p=t.memoizedState;o!==d||h!==p||Ta.current||Ds?("function"===typeof f&&(no(t,n,f,r),p=t.memoizedState),(c=Ds||ao(t,n,c,r,h,p,l)||!1)?(u||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(r,p,l),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),i.props=r,i.state=p,i.context=l,r=c):("function"!==typeof i.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Co(e,t,n,r,s,a)}function Co(e,t,n,r,a,s){No(e,t);var i=0!==(128&t.flags);if(!r&&!i)return a&&Ua(t,n,!1),Wo(e,t,s);r=t.stateNode,bo.current=t;var o=i&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=xs(t,e.child,null,s),t.child=xs(t,null,o,s)):xo(e,t,o,s),t.memoizedState=r.state,a&&Ua(t,n,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?Ia(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ia(0,t.context,!1),$s(e,t.containerInfo)}function Oo(e,t,n,r,a){return fs(),ps(a),t.flags|=256,xo(e,t,n,r),t.child}var Ro,Po,Ao,Io={dehydrated:null,treeContext:null,retryLane:0};function Do(e){return{baseLanes:e,cachePool:null,transitions:null}}function Lo(e,t,n){var r,a=t.pendingProps,i=Zs.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Sa(Zs,1&i),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=a.children,e=a.fallback,o?(a=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&a)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Dc(l,a,0,null),e=Ic(e,a,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Do(n),t.memoizedState=Io,e):Uo(t,l));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,a,i,o){if(n)return 256&t.flags?(t.flags&=-257,Mo(e,t,o,r=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=Dc({mode:"visible",children:r.children},a,0,null),(i=Ic(i,a,o,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,0!==(1&t.mode)&&xs(t,e.child,null,o),t.child.memoizedState=Do(o),t.memoizedState=Io,i);if(0===(1&t.mode))return Mo(e,t,o,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var l=r.dgst;return r=l,Mo(e,t,o,r=co(i=Error(s(419)),r,void 0))}if(l=0!==(o&e.childLanes),yo||l){if(null!==(r=Cl)){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|o))?0:a)&&a!==i.retryLane&&(i.retryLane=a,Is(e,a),tc(r,e,a,-1))}return pc(),Mo(e,t,o,r=co(Error(s(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Sc.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,rs=ca(a.nextSibling),ns=t,as=!0,ss=null,null!==e&&(Ga[Ja++]=Qa,Ga[Ja++]=Ya,Ga[Ja++]=$a,Qa=e.id,Ya=e.overflow,$a=t),t=Uo(t,r.children),t.flags|=4096,t)}(e,t,l,a,r,i,n);if(o){o=a.fallback,l=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&l)&&t.child!==i?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Pc(i,c)).subtreeFlags=14680064&i.subtreeFlags,null!==r?o=Pc(r,o):(o=Ic(o,l,n,null)).flags|=2,o.return=t,a.return=t,a.sibling=o,t.child=a,a=o,o=t.child,l=null===(l=e.child.memoizedState)?Do(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Io,a}return e=(o=e.child).sibling,a=Pc(o,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Uo(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Mo(e,t,n,r){return null!==r&&ps(r),xs(t,e.child,null,n),(e=Uo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Cs(e.return,t,n)}function Bo(e,t,n,r,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=a)}function Fo(e,t,n){var r=t.pendingProps,a=r.revealOrder,s=r.tail;if(xo(e,t,r.children,n),0!==(2&(r=Zs.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,n,t);else if(19===e.tag)zo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Sa(Zs,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===ei(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Bo(t,!1,a,n,s);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===ei(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Bo(t,!0,n,null,s);break;case"together":Bo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Dl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Pc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Vo(e,t){if(!as)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ho(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ko(e,t,n){var r=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ho(t),null;case 1:case 17:return Pa(t.type)&&Aa(),Ho(t),null;case 3:return r=t.stateNode,Qs(),Na(Ta),Na(Ca),ni(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(sc(ss),ss=null))),Ho(t),null;case 5:Xs(t);var a=Js(Gs.current);if(n=t.type,null!==e&&null!=t.stateNode)Po(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Ho(t),null}if(e=Js(Hs.current),ds(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[ha]=t,r[fa]=i,e=0!==(1&t.mode),n){case"dialog":zr("cancel",r),zr("close",r);break;case"iframe":case"object":case"embed":zr("load",r);break;case"video":case"audio":for(a=0;a<Dr.length;a++)zr(Dr[a],r);break;case"source":zr("error",r);break;case"img":case"image":case"link":zr("error",r),zr("load",r);break;case"details":zr("toggle",r);break;case"input":Q(r,i),zr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},zr("invalid",r);break;case"textarea":ae(r,i),zr("invalid",r)}for(var l in be(n,i),a=null,i)if(i.hasOwnProperty(l)){var c=i[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),a=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zr("scroll",r)}switch(n){case"input":K(r),Z(r,i,!0);break;case"textarea":K(r),ie(r);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(r.onclick=Zr)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[ha]=t,e[fa]=r,Ro(e,t),t.stateNode=e;e:{switch(l=ye(n,r),n){case"dialog":zr("cancel",e),zr("close",e),a=r;break;case"iframe":case"object":case"embed":zr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Dr.length;a++)zr(Dr[a],e);a=r;break;case"source":zr("error",e),a=r;break;case"img":case"image":case"link":zr("error",e),zr("load",e),a=r;break;case"details":zr("toggle",e),a=r;break;case"input":Q(e,r),a=$(e,r),zr("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=U({},r,{value:void 0}),zr("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),zr("invalid",e)}for(i in be(n,a),c=a)if(c.hasOwnProperty(i)){var u=c[i];"style"===i?ge(e,u):"dangerouslySetInnerHTML"===i?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===i?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(o.hasOwnProperty(i)?null!=u&&"onScroll"===i&&zr("scroll",e):null!=u&&y(e,i,u,l))}switch(n){case"input":K(e),Z(e,r,!1);break;case"textarea":K(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ho(t),null;case 6:if(e&&null!=t.stateNode)Ao(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(n=Js(Gs.current),Js(Hs.current),ds(t)){if(r=t.stateNode,n=t.memoizedProps,r[ha]=t,(i=r.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ha]=t,t.stateNode=r}return Ho(t),null;case 13:if(Na(Zs),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(as&&null!==rs&&0!==(1&t.mode)&&0===(128&t.flags))hs(),fs(),t.flags|=98560,i=!1;else if(i=ds(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(s(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(s(317));i[ha]=t}else fs(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ho(t),i=!1}else null!==ss&&(sc(ss),ss=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zs.current)?0===Al&&(Al=3):pc())),null!==t.updateQueue&&(t.flags|=4),Ho(t),null);case 4:return Qs(),null===e&&qr(t.stateNode.containerInfo),Ho(t),null;case 10:return Es(t.type._context),Ho(t),null;case 19:if(Na(Zs),null===(i=t.memoizedState))return Ho(t),null;if(r=0!==(128&t.flags),null===(l=i.rendering))if(r)Vo(i,!1);else{if(0!==Al||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ei(e))){for(t.flags|=128,Vo(i,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(l=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Sa(Zs,1&Zs.current|2),t.child}e=e.sibling}null!==i.tail&&Ye()>Fl&&(t.flags|=128,r=!0,Vo(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ei(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Vo(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!as)return Ho(t),null}else 2*Ye()-i.renderingStartTime>Fl&&1073741824!==n&&(t.flags|=128,r=!0,Vo(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=i.last)?n.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ye(),t.sibling=null,n=Zs.current,Sa(Zs,r?1&n|2:1&n),t):(Ho(t),null);case 22:case 23:return uc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Ho(t),6&t.subtreeFlags&&(t.flags|=8192)):Ho(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Go(e,t){switch(ts(t),t.tag){case 1:return Pa(t.type)&&Aa(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qs(),Na(Ta),Na(Ca),ni(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xs(t),null;case 13:if(Na(Zs),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fs()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Na(Zs),null;case 4:return Qs(),null;case 10:return Es(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Ro=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Js(Hs.current);var s,i=null;switch(n){case"input":a=$(e,a),r=$(e,r),i=[];break;case"select":a=U({},a,{value:void 0}),r=U({},r,{value:void 0}),i=[];break;case"textarea":a=re(e,a),r=re(e,r),i=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in be(n,r),n=null,a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&null!=a[u])if("style"===u){var l=a[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=a?a[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(i||(i=[]),i.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(i=i||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(i=i||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zr("scroll",e),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}},Ao=function(e,t,n,r){n!==r&&(t.flags|=4)};var Jo=!1,$o=!1,Qo="function"===typeof WeakSet?WeakSet:Set,Yo=null;function Xo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){jc(e,t,r)}else n.current=null}function Zo(e,t,n){try{n()}catch(r){jc(e,t,r)}}var el=!1;function tl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var s=a.destroy;a.destroy=void 0,void 0!==s&&Zo(t,n,s)}a=a.next}while(a!==r)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function rl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ha],delete t[fa],delete t[ma],delete t[ga],delete t[va])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ol(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(ol(e,t,n),e=e.sibling;null!==e;)ol(e,t,n),e=e.sibling}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}var cl=null,ul=!1;function dl(e,t,n){for(n=n.child;null!==n;)hl(e,t,n),n=n.sibling}function hl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(at,n)}catch(o){}switch(n.tag){case 5:$o||Xo(n,t);case 6:var r=cl,a=ul;cl=null,dl(e,t,n),ul=a,null!==(cl=r)&&(ul?(e=cl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cl.removeChild(n.stateNode));break;case 18:null!==cl&&(ul?(e=cl,n=n.stateNode,8===e.nodeType?la(e.parentNode,n):1===e.nodeType&&la(e,n),qt(e)):la(cl,n.stateNode));break;case 4:r=cl,a=ul,cl=n.stateNode.containerInfo,ul=!0,dl(e,t,n),cl=r,ul=a;break;case 0:case 11:case 14:case 15:if(!$o&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var s=a,i=s.destroy;s=s.tag,void 0!==i&&(0!==(2&s)||0!==(4&s))&&Zo(n,t,i),a=a.next}while(a!==r)}dl(e,t,n);break;case 1:if(!$o&&(Xo(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){jc(n,t,o)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?($o=(r=$o)||null!==n.memoizedState,dl(e,t,n),$o=r):dl(e,t,n);break;default:dl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qo),t.forEach(function(t){var r=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(s(160));hl(i,o,a),cl=null,ul=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(u){jc(a,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}function ml(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),gl(e),4&r){try{tl(3,e,e.return),nl(3,e)}catch(g){jc(e,e.return,g)}try{tl(5,e,e.return)}catch(g){jc(e,e.return,g)}}break;case 1:pl(t,e),gl(e),512&r&&null!==n&&Xo(n,n.return);break;case 5:if(pl(t,e),gl(e),512&r&&null!==n&&Xo(n,n.return),32&e.flags){var a=e.stateNode;try{he(a,"")}catch(g){jc(e,e.return,g)}}if(4&r&&null!=(a=e.stateNode)){var i=e.memoizedProps,o=null!==n?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===i.type&&null!=i.name&&Y(a,i),ye(l,o);var u=ye(l,i);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?ge(a,h):"dangerouslySetInnerHTML"===d?de(a,h):"children"===d?he(a,h):y(a,d,h,u)}switch(l){case"input":X(a,i);break;case"textarea":se(a,i);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var p=i.value;null!=p?ne(a,!!i.multiple,p,!1):f!==!!i.multiple&&(null!=i.defaultValue?ne(a,!!i.multiple,i.defaultValue,!0):ne(a,!!i.multiple,i.multiple?[]:"",!1))}a[fa]=i}catch(g){jc(e,e.return,g)}}break;case 6:if(pl(t,e),gl(e),4&r){if(null===e.stateNode)throw Error(s(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(g){jc(e,e.return,g)}}break;case 3:if(pl(t,e),gl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(g){jc(e,e.return,g)}break;case 4:default:pl(t,e),gl(e);break;case 13:pl(t,e),gl(e),8192&(a=e.child).flags&&(i=null!==a.memoizedState,a.stateNode.isHidden=i,!i||null!==a.alternate&&null!==a.alternate.memoizedState||(Bl=Ye())),4&r&&fl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?($o=(u=$o)||d,pl(t,e),$o=u):pl(t,e),gl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Yo=e,d=e.child;null!==d;){for(h=Yo=d;null!==Yo;){switch(p=(f=Yo).child,f.tag){case 0:case 11:case 14:case 15:tl(4,f,f.return);break;case 1:Xo(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){jc(r,n,g)}}break;case 5:Xo(f,f.return);break;case 22:if(null!==f.memoizedState){xl(h);continue}}null!==p?(p.return=f,Yo=p):xl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{a=h.stateNode,u?"function"===typeof(i=a.style).setProperty?i.setProperty("display","none","important"):i.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(g){jc(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){jc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),gl(e),4&r&&fl(e);case 21:}}function gl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(he(a,""),r.flags&=-33),ll(e,il(e),a);break;case 3:case 4:var i=r.stateNode.containerInfo;ol(e,il(e),i);break;default:throw Error(s(161))}}catch(o){jc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){Yo=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Yo;){var a=Yo,s=a.child;if(22===a.tag&&r){var i=null!==a.memoizedState||Jo;if(!i){var o=a.alternate,l=null!==o&&null!==o.memoizedState||$o;o=Jo;var c=$o;if(Jo=i,($o=l)&&!c)for(Yo=a;null!==Yo;)l=(i=Yo).child,22===i.tag&&null!==i.memoizedState?wl(a):null!==l?(l.return=i,Yo=l):wl(a);for(;null!==s;)Yo=s,bl(s,t,n),s=s.sibling;Yo=a,Jo=o,$o=c}yl(e)}else 0!==(8772&a.subtreeFlags)&&null!==s?(s.return=a,Yo=s):yl(e)}}function yl(e){for(;null!==Yo;){var t=Yo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$o||nl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$o)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Ws(t,i,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ws(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&qt(h)}}}break;default:throw Error(s(163))}$o||512&t.flags&&rl(t)}catch(f){jc(t,t.return,f)}}if(t===e){Yo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Yo=n;break}Yo=t.return}}function xl(e){for(;null!==Yo;){var t=Yo;if(t===e){Yo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Yo=n;break}Yo=t.return}}function wl(e){for(;null!==Yo;){var t=Yo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nl(4,t)}catch(l){jc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(l){jc(t,a,l)}}var s=t.return;try{rl(t)}catch(l){jc(t,s,l)}break;case 5:var i=t.return;try{rl(t)}catch(l){jc(t,i,l)}}}catch(l){jc(t,t.return,l)}if(t===e){Yo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Yo=o;break}Yo=t.return}}var _l,jl=Math.ceil,kl=x.ReactCurrentDispatcher,Nl=x.ReactCurrentOwner,Sl=x.ReactCurrentBatchConfig,El=0,Cl=null,Tl=null,Ol=0,Rl=0,Pl=ka(0),Al=0,Il=null,Dl=0,Ll=0,Ul=0,Ml=null,zl=null,Bl=0,Fl=1/0,ql=null,Wl=!1,Vl=null,Hl=null,Kl=!1,Gl=null,Jl=0,$l=0,Ql=null,Yl=-1,Xl=0;function Zl(){return 0!==(6&El)?Ye():-1!==Yl?Yl:Yl=Ye()}function ec(e){return 0===(1&e.mode)?1:0!==(2&El)&&0!==Ol?Ol&-Ol:null!==ms.transition?(0===Xl&&(Xl=mt()),Xl):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function tc(e,t,n,r){if(50<$l)throw $l=0,Ql=null,Error(s(185));vt(e,n,r),0!==(2&El)&&e===Cl||(e===Cl&&(0===(2&El)&&(Ll|=n),4===Al&&ic(e,Ol)),nc(e,r),1===n&&0===El&&0===(1&t.mode)&&(Fl=Ye()+500,za&&qa()))}function nc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var i=31-it(s),o=1<<i,l=a[i];-1===l?0!==(o&n)&&0===(o&r)||(a[i]=ft(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var r=ht(e,e===Cl?Ol:0);if(0===r)null!==n&&Je(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Je(n),1===t)0===e.tag?function(e){za=!0,Fa(e)}(oc.bind(null,e)):Fa(oc.bind(null,e)),ia(function(){0===(6&El)&&qa()}),n=null;else{switch(xt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Cc(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Yl=-1,Xl=0,0!==(6&El))throw Error(s(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var r=ht(e,e===Cl?Ol:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var a=El;El|=2;var i=fc();for(Cl===e&&Ol===t||(ql=null,Fl=Ye()+500,dc(e,t));;)try{vc();break}catch(l){hc(e,l)}Ss(),kl.current=i,El=a,null!==Tl?t=0:(Cl=null,Ol=0,t=Al)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=ac(e,a))),1===t)throw n=Il,dc(e,0),ic(e,r),nc(e,Ye()),n;if(6===t)ic(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],s=a.getSnapshot;a=a.value;try{if(!or(s(),a))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=mc(e,r))&&(0!==(i=pt(e))&&(r=i,t=ac(e,i))),1===t))throw n=Il,dc(e,0),ic(e,r),nc(e,Ye()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:xc(e,zl,ql);break;case 3:if(ic(e,r),(130023424&r)===r&&10<(t=Bl+500-Ye())){if(0!==ht(e,0))break;if(((a=e.suspendedLanes)&r)!==r){Zl(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(xc.bind(null,e,zl,ql),t);break}xc(e,zl,ql);break;case 4:if(ic(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-it(r);i=1<<o,(o=t[o])>a&&(a=o),r&=~i}if(r=a,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*jl(r/1960))-r)){e.timeoutHandle=ra(xc.bind(null,e,zl,ql),r);break}xc(e,zl,ql);break;default:throw Error(s(329))}}}return nc(e,Ye()),e.callbackNode===n?rc.bind(null,e):null}function ac(e,t){var n=Ml;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=zl,zl=n,null!==t&&sc(t)),e}function sc(e){null===zl?zl=e:zl.push.apply(zl,e)}function ic(e,t){for(t&=~Ul,t&=~Ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function oc(e){if(0!==(6&El))throw Error(s(327));wc();var t=ht(e,0);if(0===(1&t))return nc(e,Ye()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Il,dc(e,0),ic(e,t),nc(e,Ye()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,zl,ql),nc(e,Ye()),null}function lc(e,t){var n=El;El|=1;try{return e(t)}finally{0===(El=n)&&(Fl=Ye()+500,za&&qa())}}function cc(e){null!==Gl&&0===Gl.tag&&0===(6&El)&&wc();var t=El;El|=1;var n=Sl.transition,r=yt;try{if(Sl.transition=null,yt=1,e)return e()}finally{yt=r,Sl.transition=n,0===(6&(El=t))&&qa()}}function uc(){Rl=Pl.current,Na(Pl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Tl)for(n=Tl.return;null!==n;){var r=n;switch(ts(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Aa();break;case 3:Qs(),Na(Ta),Na(Ca),ni();break;case 5:Xs(r);break;case 4:Qs();break;case 13:case 19:Na(Zs);break;case 10:Es(r.type._context);break;case 22:case 23:uc()}n=n.return}if(Cl=e,Tl=e=Pc(e.current,null),Ol=Rl=t,Al=0,Il=null,Ul=Ll=Dl=0,zl=Ml=null,null!==Rs){for(t=0;t<Rs.length;t++)if(null!==(r=(n=Rs[t]).interleaved)){n.interleaved=null;var a=r.next,s=n.pending;if(null!==s){var i=s.next;s.next=a,r.next=i}n.pending=r}Rs=null}return e}function hc(e,t){for(;;){var n=Tl;try{if(Ss(),ri.current=Yi,ci){for(var r=ii.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}ci=!1}if(si=0,li=oi=ii=null,ui=!1,di=0,Nl.current=null,null===n||null===n.return){Al=1,Il=t,Tl=null;break}e:{var i=e,o=n.return,l=n,c=t;if(t=Ol,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,vo(p,o,l,0,t),1&p.mode&&mo(i,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){mo(i,u,t),pc();break e}c=Error(s(426))}else if(as&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),ps(lo(c,l));break e}}i=c=lo(c,l),4!==Al&&(Al=2),null===Ml?Ml=[i]:Ml.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Fs(i,fo(0,c,t));break e;case 1:l=c;var b=i.type,y=i.stateNode;if(0===(128&i.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Hl||!Hl.has(y)))){i.flags|=65536,t&=-t,i.lanes|=t,Fs(i,po(i,l,t));break e}}i=i.return}while(null!==i)}yc(n)}catch(x){t=x,Tl===n&&null!==n&&(Tl=n=n.return);continue}break}}function fc(){var e=kl.current;return kl.current=Yi,null===e?Yi:e}function pc(){0!==Al&&3!==Al&&2!==Al||(Al=4),null===Cl||0===(268435455&Dl)&&0===(268435455&Ll)||ic(Cl,Ol)}function mc(e,t){var n=El;El|=2;var r=fc();for(Cl===e&&Ol===t||(ql=null,dc(e,t));;)try{gc();break}catch(a){hc(e,a)}if(Ss(),El=n,kl.current=r,null!==Tl)throw Error(s(261));return Cl=null,Ol=0,Al}function gc(){for(;null!==Tl;)bc(Tl)}function vc(){for(;null!==Tl&&!$e();)bc(Tl)}function bc(e){var t=_l(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?yc(e):Tl=t,Nl.current=null}function yc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ko(n,t,Rl)))return void(Tl=n)}else{if(null!==(n=Go(n,t)))return n.flags&=32767,void(Tl=n);if(null===e)return Al=6,void(Tl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Tl=t);Tl=t=e}while(null!==t);0===Al&&(Al=5)}function xc(e,t,n){var r=yt,a=Sl.transition;try{Sl.transition=null,yt=1,function(e,t,n,r){do{wc()}while(null!==Gl);if(0!==(6&El))throw Error(s(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-it(n),s=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~s}}(e,i),e===Cl&&(Tl=Cl=null,Ol=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kl||(Kl=!0,Cc(tt,function(){return wc(),null})),i=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||i){i=Sl.transition,Sl.transition=null;var o=yt;yt=1;var l=El;El|=4,Nl.current=null,function(e,t){if(ea=Vt,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(w){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==a&&3!==h.nodeType||(l=o+a),h!==i||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===a&&(l=o),f===i&&++d===r&&(c=o),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Vt=!1,Yo=t;null!==Yo;)if(e=(t=Yo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Yo=e;else for(;null!==Yo;){t=Yo;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(s(163))}}catch(w){jc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Yo=e;break}Yo=t.return}m=el,el=!1}(e,n),ml(n,e),pr(ta),Vt=!!ea,ta=ea=null,e.current=n,vl(n,e,a),Qe(),El=l,yt=o,Sl.transition=i}else e.current=n;if(Kl&&(Kl=!1,Gl=e,Jl=a),i=e.pendingLanes,0===i&&(Hl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),nc(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Wl)throw Wl=!1,e=Vl,Vl=null,e;0!==(1&Jl)&&0!==e.tag&&wc(),i=e.pendingLanes,0!==(1&i)?e===Ql?$l++:($l=0,Ql=e):$l=0,qa()}(e,t,n,r)}finally{Sl.transition=a,yt=r}return null}function wc(){if(null!==Gl){var e=xt(Jl),t=Sl.transition,n=yt;try{if(Sl.transition=null,yt=16>e?16:e,null===Gl)var r=!1;else{if(e=Gl,Gl=null,Jl=0,0!==(6&El))throw Error(s(331));var a=El;for(El|=4,Yo=e.current;null!==Yo;){var i=Yo,o=i.child;if(0!==(16&Yo.flags)){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Yo=u;null!==Yo;){var d=Yo;switch(d.tag){case 0:case 11:case 15:tl(8,d,i)}var h=d.child;if(null!==h)h.return=d,Yo=h;else for(;null!==Yo;){var f=(d=Yo).sibling,p=d.return;if(al(d),d===u){Yo=null;break}if(null!==f){f.return=p,Yo=f;break}Yo=p}}}var m=i.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Yo=i}}if(0!==(2064&i.subtreeFlags)&&null!==o)o.return=i,Yo=o;else e:for(;null!==Yo;){if(0!==(2048&(i=Yo).flags))switch(i.tag){case 0:case 11:case 15:tl(9,i,i.return)}var b=i.sibling;if(null!==b){b.return=i.return,Yo=b;break e}Yo=i.return}}var y=e.current;for(Yo=y;null!==Yo;){var x=(o=Yo).child;if(0!==(2064&o.subtreeFlags)&&null!==x)x.return=o,Yo=x;else e:for(o=y;null!==Yo;){if(0!==(2048&(l=Yo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(_){jc(l,l.return,_)}if(l===o){Yo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Yo=w;break e}Yo=l.return}}if(El=a,qa(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(at,e)}catch(_){}r=!0}return r}finally{yt=n,Sl.transition=t}}return!1}function _c(e,t,n){e=zs(e,t=fo(0,t=lo(n,t),1),1),t=Zl(),null!==e&&(vt(e,1,t),nc(e,t))}function jc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){t=zs(t,e=po(t,e=lo(n,e),1),1),e=Zl(),null!==t&&(vt(t,1,e),nc(t,e));break}}t=t.return}}function kc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zl(),e.pingedLanes|=e.suspendedLanes&n,Cl===e&&(Ol&n)===n&&(4===Al||3===Al&&(130023424&Ol)===Ol&&500>Ye()-Bl?dc(e,0):Ul|=n),nc(e,t)}function Nc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=Zl();null!==(e=Is(e,t))&&(vt(e,t,n),nc(e,n))}function Sc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Nc(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),Nc(e,n)}function Cc(e,t){return Ge(e,t)}function Tc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oc(e,t,n,r){return new Tc(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=Oc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ac(e,t,n,r,a,i){var o=2;if(r=e,"function"===typeof e)Rc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case j:return Ic(n.children,a,i,t);case k:o=8,a|=8;break;case N:return(e=Oc(12,n,t,2|a)).elementType=N,e.lanes=i,e;case T:return(e=Oc(13,n,t,a)).elementType=T,e.lanes=i,e;case O:return(e=Oc(19,n,t,a)).elementType=O,e.lanes=i,e;case A:return Dc(n,a,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:o=10;break e;case E:o=9;break e;case C:o=11;break e;case R:o=14;break e;case P:o=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Oc(o,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function Ic(e,t,n,r){return(e=Oc(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=Oc(22,e,r,t)).elementType=A,e.lanes=n,e.stateNode={isHidden:!1},e}function Lc(e,t,n){return(e=Oc(6,e,null,t)).lanes=n,e}function Uc(e,t,n){return(t=Oc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Mc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,r,a,s,i,o,l){return e=new Mc(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Oc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ls(s),e}function Bc(e){if(!e)return Ea;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Pa(n))return Da(e,n,t)}return t}function Fc(e,t,n,r,a,s,i,o,l){return(e=zc(n,r,!0,e,0,s,0,o,l)).context=Bc(null),n=e.current,(s=Ms(r=Zl(),a=ec(n))).callback=void 0!==t&&null!==t?t:null,zs(n,s,a),e.current.lanes=a,vt(e,a,r),nc(e,r),e}function qc(e,t,n,r){var a=t.current,s=Zl(),i=ec(a);return n=Bc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ms(s,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=zs(a,t,i))&&(tc(e,a,i,s),Bs(e,a,i)),i}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Vc(e,t),(e=e.alternate)&&Vc(e,t)}_l=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ta.current)yo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return yo=!1,function(e,t,n){switch(t.tag){case 3:To(t),fs();break;case 5:Ys(t);break;case 1:Pa(t.type)&&La(t);break;case 4:$s(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Sa(_s,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Sa(Zs,1&Zs.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Lo(e,t,n):(Sa(Zs,1&Zs.current),null!==(e=Wo(e,t,n))?e.sibling:null);Sa(Zs,1&Zs.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Fo(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Sa(Zs,Zs.current),r)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,n)}return Wo(e,t,n)}(e,t,n);yo=0!==(131072&e.flags)}else yo=!1,as&&0!==(1048576&t.flags)&&Za(t,Ka,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;qo(e,t),e=t.pendingProps;var a=Ra(t,Ca.current);Ts(t,n),a=mi(null,t,r,e,a,n);var i=gi();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pa(r)?(i=!0,La(t)):i=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ls(t),a.updater=ro,t.stateNode=a,a._reactInternals=t,oo(t,r,e,n),t=Co(null,t,r,!0,i,n)):(t.tag=0,as&&i&&es(t),xo(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(qo(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===R)return 14}return 2}(r),e=to(r,e),a){case 0:t=So(null,t,r,e,n);break e;case 1:t=Eo(null,t,r,e,n);break e;case 11:t=wo(null,t,r,e,n);break e;case 14:t=_o(null,t,r,to(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,So(e,t,r,a=t.elementType===r?a:to(r,a),n);case 1:return r=t.type,a=t.pendingProps,Eo(e,t,r,a=t.elementType===r?a:to(r,a),n);case 3:e:{if(To(t),null===e)throw Error(s(387));r=t.pendingProps,a=(i=t.memoizedState).element,Us(e,t),qs(t,r,null,n);var o=t.memoizedState;if(r=o.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Oo(e,t,r,n,a=lo(Error(s(423)),t));break e}if(r!==a){t=Oo(e,t,r,n,a=lo(Error(s(424)),t));break e}for(rs=ca(t.stateNode.containerInfo.firstChild),ns=t,as=!0,ss=null,n=ws(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fs(),r===a){t=Wo(e,t,n);break e}xo(e,t,r,n)}t=t.child}return t;case 5:return Ys(t),null===e&&cs(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,o=a.children,na(r,a)?o=null:null!==i&&na(r,i)&&(t.flags|=32),No(e,t),xo(e,t,o,n),t.child;case 6:return null===e&&cs(t),null;case 13:return Lo(e,t,n);case 4:return $s(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xs(t,null,r,n):xo(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,wo(e,t,r,a=t.elementType===r?a:to(r,a),n);case 7:return xo(e,t,t.pendingProps,n),t.child;case 8:case 12:return xo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,Sa(_s,r._currentValue),r._currentValue=o,null!==i)if(or(i.value,o)){if(i.children===a.children&&!Ta.current){t=Wo(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){o=i.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=Ms(-1,n&-n)).tag=2;var u=i.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Cs(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===i.tag)o=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(o=i.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Cs(o,n,t),o=i.sibling}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===t){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}xo(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ts(t,n),r=r(a=Os(a)),t.flags|=1,xo(e,t,r,n),t.child;case 14:return a=to(r=t.type,t.pendingProps),_o(e,t,r,a=to(r.type,a),n);case 15:return jo(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:to(r,a),qo(e,t),t.tag=1,Pa(r)?(e=!0,La(t)):e=!1,Ts(t,n),so(t,r,a),oo(t,r,a,n),Co(null,t,r,!0,e,n);case 19:return Fo(e,t,n);case 22:return ko(e,t,n)}throw Error(s(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Gc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Yc(){}function Xc(e,t,n,r,a){var s=n._reactRootContainer;if(s){var i=s;if("function"===typeof a){var o=a;a=function(){var e=Wc(i);o.call(e)}}qc(t,i,e,a)}else i=function(e,t,n,r,a){if(a){if("function"===typeof r){var s=r;r=function(){var e=Wc(i);s.call(e)}}var i=Fc(t,r,e,0,null,!1,0,"",Yc);return e._reactRootContainer=i,e[pa]=i.current,qr(8===e.nodeType?e.parentNode:e),cc(),i}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var o=r;r=function(){var e=Wc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Yc);return e._reactRootContainer=l,e[pa]=l.current,qr(8===e.nodeType?e.parentNode:e),cc(function(){qc(t,l,n,r)}),l}(n,t,e,a,r);return Wc(i)}Jc.prototype.render=Gc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));qc(e,t,null,null)},Jc.prototype.unmount=Gc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cc(function(){qc(null,e,null,null)}),t[pa]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<At.length&&0!==t&&t<At[n].priority;n++);At.splice(n,0,e),0===n&&Ut(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(bt(t,1|n),nc(t,Ye()),0===(6&El)&&(Fl=Ye()+500,qa()))}break;case 13:cc(function(){var t=Is(e,1);if(null!==t){var n=Zl();tc(t,e,1,n)}}),Hc(e,1)}},_t=function(e){if(13===e.tag){var t=Is(e,134217728);if(null!==t)tc(t,e,134217728,Zl());Hc(e,134217728)}},jt=function(e){if(13===e.tag){var t=ec(e),n=Is(e,t);if(null!==n)tc(n,e,t,Zl());Hc(e,t)}},kt=function(){return yt},Nt=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},_e=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=wa(r);if(!a)throw Error(s(90));G(r),X(r,a)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ce=lc,Te=cc;var Zc={usingClientEntryPoint:!1,Events:[ya,xa,wa,Se,Ee,lc]},eu={findFiberByHostInstance:ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nu.isDisabled&&nu.supportsFiber)try{at=nu.inject(tu),st=nu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$c(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$c(e))throw Error(s(299));var n=!1,r="",a=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,qr(8===e.nodeType?e.parentNode:e),new Gc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return cc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(s(200));return Xc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$c(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,a=!1,i="",o=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Fc(t,null,e,1,null!=n?n:null,a,0,i,o),e[pa]=t.current,qr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Jc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(s(200));return Xc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(s(40));return!!e._reactRootContainer&&(cc(function(){Xc(null,null,e,!1,function(){e._reactRootContainer=null,e[pa]=null})}),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return Xc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853(e,t,n){e.exports=n(234)},950(e,t,n){!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();var r=n(43),a=n(391),s=n(579);function i(e){let{className:t="w-8 h-8"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("circle",{cx:"12",cy:"8",r:"3",fill:"#fff"}),(0,s.jsx)("path",{d:"M4 20c1.5-4 6-6 8-6s6.5 2 8 6",stroke:"#6b7280",strokeWidth:"1"})]})}function o(e){let{className:t="w-8 h-8"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1.5",fill:"#fff"}),(0,s.jsx)("path",{d:"M7 6v12M12 6v12M17 6v12",stroke:"#6b7280",strokeWidth:"1"})]})}function l(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"8",height:"8",rx:"1",fill:"#ffd700"}),(0,s.jsx)("rect",{x:"13",y:"3",width:"8",height:"5",rx:"1",fill:"#6a82fb"}),(0,s.jsx)("rect",{x:"13",y:"10",width:"8",height:"11",rx:"1",fill:"#43e97b"})]})}function c(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"4",y:"3",width:"6",height:"18",rx:"1",fill:"#4b6cb7"}),(0,s.jsx)("rect",{x:"14",y:"7",width:"6",height:"14",rx:"1",fill:"#182848"})]})}function u(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"6",width:"18",height:"3",rx:"1",fill:"#6a82fb"}),(0,s.jsx)("rect",{x:"3",y:"11",width:"18",height:"3",rx:"1",fill:"#fc5c7d"}),(0,s.jsx)("rect",{x:"3",y:"16",width:"18",height:"3",rx:"1",fill:"#43e97b"})]})}function d(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"#f3f4f6"}),(0,s.jsx)("rect",{x:"7",y:"7",width:"3",height:"3",fill:"#6a82fb"}),(0,s.jsx)("rect",{x:"14",y:"7",width:"3",height:"3",fill:"#ffd700"}),(0,s.jsx)("rect",{x:"7",y:"14",width:"3",height:"3",fill:"#43e97b"}),(0,s.jsx)("rect",{x:"14",y:"14",width:"3",height:"3",fill:"#ff6b6b"})]})}function h(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",fill:"#ffffff",stroke:"#e5e7eb"}),(0,s.jsx)("rect",{x:"4",y:"9",width:"6",height:"2",rx:"0.5",fill:"#6a82fb"})]})}function f(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",fill:"#f8fafc",stroke:"#e6eef8"}),(0,s.jsx)("path",{d:"M8 2v4M16 2v4",stroke:"#6b7280",strokeWidth:"1"})]})}function p(e){let{className:t="w-5 h-5"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z",fill:"#fff",stroke:"#6b7280"}),(0,s.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 2.41 16l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.67 0 1.21-.42 1.51-1a1.65 1.65 0 0 0-.33-1.82L4.3 2.41A2 2 0 1 1 7.13.58l.06.06A1.65 1.65 0 0 0 9 1.47c.3.58.84 1 1.51 1H12a2 2 0 1 1 0 4h-.09c-.67 0-1.21.42-1.51 1a1.65 1.65 0 0 0 .33 1.82l.06.06A2 2 0 1 1 16.87 7.9l-.06-.06a1.65 1.65 0 0 0-1.82-.33c-.58.3-1 0-1 1.51V9a2 2 0 1 1 4 0v.09c0 .67.42 1.21 1 1.51.7.3 1 .84 1.51 1.82z",stroke:"#6b7280",strokeWidth:"0.5"})]})}function m(e){let{className:t="w-5 h-5"}=e;return(0,s.jsx)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M21.7 13.35l-2.45-2.45a3 3 0 0 0-4.24 0l-.9.9-1.06-1.06.9-.9a3 3 0 0 0 0-4.24L10.65 2.3 8.3 4.65 9.7 6.05 7.95 7.8a6 6 0 1 0 8.49 8.49l1.75-1.75 1.4 1.4 2.35-2.35z",fill:"#fff",stroke:"#6b7280"})})}function g(e){let{className:t="w-8 h-8"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M7 5v14M12 5v14M17 5v14",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}function v(e){let{className:t="w-8 h-8"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M8 12.5l2.5 2.5L16 9.5",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})]})}function b(e){let{className:t="w-8 h-8"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3.5",y:"5",width:"17",height:"15",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M8 4v3M16 4v3M3.5 9h17",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M12 12.5l2 .8-1.2 1.7.1 2-1.9-.8-1.9.8.1-2L8 13.3l2-.8L12 10.8l2 1.7z",stroke:"currentColor",strokeWidth:"1.2",fill:"none"})]})}function y(e){let{className:t="w-8 h-8"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"4",y:"12",width:"16",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("rect",{x:"5",y:"9",width:"6",height:"3",rx:"1",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M14 9h5a2 2 0 0 1 2 2v1",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}function x(e){let{className:t="w-8 h-8"}=e;return(0,s.jsx)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M21 13l-2.5-2.5a3 3 0 0 0-4.2 0l-1 1-1.8-1.8 1-1a3 3 0 0 0 0-4.2L10 2.8 7.8 5l1.2 1.2-1.5 1.5a6 6 0 1 0 8.5 8.5l1.5-1.5 1.2 1.2L21 13z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function w(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M4 10a12 12 0 0 1 16 0",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M7 13a8 8 0 0 1 10 0",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M10 16a4 4 0 0 1 4 0",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,s.jsx)("circle",{cx:"12",cy:"19",r:"1",fill:"currentColor"})]})}function _(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),(0,s.jsx)("path",{d:"M8 3l4 3 4-3",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function j(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 4v16M4 12h16",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M7 7l3 3M14 14l3 3M7 17l3-3M14 10l3-3",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function k(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"6",y:"5",width:"12",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.2"}),(0,s.jsx)("path",{d:"M9 9h6M9 13h6",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function N(e){let{className:t="w-[10px] h-[10px]"}=e;return(0,s.jsxs)("svg",{className:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("circle",{cx:"9",cy:"9",r:"2",stroke:"currentColor",strokeWidth:"1"}),(0,s.jsx)("circle",{cx:"15",cy:"9",r:"2",stroke:"currentColor",strokeWidth:"1"}),(0,s.jsx)("path",{d:"M3 20c2-4 8-4 9-4s7 0 9 4",stroke:"currentColor",strokeWidth:"1.2",strokeLinecap:"round"})]})}function S(e){let{onNavigate:t}=e;const n=(e,n)=>{if(t){n.preventDefault&&n.preventDefault();try{console.log("Sidebar nav ->",e)}catch(r){}t(e);try{window.history.pushState({},"","/".concat(e))}catch(r){}}};return(0,s.jsxs)("aside",{className:"bg-[#16213e] text-white w-72 min-h-screen flex flex-col justify-between shadow-xl",dir:"rtl",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"p-6 text-2xl font-bold border-b border-[#1f2a48]",children:["\u0641\u0646\u062f\u0642 \u0627\u0644\u0643\u064a\u0644\u0627\u0646\u064a",(0,s.jsx)("div",{className:"text-xs font-normal mt-1 text-[#ffd700]",children:"\u0646\u0638\u0627\u0645 \u0625\u062f\u0627\u0631\u0629 \u0645\u062a\u0643\u0627\u0645\u0644"})]}),(0,s.jsxs)("nav",{className:"mt-6 flex flex-col gap-2 px-4 text-base",children:[(0,s.jsxs)("a",{href:"/dashboard",onClick:e=>n("dashboard",e),className:"py-2 px-3 rounded flex items-center gap-3 bg-[#1f2a48] text-[#ffd700]",children:[(0,s.jsx)(l,{className:"w-5 h-5"}),"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645"]}),(0,s.jsxs)("a",{href:"/buildings",onClick:e=>n("buildings",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(c,{className:"w-5 h-5"}),"\u0627\u0644\u0645\u0628\u0627\u0646\u064a"]}),(0,s.jsxs)("a",{href:"/floors",onClick:e=>n("floors",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(u,{className:"w-5 h-5"}),"\u0627\u0644\u0637\u0648\u0627\u0628\u0642"]}),(0,s.jsxs)("a",{href:"/rooms",onClick:e=>n("rooms",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(d,{className:"w-5 h-5"}),"\u0627\u0644\u063a\u0631\u0641"]}),(0,s.jsxs)("a",{href:"/room-types",onClick:e=>n("room-types",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(d,{className:"w-5 h-5"}),"\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u063a\u0631\u0641"]}),(0,s.jsxs)("a",{href:"/reservations",onClick:e=>n("reservations",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(f,{className:"w-5 h-5"}),"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0634\u0627\u0645\u0644\u0629"]}),(0,s.jsxs)("a",{href:"/guests",onClick:e=>n("guests",e),className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(i,{className:"w-5 h-5"}),"\u0627\u0644\u0646\u0632\u0644\u0627\u0621"]}),(0,s.jsxs)("a",{href:"/vacant-rooms",className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(d,{className:"w-5 h-5"}),"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0641\u0627\u0631\u063a\u0629"]}),(0,s.jsxs)("a",{href:"/smart-cards",className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(h,{className:"w-5 h-5"}),"\u0627\u0644\u0628\u0637\u0627\u0642\u0627\u062a \u0627\u0644\u0630\u0643\u064a\u0629"]}),(0,s.jsxs)("a",{href:"/users",className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(i,{className:"w-5 h-5"}),"\u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u0648\u0646"]}),(0,s.jsxs)("a",{href:"/settings",className:"py-2 px-3 rounded hover:bg-[#1f2a48] flex items-center gap-3",children:[(0,s.jsx)(p,{className:"w-5 h-5"}),"\u0625\u0639\u062f\u0627\u062f\u0627\u062a \u0627\u0644\u0646\u0638\u0627\u0645"]})]})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-[#1f2a48] flex flex-col gap-2",children:[(0,s.jsx)("div",{className:"text-sm",children:"System Administrator"}),(0,s.jsx)("button",{className:"bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded",children:"\u062e\u0631\u0648\u062c"})]})]})}function E(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function C(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{l(r.next(e))}catch(t){s(t)}}function o(e){try{l(r.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;class T extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",n=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=n}}class O extends T{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class R extends T{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class P extends T{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var A;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(A||(A={}));class I{constructor(e){let{headers:t={},customFetch:n,region:r=A.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=r,this.fetch=(e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)})(n)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){return C(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){var r;let a,s;try{const{headers:i,method:o,body:l,signal:c,timeout:u}=n;let d={},{region:h}=n;h||(h=t.region);const f=new URL("".concat(t.url,"/").concat(e));let p;h&&"any"!==h&&(d["x-region"]=h,f.searchParams.set("forceFunctionRegion",h)),l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",p=l):"string"===typeof l?(d["Content-Type"]="text/plain",p=l):"undefined"!==typeof FormData&&l instanceof FormData?p=l:(d["Content-Type"]="application/json",p=JSON.stringify(l)):p=!l||"string"===typeof l||"undefined"!==typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer||"undefined"!==typeof FormData&&l instanceof FormData?l:JSON.stringify(l);let m=c;u&&(s=new AbortController,a=setTimeout(()=>s.abort(),u),c?(m=s.signal,c.addEventListener("abort",()=>s.abort())):m=s.signal);const g=yield t.fetch(f.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},d),t.headers),i),body:p,signal:m}).catch(e=>{throw new O(e)}),v=g.headers.get("x-relay-error");if(v&&"true"===v)throw new R(g);if(!g.ok)throw new P(g);let b,y=(null!==(r=g.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return b="application/json"===y?yield g.json():"application/octet-stream"===y||"application/pdf"===y?yield g.blob():"text/event-stream"===y?g:"multipart/form-data"===y?yield g.formData():yield g.text(),{data:b,error:null,response:g}}catch(i){return{data:null,error:i,response:i instanceof P||i instanceof R?i.context:void 0}}finally{a&&clearTimeout(a)}}()})}}var D=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},L=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(n=e.isMaybeSingle)&&void 0!==n&&n,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var n=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,r=null,a=null,s=e.status,i=e.statusText;if(e.ok){var o,l;if("HEAD"!==n.method){var c;const t=await e.text();""===t||(r="text/csv"===n.headers.get("Accept")||n.headers.get("Accept")&&(null===(c=n.headers.get("Accept"))||void 0===c?void 0:c.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const u=null===(o=n.headers.get("Prefer"))||void 0===o?void 0:o.match(/count=(exact|planned|estimated)/),d=null===(l=e.headers.get("content-range"))||void 0===l?void 0:l.split("/");u&&d&&d.length>1&&(a=parseInt(d[1])),n.isMaybeSingle&&"GET"===n.method&&Array.isArray(r)&&(r.length>1?(t={code:"PGRST116",details:"Results contain ".concat(r.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},r=null,a=null,s=406,i="Not Acceptable"):r=1===r.length?r[0]:null)}else{var u;const a=await e.text();try{t=JSON.parse(a),Array.isArray(t)&&404===e.status&&(r=[],t=null,s=200,i="OK")}catch(d){404===e.status&&""===a?(s=204,i="No Content"):t={message:a}}if(t&&n.isMaybeSingle&&(null===t||void 0===t||null===(u=t.details)||void 0===u?void 0:u.includes("0 rows"))&&(t=null,s=200,i="OK"),t&&n.shouldThrowOnError)throw new D(t)}return{error:t,data:r,count:a,status:s,statusText:i}});return this.shouldThrowOnError||(r=r.catch(e=>{var t;let n="";const r=null===e||void 0===e?void 0:e.cause;if(r){var a,s,i,o;const t=null!==(a=null===r||void 0===r?void 0:r.message)&&void 0!==a?a:"",l=null!==(s=null===r||void 0===r?void 0:r.code)&&void 0!==s?s:"";n="".concat(null!==(i=null===e||void 0===e?void 0:e.name)&&void 0!==i?i:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),n+="\n\nCaused by: ".concat(null!==(o=null===r||void 0===r?void 0:r.name)&&void 0!==o?o:"Error",": ").concat(t),l&&(n+=" (".concat(l,")")),(null===r||void 0===r?void 0:r.stack)&&(n+="\n".concat(r.stack))}else{var l;n=null!==(l=null===e||void 0===e?void 0:e.stack)&&void 0!==l?l:""}return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:n,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}},U=class extends L{select(e){let t=!1;const n=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:a=r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=a?"".concat(a,".order"):"order",i=this.url.searchParams.get(s);return this.url.searchParams.set(s,"".concat(i?"".concat(i,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===n?"":n?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="undefined"===typeof n?"limit":"".concat(n,".limit");return this.url.searchParams.set(r,"".concat(e)),this}range(e,t){let{foreignTable:n,referencedTable:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a="undefined"===typeof r?"offset":"".concat(r,".offset"),s="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(a,"".concat(e)),this.url.searchParams.set(s,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:a=!1,format:s="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var i;const o=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(s,'; for="').concat(l,'"; options=').concat(o,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}};const M=new RegExp("[,()]");var z=class extends U{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}regexMatch(e,t){return this.url.searchParams.append(e,"match.".concat(t)),this}regexIMatch(e,t){return this.url.searchParams.append(e,"imatch.".concat(t)),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}isDistinct(e,t){return this.url.searchParams.append(e,"isdistinct.".concat(t)),this}in(e,t){const n=Array.from(new Set(t)).map(e=>"string"===typeof e&&M.test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(n,")")),this}notIn(e,t){const n=Array.from(new Set(t)).map(e=>"string"===typeof e&&M.test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"not.in.(".concat(n,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:n,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");const s=void 0===n?"":"(".concat(n,")");return this.url.searchParams.append(e,"".concat(a,"fts").concat(s,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,n]=e;this.url.searchParams.append(t,"eq.".concat(n))}),this}not(e,t,n){return this.url.searchParams.append(e,"not.".concat(t,".").concat(n)),this}or(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n?"".concat(n,".or"):"or";return this.url.searchParams.append(r,"(".concat(e,")")),this}filter(e,t,n){return this.url.searchParams.append(e,"".concat(t,".").concat(n)),this}},B=class{constructor(e,t){let{headers:n={},schema:r,fetch:a}=t;this.url=e,this.headers=new Headers(n),this.schema=r,this.fetch=a}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:n=!1,count:r}=null!==t&&void 0!==t?t:{},a=n?"HEAD":"GET";let s=!1;const i=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!s?"":('"'===e&&(s=!s),e)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",i),r&&l.append("Prefer","count=".concat(r)),new z({method:a,url:o,headers:l,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;const{url:a,headers:s}=this.cloneRequestState();if(t&&s.append("Prefer","count=".concat(t)),n||s.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));a.searchParams.set("columns",e.join(","))}}return new z({method:"POST",url:a,headers:s,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:a=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s;const{url:i,headers:o}=this.cloneRequestState();if(o.append("Prefer","resolution=".concat(n?"ignore":"merge","-duplicates")),void 0!==t&&i.searchParams.set("on_conflict",t),r&&o.append("Prefer","count=".concat(r)),a||o.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));i.searchParams.set("columns",e.join(","))}}return new z({method:"POST",url:i,headers:o,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const{url:r,headers:a}=this.cloneRequestState();return t&&a.append("Prefer","count=".concat(t)),new z({method:"PATCH",url:r,headers:a,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;const{url:n,headers:r}=this.cloneRequestState();return e&&r.append("Prefer","count=".concat(e)),new z({method:"DELETE",url:n,headers:r,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}},F=class e{constructor(e){let{headers:t={},schema:n,fetch:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=r}from(e){if(!e||"string"!==typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new B(new URL("".concat(this.url,"/").concat(e)),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:n=!1,get:r=!1,count:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var s;let i;const o=new URL("".concat(this.url,"/rpc/").concat(e));let l;const c=e=>null!==e&&"object"===typeof e&&(!Array.isArray(e)||e.some(c)),u=n&&Object.values(t).some(c);u?(i="POST",l=t):n||r?(i=n?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,n]=e;return void 0!==n}).map(e=>{let[t,n]=e;return[t,Array.isArray(n)?"{".concat(n.join(","),"}"):"".concat(n)]}).forEach(e=>{let[t,n]=e;o.searchParams.append(t,n)})):(i="POST",l=t);const d=new Headers(this.headers);return u?d.set("Prefer",a?"count=".concat(a,",return=minimal"):"return=minimal"):a&&d.set("Prefer","count=".concat(a)),new z({method:i,url:o,headers:d,schema:this.schemaName,body:l,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}};const q=class{constructor(){}static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket)return{type:"native",constructor:n.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node){const t=e.node,n=parseInt(t.replace(/^v/,"").split(".")[0]);return n>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(n," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(n," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},W="realtime-js/".concat("2.90.1"),V="1.0.0",H=V,K=1e4;var G,J,$,Q,Y,X;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(G||(G={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(J||(J={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}($||($={})),function(e){e.websocket="websocket"}(Q||(Q={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(Y||(Y={}));class Z{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!==e&&void 0!==e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"===typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,n;const r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:{},a=(new TextEncoder).encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,t,n){var r,a;const s=e.topic,i=null!==(r=e.ref)&&void 0!==r?r:"",o=null!==(a=e.join_ref)&&void 0!==a?a:"",l=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},u=0===Object.keys(c).length?"":JSON.stringify(c);if(o.length>255)throw new Error("joinRef length ".concat(o.length," exceeds maximum of 255"));if(i.length>255)throw new Error("ref length ".concat(i.length," exceeds maximum of 255"));if(s.length>255)throw new Error("topic length ".concat(s.length," exceeds maximum of 255"));if(l.length>255)throw new Error("userEvent length ".concat(l.length," exceeds maximum of 255"));if(u.length>255)throw new Error("metadata length ".concat(u.length," exceeds maximum of 255"));const d=this.USER_BROADCAST_PUSH_META_LENGTH+o.length+i.length+s.length+l.length+u.length,h=new ArrayBuffer(this.HEADER_LENGTH+d);let f=new DataView(h),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,o.length),f.setUint8(p++,i.length),f.setUint8(p++,s.length),f.setUint8(p++,l.length),f.setUint8(p++,u.length),f.setUint8(p++,t),Array.from(o,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(i,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(s,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(l,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(u,e=>f.setUint8(p++,e.charCodeAt(0)));var m=new Uint8Array(h.byteLength+n.byteLength);return m.set(new Uint8Array(h),0),m.set(new Uint8Array(n),h.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e)){return t(this._binaryDecode(e))}if("string"===typeof e){const n=JSON.parse(e),[r,a,s,i,o]=n;return t({join_ref:r,ref:a,topic:s,event:i,payload:o})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;if(n===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}_decodeUserBroadcast(e,t,n){const r=t.getUint8(1),a=t.getUint8(2),s=t.getUint8(3),i=t.getUint8(4);let o=this.HEADER_LENGTH+4;const l=n.decode(e.slice(o,o+r));o+=r;const c=n.decode(e.slice(o,o+a));o+=a;const u=n.decode(e.slice(o,o+s));o+=s;const d=e.slice(o,e.byteLength),h=i===this.JSON_ENCODING?JSON.parse(n.decode(d)):d,f={type:this.BROADCAST_EVENT,event:c,payload:h};return s>0&&(f.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null===e||void 0===e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"===typeof e?Object.fromEntries(Object.entries(e).filter(e=>{let[n]=e;return t.includes(n)})):{}}}class ee{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(X||(X={}));const te=function(e,t){var n;const r=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce((n,a)=>(n[a]=ne(a,e,t,r),n),{}):{}},ne=(e,t,n,r)=>{const a=t.find(t=>t.name===e),s=null===a||void 0===a?void 0:a.type,i=n[e];return s&&!r.includes(s)?re(s,i):ae(i)},re=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return le(t,n)}switch(e){case X.bool:return se(t);case X.float4:case X.float8:case X.int2:case X.int4:case X.int8:case X.numeric:case X.oid:return ie(t);case X.json:case X.jsonb:return oe(t);case X.timestamp:return ce(t);case X.abstime:case X.date:case X.daterange:case X.int4range:case X.int8range:case X.money:case X.reltime:case X.text:case X.time:case X.timestamptz:case X.timetz:case X.tsrange:case X.tstzrange:default:return ae(t)}},ae=e=>e,se=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ie=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},oe=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return e}return e},le=(e,t)=>{if("string"!==typeof e)return e;const n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){let r;const s=e.slice(1,n);try{r=JSON.parse("["+s+"]")}catch(a){r=s?s.split(","):[]}return r.map(e=>re(t,e))}return e},ce=e=>"string"===typeof e?e.replace(" ","T"):e,ue=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class de{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K;this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:n}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var he,fe,pe,me;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(he||(he={}));class ge{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ge.syncState(this.state,e,t,n),this.pendingDiffs.forEach(e=>{this.state=ge.syncDiff(this.state,e,t,n)}),this.pendingDiffs=[],r()}),this.channel._on(n.diff,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=ge.syncDiff(this.state,e,t,n),r())}),this.onJoin((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})}),this.onLeave((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const a=this.cloneDeep(e),s=this.transformState(t),i={},o={};return this.map(a,(e,t)=>{s[e]||(o[e]=t)}),this.map(s,(e,t)=>{const n=a[e];if(n){const r=t.map(e=>e.presence_ref),a=n.map(e=>e.presence_ref),s=t.filter(e=>a.indexOf(e.presence_ref)<0),l=n.filter(e=>r.indexOf(e.presence_ref)<0);s.length>0&&(i[e]=s),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(a,{joins:i,leaves:o},n,r)}static syncDiff(e,t,n,r){const{joins:a,leaves:s}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(a,(t,r)=>{var a;const s=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),s.length>0){const n=e[t].map(e=>e.presence_ref),r=s.filter(e=>n.indexOf(e.presence_ref)<0);e[t].unshift(...r)}n(t,s,r)}),this.map(s,(t,n)=>{let a=e[t];if(!a)return;const s=n.map(e=>e.presence_ref);a=a.filter(e=>s.indexOf(e.presence_ref)<0),e[t]=a,r(t,a,n),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return t[n]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(fe||(fe={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(pe||(pe={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(me||(me={}));class ve{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n=arguments.length>2?arguments[2]:void 0;var r,a;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=J.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new de(this,$.join,this.params,this.timeout),this.rejoinTimer=new ee(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=J.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=J.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=J.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=J.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=J.errored,this.rejoinTimer.scheduleTimeout())}),this._on($.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new ge(this),this.broadcastEndpointURL=ue(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(a=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===a?void 0:a.replay))throw"tried to use replay on public channel '".concat(this.topic,"'. It must be a private channel.")}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var n,r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==J.closed){const{config:{broadcast:s,presence:i,private:o}}=this.params,l=null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[pe.PRESENCE]&&this.bindings[pe.PRESENCE].length>0||!0===(null===(a=this.params.config.presence)||void 0===a?void 0:a.enabled),u={},d={broadcast:s,presence:Object.assign(Object.assign({},i),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e(me.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e(me.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:n}=t;var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==n){const t=this.bindings.postgres_changes,a=null!==(r=null===t||void 0===t?void 0:t.length)&&void 0!==r?r:0,s=[];for(let r=0;r<a;r++){const a=t[r],{filter:{event:i,schema:o,table:l,filter:c}}=a,u=n&&n[r];if(!(u&&u.event===i&&ve.isFilterValueEqual(u.schema,o)&&ve.isFilterValueEqual(u.table,l)&&ve.isFilterValueEqual(u.filter,c)))return this.unsubscribe(),this.state=J.errored,void(null===e||void 0===e||e(me.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},a),{id:u.id}))}return this.bindings.postgres_changes=s,void(e&&e(me.SUBSCRIBED))}null===e||void 0===e||e(me.SUBSCRIBED)}).receive("error",t=>{this.state=J.errored,null===e||void 0===e||e(me.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e(me.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===J.joined&&e===pe.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r;if(void 0===t||null===t)return Promise.reject("Payload is required for httpSend()");const a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization="Bearer ".concat(this.socket.accessTokenValue));const s={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,s,null!==(r=n.timeout)&&void 0!==r?r:this.timeout);if(202===i.status)return{success:!0};let o=i.statusText;try{const e=await i.json();o=e.error||e.message||o}catch(l){}return Promise.reject(new Error(o))}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(n=>{var r,a,s;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(s=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===s?void 0:s.ack)||n("ok"),i.receive("ok",()=>n("ok")),i.receive("error",()=>n("error")),i.receive("timeout",()=>n("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:i}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization="Bearer ".concat(this.socket.accessTokenValue));const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,l,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=J.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger($.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new de(this,$.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null===n||void 0===n||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=J.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,a=setTimeout(()=>r.abort(),n),s=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),s}_push(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let r=new de(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,a;const s=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=$;if(n&&[i,o,l,c].indexOf(s)>=0&&n!==this._joinRef())return;let u=this._onMessage(s,t,n);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,n,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===s}).map(e=>e.callback(u,n)):null===(a=this.bindings[s])||void 0===a||a.filter(e=>{var n,r,a,i,o,l,c,u;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in e){const s=e.id,l=null===(n=e.filter)||void 0===n?void 0:n.event;return s&&(null===(r=t.ids)||void 0===r?void 0:r.includes(s))&&("*"===l||(null===l||void 0===l?void 0:l.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))&&(!(null===(i=e.filter)||void 0===i?void 0:i.table)||e.filter.table===(null===(o=t.data)||void 0===o?void 0:o.table))}{const n=null===(c=null===(l=null===e||void 0===e?void 0:e.filter)||void 0===l?void 0:l.event)||void 0===c?void 0:c.toLocaleLowerCase();return"*"===n||n===(null===(u=null===t||void 0===t?void 0:t.event)||void 0===u?void 0:u.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===s}).map(e=>{if("object"===typeof u&&"ids"in u){const e=u.data,{schema:t,table:n,commit_timestamp:r,type:a,errors:s}=e,i={schema:t,table:n,commit_timestamp:r,eventType:a,new:{},old:{},errors:s};u=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(u,n)})}_isClosed(){return this.state===J.closed}_isJoined(){return this.state===J.joined}_isJoining(){return this.state===J.joining}_isLeaving(){return this.state===J.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,n){const r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&ve.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(null!==e&&void 0!==e?e:void 0)===(null!==t&&void 0!==t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on($.close,{},e)}_onError(e){this._on($.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=J.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=te(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=te(e.columns,e.old_record)),t}}const be=()=>{},ye=25e3,xe=10,we=100,_e=[1e3,2e3,5e3,1e4];class je{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=K,this.transport=null,this.heartbeatIntervalMs=ye,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=be,this.ref=0,this.reconnectTimer=null,this.vsn=H,this.logger=be,this.conn=null,this.sendBuffer=[],this.serializer=new Z,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},!(null===(n=null===t||void 0===t?void 0:t.params)||void 0===n?void 0:n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(Q.websocket),this.httpEndpoint=ue(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=q.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},"function"===typeof this.conn.close&&(e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case G.connecting:return Y.Connecting;case G.open:return Y.Open;case G.closing:return Y.Closing;default:return Y.Closed}}isConnected(){return this.connectionState()===Y.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const n="realtime:".concat(e),r=this.getChannels().find(e=>e.topic===n);if(r)return r;{const n=new ve("realtime:".concat(e),t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:n,payload:r,ref:a}=e,s=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(n," (").concat(a,")"),r),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},we)}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){const t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(o){this.log("error","error in heartbeat callback",o)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:t,event:n,payload:r,ref:a}=e,s=a?"(".concat(a,")"):"",i=r.status||"";this.log("receive","".concat(i," ").concat(t," ").concat(n," ").concat(s).trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(n,r,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===G.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===G.open||this.conn.readyState===G.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL()));(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger($.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return"".concat(e).concat(n).concat(r)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!1;if(t)e=t,n=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),e=this.accessTokenValue}else e=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const n={access_token:e,version:W};e&&t.updateJoinPayload(n),t.joinedOnce&&t._isJoined()&&t._push($.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this._isManualToken()||this.setAuth().catch(t=>{this.log("error","Error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(r){this.log("error","error in ".concat(e," callback"),r)}})}catch(n){this.log("error","error triggering ".concat(e," callbacks"),n)}}_setupReconnectionTimer(){this.reconnectTimer=new ee(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},xe)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,a,s,i,o,l,c,u,d,h;switch(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(n=null===e||void 0===e?void 0:e.timeout)&&void 0!==n?n:K,this.heartbeatIntervalMs=null!==(r=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:ye,this.worker=null!==(a=null===e||void 0===e?void 0:e.worker)&&void 0!==a&&a,this.accessToken=null!==(s=null===e||void 0===e?void 0:e.accessToken)&&void 0!==s?s:null,this.heartbeatCallback=null!==(i=null===e||void 0===e?void 0:e.heartbeatCallback)&&void 0!==i?i:be,this.vsn=null!==(o=null===e||void 0===e?void 0:e.vsn)&&void 0!==o?o:H,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>_e[e-1]||1e4,this.vsn){case V:this.encode=null!==(c=null===e||void 0===e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(u=null===e||void 0===e?void 0:e.decode)&&void 0!==u?u:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(d=null===e||void 0===e?void 0:e.encode)&&void 0!==d?d:this.serializer.encode.bind(this.serializer),this.decode=null!==(h=null===e||void 0===e?void 0:e.decode)&&void 0!==h?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error("Unsupported serializer version: ".concat(this.vsn))}if(this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Ne(e){var t=function(e,t){if("object"!=ke(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ke(t)?t:t+""}function Se(e,t,n){return(t=Ne(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach(function(t){Se(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Te=class extends Error{constructor(e,t){var n;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===(null===(n=t.icebergType)||void 0===n?void 0:n.includes("CommitState"))}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function Oe(e){var t;const n=null!==(t=e.fetchImpl)&&void 0!==t?t:globalThis.fetch;return{async request(t){let{method:r,path:a,query:s,body:i,headers:o}=t;const l=function(e,t,n){const r=new URL(t,e);if(n)for(const[a,s]of Object.entries(n))void 0!==s&&r.searchParams.set(a,s);return r.toString()}(e.baseUrl,a,s),c=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:"Bearer ".concat(e.token)}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),u=await n(l,{method:r,headers:Ce(Ce(Ce({},i?{"Content-Type":"application/json"}:{}),c),o),body:i?JSON.stringify(i):void 0}),d=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),f=h&&d?JSON.parse(d):d;if(!u.ok){var p;const e=h?f:void 0,t=null===e||void 0===e?void 0:e.error;throw new Te(null!==(p=null===t||void 0===t?void 0:t.message)&&void 0!==p?p:"Request failed with status ".concat(u.status),{status:u.status,icebergType:null===t||void 0===t?void 0:t.type,icebergCode:null===t||void 0===t?void 0:t.code,details:e})}return{status:u.status,headers:u.headers,data:f}}}}function Re(e){return e.join("\x1f")}var Pe=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Re(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces"),query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const n={namespace:e.namespace,properties:null===t||void 0===t?void 0:t.properties};return(await this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces"),body:n})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:"".concat(this.prefix,"/namespaces/").concat(Re(e.namespace))})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Re(e.namespace))})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:"".concat(this.prefix,"/namespaces/").concat(Re(e.namespace))}),!0}catch(t){if(t instanceof Te&&404===t.status)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(n){if(n instanceof Te&&409===n.status)return;throw n}}};function Ae(e){return e.join("\x1f")}var Ie=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;this.client=e,this.prefix=t,this.accessDelegation=n}async listTables(e){return(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Ae(e.namespace),"/tables")})).data.identifiers}async createTable(e,t){const n={};this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces/").concat(Ae(e.namespace),"/tables"),body:t,headers:n})).data.metadata}async updateTable(e,t){const n=await this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces/").concat(Ae(e.namespace),"/tables/").concat(e.name),body:t});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(e,t){var n;await this.client.request({method:"DELETE",path:"".concat(this.prefix,"/namespaces/").concat(Ae(e.namespace),"/tables/").concat(e.name),query:{purgeRequested:String(null!==(n=null===t||void 0===t?void 0:t.purge)&&void 0!==n&&n)}})}async loadTable(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Ae(e.namespace),"/tables/").concat(e.name),headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:"".concat(this.prefix,"/namespaces/").concat(Ae(e.namespace),"/tables/").concat(e.name),headers:t}),!0}catch(n){if(n instanceof Te&&404===n.status)return!1;throw n}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(n){if(n instanceof Te&&409===n.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw n}}},De=class{constructor(e){var t;let n="v1";e.catalogName&&(n+="/".concat(e.catalogName));const r=e.baseUrl.endsWith("/")?e.baseUrl:"".concat(e.baseUrl,"/");this.client=Oe({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=null===(t=e.accessDelegation)||void 0===t?void 0:t.join(","),this.namespaceOps=new Pe(this.client,n),this.tableOps=new Ie(this.client,n,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}};var Le=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function Ue(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}var Me=class extends Le{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ze=class extends Le{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const Be=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},Fe=e=>{if(Array.isArray(e))return e.map(e=>Fe(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[n,r]=e;const a=n.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[a]=Fe(r)}),t};function qe(e){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e){var t=function(e,t){if("object"!=qe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=qe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qe(t)?t:t+""}function Ve(e,t,n){return(t=We(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach(function(t){Ve(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const Ge=e=>{var t;return e.msg||e.message||e.error_description||("string"===typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},Je=async(e,t,n)=>{e instanceof await Response&&!(null===n||void 0===n?void 0:n.noResolveJson)?e.json().then(n=>{const r=e.status||500,a=(null===n||void 0===n?void 0:n.statusCode)||r+"";t(new Me(Ge(n),r,a))}).catch(e=>{t(new ze(Ge(e),e))}):t(new ze(Ge(e),e))},$e=(e,t,n,r)=>{const a={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(a.headers=Ke({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,(null===t||void 0===t?void 0:t.duplex)&&(a.duplex=t.duplex),Ke(Ke({},a),n)):a};async function Qe(e,t,n,r,a,s){return new Promise((i,o)=>{e(n,$e(t,r,a,s)).then(e=>{if(!e.ok)throw e;return(null===r||void 0===r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>Je(e,o,r))})}async function Ye(e,t,n,r){return Qe(e,"GET",t,n,r)}async function Xe(e,t,n,r,a){return Qe(e,"POST",t,r,a,n)}async function Ze(e,t,n,r,a){return Qe(e,"PUT",t,r,a,n)}async function et(e,t,n,r,a){return Qe(e,"DELETE",t,r,a,n)}var tt=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ue(e))return{data:null,error:e};throw e}}};let nt;nt=Symbol.toStringTag;var rt=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[nt]="BlobDownloadBuilder",this.promise=null}asStream(){return new tt(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ue(e))return{data:null,error:e};throw e}}};const at={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},st={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var it=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=Be(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,n,r){var a=this;try{let s;const i=Ke(Ke({},st),r);let o=Ke(Ke({},a.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const l=i.metadata;"undefined"!==typeof Blob&&n instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",a.encodeMetadata(l)),s.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(s=n,s.has("cacheControl")||s.append("cacheControl",i.cacheControl),l&&!s.has("metadata")&&s.append("metadata",a.encodeMetadata(l))):(s=n,o["cache-control"]="max-age=".concat(i.cacheControl),o["content-type"]=i.contentType,l&&(o["x-metadata"]=a.toBase64(a.encodeMetadata(l))),("undefined"!==typeof ReadableStream&&s instanceof ReadableStream||s&&"object"===typeof s&&"pipe"in s&&"function"===typeof s.pipe)&&!i.duplex&&(i.duplex="half")),(null===r||void 0===r?void 0:r.headers)&&(o=Ke(Ke({},o),r.headers));const c=a._removeEmptyFolders(t),u=a._getFinalPath(c),d=await("PUT"==e?Ze:Xe)(a.fetch,"".concat(a.url,"/object/").concat(u),s,Ke({headers:o},(null===i||void 0===i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(s){if(a.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async upload(e,t,n){return this.uploadOrUpdate("POST",e,t,n)}async uploadToSignedUrl(e,t,n,r){var a=this;const s=a._removeEmptyFolders(e),i=a._getFinalPath(s),o=new URL(a.url+"/object/upload/sign/".concat(i));o.searchParams.set("token",t);try{let e;const t=Ke({upsert:st.upsert},r),i=Ke(Ke({},a.headers),{"x-upsert":String(t.upsert)});return"undefined"!==typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,i["cache-control"]="max-age=".concat(t.cacheControl),i["content-type"]=t.contentType),{data:{path:s,fullPath:(await Ze(a.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(l){if(a.shouldThrowOnError)throw l;if(Ue(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(e,t){var n=this;try{let r=n._getFinalPath(e);const a=Ke({},n.headers);(null===t||void 0===t?void 0:t.upsert)&&(a["x-upsert"]="true");const s=await Xe(n.fetch,"".concat(n.url,"/object/upload/sign/").concat(r),{},{headers:a}),i=new URL(n.url+s.url),o=i.searchParams.get("token");if(!o)throw new Le("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Ue(r))return{data:null,error:r};throw r}}async update(e,t,n){return this.uploadOrUpdate("PUT",e,t,n)}async move(e,t,n){var r=this;try{return{data:await Xe(r.fetch,"".concat(r.url,"/object/move"),{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:r.headers}),error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(Ue(a))return{data:null,error:a};throw a}}async copy(e,t,n){var r=this;try{return{data:{path:(await Xe(r.fetch,"".concat(r.url,"/object/copy"),{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:r.headers})).Key},error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(Ue(a))return{data:null,error:a};throw a}}async createSignedUrl(e,t,n){var r=this;try{let a=r._getFinalPath(e),s=await Xe(r.fetch,"".concat(r.url,"/object/sign/").concat(a),Ke({expiresIn:t},(null===n||void 0===n?void 0:n.transform)?{transform:n.transform}:{}),{headers:r.headers});const i=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return s={signedUrl:encodeURI("".concat(r.url).concat(s.signedURL).concat(i))},{data:s,error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(Ue(a))return{data:null,error:a};throw a}}async createSignedUrls(e,t,n){var r=this;try{const a=await Xe(r.fetch,"".concat(r.url,"/object/sign/").concat(r.bucketId),{expiresIn:t,paths:e},{headers:r.headers}),s=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return{data:a.map(e=>Ke(Ke({},e),{},{signedUrl:e.signedURL?encodeURI("".concat(r.url).concat(e.signedURL).concat(s)):null})),error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(Ue(a))return{data:null,error:a};throw a}}download(e,t){const n="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),a=r?"?".concat(r):"",s=this._getFinalPath(e);return new rt(()=>Ye(this.fetch,"".concat(this.url,"/").concat(n,"/").concat(s).concat(a),{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){var t=this;const n=t._getFinalPath(e);try{return{data:Fe(await Ye(t.fetch,"".concat(t.url,"/object/info/").concat(n),{headers:t.headers})),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Ue(r))return{data:null,error:r};throw r}}async exists(e){var t=this;const n=t._getFinalPath(e);try{return await async function(e,t,n,r){return Qe(e,"HEAD",t,Ke(Ke({},n),{},{noResolveJson:!0}),r)}(t.fetch,"".concat(t.url,"/object/").concat(n),{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Ue(r)&&r instanceof ze){const e=r.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:r}}throw r}}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],a=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==a&&r.push(a);const s="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==i&&r.push(i);let o=r.join("&");return""!==o&&(o="?".concat(o)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(s,"/public/").concat(n).concat(o))}}}async remove(e){var t=this;try{return{data:await et(t.fetch,"".concat(t.url,"/object/").concat(t.bucketId),{prefixes:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async list(e,t,n){var r=this;try{const a=Ke(Ke(Ke({},at),t),{},{prefix:e||""});return{data:await Xe(r.fetch,"".concat(r.url,"/object/list/").concat(r.bucketId),a,{headers:r.headers},n),error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(Ue(a))return{data:null,error:a};throw a}}async listV2(e,t){var n=this;try{const r=Ke({},e);return{data:await Xe(n.fetch,"".concat(n.url,"/object/list-v2/").concat(n.bucketId),r,{headers:n.headers},t),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Ue(r))return{data:null,error:r};throw r}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}};const ot="2.90.1",lt={"X-Client-Info":"storage-js/".concat(ot)};var ct=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1;const a=new URL(e);(null===r||void 0===r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Ke(Ke({},lt),t),this.fetch=Be(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const n=t.listBucketOptionsToQueryString(e);return{data:await Ye(t.fetch,"".concat(t.url,"/bucket").concat(n),{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async getBucket(e){var t=this;try{return{data:await Ye(t.fetch,"".concat(t.url,"/bucket/").concat(e),{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async createBucket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};var n=this;try{return{data:await Xe(n.fetch,"".concat(n.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Ue(r))return{data:null,error:r};throw r}}async updateBucket(e,t){var n=this;try{return{data:await Ze(n.fetch,"".concat(n.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Ue(r))return{data:null,error:r};throw r}}async emptyBucket(e){var t=this;try{return{data:await Xe(t.fetch,"".concat(t.url,"/bucket/").concat(e,"/empty"),{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await et(t.fetch,"".concat(t.url,"/bucket/").concat(e),{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},ut=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Ke(Ke({},lt),t),this.fetch=Be(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Xe(t.fetch,"".concat(t.url,"/bucket"),{name:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async listBuckets(e){var t=this;try{const n=new URLSearchParams;void 0!==(null===e||void 0===e?void 0:e.limit)&&n.set("limit",e.limit.toString()),void 0!==(null===e||void 0===e?void 0:e.offset)&&n.set("offset",e.offset.toString()),(null===e||void 0===e?void 0:e.sortColumn)&&n.set("sortColumn",e.sortColumn),(null===e||void 0===e?void 0:e.sortOrder)&&n.set("sortOrder",e.sortOrder),(null===e||void 0===e?void 0:e.search)&&n.set("search",e.search);const r=n.toString(),a=r?"".concat(t.url,"/bucket?").concat(r):"".concat(t.url,"/bucket");return{data:await Ye(t.fetch,a,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await et(t.fetch,"".concat(t.url,"/bucket/").concat(e),{},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}from(e){var t=this;if(!(e=>!(!e||"string"!==typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new Le("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new De({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(e,t){const n=e[t];return"function"!==typeof n?n:async function(){try{for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return{data:await n.apply(e,a),error:null}}catch(i){if(r)throw i;return{data:null,error:i}}}}})}};const dt={"X-Client-Info":"storage-js/".concat(ot),"Content-Type":"application/json"};var ht=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function ft(e){return"object"===typeof e&&null!==e&&"__isStorageVectorsError"in e}var pt=class extends ht{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},mt=class extends ht{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const gt=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},vt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),bt=(e,t,n,r)=>{const a={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(a.headers=Ke({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,Ke(Ke({},a),n)):a};async function yt(e,t,n,r,a,s){return new Promise((i,o)=>{e(n,bt(t,r,a,s)).then(e=>{if(!e.ok)throw e;if(null===r||void 0===r?void 0:r.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>i(e)).catch(e=>(async(e,t,n)=>{if(e&&"object"===typeof e&&"status"in e&&"ok"in e&&"number"===typeof e.status&&!(null===n||void 0===n?void 0:n.noResolveJson)){const n=e.status||500,r=e;if("function"===typeof r.json)r.json().then(e=>{const r=(null===e||void 0===e?void 0:e.statusCode)||(null===e||void 0===e?void 0:e.code)||n+"";t(new pt(vt(e),n,r))}).catch(()=>{const e=n+"";t(new pt(r.statusText||"HTTP ".concat(n," error"),n,e))});else{const e=n+"";t(new pt(r.statusText||"HTTP ".concat(n," error"),n,e))}}else t(new mt(vt(e),e))})(e,o,r))})}async function xt(e,t,n,r,a){return yt(e,"POST",t,r,a,n)}var wt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Ke(Ke({},dt),t),this.fetch=gt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/CreateIndex"),e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async getIndex(e,t){var n=this;try{return{data:await xt(n.fetch,"".concat(n.url,"/GetIndex"),{vectorBucketName:e,indexName:t},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ft(r))return{data:null,error:r};throw r}}async listIndexes(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/ListIndexes"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async deleteIndex(e,t){var n=this;try{return{data:await xt(n.fetch,"".concat(n.url,"/DeleteIndex"),{vectorBucketName:e,indexName:t},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ft(r))return{data:null,error:r};throw r}}},_t=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Ke(Ke({},dt),t),this.fetch=gt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await xt(t.fetch,"".concat(t.url,"/PutVectors"),e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async getVectors(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/GetVectors"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async listVectors(e){var t=this;try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and ".concat(e.segmentCount-1))}return{data:await xt(t.fetch,"".concat(t.url,"/ListVectors"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async queryVectors(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/QueryVectors"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await xt(t.fetch,"".concat(t.url,"/DeleteVectors"),e,{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}},jt=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Ke(Ke({},dt),t),this.fetch=gt(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/CreateVectorBucket"),{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async getBucket(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/GetVectorBucket"),{vectorBucketName:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async listBuckets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/ListVectorBuckets"),e,{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}async deleteBucket(e){var t=this;try{return{data:await xt(t.fetch,"".concat(t.url,"/DeleteVectorBucket"),{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ft(n))return{data:null,error:n};throw n}}},kt=class extends jt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t.headers||{},t.fetch)}from(e){return new Nt(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},Nt=class extends wt{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n}async createIndex(e){return(()=>super.createIndex)().call(this,Ke(Ke({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(()=>super.listIndexes)().call(this,Ke(Ke({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new St(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},St=class extends _t{constructor(e,t,n,r,a){super(e,t,a),this.vectorBucketName=n,this.indexName=r}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,Ke(Ke({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,Ke(Ke({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=this;return(()=>super.listVectors)().call(t,Ke(Ke({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,Ke(Ke({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,Ke(Ke({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Et=class extends ct{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new it(this.url,this.headers,e,this.fetch)}get vectors(){return new kt(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ut(this.url+"/iceberg",this.headers,this.fetch)}};const Ct="2.90.1",Tt=3e4,Ot=9e4,Rt={"X-Client-Info":"gotrue-js/".concat(Ct)},Pt="X-Supabase-Api-Version",At={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},It=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Dt extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Lt(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Ut extends Dt{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class Mt extends Dt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class zt extends Dt{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class Bt extends zt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ft extends zt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qt extends zt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Wt extends zt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Vt extends zt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ht extends zt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Kt extends zt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Gt(e){return Lt(e)&&"AuthRetryableFetchError"===e.name}class Jt extends zt{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class $t extends zt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Yt=" \t\n\r=".split(""),Xt=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Yt.length;t+=1)e[Yt[t].charCodeAt(0)]=-2;for(let t=0;t<Qt.length;t+=1)e[Qt[t].charCodeAt(0)]=t;return e})();function Zt(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(Qt[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(Qt[e]),t.queuedBits-=6}}function en(e,t,n){const r=Xt[e];if(!(r>-1)){if(-2===r)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function tn(e){const t=[],n=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},s=e=>{!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(let n=1;n<6;n+=1)if(0===(e>>7-n&1)){t.utf8seq=n;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,r,n)};for(let i=0;i<e.length;i+=1)en(e.charCodeAt(i),a,s);return t.join("")}function nn(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function rn(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(n+1)-56320&65535|t),n+=1}nn(r,t)}}function an(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)en(e.charCodeAt(a),n,r);return new Uint8Array(t)}function sn(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Zt(e,n,r)),Zt(null,n,r),t.join("")}const on=()=>"undefined"!==typeof window&&"undefined"!==typeof document,ln={tested:!1,writable:!1},cn=()=>{if(!on())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(t){return!1}if(ln.tested)return ln.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ln.tested=!0,ln.writable=!0}catch(t){ln.tested=!0,ln.writable=!1}return ln.writable};const un=e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)},dn=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},hn=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(r){return n}},fn=async(e,t)=>{await e.removeItem(t)};class pn{constructor(){this.promise=new pn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function mn(e){const t=e.split(".");if(3!==t.length)throw new $t("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!It.test(t[n]))throw new $t("JWT not in base64url format");return{header:JSON.parse(tn(t[0])),payload:JSON.parse(tn(t[1])),signature:an(t[2]),raw:{header:t[0],payload:t[1]}}}function gn(e){return("0"+e.toString(16)).substr(-2)}async function vn(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,gn).join("")}();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await dn(e,"".concat(t,"-code-verifier"),a);const s=await vn(r);return[s,r===s?"plain":"s256"]}pn.promiseConstructor=Promise;const yn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const xn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function wn(e){if(!xn.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function _n(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function jn(e){return JSON.parse(JSON.stringify(e))}const kn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Nn=[502,503,504];async function Sn(e){var t,n;if(!("object"===typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json))throw new Kt(kn(e),0);if(Nn.includes(e.status))throw new Kt(kn(e),e.status);let r,a;try{r=await e.json()}catch(i){throw new Mt(kn(i),i)}const s=function(e){const t=e.headers.get(Pt);if(!t)return null;if(!t.match(yn))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(i){return null}}(e);if(s&&s.getTime()>=At.timestamp&&"object"===typeof r&&r&&"string"===typeof r.code?a=r.code:"object"===typeof r&&r&&"string"===typeof r.error_code&&(a=r.error_code),a){if("weak_password"===a)throw new Jt(kn(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new Bt}else if("object"===typeof r&&r&&"object"===typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new Jt(kn(r),e.status,r.weak_password.reasons);throw new Ut(kn(r),e.status||500,a)}async function En(e,t,n,r){var a;const s=Object.assign({},null===r||void 0===r?void 0:r.headers);s[Pt]||(s[Pt]=At.name),(null===r||void 0===r?void 0:r.jwt)&&(s.Authorization="Bearer ".concat(r.jwt));const i=null!==(a=null===r||void 0===r?void 0:r.query)&&void 0!==a?a:{};(null===r||void 0===r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,n,r,a,s){const i=((e,t,n,r)=>{const a={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))})(t,r,a,s);let o;try{o=await e(n,Object.assign({},i))}catch(l){throw console.error(l),new Kt(kn(l),0)}o.ok||await Sn(o);if(null===r||void 0===r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await Sn(l)}}(e,t,n+o,{headers:s,noResolveJson:null===r||void 0===r?void 0:r.noResolveJson},{},null===r||void 0===r?void 0:r.body);return(null===r||void 0===r?void 0:r.xform)?null===r||void 0===r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Cn(e){var t;let n=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Tn(e){const t=Cn(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function On(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Rn(e){return{data:e,error:null}}function Pn(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:a,verification_type:s}=e,i=E(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:r,redirect_to:a,verification_type:s},user:Object.assign({},i)},error:null}}function An(e){return e}const In=["global","local","others"];class Dn{constructor(e){let{url:t="",headers:n={},fetch:r}=e;this.url=t,this.headers=n,this.fetch=un(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:In[0];if(In.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(In.join(", ")));try{return await En(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Lt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await En(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:On})}catch(n){if(Lt(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=E(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=null===n||void 0===n?void 0:n.newEmail,delete r.newEmail),await En(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:r,headers:this.headers,xform:Pn,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Lt(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await En(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:On})}catch(t){if(Lt(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,a,s,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await En(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(a=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:An});if(c.error)throw c.error;const u=await c.json(),d=null!==(s=c.headers.get("x-total-count"))&&void 0!==s?s:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(n,"Page")]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Lt(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){wn(e);try{return await En(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:On})}catch(t){if(Lt(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){wn(e);try{return await En(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:On})}catch(n){if(Lt(n))return{data:{user:null},error:n};throw n}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];wn(e);try{return await En(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:On})}catch(n){if(Lt(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){wn(e.userId);try{const{data:t,error:n}=await En(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(t){if(Lt(t))return{data:null,error:t};throw t}}async _deleteFactor(e){wn(e.userId),wn(e.id);try{return{data:await En(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,r,a,s,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await En(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(a=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:An});if(c.error)throw c.error;const u=await c.json(),d=null!==(s=c.headers.get("x-total-count"))&&void 0!==s?s:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l["".concat(n,"Page")]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Lt(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await En(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients"),{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Lt(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await En(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Lt(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await En(this.fetch,"PUT","".concat(this.url,"/admin/oauth/clients/").concat(e),{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(n){if(Lt(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await En(this.fetch,"DELETE","".concat(this.url,"/admin/oauth/clients/").concat(e),{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Lt(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await En(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients/").concat(e,"/regenerate_secret"),{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(Lt(t))return{data:null,error:t};throw t}}}function Ln(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Un=!!(globalThis&&cn()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Mn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class zn extends Mn{}async function Bn(e,t,n){Un&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Un&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw Un&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new zn('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(Un)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}Un&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await n()}finally{Un&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}function Fn(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error('@supabase/auth-js: Address "'.concat(e,'" is invalid.'));return e.toLowerCase()}function qn(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Wn extends Error{constructor(e){let{message:t,code:n,cause:r,name:a}=e;var s;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(s=null!==a&&void 0!==a?a:r instanceof Error?r.name:void 0)&&void 0!==s?s:"Unknown Error",this.code=n}}class Vn extends Wn{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Hn(e){let{error:t,options:n}=e;var r,a,s;const{publicKey:i}=n;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Wn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if("ConstraintError"===t.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Wn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if("conditional"===n.mediation&&"required"===(null===(a=i.authenticatorSelection)||void 0===a?void 0:a.userVerification))return new Wn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if("required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new Wn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if("InvalidStateError"===t.name)return new Wn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if("NotAllowedError"===t.name)return new Wn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("NotSupportedError"===t.name){return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Wn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Wn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t})}if("SecurityError"===t.name){const e=window.location.hostname;if(!Xn(e))return new Wn({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(i.rp.id!==e)return new Wn({message:'The RP ID "'.concat(i.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("TypeError"===t.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Wn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if("UnknownError"===t.name)return new Wn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Wn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function Kn(e){let{error:t,options:n}=e;const{publicKey:r}=n;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Wn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new Wn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){const e=window.location.hostname;if(!Xn(e))return new Wn({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==e)return new Wn({message:'The RP ID "'.concat(r.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new Wn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Wn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}const Gn=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Jn(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!==typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"===typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,a=E(e,["challenge","user","excludeCredentials"]),s=an(t).buffer,i=Object.assign(Object.assign({},n),{id:an(n.id).buffer}),o=Object.assign(Object.assign({},a),{challenge:s,user:i});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:an(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function $n(e){if(!e)throw new Error("Credential request options are required");if("undefined"!==typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"===typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=E(e,["challenge","allowCredentials"]),a=an(t).buffer,s=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){s.allowCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];s.allowCredentials[e]=Object.assign(Object.assign({},t),{id:an(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return s}function Qn(e){var t;if("toJSON"in e&&"function"===typeof e.toJSON)return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:sn(new Uint8Array(e.response.attestationObject)),clientDataJSON:sn(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function Yn(e){var t;if("toJSON"in e&&"function"===typeof e.toJSON)return e.toJSON();const n=e,r=e.getClientExtensionResults(),a=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:sn(new Uint8Array(a.authenticatorData)),clientDataJSON:sn(new Uint8Array(a.clientDataJSON)),signature:sn(new Uint8Array(a.signature)),userHandle:a.userHandle?sn(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function Xn(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Zn(){var e,t;return!!(on()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"===typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"===typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const er={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},tr={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function nr(){const e=e=>null!==e&&"object"===typeof e&&!Array.isArray(e),t=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),n={};for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];for(const i of a)if(i)for(const r in i){const a=i[r];if(void 0!==a)if(Array.isArray(a))n[r]=a;else if(t(a))n[r]=a;else if(e(a)){const t=n[r];e(t)?n[r]=nr(t,a):n[r]=nr(a)}else n[r]=a}return n}class rr{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge(e,t){let{factorId:n,webauthn:r,friendlyName:a,signal:s}=e;try{const{data:e,error:i}=await this.client.mfa.challenge({factorId:n,webauthn:r});if(!e)return{data:null,error:i};const o=null!==s&&void 0!==s?s:Gn.createNewAbortSignal();if("create"===e.webauthn.type){const{user:t}=e.webauthn.credential_options.publicKey;t.name||(t.name="".concat(t.id,":").concat(a)),t.displayName||(t.displayName=t.name)}switch(e.webauthn.type){case"create":{const r=function(e,t){return nr(er,e,t||{})}(e.webauthn.credential_options.publicKey,null===t||void 0===t?void 0:t.create),{data:a,error:s}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Vn("Browser returned unexpected credential type",t)}:{data:null,error:new Vn("Empty credential response",t)}}catch(t){return{data:null,error:Hn({error:t,options:e})}}}({publicKey:r,signal:o});return a?{data:{factorId:n,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:a}},error:null}:{data:null,error:s}}case"request":{const r=function(e,t){return nr(tr,e,t||{})}(e.webauthn.credential_options.publicKey,null===t||void 0===t?void 0:t.request),{data:a,error:s}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Vn("Browser returned unexpected credential type",t)}:{data:null,error:new Vn("Empty credential response",t)}}catch(t){return{data:null,error:Kn({error:t,options:e})}}}(Object.assign(Object.assign({},e.webauthn.credential_options),{publicKey:r,signal:o}));return a?{data:{factorId:n,challengeId:e.id,webauthn:{type:e.webauthn.type,credential_response:a}},error:null}:{data:null,error:s}}}}catch(i){return Lt(i)?{data:null,error:i}:{data:null,error:new Mt("Unexpected error in challenge",i)}}}async _verify(e){let{challengeId:t,factorId:n,webauthn:r}=e;return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:r})}async _authenticate(e,t){let{factorId:n,webauthn:{rpId:r=("undefined"!==typeof window?window.location.hostname:void 0),rpOrigins:a=("undefined"!==typeof window?[window.location.origin]:void 0),signal:s}={}}=e;if(!r)return{data:null,error:new Dt("rpId is required for WebAuthn authentication")};try{if(!Zn())return{data:null,error:new Mt("Browser does not support WebAuthn",null)};const{data:e,error:i}=await this.challenge({factorId:n,webauthn:{rpId:r,rpOrigins:a},signal:s},{request:t});if(!e)return{data:null,error:i};const{webauthn:o}=e;return this._verify({factorId:n,challengeId:e.challengeId,webauthn:{type:o.type,rpId:r,rpOrigins:a,credential_response:o.credential_response}})}catch(i){return Lt(i)?{data:null,error:i}:{data:null,error:new Mt("Unexpected error in authenticate",i)}}}async _register(e,t){let{friendlyName:n,webauthn:{rpId:r=("undefined"!==typeof window?window.location.hostname:void 0),rpOrigins:a=("undefined"!==typeof window?[window.location.origin]:void 0),signal:s}={}}=e;if(!r)return{data:null,error:new Dt("rpId is required for WebAuthn registration")};try{if(!Zn())return{data:null,error:new Mt("Browser does not support WebAuthn",null)};const{data:e,error:i}=await this._enroll({friendlyName:n});if(!e)return await this.client.mfa.listFactors().then(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.all.find(e=>"webauthn"===e.factor_type&&e.friendly_name===n&&"unverified"!==e.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null===e||void 0===e?void 0:e.id}):void 0),{data:null,error:i};const{data:o,error:l}=await this._challenge({factorId:e.id,friendlyName:e.friendly_name,webauthn:{rpId:r,rpOrigins:a},signal:s},{create:t});return o?this._verify({factorId:e.id,challengeId:o.challengeId,webauthn:{rpId:r,rpOrigins:a,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(i){return Lt(i)?{data:null,error:i}:{data:null,error:new Mt("Unexpected error in register",i)}}}}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!==typeof self&&(self.globalThis=self)}}();const ar={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Rt,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function sr(e,t,n){return await n()}const ir={};class or{get jwks(){var e,t;return null!==(t=null===(e=ir[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){ir[this.storageKey]=Object.assign(Object.assign({},ir[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=ir[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ir[this.storageKey]=Object.assign(Object.assign({},ir[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},ar),e);if(this.storageKey=a.storageKey,this.instanceID=null!==(t=or.nextInstanceID[this.storageKey])&&void 0!==t?t:0,or.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,"function"===typeof a.debug&&(this.logger=a.debug),this.instanceID>0&&on()){const e="".concat(this._logPrefix()," Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Dn({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=un(a.fetch),this.lock=a.lock||sr,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&on()&&(null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===n?void 0:n.locks)?this.lock=Bn:this.lock=sr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new rr(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:cn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ln(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Ln(this.memoryStorage)),on()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return"GoTrueClient@"+"".concat(this.storageKey,":").concat(this.instanceID," (").concat(Ct,") ").concat((new Date).toISOString())}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger(this._logPrefix(),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},n="none";if(on()&&(t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach((e,n)=>{t[n]=e})}catch(r){}return n.searchParams.forEach((e,n)=>{t[n]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),on()&&this.detectSessionInUrl&&"none"!==n){const{data:r,error:a}=await this._getSessionFromURL(t,n);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),function(e){return Lt(e)&&"AuthImplicitGrantRedirectError"===e.name}(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return{error:a}}const{session:s,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),await this._saveSession(s),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Lt(t)?this._returnResult({error:t}):this._returnResult({error:new Mt("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const a=await En(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(n=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Cn}),{data:s,error:i}=a;if(i||!s)return this._returnResult({data:{user:null,session:null},error:i});const o=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(a){if(Lt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var t,n,r;try{let a;if("email"in e){const{email:n,password:r,options:s}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await bn(this.storage,this.storageKey)),a=await En(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===s||void 0===s?void 0:s.emailRedirectTo,body:{email:n,password:r,data:null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken},code_challenge:i,code_challenge_method:o},xform:Cn})}else{if(!("phone"in e))throw new qt("You must provide either an email or phone number and a password");{const{phone:t,password:s,options:i}=e;a=await En(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:s,data:null!==(n=null===i||void 0===i?void 0:i.data)&&void 0!==n?n:{},channel:null!==(r=null===i||void 0===i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:Cn})}}const{data:s,error:i}=a;if(i||!s)return await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),this._returnResult({data:{user:null,session:null},error:i});const o=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(a){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:r,options:a}=e;t=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:Tn})}else{if(!("phone"in e))throw new qt("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:a}=e;t=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:Tn})}}const{data:n,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const e=new Ft;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(Lt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,r,a;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}}async signInWithEthereum(e){var t,n,r,a,s,i,o,l,c,u,d;let h,f;if("message"in e)h=e.message,f=e.signature;else{const{chain:u,wallet:d,statement:p,options:m}=e;let g;if(on())if("object"===typeof d)g=d;else{const e=window;if(!("ethereum"in e)||"object"!==typeof e.ethereum||!("request"in e.ethereum)||"function"!==typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");g=e.ethereum}else{if("object"!==typeof d||!(null===m||void 0===m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=d}const v=new URL(null!==(t=null===m||void 0===m?void 0:m.url)&&void 0!==t?t:window.location.href),b=await g.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const y=Fn(b[0]);let x=null===(n=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===n?void 0:n.chainId;if(!x){const e=await g.request({method:"eth_chainId"});x=parseInt(e,16)}h=function(e){var t;const{chainId:n,domain:r,expirationTime:a,issuedAt:s=new Date,nonce:i,notBefore:o,requestId:l,resources:c,scheme:u,uri:d,version:h}=e;if(!Number.isInteger(n))throw new Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '.concat(n));if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '.concat(i));if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ".concat(h));if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: ".concat(e.statement));const f=Fn(e.address),p=u?"".concat(u,"://").concat(r):r,m=e.statement?"".concat(e.statement,"\n"):"",g="".concat(p," wants you to sign in with your Ethereum account:\n").concat(f,"\n\n").concat(m);let v="URI: ".concat(d,"\nVersion: ").concat(h,"\nChain ID: ").concat(n).concat(i?"\nNonce: ".concat(i):"","\nIssued At: ").concat(s.toISOString());if(a&&(v+="\nExpiration Time: ".concat(a.toISOString())),o&&(v+="\nNot Before: ".concat(o.toISOString())),l&&(v+="\nRequest ID: ".concat(l)),c){let e="\nResources:";for(const t of c){if(!t||"string"!==typeof t)throw new Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '.concat(t));e+="\n- ".concat(t)}v+=e}return"".concat(g,"\n").concat(v)}({domain:v.host,address:y,statement:p,uri:v.href,version:"1",chainId:x,nonce:null===(r=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(s=null===(a=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===a?void 0:a.issuedAt)&&void 0!==s?s:new Date,expirationTime:null===(i=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===i?void 0:i.expirationTime,notBefore:null===(o=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null===m||void 0===m?void 0:m.signInWithEthereum)||void 0===c?void 0:c.resources}),f=await g.request({method:"personal_sign",params:[qn(h),y]})}try{const{data:t,error:n}=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:f},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Cn});if(n)throw n;if(!t||!t.session||!t.user){const e=new Ft;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(p){if(Lt(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var t,n,r,a,s,i,o,l,c,u,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:d,wallet:h,statement:m,options:g}=e;let v;if(on())if("object"===typeof h)v=h;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!==typeof h||!(null===g||void 0===g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=h}const b=new URL(null!==(t=null===g||void 0===g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===g||void 0===g?void 0:g.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),m?{statement:m}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in v)||"function"!==typeof v.signMessage||!("publicKey"in v)||"object"!==typeof v||!v.publicKey||!("toBase58"in v.publicKey)||"function"!==typeof v.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=["".concat(b.host," wants you to sign in with your Solana account:"),v.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1","URI: ".concat(b.href),"Issued At: ".concat(null!==(r=null===(n=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==r?r:(new Date).toISOString()),...(null===(a=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===a?void 0:a.notBefore)?["Not Before: ".concat(g.signInWithSolana.notBefore)]:[],...(null===(s=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===s?void 0:s.expirationTime)?["Expiration Time: ".concat(g.signInWithSolana.expirationTime)]:[],...(null===(i=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===i?void 0:i.chainId)?["Chain ID: ".concat(g.signInWithSolana.chainId)]:[],...(null===(o=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===o?void 0:o.nonce)?["Nonce: ".concat(g.signInWithSolana.nonce)]:[],...(null===(l=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?["Request ID: ".concat(g.signInWithSolana.requestId)]:[],...(null===(u=null===(c=null===g||void 0===g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...g.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(f),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:n}=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:sn(p)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Cn});if(n)throw n;if(!t||!t.session||!t.user){const e=new Ft;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(m){if(Lt(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const t=await hn(this.storage,"".concat(this.storageKey,"-code-verifier")),[n,r]=(null!==t&&void 0!==t?t:"").split("/");try{if(!n&&"pkce"===this.flowType)throw new Ht;const{data:t,error:a}=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:Cn});if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),a)throw a;if(!t||!t.session||!t.user){const e=new Ft;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!==r&&void 0!==r?r:null}),error:a})}catch(a){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:a,nonce:s}=e,i=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:n,id_token:r,access_token:a,nonce:s,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:Cn}),{data:o,error:l}=i;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o||!o.session||!o.user){const e=new Ft;return this._returnResult({data:{user:null,session:null},error:e})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:o,error:l})}catch(t){if(Lt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,r,a,s;try{if("email"in e){const{email:r,options:a}=e;let s=null,i=null;"pkce"===this.flowType&&([s,i]=await bn(this.storage,this.storageKey));const{error:o}=await En(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:r,data:null!==(t=null===a||void 0===a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(n=null===a||void 0===a?void 0:a.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken},code_challenge:s,code_challenge_method:i},redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){const{phone:t,options:n}=e,{data:i,error:o}=await En(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(r=null===n||void 0===n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(a=null===n||void 0===n?void 0:n.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},channel:null!==(s=null===n||void 0===n?void 0:n.channel)&&void 0!==s?s:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null===i||void 0===i?void 0:i.message_id},error:o})}throw new qt("You must provide either an email or phone number.")}catch(i){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(e){var t,n;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:s,error:i}=await En(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:Cn});if(i)throw i;if(!s){throw new Error("An error occurred on token verification.")}const o=s.session,l=s.user;return(null===o||void 0===o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(r){if(Lt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,n,r,a,s;try{let i=null,o=null;"pkce"===this.flowType&&([i,o]=await bn(this.storage,this.storageKey));const l=await En(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Rn});return(null===(a=l.data)||void 0===a?void 0:a.url)&&on()&&!(null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(i){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Bt;const{error:r}=await En(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(Lt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:n,type:r,options:a}=e,{error:s}=await En(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:s})}if("phone"in e){const{phone:n,type:r,options:a}=e,{data:s,error:i}=await En(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null===s||void 0===s?void 0:s.message_id},error:i})}throw new qt("You must provide either an email or phone number and a type")}catch(t){if(Lt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(e){}})()),n}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await hn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&1e3*e.expires_at-Date.now()<Ot;if(this._debug("#__loadSession()","session has".concat(n?"":" not"," expired"),"expires_at",e.expires_at),!n){if(this.userStorage){const t=await hn(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=_n()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,n,r)=>{if("__isInsecureUserWarningProxy"===n)return!0;if("symbol"===typeof n){const t=n.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,n,r)}return t.value||"string"!==typeof n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,n,r)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await En(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:On}):await this._useSession(async e=>{var t,n,r;const{data:a,error:s}=e;if(s)throw s;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await En(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(r=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,xform:On}):{data:{user:null},error:new Bt}})}catch(t){if(Lt(t))return function(e){return Lt(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await fn(this.storage,"".concat(this.storageKey,"-code-verifier"))),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async n=>{const{data:r,error:a}=n;if(a)throw a;if(!r.session)throw new Bt;const s=r.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=await bn(this.storage,this.storageKey));const{data:l,error:c}=await En(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:s.access_token,xform:On});if(c)throw c;return s.user=l.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),this._returnResult({data:{user:s.user},error:null})})}catch(n){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Bt;const t=Date.now()/1e3;let n=t,r=!0,a=null;const{payload:s}=mn(e.access_token);if(s.exp&&(n=s.exp,r=n<=t),r){const{data:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:r,error:s}=await this._getUser(e.access_token);if(s)throw s;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(t){if(Lt(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:r,error:a}=t;if(a)throw a;e=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new Bt;const{data:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Lt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!on())throw new Wt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Wt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Vt("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Wt("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Vt("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:a,refresh_token:s,expires_in:i,expires_at:o,token_type:l}=e;if(!a||!i||!s||!l)throw new Wt("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(i);let d=c+u;o&&(d=parseInt(o));const h=d-c;1e3*h<=Tt&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(h,"s, should have been closer to ").concat(u,"s"));const f=d-u;c-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,c):c-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,c);const{data:p,error:m}=await this._getUser(a);if(m)throw m;const g={provider_token:n,provider_refresh_token:r,access_token:a,expires_in:u,expires_at:d,refresh_token:s,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(n){if(Lt(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return"function"===typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await hn(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var n;const{data:r,error:a}=t;if(a)return this._returnResult({error:a});const s=null===(n=r.session)||void 0===n?void 0:n.access_token;if(s){const{error:t}=await this.admin.signOut(s,e);if(t&&(!function(e){return Lt(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await fn(this.storage,"".concat(this.storageKey,"-code-verifier"))),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:r},error:a}=t;if(a)throw a;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(a){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null;"pkce"===this.flowType&&([n,r]=await bn(this.storage,this.storageKey,!0));try{return await En(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:r}=await this._useSession(async t=>{var n,r,a,s,i;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return await En(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(s=o.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0})});if(r)throw r;return on()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===n||void 0===n?void 0:n.url),this._returnResult({data:{provider:e.provider,url:null===n||void 0===n?void 0:n.url},error:null})}catch(n){if(Lt(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:r,data:{session:a}}=t;if(r)throw r;const{options:s,provider:i,token:o,access_token:l,nonce:c}=e,u=await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,jwt:null!==(n=null===a||void 0===a?void 0:a.access_token)&&void 0!==n?n:void 0,body:{provider:i,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null===s||void 0===s?void 0:s.captchaToken}},xform:Cn}),{data:d,error:h}=u;return h?this._returnResult({data:{user:null,session:null},error:h}):d&&d.session&&d.user?(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:h})):this._returnResult({data:{user:null,session:null},error:new Ft})}catch(r){if(await fn(this.storage,"".concat(this.storageKey,"-code-verifier")),Lt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:a,error:s}=t;if(s)throw s;return await En(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(r=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const a=Date.now();return await(n=async n=>(n>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await En(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:Cn})),r=(e,t)=>{const n=200*Math.pow(2,e);return t&&Gt(t)&&Date.now()+n-a<Tt},new Promise((e,t)=>{(async()=>{for(let s=0;s<1/0;s++)try{const t=await n(s);if(!r(s,null,t))return void e(t)}catch(a){if(!r(s,a))return void t(a)}})()}))}catch(a){if(this._debug(t,"error",a),Lt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(t,"end")}var n,r}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),on()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await hn(this.storage,this.storageKey);if(a&&this.userStorage){let t=await hn(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:a.user},await dn(this.userStorage,this.storageKey+"-user",t)),a.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:_n()}else if(a&&!a.user&&!a.user){const e=await hn(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(a.user=e.user,await fn(this.storage,this.storageKey+"-user"),await dn(this.storage,this.storageKey,a)):a.user=_n()}if(this._debug(n,"session from storage",a),!this._isValidSession(a))return this._debug(n,"session is not valid"),void(null!==a&&await this._removeSession());const s=1e3*(null!==(t=a.expires_at)&&void 0!==t?t:1/0)-Date.now()<Ot;if(this._debug(n,"session has".concat(s?"":" not"," expired with margin of ").concat(Ot,"s")),s){if(this.autoRefreshToken&&a.refresh_token){const{error:e}=await this._callRefreshToken(a.refresh_token);e&&(console.error(e),Gt(e)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(a.user&&!0===a.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(a.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(a.user=e.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(n,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){return this._debug(n,"error",a),void console.error(a)}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Bt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(r,"begin");try{this.refreshingDeferred=new pn;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new Bt;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(a){if(this._debug(r,"error",a),Lt(a)){const e={data:null,error:a};return Gt(a)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r="#_notifyAllSubscribers(".concat(e,")");this._debug(r,"begin",t,"broadcast = ".concat(n));try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(e,t)}catch(a){r.push(a)}});if(await Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await fn(this.storage,"".concat(this.storageKey,"-code-verifier"));const t=Object.assign({},e),n=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!n&&t.user&&await dn(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=jn(e);await dn(this.storage,this.storageKey,r)}else{const e=jn(t);await dn(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await fn(this.storage,this.storageKey),await fn(this.storage,this.storageKey+"-code-verifier"),await fn(this.storage,this.storageKey+"-user"),this.userStorage&&await fn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&on()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Tt);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"===typeof t&&"function"===typeof t.unref?t.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:n}}=e;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-t)/Tt);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(r," ticks, a tick lasts ").concat(Tt,"ms, refresh threshold is ").concat(3," ticks")),r<=3&&await this._callRefreshToken(n.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Mn))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!on()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=["provider=".concat(encodeURIComponent(t))];if((null===n||void 0===n?void 0:n.redirectTo)&&r.push("redirect_to=".concat(encodeURIComponent(n.redirectTo))),(null===n||void 0===n?void 0:n.scopes)&&r.push("scopes=".concat(encodeURIComponent(n.scopes))),"pkce"===this.flowType){const[e,t]=await bn(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});r.push(n.toString())}if(null===n||void 0===n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);r.push(e.toString())}return(null===n||void 0===n?void 0:n.skipBrowserRedirect)&&r.push("skip_http_redirect=".concat(n.skipBrowserRedirect)),"".concat(e,"?").concat(r.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:a}=t;return a?this._returnResult({data:null,error:a}):await En(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:a,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await En(this.fetch,"POST","".concat(this.url,"/factors"),{body:i,headers:this.headers,jwt:null===(n=null===a||void 0===a?void 0:a.session)||void 0===n?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(r=null===o||void 0===o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code="data:image/svg+xml;utf-8,".concat(o.totp.qr_code)),this._returnResult({data:o,error:null}))})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:a}=t;if(a)return this._returnResult({data:null,error:a});const s=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?Qn(e.webauthn.credential_response):Yn(e.webauthn.credential_response)})}:{code:e.code}),{data:i,error:o}=await En(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:s,headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});return o?this._returnResult({data:null,error:o}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:o}))})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:a}=t;if(a)return this._returnResult({data:null,error:a});const s=await En(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:e,headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});if(s.error)return s;const{data:i}=s;if("webauthn"!==i.type)return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Jn(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:$n(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const a of null!==(e=null===t||void 0===t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(a),"verified"===a.status&&r[a.factor_type].push(a);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=mn(n.access_token);let s=null;a.aal&&(s=a.aal);let i=s;(null!==(t=null===(e=n.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(i="aal2");return{data:{currentLevel:s,nextLevel:i,currentAuthenticationMethods:a.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await En(this.fetch,"GET","".concat(this.url,"/oauth/authorizations/").concat(e),{headers:this.headers,jwt:n.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Bt})})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;if(a)return this._returnResult({data:null,error:a});if(!r)return this._returnResult({data:null,error:new Bt});const s=await En(this.fetch,"POST","".concat(this.url,"/oauth/authorizations/").concat(e,"/consent"),{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return s.data&&s.data.redirect_url&&on()&&!(null===t||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(n){if(Lt(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;if(a)return this._returnResult({data:null,error:a});if(!r)return this._returnResult({data:null,error:new Bt});const s=await En(this.fetch,"POST","".concat(this.url,"/oauth/authorizations/").concat(e,"/consent"),{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return s.data&&s.data.redirect_url&&on()&&!(null===t||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(s.data.redirect_url),s})}catch(n){if(Lt(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await En(this.fetch,"GET","".concat(this.url,"/user/oauth/grants"),{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new Bt})})}catch(e){if(Lt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?(await En(this.fetch,"DELETE","".concat(this.url,"/user/oauth/grants"),{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Bt})})}catch(t){if(Lt(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const n=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>n)return t;const{data:r,error:a}=await En(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(a)throw a;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=n,t=r.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=e;if(!n){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});n=e.session.access_token}const{header:r,payload:a,signature:s,raw:{header:i,payload:o}}=mn(n);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:a,header:r,signature:s},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,s,function(e){const t=[];return rn(e,e=>t.push(e)),new Uint8Array(t)}("".concat(i,".").concat(o))))throw new $t("Invalid JWT signature");return{data:{claims:a,header:r,signature:s},error:null}}catch(n){if(Lt(n))return this._returnResult({data:null,error:n});throw n}}}or.nextInstanceID={};const lr=or;let cr="";cr="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ur={headers:{"X-Client-Info":"supabase-js-".concat(cr,"/").concat("2.90.1")}},dr={schema:"public"},hr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},fr={};function pr(e){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mr(e){var t=function(e,t){if("object"!=pr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==pr(t)?t:t+""}function gr(e,t,n){return(t=mr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function br(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(n),!0).forEach(function(t){gr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const yr=(e,t,n)=>{const r=(e=>e?function(){return e(...arguments)}:function(){return fetch(...arguments)})(n),a=Headers;return async(n,s)=>{var i;const o=null!==(i=await t())&&void 0!==i?i:e;let l=new a(null===s||void 0===s?void 0:s.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization","Bearer ".concat(o)),r(n,br(br({},s),{},{headers:l}))}};var xr=class extends lr{constructor(e){super(e)}},wr=class{constructor(e,t,n){var r,a;this.supabaseUrl=e,this.supabaseKey=t;const s=function(e){const t=null===e||void 0===e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((n=t).endsWith("/")?n:n+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var n}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",s),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",s),this.storageUrl=new URL("storage/v1",s),this.functionsUrl=new URL("functions/v1",s);const i="sb-".concat(s.hostname.split(".")[0],"-auth-token"),o=function(e,t){var n,r;const{db:a,auth:s,realtime:i,global:o}=e,{db:l,auth:c,realtime:u,global:d}=t,h={db:br(br({},l),a),auth:br(br({},c),s),realtime:br(br({},u),i),storage:{},global:br(br(br({},d),o),{},{headers:br(br({},null!==(n=null===d||void 0===d?void 0:d.headers)&&void 0!==n?n:{}),null!==(r=null===o||void 0===o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!==n&&void 0!==n?n:{},{db:dr,realtime:fr,auth:br(br({},hr),{},{storageKey:i}),global:ur});var l;(this.storageKey=null!==(r=o.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=o.global.headers)&&void 0!==a?a:{},o.accessToken)?(this.accessToken=o.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(l=o.auth)&&void 0!==l?l:{},this.headers,o.global.fetch);this.fetch=yr(t,this._getAccessToken.bind(this),o.global.fetch),this.realtime=this._initRealtimeClient(br({headers:this.headers,accessToken:this._getAccessToken.bind(this)},o.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new F(new URL("rest/v1",s).href,{headers:this.headers,schema:o.db.schema,fetch:this.fetch}),this.storage=new Et(this.storageUrl.href,this.headers,this.fetch,null===n||void 0===n?void 0:n.storage),o.accessToken||this._listenForAuthEvents()}get functions(){return new I(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{head:!1,get:!1,count:void 0};return this.rest.rpc(e,t,n)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,n=this;if(n.accessToken)return await n.accessToken();const{data:r}=await n.auth.getSession();return null!==(e=null===(t=r.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:n.supabaseKey}_initSupabaseAuthClient(e,t,n){let{autoRefreshToken:r,persistSession:a,detectSessionInUrl:s,storage:i,userStorage:o,storageKey:l,flowType:c,lock:u,debug:d,throwOnError:h}=e;const f={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new xr({url:this.authUrl.href,headers:br(br({},f),t),storageKey:l,autoRefreshToken:r,persistSession:a,detectSessionInUrl:s,storage:i,userStorage:o,flowType:c,lock:u,debug:d,throwOnError:h,fetch:n,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new je(this.realtimeUrl.href,br(br({},e),{},{params:br(br({},{apikey:this.supabaseKey}),null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=n,this.realtime.setAuth(n))}};(function(){if("undefined"!==typeof window)return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(void 0===t||null===t)return!1;const n=t.match(/^v(\d+)\./);return!!n&&parseInt(n[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const _r=((e,t,n)=>new wr(e,t,n))("https://swsrtxzzwqykwcbbdann.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN3c3J0eHp6d3F5a3djYmJkYW5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODk4NTMsImV4cCI6MjA4MzU2NTg1M30.tIWQg7hjphXJImqq9ZzNGFQyuDOdhN5GpGSmaiQlxSw");const jr=function(){var e;const[t,n]=(0,r.useState)({visits:0,reservations:0,totalRooms:0,availableRooms:0,occupiedRooms:0,guestBalance:0,cashboxBalance:0,totalRevenue:0,todayRevenue:0,todayCheckins:0,todayCheckouts:0,currentVisits:0,pendingPayments:0,occupancyRate:0,lastTransaction:null}),[a,i]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{!async function(){i(!0);try{const{count:e}=await _r.from("guests").select("*",{count:"exact",head:!0}),{count:t}=await _r.from("reservations").select("*",{count:"exact",head:!0}),{data:r,count:a}=await _r.from("rooms").select("*",{count:"exact"}),s=r?r.filter(e=>"\u0645\u062a\u0627\u062d\u0629"===e.status).length:0,i=r?r.filter(e=>"\u0645\u0634\u063a\u0648\u0644\u0629"===e.status).length:0,{data:o}=await _r.from("financial_transactions").select("amount,transaction_type,created_at"),l=o?o.filter(e=>"\u062f\u0641\u0639"===e.transaction_type).reduce((e,t)=>e+Number(t.amount),0):0,c=o?o.reduce((e,t)=>e+Number(t.amount),0):0,u=c,d=(new Date).toISOString().slice(0,10),h=o?o.filter(e=>e.created_at&&e.created_at.startsWith(d)).reduce((e,t)=>e+Number(t.amount),0):0,{data:f}=await _r.from("reservations").select("check_in_date,check_out_date,status"),p=f?f.filter(e=>e.check_in_date===d).length:0,m=f?f.filter(e=>e.check_out_date===d).length:0,g=f?f.filter(e=>"\u0646\u0634\u0637\u0629"===e.status).length:0,v=o?o.filter(e=>"\u0645\u0639\u0644\u0642\u0629"===e.transaction_type).length:0,b=a&&i?Math.round(i/a*100):0,{data:y}=await _r.from("financial_transactions").select("*").order("created_at",{ascending:!1}).limit(1);n({visits:e||0,reservations:t||0,totalRooms:a||0,availableRooms:s,occupiedRooms:i,guestBalance:l,cashboxBalance:c,totalRevenue:u,todayRevenue:h,todayCheckins:p,todayCheckouts:m,currentVisits:g,pendingPayments:v,occupancyRate:b,lastTransaction:y&&y.length>0?y[0]:null})}catch(e){console.error("fetchStats error",e)}finally{i(!1)}}()},[]),a?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen text-xl",children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a..."}):(0,s.jsxs)("div",{className:"flex flex-col gap-6 p-6 bg-gray-50 min-h-screen",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"bg-yellow-400 text-white px-4 py-2 rounded",children:"\u0646\u0633\u062e\u0629 \u0627\u062d\u062a\u064a\u0627\u0637\u064a\u0629"}),(0,s.jsx)("button",{className:"bg-white border rounded p-2",children:(0,s.jsx)("span",{role:"img","aria-label":"\u062a\u0646\u0628\u064a\u0647",children:"\ud83d\udd14"})})]}),(0,s.jsx)("div",{className:"text-gray-600",children:(new Date).toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"\u0644\u0648\u062d\u0629 \u0627\u0644\u062a\u062d\u0643\u0645 \u0627\u0644\u0630\u0643\u064a\u0629"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 bg-gradient-to-l from-blue-400 to-purple-400 rounded-lg p-4 text-white",children:[(0,s.jsxs)("a",{href:"/checkin",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83d\udd11"}),(0,s.jsx)("span",{children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644"})]}),(0,s.jsxs)("a",{href:"/reservation",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"}),(0,s.jsx)("span",{children:"\u062d\u062c\u0632 \u062c\u062f\u064a\u062f"})]}),(0,s.jsxs)("a",{href:"/guests",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83d\udc64"}),(0,s.jsx)("span",{children:"\u0625\u0636\u0627\u0641\u0629 \u0646\u0632\u064a\u0644"})]}),(0,s.jsxs)("a",{href:"/rooms",className:"flex flex-col items-center gap-2 hover:scale-105 transition",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83c\udfe8"}),(0,s.jsx)("span",{children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83d\udc65"}),(0,s.jsx)("div",{className:"text-lg font-bold",children:t.visits}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc5"}),(0,s.jsx)("div",{className:"text-lg font-bold",children:t.reservations}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,s.jsx)("span",{className:"text-2xl",children:"\ud83c\udfe2"}),(0,s.jsx)("div",{className:"text-lg font-bold",children:t.totalRooms}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,s.jsx)("span",{className:"text-2xl text-green-500",children:"\u2705"}),(0,s.jsx)("div",{className:"text-lg font-bold",children:t.availableRooms}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u062a\u0627\u062d\u0629"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 flex flex-col items-center shadow",children:[(0,s.jsx)("span",{className:"text-2xl text-red-500",children:"\u26d4"}),(0,s.jsx)("div",{className:"text-lg font-bold",children:t.occupiedRooms}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u0634\u063a\u0648\u0644\u0629"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-yellow-100 rounded-lg p-4 flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-yellow-700",children:[t.guestBalance," \u062c\u0646\u064a\u0647"]}),(0,s.jsx)("div",{className:"text-gray-600",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),(0,s.jsxs)("div",{className:"bg-yellow-200 rounded-lg p-4 flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-yellow-800",children:[t.cashboxBalance," \u062c\u0646\u064a\u0647"]}),(0,s.jsx)("div",{className:"text-gray-600",children:"\u0631\u0635\u064a\u062f \u0627\u0644\u062e\u0632\u0646\u0629"})]}),(0,s.jsxs)("div",{className:"bg-blue-100 rounded-lg p-4 flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-blue-700",children:[t.totalRevenue," \u062c\u0646\u064a\u0647"]}),(0,s.jsx)("div",{className:"text-gray-600",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"})]}),(0,s.jsxs)("div",{className:"bg-green-100 rounded-lg p-4 flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-green-700",children:[t.todayRevenue," \u062c\u0646\u064a\u0647"]}),(0,s.jsx)("div",{className:"text-gray-600",children:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u064a\u0648\u0645"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,s.jsx)("div",{className:"font-bold mb-2",children:"\u062d\u0631\u0643\u0629 \u0627\u0644\u064a\u0648\u0645"}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u062e\u0648\u0644 \u0627\u0644\u064a\u0648\u0645"}),(0,s.jsx)("span",{children:t.todayCheckins})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"\u062a\u0633\u062c\u064a\u0644 \u062e\u0631\u0648\u062c \u0627\u0644\u064a\u0648\u0645"}),(0,s.jsx)("span",{children:t.todayCheckouts})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"\u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,s.jsx)("span",{children:t.currentVisits})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"\u0645\u062f\u0641\u0648\u0639\u0627\u062a \u0645\u0639\u0644\u0642\u0629"}),(0,s.jsx)("span",{children:t.pendingPayments})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,s.jsx)("div",{className:"font-bold mb-2",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0625\u0634\u063a\u0627\u0644"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded h-3",children:(0,s.jsx)("div",{className:"bg-blue-500 h-3 rounded",style:{width:"".concat(t.occupancyRate,"%")}})}),(0,s.jsxs)("span",{className:"text-sm",children:[t.occupancyRate,"%"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:["\u0645\u062a\u0627\u062d\u0629: ",t.availableRooms]}),(0,s.jsxs)("span",{children:["\u0645\u0634\u063a\u0648\u0644\u0629: ",t.occupiedRooms]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow",children:[(0,s.jsx)("div",{className:"font-bold mb-2",children:"\u0622\u062e\u0631 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0627\u0644\u0645\u0627\u0644\u064a\u0629"}),t.lastTransaction?(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{children:[t.lastTransaction.id," - ",t.lastTransaction.description]}),(0,s.jsxs)("span",{className:"text-green-700 font-bold",children:["+",t.lastTransaction.amount," \u062c\u0646\u064a\u0647"]}),(0,s.jsx)("span",{className:"text-gray-500 text-sm",children:null===(e=t.lastTransaction.created_at)||void 0===e?void 0:e.slice(0,10)})]}):(0,s.jsx)("div",{className:"text-gray-400",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0639\u0627\u0645\u0644\u0627\u062a \u0645\u0627\u0644\u064a\u0629"})]})]})};function kr(e){var t,n,r;let{building:a,onEdit:i,onDelete:o}=e;const l="inactive"===a.status?"\u063a\u064a\u0631 \u0646\u0634\u0637":"maintenance"===a.status?"\u0635\u064a\u0627\u0646\u0629":"\u0646\u0634\u0637",c="inactive"===a.status?"bg-gray-100 text-gray-700":"maintenance"===a.status?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-700";return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 relative",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm ".concat(c),children:["maintenance"===a.status&&(0,s.jsx)(m,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:l})]}),(0,s.jsx)("h3",{className:"text-lg font-semibold mt-3",children:a.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:a.name_en})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0645\u0628\u0646\u0649 ",a.code]})})]}),(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-blue-600 font-semibold",children:null!==(t=a.floors_count)&&void 0!==t?t:0}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0637\u0648\u0627\u0628\u0642"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-gray-800 font-semibold",children:null!==(n=a.total_rooms)&&void 0!==n?n:0}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-green-600 font-semibold",children:null!==(r=a.available_rooms)&&void 0!==r?r:0}),(0,s.jsx)("div",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641 \u0627\u0644\u0645\u062a\u0627\u062d\u0629"})]})]}),(0,s.jsx)("div",{className:"mt-4 text-sm text-gray-600",children:a.description}),(0,s.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,s.jsx)("button",{onClick:i,className:"bg-yellow-400 px-4 py-2 rounded text-white",children:"\u062a\u0639\u062f\u064a\u0644 \u270f\ufe0f"}),(0,s.jsx)("button",{onClick:o,className:"bg-red-500 px-4 py-2 rounded text-white",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})]})}function Nr(e){let{initialData:t=null,onClose:n,onSave:a}=e;const[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(0),[h,f]=(0,r.useState)("active"),[p,m]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&(o(t.code||""),c(t.name||""),d(t.floors_count||0),f(t.status||"active"),m(t.description||""))},[t]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-start justify-center p-6 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6 shadow-lg mt-12",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0645\u0628\u0646\u0649":"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u0646\u0649"}),(0,s.jsx)("button",{onClick:n,className:"text-gray-500",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,s.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const n={code:i||null,name:l||null,description:p||null,floors_count:u||0,status:h};t&&t.id&&(n.id=t.id),await a(n)},className:"mt-4 grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0631\u0642\u0645 \u0627\u0644\u0645\u0628\u0646\u0649 *"}),(0,s.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0628\u0646\u0649 *"}),(0,s.jsx)("input",{value:l,onChange:e=>c(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0637\u0648\u0627\u0628\u0642 *"}),(0,s.jsx)("input",{type:"number",value:u,onChange:e=>d(Number(e.target.value)),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629 *"}),(0,s.jsxs)("select",{value:h,onChange:e=>f(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,s.jsx)("option",{value:"active",children:"\u0646\u0634\u0637"}),(0,s.jsx)("option",{value:"inactive",children:"\u063a\u064a\u0631 \u0646\u0634\u0637"})]})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,s.jsx)("textarea",{value:p,onChange:e=>m(e.target.value),className:"w-full border rounded px-3 py-2 h-28"})]}),(0,s.jsxs)("div",{className:"col-span-2 flex gap-3 justify-start mt-2",children:[(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a \ud83d\udcbe"}),(0,s.jsx)("button",{type:"button",onClick:n,className:"bg-gray-100 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})})}function Sr(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[i,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),u=async()=>{a(!0);try{const{data:e,error:n}=await _r.from("buildings_with_floor_count").select("*").order("created_at",{ascending:!1});if(n)throw n;const r=e||[],a=await Promise.all(r.map(async e=>{let t=0,n=0;try{const n=await _r.from("rooms").select("id",{count:"exact",head:!0}).eq("building_id",e.id);n.error||(t=n.count||0)}catch(r){}try{const t=await _r.from("rooms").select("id",{count:"exact",head:!0}).eq("building_id",e.id).eq("is_available",!0);t.error||(n=t.count||0)}catch(r){}return Ce(Ce({},e),{},{total_rooms:t,available_rooms:n})}));t(a)}catch(e){console.error("Failed loading buildings",e),t([])}finally{a(!1)}};(0,r.useEffect)(()=>{u()},[]);return(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0645\u0628\u0627\u0646\u064a"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0645\u0628\u0627\u0646\u064a \u0648\u0637\u0648\u0627\u0628\u0642 \u0627\u0644\u0641\u0646\u062f\u0642"})]}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:()=>{c(null),o(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2",children:"\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u0646\u0649 \u062c\u062f\u064a\u062f +"})})]}),n?(0,s.jsx)("div",{children:"\u062a\u062d\u0645\u064a\u0644..."}):0===e.length?(0,s.jsx)("div",{className:"p-6 bg-white rounded shadow",children:'\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0628\u0627\u0646\u064d \u0628\u0639\u062f. \u0627\u0636\u063a\u0637 "\u0625\u0636\u0627\u0641\u0629 \u0645\u0628\u0646\u0649 \u062c\u062f\u064a\u062f" \u0644\u0625\u0646\u0634\u0627\u0621 \u0623\u0648\u0644 \u0645\u0628\u0646\u0649.'}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.map(e=>(0,s.jsx)(kr,{building:e,onEdit:()=>(c(e),void o(!0)),onDelete:()=>(async e=>{window.confirm("\u0647\u0644 \u062a\u0631\u063a\u0628 \u062d\u0642\u0627\u064b \u0628\u062d\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u0645\u0628\u0646\u0649\u061f")&&(await _r.from("buildings").update({is_deleted:!0}).eq("id",e),u())})(e.id)},e.id))}),i&&(0,s.jsx)(Nr,{initialData:l,onClose:()=>o(!1),onSave:async e=>{try{let t=null;if(e.id){await _r.from("buildings").update(e).eq("id",e.id);const{data:n}=await _r.from("buildings").select("*").eq("id",e.id).single();t=n}else{const{data:n,error:r}=await _r.from("buildings").insert([e]).select().single();if(r)throw r;t=n}const n=Number(e.floors_count)||0;if(console.log("handleSave: payload.floors_count=",e.floors_count,"floorsCount=",n,"buildingRecord=",t),t&&n>0){const{data:e=[]}=await _r.from("floors").select("floor_number").eq("building_id",t.id),r=new Set(e.map(e=>Number(e.floor_number))),a=[];for(let s=1;s<=n;s++)r.has(s)||a.push({building_id:t.id,floor_number:s});if(console.log("Floors to insert:",a.length,a),a.length){const{error:e}=await _r.from("floors").insert(a);e?(console.error("Failed creating floors",e),window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0637\u0648\u0627\u0628\u0642: "+(e.message||e))):(console.log("Inserted floors count (requested):",a.length),window.alert("\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 "+a.length+" \u0637\u0627\u0628\u0642/\u0637\u0648\u0627\u0628\u0642 \u0644\u0644\u0645\u0628\u0646\u0649 \u0628\u0646\u062c\u0627\u062d."))}else console.log("No new floors to insert")}}catch(t){console.error(t)}o(!1),u()}})]})}function Er(e){let{status:t}=e;const n={available:{text:"\u0645\u062a\u0627\u062d\u0629",cls:"bg-green-100 text-green-700"},reserved:{text:"\u0645\u062d\u062c\u0648\u0632\u0629",cls:"bg-amber-100 text-amber-700"},occupied:{text:"\u0645\u0634\u063a\u0648\u0644\u0629",cls:"bg-pink-100 text-pink-700"},maintenance:{text:"\u0635\u064a\u0627\u0646\u0629",cls:"bg-red-100 text-red-700"}},r=n[t]||n.available;return(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(r.cls),children:r.text})}function Cr(e){let{room:t,onEdit:n,onDelete:r,onSelect:a,selected:i}=e;const o=Array.isArray(t.features)?t.features:[],l=e=>{const t=String(e||"").toLowerCase();return t.includes("wifi")?(0,s.jsx)(w,{className:"w-[12px] h-[12px]",title:"\u0648\u0627\u064a \u0641\u0627\u064a"}):"tv"===t?(0,s.jsx)(_,{className:"w-[12px] h-[12px]",title:"\u062a\u0644\u0641\u0627\u0632"}):t.includes("ac")?(0,s.jsx)(j,{className:"w-[12px] h-[12px]",title:"\u062a\u0643\u064a\u064a\u0641"}):t.includes("minibar")?(0,s.jsx)(k,{className:"w-[12px] h-[12px]",title:"\u0645\u064a\u0646\u064a \u0628\u0627\u0631"}):null},c=e=>{let{value:t}=e;const n={clean:{text:"\u0646\u0638\u064a\u0641\u0629",cls:"bg-green-100 text-green-700"},in_cleaning:{text:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",cls:"bg-amber-100 text-amber-700"},needs_cleaning:{text:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",cls:"bg-red-100 text-red-700"}},r=n[t]||n.clean;return(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(r.cls),children:r.text})};return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden",dir:"rtl",children:[(0,s.jsx)("div",{className:"h-1 ".concat((e=>{switch(e){case"available":return"bg-status-available";case"reserved":return"bg-status-reserved";case"occupied":return"bg-status-occupied";case"maintenance":return"bg-status-maintenance";default:return"bg-gray-300"}})(t.status)),title:"\u062d\u0627\u0644\u0629: ".concat(t.status)}),(0,s.jsxs)("div",{className:"px-4 pt-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:!!i,onChange:a,title:"\u062a\u062d\u062f\u064a\u062f"}),(0,s.jsx)("div",{className:"text-gray-800 font-bold",children:t.room_code})]}),(0,s.jsx)(Er,{status:t.status})]}),(0,s.jsxs)("div",{className:"px-4 py-3 text-xs text-gray-600",children:[(0,s.jsxs)("div",{className:"mb-1",children:[t.floor_name," \u2013 ",t.building_name]}),(0,s.jsxs)("div",{className:"mb-1",children:[(0,s.jsx)("span",{className:"font-semibold",children:t.room_type_name_ar}),(0,s.jsxs)("span",{className:"ml-2 text-gray-500",children:["(",t.room_type_name_en,")"]})]}),(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-blue-700 font-bold text-base",children:Number(t.computed_price||0)}),(0,s.jsx)("span",{className:"text-gray-500",children:"\u062c\u0646\u064a\u0647/\u0644\u064a\u0644\u0629"})]}),(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,s.jsx)(N,{className:"w-[12px] h-[12px] text-gray-500",title:"\u0623\u0642\u0635\u0649 \u0639\u062f\u062f \u0636\u064a\u0648\u0641"}),(0,s.jsxs)("span",{children:["\u0623\u0642\u0635\u0649 \u0639\u062f\u062f \u0623\u0634\u062e\u0627\u0635: ",Number(t.max_guests||0)]})]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"text-gray-700 mr-2",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0646\u0638\u0627\u0641\u0629:"}),(0,s.jsx)(c,{value:t.cleanliness})]}),o.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:o.map((e,t)=>(0,s.jsxs)("span",{className:"text-[11px] px-2 py-[5px] rounded border border-gray-200 bg-gray-50 text-gray-600 flex items-center gap-2",title:String(e),children:[l(e),(0,s.jsx)("span",{children:e})]},t))}),t.description&&(0,s.jsx)("div",{className:"mt-2 text-gray-600",children:t.description})]}),(0,s.jsx)("div",{className:"px-4 py-3 border-t bg-gray-50",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:n,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062a\u0639\u062f\u064a\u0644 \u270d\ufe0f"}),(0,s.jsx)("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})})]})}function Tr(e){let{initialData:t=null,onClose:n,onSave:a}=e;const[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)("active"),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[p,m]=(0,r.useState)(""),[g,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&(o(t.floor_name||t.name||"\u0627\u0644\u0637\u0627\u0628\u0642 "+(t.floor_number||"")),c(t.status||"active"),d(t.description||""),f(t.maintenance_note||""),m(void 0!==t.capacity&&null!==t.capacity?String(t.capacity):""),v(Boolean(t.needs_inspection)))},[t]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-start justify-center p-6 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-6 shadow-lg mt-12",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"\u062a\u0639\u062f\u064a\u0644 \u0637\u0627\u0628\u0642"}),(0,s.jsx)("button",{onClick:n,className:"text-gray-500",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const n={id:t.floor_id||t.id,name:i||null,status:l,description:u||null,maintenance_note:h||null,capacity:""===p?null:Number(p),needs_inspection:g};a&&a(n)},className:"mt-4 grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0631\u0642\u0645 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,s.jsx)("input",{value:(null===t||void 0===t?void 0:t.floor_number)||"",disabled:!0,className:"w-full border rounded px-3 py-2 bg-gray-50"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,s.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,s.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,s.jsx)("option",{value:"active",children:"\u0646\u0634\u0637"}),(0,s.jsx)("option",{value:"inactive",children:"\u063a\u064a\u0631 \u0646\u0634\u0637"}),(0,s.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0633\u0639\u0629 \u0627\u0644\u0637\u0627\u0628\u0642 (\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641)"}),(0,s.jsx)("input",{value:p,onChange:e=>m(e.target.value),type:"number",className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0645\u0644\u0627\u062d\u0638\u0629 \u0627\u0644\u0635\u064a\u0627\u0646\u0629"}),(0,s.jsx)("input",{value:h,onChange:e=>f(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,s.jsx)("textarea",{value:u,onChange:e=>d(e.target.value),className:"w-full border rounded px-3 py-2 h-28"})]}),(0,s.jsx)("div",{className:"col-span-2 flex items-center gap-4 mt-2",children:(0,s.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:g,onChange:e=>v(e.target.checked)}),(0,s.jsx)("span",{className:"text-sm",children:"\u064a\u062d\u062a\u0627\u062c \u0641\u062d\u0635"})]})}),(0,s.jsxs)("div",{className:"col-span-2 flex gap-3 justify-start mt-2",children:[(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"}),(0,s.jsx)("button",{type:"button",onClick:n,className:"bg-gray-100 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})})}function Or(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(null),[i,l]=(0,r.useState)([]),[c,u]=(0,r.useState)([]),[d,h]=(0,r.useState)(!0),[f,p]=(0,r.useState)(!1),[w,_]=(0,r.useState)(null),j=async e=>{h(!0);try{const{data:r,error:a}=await _r.from("building_floor_overview").select("*").eq("building_id",e).order("floor_number",{ascending:!0});let s=r||[];try{const{data:n,error:r}=await _r.from("floors").select("*").eq("building_id",e);if(!r&&n){const e=new Map(n.map(e=>[String(e.id),e])),r=new Map(n.map(e=>[String(e.floor_number),e]));s=(s||[]).map(t=>{const n=t.floor_id&&e.has(String(t.floor_id))?e.get(String(t.floor_id)):r.has(String(t.floor_number))?r.get(String(t.floor_number)):null;var a,s,i,o,l,c,u,d,h;return n?Ce(Ce({},t),{},{floor_id:n.id||t.floor_id,floor_number:null!==(a=n.floor_number)&&void 0!==a?a:t.floor_number,floor_name:null!==(s=null!==(i=n.floor_name)&&void 0!==i?i:n.name)&&void 0!==s?s:t.floor_name,name:null!==(o=n.name)&&void 0!==o?o:t.name,status:null!==(l=n.status)&&void 0!==l?l:t.status,description:null!==(c=n.description)&&void 0!==c?c:t.description,maintenance_note:null!==(u=n.maintenance_note)&&void 0!==u?u:t.maintenance_note,capacity:null!==(d=n.capacity)&&void 0!==d?d:t.capacity,needs_inspection:null!==(h=n.needs_inspection)&&void 0!==h?h:t.needs_inspection}):t});const a=new Set((s||[]).map(e=>String(e.floor_id||e.id)));for(const i of n){var t;if(!a.has(String(i.id)))s.push({floor_id:i.id,building_id:i.building_id,floor_number:i.floor_number,floor_name:null!==(t=i.floor_name)&&void 0!==t?t:i.name,name:i.name,status:i.status,description:i.description,maintenance_note:i.maintenance_note,capacity:i.capacity,needs_inspection:i.needs_inspection})}}}catch(n){console.warn("Failed fetching raw floors rows",n)}a||l(s||[]);const{data:i,error:o}=await _r.from("rooms_by_floor").select("*").eq("building_id",e).order("room_code",{ascending:!0});o||u(i||[])}catch(n){console.error(n),l([]),u([])}finally{h(!1)}};(0,r.useEffect)(()=>{(async()=>{const{data:e,error:r}=await _r.from("buildings").select("*").order("created_at",{ascending:!1});r||(t(e||[]),!n&&e&&e.length&&a(e[0]))})()},[]),(0,r.useEffect)(()=>{n&&j(n.id)},[n]);return(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-400",children:(0,s.jsx)(o,{className:"w-12 h-12"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0637\u0648\u0627\u0628\u0642"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["\u0639\u0631\u0636 \u0648\u0637\u0628\u0627\u0639\u0629 \u0637\u0648\u0627\u0628\u0642 \u0648\u063a\u0631\u0641 \u0627\u0644\u0645\u0628\u0646\u0649",n?" \u2014 ".concat(n.name):""]})]})]})}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("div",{className:"flex gap-4 overflow-auto",children:e.map(e=>(0,s.jsxs)("button",{onClick:()=>a(e),className:"min-w-[160px] p-4 rounded shadow flex flex-col items-start justify-center ".concat(n&&n.id===e.id?"border-2 border-blue-400 bg-white":"bg-white/80"),children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["\u0645\u0628\u0646\u0649 ",e.code]}),(0,s.jsx)("div",{className:"font-semibold",children:e.name}),(0,s.jsx)("div",{className:"text-xs mt-2 inline-flex items-center gap-2",children:"maintenance"===e.status?(0,s.jsx)("span",{className:"px-2 py-1 rounded text-yellow-800 bg-yellow-100",children:"\u0635\u064a\u0627\u0646\u0629"}):"inactive"===e.status?(0,s.jsx)("span",{className:"px-2 py-1 rounded text-gray-700 bg-gray-100",children:"\u063a\u064a\u0631 \u0646\u0634\u0637"}):(0,s.jsx)("span",{className:"px-2 py-1 rounded text-white bg-green-500",children:"\u0646\u0634\u0637"})})]},e.id))}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4",children:(()=>{const e=i.reduce((e,t)=>(e.total+=Number(t.total_rooms||0),e.available+=Number(t.available_rooms||0),e.occupied+=Number(t.occupied_rooms||0),e.reserved+=Number(t.reserved_rooms||0),e.maintenance+=Number(t.maintenance_rooms||0),e),{total:0,available:0,occupied:0,reserved:0,maintenance:0});return[{key:"total",label:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u0631\u0641",value:e.total,color:"bg-white",iconBg:"bg-indigo-100 text-indigo-700",icon:(0,s.jsx)(g,{className:"w-8 h-8"})},{key:"available",label:"\u0645\u062a\u0627\u062d\u0629",value:e.available,color:"bg-green-50",iconBg:"bg-green-100 text-green-700",icon:(0,s.jsx)(v,{className:"w-8 h-8"})},{key:"reserved",label:"\u0645\u062d\u062c\u0648\u0632\u0629",value:e.reserved,color:"bg-amber-50",iconBg:"bg-amber-100 text-amber-700",icon:(0,s.jsx)(b,{className:"w-8 h-8"})},{key:"occupied",label:"\u0645\u0634\u063a\u0648\u0644\u0629",value:e.occupied,color:"bg-rose-50",iconBg:"bg-rose-100 text-rose-700",icon:(0,s.jsx)(y,{className:"w-8 h-8"})},{key:"maintenance",label:"\u0635\u064a\u0627\u0646\u0629",value:e.maintenance,color:"bg-yellow-50",iconBg:"bg-yellow-100 text-yellow-700",icon:(0,s.jsx)(x,{className:"w-8 h-8"})}].map(e=>(0,s.jsx)("div",{className:"p-4 rounded shadow ".concat(e.color),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.label}),(0,s.jsx)("div",{className:"text-2xl font-bold mt-1",children:e.value})]}),(0,s.jsx)("div",{className:"p-2 rounded-full ".concat(e.iconBg),children:e.icon})]})},e.key))})()})]}),d?(0,s.jsx)("div",{children:"\u062a\u062d\u0645\u064a\u0644..."}):(0,s.jsxs)("div",{className:"space-y-6",children:[0===i.length?(0,s.jsx)("div",{className:"p-6 bg-white rounded shadow",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0637\u0648\u0627\u0628\u0642 \u0644\u0639\u0631\u0636\u0647\u0627 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u0645\u0628\u0646\u0649."}):i.map(e=>(0,s.jsxs)("section",{className:"bg-white rounded shadow",children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between",style:"maintenance"===e.status?{background:"linear-gradient(90deg,#ff416c,#ff4b2b)"}:"inactive"===e.status?{background:"linear-gradient(90deg,#757f9a,#d7dde8)"}:{background:"linear-gradient(90deg,#6a11cb,#2575fc)"},children:[(0,s.jsxs)("div",{className:"text-white",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"text-lg font-semibold",children:e.floor_name||e.name||"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.floor_number)}),"maintenance"===e.status&&(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs",children:[(0,s.jsx)(m,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"\u0635\u064a\u0627\u0646\u0629"})]})]}),(0,s.jsxs)("div",{className:"text-sm opacity-90",children:[e.total_rooms," \u0625\u062c\u0645\u0627\u0644\u064a \xb7 ",e.available_rooms," \u0645\u062a\u0627\u062d\u0629 \xb7 ",e.occupied_rooms," \u0645\u0634\u063a\u0648\u0644\u0629"]}),e.description&&(0,s.jsx)("div",{className:"text-xs opacity-90 mt-1",children:e.description}),e.maintenance_note&&(0,s.jsxs)("div",{className:"text-xs opacity-90 mt-1",children:["\u0645\u0644\u0627\u062d\u0638\u0629: ",e.maintenance_note]}),void 0!==e.capacity&&null!==e.capacity&&(0,s.jsxs)("div",{className:"text-xs opacity-90 mt-1",children:["\u0633\u0639\u0629: ",e.capacity]})]}),(0,s.jsxs)("div",{className:"text-white text-sm flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>(async e=>{console.log("handleEditFloor - floor:",e);try{if(e.floor_id){const{data:t,error:n}=await _r.from("floors").select("*").eq("id",e.floor_id).single();!n&&t?_(Ce(Ce({},e),t)):(console.warn("Could not fetch full floor row, using view row",n),_(e))}else _(e)}catch(t){console.warn("Error fetching full floor row",t),_(e)}p(!0)})(e),className:"bg-white/20 px-3 py-1 rounded text-white",children:"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,s.jsx)("div",{children:n&&n.name})]})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("div",{className:"flex gap-4 overflow-x-auto",children:0===c.filter(t=>t.floor_id===e.floor_id).length?(0,s.jsxs)("div",{className:"w-full py-8 text-center",children:[(0,s.jsx)("div",{className:"text-gray-400 mb-4",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u0637\u0627\u0628\u0642"}),(0,s.jsx)("button",{onClick:()=>((e,t)=>{const n="/rooms?building=".concat(e,"&floor=").concat(t);try{window.location.href=n}catch(r){console.log("navigate",n)}})(e.building_id,e.floor_number),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641"})]}):c.filter(t=>t.floor_id===e.floor_id).map(e=>(0,s.jsx)(Cr,{room:e},e.id))})})]},e.floor_id)),(0,s.jsxs)("div",{className:"bg-white rounded shadow p-4",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"\u0645\u062e\u0637\u0637 \u0627\u0644\u0645\u0628\u0646\u0649 \u0627\u0644\u0643\u0627\u0645\u0644"}),(0,s.jsx)("div",{className:"overflow-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-500",children:[(0,s.jsx)("th",{className:"p-2",children:"\u0627\u0644\u0637\u0627\u0628\u0642"}),(0,s.jsx)("th",{className:"p-2",children:"\u0639\u062f\u062f \u0627\u0644\u063a\u0631\u0641"}),(0,s.jsx)("th",{className:"p-2",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,s.jsx)("th",{className:"p-2",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,s.jsx)("th",{className:"p-2",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,s.jsx)("th",{className:"p-2",children:"\u0635\u064a\u0627\u0646\u0629"}),(0,s.jsx)("th",{className:"p-2",children:"\u0645\u0639\u062f\u0644 \u0627\u0644\u0627\u0634\u063a\u0627\u0644"})]})}),(0,s.jsx)("tbody",{children:i.map(e=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsxs)("td",{className:"p-2",children:["\u0627\u0644\u0637\u0627\u0628\u0642 ",e.floor_number]}),(0,s.jsx)("td",{className:"p-2",children:e.total_rooms}),(0,s.jsx)("td",{className:"p-2 text-green-600",children:e.available_rooms}),(0,s.jsx)("td",{className:"p-2 text-red-600",children:e.occupied_rooms}),(0,s.jsx)("td",{className:"p-2 text-yellow-600",children:e.reserved_rooms}),(0,s.jsx)("td",{className:"p-2",children:e.maintenance_rooms}),(0,s.jsxs)("td",{className:"p-2",children:[Math.round(100*(e.occupancy_rate||0)),"%"]})]},e.floor_id))})]})})]})]}),f&&(0,s.jsx)(Tr,{initialData:w,onClose:()=>p(!1),onSave:async e=>{console.group("handleSaveFloor"),console.log("payload:",e);try{const r=e.id;if(!r)throw new Error("Missing floor id");const a={};void 0!==e.status&&(a.status=e.status),void 0!==e.description&&(a.description=e.description),void 0!==e.name&&(a.name=e.name),void 0!==e.maintenance_note&&(a.maintenance_note=e.maintenance_note),void 0!==e.capacity&&null!==e.capacity&&(a.capacity=Number(e.capacity)),void 0!==e.needs_inspection&&(a.needs_inspection=Boolean(e.needs_inspection)),console.log("Attempting bulk update with payload:",a);let s=0,i=null;for(;s<6;){s+=1;const e=await _r.from("floors").update(a).eq("id",r);if(console.log("bulk update attempt",s,e),!e.error){i=e;break}i=e;const t=(e.error.message||"").toLowerCase(),n=t.match(/column \"([^\"]+)\"/);if(n&&n[1]){const e=n[1];if(a.hasOwnProperty(e)){console.warn("Removing column from payload and retrying:",e),delete a[e];continue}}const o=t.match(/could not find the '([^']+)'/);if(!(o&&o[1]&&a.hasOwnProperty(o[1])))throw e.error;console.warn("Removing column (alt message) from payload and retrying:",o[1]),delete a[o[1]]}try{const{data:e,error:t}=await _r.from("floors").select("*").eq("id",r).single();console.log("Refetched floor row:",{refData:e,refErr:t}),!t&&e&&l(t=>t.map(t=>{var n,r,a,s,i,o,l,c,u;return t.floor_id&&String(t.floor_id)===String(e.id)||t.id&&String(t.id)===String(e.id)?Ce(Ce({},t),{},{floor_id:e.id,floor_number:null!==(n=e.floor_number)&&void 0!==n?n:t.floor_number,floor_name:null!==(r=null!==(a=e.floor_name)&&void 0!==a?a:e.name)&&void 0!==r?r:t.floor_name,name:null!==(s=e.name)&&void 0!==s?s:t.name,status:null!==(i=e.status)&&void 0!==i?i:t.status,description:null!==(o=e.description)&&void 0!==o?o:t.description,maintenance_note:null!==(l=e.maintenance_note)&&void 0!==l?l:t.maintenance_note,capacity:null!==(c=e.capacity)&&void 0!==c?c:t.capacity,needs_inspection:null!==(u=e.needs_inspection)&&void 0!==u?u:t.needs_inspection}):t}))}catch(t){console.warn("Failed refetching floor row",t)}p(!1),n&&j(n.id)}catch(r){console.error("Failed saving floor",r);try{const e=r&&r.message?r.message:JSON.stringify(r);window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u0637\u0627\u0628\u0642: "+e)}catch(a){window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u0637\u0627\u0628\u0642. \u0641\u062a\u062d \u0627\u0644\u0640 Console \u0644\u0645\u0632\u064a\u062f \u0645\u0646 \u0627\u0644\u062a\u0641\u0627\u0635\u064a\u0644.")}}console.groupEnd()}})]})}function Rr(e){let{type:t,onEdit:n,onDelete:r}=e;const a=Array.isArray(t.features)?t.features:[];return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden",dir:"rtl",children:[(0,s.jsx)("div",{className:"h-1 bg-gradient-to-r from-purple-500 to-indigo-500"}),(0,s.jsxs)("div",{className:"px-4 pt-4",children:[(0,s.jsx)("div",{className:"text-blue-700 font-extrabold text-xl",children:Number(t.base_price||0)}),(0,s.jsx)("div",{className:"text-[11px] text-gray-500",children:"\u0644\u064a\u0644\u0629/\u063a\u0631\u0641\u0629"})]}),(0,s.jsxs)("div",{className:"px-4 py-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold text-[15px]",children:t.name_ar}),(0,s.jsx)("div",{className:"text-[11px] text-gray-500",children:t.name})]}),t.code&&(()=>{const e=String(t.code||"").toUpperCase(),n="DELUXE"===e?"bg-blue-100 text-blue-700":"DOUBLE"===e?"bg-indigo-100 text-indigo-700":"TRIPLE"===e?"bg-purple-100 text-purple-700":"SUITE"===e?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700 border border-gray-200";return(0,s.jsx)("span",{className:"text-[9px] px-2 py-[2px] rounded ".concat(n," uppercase tracking-wide"),children:e})})()]}),(0,s.jsxs)("div",{className:"mt-2 text-[11px] text-gray-600 flex items-center gap-2",children:[(0,s.jsx)(N,{className:"w-[12px] h-[12px] text-gray-500"}),(0,s.jsxs)("span",{children:["\u0639\u062f\u062f \u0627\u0644\u0623\u0634\u062e\u0627\u0635 \u0627\u0644\u0623\u0642\u0635\u0649: ",Number(t.max_guests||0)]})]}),a.length>0&&(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:a.map((e,t)=>{const n=String(e||"").toLowerCase(),r=n.includes("wifi")?(0,s.jsx)(w,{className:"w-[12px] h-[12px]"}):"tv"===n?(0,s.jsx)(_,{className:"w-[12px] h-[12px]"}):n.includes("ac")?(0,s.jsx)(j,{className:"w-[12px] h-[12px]"}):n.includes("minibar")?(0,s.jsx)(k,{className:"w-[12px] h-[12px]"}):null;return(0,s.jsxs)("span",{className:"text-[11px] px-2 py-[5px] rounded border border-gray-200 bg-gray-50 text-gray-600 flex items-center gap-2",children:[r,(0,s.jsx)("span",{children:e})]},t)})}),t.description&&(0,s.jsx)("div",{className:"mt-3 text-[11px] text-gray-600",children:t.description})]}),(0,s.jsx)("div",{className:"px-4 py-3 border-t bg-gray-50",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:n,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062a\u0639\u062f\u064a\u0644 \u270d\ufe0f"}),(0,s.jsx)("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})})]})}function Pr(e){let{initialData:t=null,onClose:n,onSave:a}=e;const[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[p,m]=(0,r.useState)(""),[g,v]=(0,r.useState)(""),[b,y]=(0,r.useState)(""),[x,w]=(0,r.useState)(""),[_,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{t?(o(t.code||""),c(t.name||""),d(t.name_ar||""),f(null!=t.base_price?String(t.base_price):""),m(null!=t.max_guests?String(t.max_guests):""),v(Array.isArray(t.features)?t.features.join(", "):""),y(t.description||""),w(null!=t.display_order?String(t.display_order):""),j(void 0===t.is_active||!!t.is_active)):j(!0)},[t]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-start justify-center p-6 z-50",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-3xl p-6 shadow-lg mt-12",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0646\u0648\u0639 \u063a\u0631\u0641\u0629":"\u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u063a\u0631\u0641\u0629"}),(0,s.jsx)("button",{onClick:n,className:"text-gray-500",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a&&a({code:i,name:l,name_ar:u,base_price:h,max_guests:p,features:g,description:b,display_order:x,is_active:_})},className:"mt-4 grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0627\u0633\u0645 \u0628\u0627\u0644\u0625\u0646\u062c\u0644\u064a\u0632\u064a\u0629 *"}),(0,s.jsx)("input",{value:l,onChange:e=>c(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0631\u0645\u0632 \u0627\u0644\u0646\u0648\u0639 *"}),(0,s.jsx)("input",{value:i,onChange:e=>o(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0623\u0633\u0627\u0633\u064a (\u062c\u0646\u064a\u0647) *"}),(0,s.jsx)("input",{value:h,onChange:e=>f(e.target.value),type:"number",className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0627\u0633\u0645 \u0628\u0627\u0644\u0639\u0631\u0628\u064a\u0629 *"}),(0,s.jsx)("input",{value:u,onChange:e=>d(e.target.value),className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u062d\u062f \u0627\u0644\u0623\u0642\u0635\u0649 \u0644\u0644\u0623\u0634\u062e\u0627\u0635 *"}),(0,s.jsx)("input",{value:p,onChange:e=>m(e.target.value),type:"number",className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0645\u0645\u064a\u0632\u0627\u062a"}),(0,s.jsx)("input",{value:g,onChange:e=>v(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"WiFi, TV, AC, Minibar"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,s.jsx)("textarea",{value:b,onChange:e=>y(e.target.value),className:"w-full border rounded px-3 py-2 h-24"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u062a\u0631\u062a\u064a\u0628 \u0627\u0644\u0639\u0631\u0636"}),(0,s.jsx)("input",{value:x,onChange:e=>w(e.target.value),type:"number",className:"w-full border rounded px-3 py-2"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:_,onChange:e=>j(e.target.checked)}),(0,s.jsx)("span",{className:"text-sm",children:"\u0646\u0634\u0637"})]}),(0,s.jsxs)("div",{className:"col-span-2 flex gap-3 justify-start mt-2",children:[(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"}),(0,s.jsx)("button",{type:"button",onClick:n,className:"bg-gray-100 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]})})}function Ar(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[i,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),u=async()=>{a(!0);try{const{data:e,error:n}=await _r.from("room_types_active").select("*");if(n)throw n;t(e||[])}catch(e){console.error("Failed loading room types",e),t([])}finally{a(!1)}};(0,r.useEffect)(()=>{u()},[]);return(0,s.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u063a\u0631\u0641"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0623\u0646\u0648\u0627\u0639 \u0648\u062a\u0635\u0646\u064a\u0641\u0627\u062a \u0627\u0644\u063a\u0631\u0641 \u0648\u0627\u0644\u0623\u0633\u0639\u0627\u0631"})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:async()=>{try{const e=[{code:"SINGLE",name:"Single Room",name_ar:"\u063a\u0631\u0641\u0629 \u0645\u0641\u0631\u062f\u0629",base_price:500,max_guests:1,features:["WiFi","TV","AC","Minibar"],description:"Standard single room with one bed",display_order:10,is_active:!0},{code:"DOUBLE",name:"Double Room",name_ar:"\u063a\u0631\u0641\u0629 \u0645\u0632\u062f\u0648\u062c\u0629",base_price:800,max_guests:2,features:["WiFi","TV","AC","Minibar"],description:"Standard double room with two beds",display_order:20,is_active:!0},{code:"DELUXE",name:"Deluxe Suite",name_ar:"\u062c\u0646\u0627\u062d \u062f\u064a\u0644\u0648\u0643\u0633",base_price:2e3,max_guests:4,features:["WiFi","TV","AC","Minibar"],description:"Premium deluxe suite",display_order:30,is_active:!0},{code:"TRIPLE",name:"Triple Room",name_ar:"\u063a\u0631\u0641\u0629 \u062b\u0644\u0627\u062b\u064a\u0629",base_price:1200,max_guests:3,features:["WiFi","TV","AC","Minibar"],description:"Standard triple room",display_order:40,is_active:!0},{code:"SUITE",name:"Suite",name_ar:"\u062c\u0646\u0627\u062d",base_price:1500,max_guests:4,features:["WiFi","TV","AC","Minibar"],description:"Suite",display_order:50,is_active:!0}],t=e.map(e=>e.code),{data:n,error:r}=await _r.from("room_types").select("code").in("code",t);if(r)throw r;const a=(n||[]).map(e=>(e.code||"").toUpperCase()),s=e.filter(e=>!a.includes((e.code||"").toUpperCase()));if(0===s.length)return void window.alert("\u0627\u0644\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u0627\u0641\u062a\u0631\u0627\u0636\u064a\u0629 \u0645\u0648\u062c\u0648\u062f\u0629 \u0628\u0627\u0644\u0641\u0639\u0644.");const{error:i}=await _r.from("room_types").insert(s);if(i)throw i;await u(),window.alert("\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u0627\u0641\u062a\u0631\u0627\u0636\u064a\u0629 \u0628\u0646\u062c\u0627\u062d.")}catch(e){console.error("Seeding defaults failed",e),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u0627\u0641\u062a\u0631\u0627\u0636\u064a\u0629: "+(e.message||e))}},className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"\u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0623\u0646\u0648\u0627\u0639 \u0627\u0644\u0627\u0641\u062a\u0631\u0627\u0636\u064a\u0629"}),(0,s.jsx)("button",{onClick:()=>{c(null),o(!0)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u062c\u062f\u064a\u062f +"})]})]}),n?(0,s.jsx)("div",{children:"\u062a\u062d\u0645\u064a\u0644..."}):0===e.length?(0,s.jsx)("div",{className:"p-6 bg-white rounded shadow",children:'\u0644\u0627 \u062a\u0648\u062c\u062f \u0623\u0646\u0648\u0627\u0639 \u063a\u0631\u0641 \u0628\u0639\u062f. \u0627\u0636\u063a\u0637 "\u0625\u0636\u0627\u0641\u0629 \u0646\u0648\u0639 \u062c\u062f\u064a\u062f" \u0644\u0625\u0646\u0634\u0627\u0621 \u0623\u0648\u0644 \u0646\u0648\u0639.'}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-6",children:e.map(e=>(0,s.jsx)(Rr,{type:e,onEdit:()=>(c(e),void o(!0)),onDelete:()=>(async e=>{try{if(!e||!e.id)return;const t=window.prompt("\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641 \u0627\u0643\u062a\u0628: ok","");if(!t||"ok"!==String(t).trim().toLowerCase())return void window.alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062d\u0630\u0641.");const{error:n}=await _r.from("room_types").delete().eq("id",e.id);if(n)throw n;await u()}catch(t){console.error("Failed deleting room type",t);const r=String((null===t||void 0===t?void 0:t.message)||t||"").toLowerCase();if(r.includes("foreign")||r.includes("constraint")||r.includes("violat"))try{const{error:t}=await _r.from("room_types").update({is_active:!1}).eq("id",e.id);if(t)throw t;await u(),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0630\u0641 \u0628\u0633\u0628\u0628 \u0627\u0631\u062a\u0628\u0627\u0637\u0627\u062a\u060c \u062a\u0645 \u0625\u062e\u0641\u0627\u0624\u0647 (\u063a\u064a\u0631 \u0646\u0634\u0637).")}catch(n){console.error("Soft-hide failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641/\u0625\u062e\u0641\u0627\u0621 \u0627\u0644\u0646\u0648\u0639: "+(n.message||n))}else window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0627\u0644\u062d\u0630\u0641: "+(t.message||t))}})(e)},e.id))}),i&&(0,s.jsx)(Pr,{initialData:l,onClose:()=>o(!1),onSave:async e=>{try{var t,n,r,a;const s={code:(null===(t=e.code)||void 0===t?void 0:t.trim())||null,name:(null===(n=e.name)||void 0===n?void 0:n.trim())||null,name_ar:(null===(r=e.name_ar)||void 0===r?void 0:r.trim())||null,base_price:Number(e.base_price||0),max_guests:Number(e.max_guests||1),features:Array.isArray(e.features)?e.features:(e.features||"").split(",").map(e=>e.trim()).filter(Boolean),description:(null===(a=e.description)||void 0===a?void 0:a.trim())||null,display_order:null!=e.display_order&&""!==e.display_order?Number(e.display_order):null,is_active:void 0===e.is_active||!!e.is_active};if(l&&l.id){const{error:e}=await _r.from("room_types").update(s).eq("id",l.id);if(e)throw e}else{const{error:e}=await _r.from("room_types").insert([s]);if(e)throw e}o(!1),u()}catch(s){console.error("Failed saving room type",s),window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629: "+(s.message||s))}}})]})}function Ir(e){let{initialData:t,buildings:n,floors:a,roomTypes:i,onClose:o,onSave:l}=e;const[c,u]=(0,r.useState)((null===t||void 0===t?void 0:t.building_id)||""),[d,h]=(0,r.useState)((null===t||void 0===t?void 0:t.floor_id)||""),[f,p]=(0,r.useState)((null===t||void 0===t?void 0:t.room_type_id)||""),[m,g]=(0,r.useState)((null===t||void 0===t?void 0:t.room_code)||""),[v,b]=(0,r.useState)((null===t||void 0===t?void 0:t.status)||"available"),[y,x]=(0,r.useState)((null===t||void 0===t?void 0:t.cleanliness)||"clean"),[w,_]=(0,r.useState)((null===t||void 0===t?void 0:t.description)||""),[j,k]=(0,r.useState)(()=>(Array.isArray(null===t||void 0===t?void 0:t.features)?t.features:[]).join(", ")),[N,S]=(0,r.useState)((null===t||void 0===t?void 0:t.image_url)||""),[E,C]=(0,r.useState)(!1),[T,O]=(0,r.useState)({});(0,r.useEffect)(()=>{if(d&&!c){const e=a.find(e=>String(e.id)===String(d));e&&u(e.building_id)}},[d,c,a]);const R=(0,r.useMemo)(()=>{if(!c)return a;const e=a.filter(e=>String(e.building_id)===String(c));return e.length>0?e:a},[a,c]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b",children:(0,s.jsx)("h3",{className:"text-xl font-bold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u063a\u0631\u0641\u0629":"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629 \u062c\u062f\u064a\u062f\u0629"})}),(0,s.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return c||(e.building_id="\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0628\u0646\u0649."),d||(e.floor_id="\u0627\u062e\u062a\u0631 \u0627\u0644\u0637\u0627\u0628\u0642."),f||(e.room_type_id="\u0627\u062e\u062a\u0631 \u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629."),m&&0!==String(m).trim().length||(e.room_code="\u0627\u0643\u062a\u0628 \u0631\u0642\u0645/\u0631\u0645\u0632 \u0627\u0644\u063a\u0631\u0641\u0629."),O(e),0===Object.keys(e).length})()){C(!0);try{await l({building_id:c,floor_id:d,room_type_id:f,room_code:m,status:v,cleanliness:y,description:w,features:j,image_url:N})}finally{C(!1)}}},className:"px-6 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u0628\u0646\u0649 *"}),(0,s.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:c,onChange:e=>{u(e.target.value),O(e=>Ce(Ce({},e),{},{building_id:void 0}))},children:[(0,s.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0645\u0628\u0646\u0649"}),n.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),T.building_id&&(0,s.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.building_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0637\u0627\u0628\u0642 *"}),(0,s.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:d,onChange:e=>{h(e.target.value),O(e=>Ce(Ce({},e),{},{floor_id:void 0}))},children:[(0,s.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0637\u0627\u0628\u0642"}),R.map(e=>{const t=e.name||e.floor_name||(e.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.floor_number):e.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.number):"\u0637\u0627\u0628\u0642 #".concat(e.id));return(0,s.jsx)("option",{value:e.id,children:t},e.id)})]}),T.floor_id&&(0,s.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.floor_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629 *"}),(0,s.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:f,onChange:e=>{p(e.target.value),O(e=>Ce(Ce({},e),{},{room_type_id:void 0}))},children:[(0,s.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0646\u0648\u0639"}),i.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name_ar," (",Number(e.base_price)," \u062c\u0646\u064a\u0647)"]},e.id))]}),T.room_type_id&&(0,s.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.room_type_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u063a\u0631\u0641\u0629 *"}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:m,onChange:e=>{g(e.target.value),O(e=>Ce(Ce({},e),{},{room_code:void 0}))},placeholder:"A101"})}),T.room_code&&(0,s.jsx)("div",{className:"text-red-600 text-xs mt-1",children:T.room_code})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u062d\u0627\u0644\u0629 *"}),(0,s.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:v,onChange:e=>b(e.target.value),children:[(0,s.jsx)("option",{value:"available",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,s.jsx)("option",{value:"reserved",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,s.jsx)("option",{value:"occupied",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,s.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u0646\u0638\u0627\u0641\u0629 *"}),(0,s.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:y,onChange:e=>x(e.target.value),children:[(0,s.jsx)("option",{value:"clean",children:"\u0646\u0638\u064a\u0641\u0629"}),(0,s.jsx)("option",{value:"in_cleaning",children:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641"}),(0,s.jsx)("option",{value:"needs_cleaning",children:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0648\u0635\u0641"}),(0,s.jsx)("textarea",{className:"mt-1 border rounded w-full px-3 py-2",rows:3,value:w,onChange:e=>_(e.target.value),placeholder:"\u0648\u0635\u0641 \u0625\u0636\u0627\u0641\u064a..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u0645\u064a\u0632\u0627\u062a"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:j,onChange:e=>k(e.target.value),placeholder:"WiFi\u060c \u062a\u0644\u0641\u0627\u0632\u060c \u062a\u0643\u064a\u064a\u0641\u060c \u0645\u064a\u0646\u064a \u0628\u0627\u0631"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0635\u0648\u0631\u0629 \u0627\u0644\u063a\u0631\u0641\u0629"}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,s.jsx)("input",{className:"border rounded px-3 py-2 flex-1",value:N,onChange:e=>S(e.target.value),placeholder:"\u0631\u0627\u0628\u0637 \u0627\u0644\u0635\u0648\u0631\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,s.jsxs)("label",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-2 rounded cursor-pointer",children:["\u0631\u0641\u0639 \u0645\u0644\u0641",(0,s.jsx)("input",{type:"file",className:"hidden",onChange:e=>{var t;return(async t=>{try{if(!t)return;const e=t.name.split(".").pop(),n="room-".concat(Date.now(),".").concat(e),{error:r}=await _r.storage.from("room-images").upload(n,t,{upsert:!0});if(r)throw r;const{data:a}=_r.storage.from("room-images").getPublicUrl(n);S((null===a||void 0===a?void 0:a.publicUrl)||n)}catch(e){console.error("Upload failed",e),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629: "+(e.message||e))}})(null===(t=e.target.files)||void 0===t?void 0:t[0])}})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0645\u062d\u0633\u0648\u0628"}),(0,s.jsx)("div",{className:"mt-1 border rounded w-full px-3 py-2 bg-green-50 text-green-700",children:(()=>{const e=i.find(e=>String(e.id)===String(f)),t=Number((null===e||void 0===e?void 0:e.base_price)||0);return"".concat(t," \u062c\u0646\u064a\u0647/\u0644\u064a\u0644\u0629")})()})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:o,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"}),(0,s.jsx)("button",{type:"submit",disabled:E,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:E?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"})]})]})]})})}function Dr(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[i,o]=(0,r.useState)(!1),[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)([]),[h,f]=(0,r.useState)([]),[p,m]=(0,r.useState)([]),[g,v]=(0,r.useState)("all"),[b,y]=(0,r.useState)("all"),[x,w]=(0,r.useState)({available:!0,reserved:!0,occupied:!0,maintenance:!0}),[_,j]=(0,r.useState)({clean:!0,in_cleaning:!0,needs_cleaning:!0}),[k,N]=(0,r.useState)(""),[S,E]=(0,r.useState)(""),[C,T]=(0,r.useState)(0),[O,R]=(0,r.useState)(12),[P,A]=(0,r.useState)(0),[I,D]=(0,r.useState)(new Set),L=async()=>{a(!0);try{const e=(()=>{const e=_r.from("rooms_overview").select("*",{count:"exact"}).order("room_code",{ascending:!0}),t=(S||"").trim();t&&e.or("room_code.ilike.%".concat(t,"%,description.ilike.%").concat(t,"%"));const n=Object.entries(x).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});n.length>0&&n.length<4&&e.in("status",n);const r=Object.entries(_).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});r.length>0&&r.length<3&&e.in("cleanliness",r);const a=C*O,s=a+O-1;return e.range(a,s),e})(),{data:n,error:r,count:a}=await e;if(r)throw r;t(n||[]),A(a||0)}catch(e){console.error("Failed to load rooms",e),t([]),A(0)}finally{a(!1)}};(0,r.useEffect)(()=>{(async()=>{try{var e;const[{data:a,error:s}]=await Promise.all([_r.from("buildings").select("id,name").order("name")]);if(s)throw s;d(a||[]);let i=[],o=null;try{const{data:e,error:t}=await _r.from("floors").select("id,name,floor_number,number,building_id").order("id");if(t)throw t;i=e||[]}catch(t){o=t;try{const{data:e,error:t}=await _r.from("floors").select("*");if(t)throw t;i=e||[]}catch(n){console.error("Failed floors lookup (fallback also failed)",n),i=[]}}o&&console.warn("Floors initial fetch err:",(null===(e=o)||void 0===e?void 0:e.message)||o),f(i);try{const{data:e,error:t}=await _r.from("room_types_active").select("id,name,name_ar,base_price,max_guests").order("display_order");if(t)throw t;m(e||[])}catch(r){console.error("Failed room types lookup",r),m([])}}catch(a){console.error("Failed to load lookups",a)}})(),L()},[]),(0,r.useEffect)(()=>{const e=_r.channel("rooms-live").on("postgres_changes",{event:"*",schema:"public",table:"rooms"},()=>{L()}).on("postgres_changes",{event:"*",schema:"public",table:"reservations"},()=>{L()}).subscribe();return()=>{try{_r.removeChannel(e)}catch(t){}}},[]),(0,r.useEffect)(()=>{const e=setTimeout(()=>E(k),350);return()=>clearTimeout(e)},[k]),(0,r.useEffect)(()=>{L()},[S,x,_,C,O]);const U=(0,r.useMemo)(()=>e.filter(e=>("all"===g||String(e.building_id)===String(g))&&("all"===b||String(e.floor_id)===String(b))),[e,g,b]),M=(0,r.useMemo)(()=>({total:U.length,available:U.filter(e=>"available"===e.status).length,reserved:U.filter(e=>"reserved"===e.status).length,occupied:U.filter(e=>"occupied"===e.status).length,maintenance:U.filter(e=>"maintenance"===e.status).length}),[U]),z=()=>{c(null),o(!0)},B=(0,r.useMemo)(()=>{if("all"===g)return h;const e=h.filter(e=>String(e.building_id)===String(g));return e.length>0?e:h},[h,g]),F=e=>w(t=>Ce(Ce({},t),{},{[e]:!t[e]})),q=e=>j(t=>Ce(Ce({},t),{},{[e]:!t[e]})),W=e=>{let{active:t,color:n,label:r,count:a,onClick:i,title:o}=e;return(0,s.jsxs)("button",{title:o,onClick:i,className:"px-3 py-1 rounded-full text-sm border ".concat(t?"bg-".concat(n,"-100 text-").concat(n,"-700 border-").concat(n,"-300"):"bg-white text-gray-600 border-gray-200"," hover:bg-gray-100"),children:[(0,s.jsx)("span",{className:"ml-2",children:r}),(0,s.jsx)("span",{className:"px-2 py-[1px] rounded text-xs ".concat(t?"bg-".concat(n,"-200 text-").concat(n,"-800"):"bg-gray-200 text-gray-700"),children:a})]})},V=I.size,H=(0,r.useMemo)(()=>0!==U.length&&U.every(e=>I.has(e.id)),[U,I]),K=async(e,t)=>{if(0!==I.size)try{const n=Array.from(I),{error:r}=await _r.from("rooms").update({[e]:t}).in("id",n);if(r)throw r;D(new Set),await L()}catch(n){console.error("Bulk update failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0625\u062c\u0631\u0627\u0621 \u0627\u0644\u062c\u0645\u0627\u0639\u064a: "+(n.message||n))}};return(0,s.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u063a\u0631\u0641"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0646\u0638\u0627\u0645 \u0645\u062a\u0643\u0627\u0645\u0644 \u0644\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u063a\u0631\u0641 \u0645\u0639 \u0627\u0644\u0639\u062f\u0651\u0627\u062f\u0627\u062a \u0648\u0627\u0644\u062a\u0635\u0641\u064a\u0627\u062a"})]}),(0,s.jsx)("button",{onClick:z,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629 \u062c\u062f\u064a\u062f\u0629 +"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"\u0635\u064a\u0627\u0646\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:M.maintenance})]}),(0,s.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:M.reserved})]}),(0,s.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-pink-600",children:M.occupied})]}),(0,s.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:M.available})]}),(0,s.jsxs)("div",{className:"bg-white rounded shadow p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"\u0625\u062c\u0645\u0627\u0644\u064a"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:M.total})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,s.jsxs)("select",{className:"border rounded px-3 py-2",value:g,onChange:e=>v(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"\u0643\u0644 \u0627\u0644\u0645\u0628\u0627\u0646\u064a"}),u.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsxs)("select",{className:"border rounded px-3 py-2",value:b,onChange:e=>y(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"\u0643\u0644 \u0627\u0644\u0637\u0648\u0627\u0628\u0642"}),B.map(e=>{const t=e.name||e.floor_name||(e.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.floor_number):e.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(e.number):"\u0637\u0627\u0628\u0642 #".concat(e.id));return(0,s.jsx)("option",{value:e.id,children:t},e.id)})]}),(0,s.jsx)("input",{className:"border rounded px-3 py-2 flex-1 min-w-[180px]",placeholder:"\u0628\u062d\u062b: \u0631\u0642\u0645/\u0648\u0635\u0641 \u0627\u0644\u063a\u0631\u0641\u0629",value:k,onChange:e=>{N(e.target.value),T(0)}}),(0,s.jsx)("button",{className:"border rounded px-3 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>{w({available:!0,reserved:!0,occupied:!0,maintenance:!0}),j({clean:!0,in_cleaning:!0,needs_cleaning:!0}),v("all"),y("all"),N(""),T(0)},children:"\u0625\u0639\u0627\u062f\u0629 \u0636\u0628\u0637"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-6",children:[(0,s.jsx)(W,{title:"\u062d\u0627\u0644\u0629: \u0645\u062a\u0627\u062d\u0629",active:x.available,color:"green",label:"\u0645\u062a\u0627\u062d\u0629",count:U.filter(e=>"available"===e.status).length,onClick:()=>F("available")}),(0,s.jsx)(W,{title:"\u062d\u0627\u0644\u0629: \u0645\u062d\u062c\u0648\u0632\u0629",active:x.reserved,color:"amber",label:"\u0645\u062d\u062c\u0648\u0632\u0629",count:U.filter(e=>"reserved"===e.status).length,onClick:()=>F("reserved")}),(0,s.jsx)(W,{title:"\u062d\u0627\u0644\u0629: \u0645\u0634\u063a\u0648\u0644\u0629",active:x.occupied,color:"pink",label:"\u0645\u0634\u063a\u0648\u0644\u0629",count:U.filter(e=>"occupied"===e.status).length,onClick:()=>F("occupied")}),(0,s.jsx)(W,{title:"\u062d\u0627\u0644\u0629: \u0635\u064a\u0627\u0646\u0629",active:x.maintenance,color:"red",label:"\u0635\u064a\u0627\u0646\u0629",count:U.filter(e=>"maintenance"===e.status).length,onClick:()=>F("maintenance")}),(0,s.jsx)("span",{className:"mx-2 text-gray-400",children:"|"}),(0,s.jsx)(W,{title:"\u0646\u0638\u0627\u0641\u0629: \u0646\u0638\u064a\u0641\u0629",active:_.clean,color:"green",label:"\u0646\u0638\u064a\u0641\u0629",count:U.filter(e=>"clean"===e.cleanliness).length,onClick:()=>q("clean")}),(0,s.jsx)(W,{title:"\u0646\u0638\u0627\u0641\u0629: \u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",active:_.in_cleaning,color:"amber",label:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",count:U.filter(e=>"in_cleaning"===e.cleanliness).length,onClick:()=>q("in_cleaning")}),(0,s.jsx)(W,{title:"\u0646\u0638\u0627\u0641\u0629: \u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",active:_.needs_cleaning,color:"red",label:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",count:U.filter(e=>"needs_cleaning"===e.cleanliness).length,onClick:()=>q("needs_cleaning")})]}),!n&&U.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:H,onChange:e=>{return t=e.target.checked,void D(e=>{const n=new Set(e);return t?U.forEach(e=>n.add(e.id)):U.forEach(e=>n.delete(e.id)),n});var t}}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:"\u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0643\u0644 (\u0627\u0644\u0639\u0646\u0627\u0635\u0631 \u0627\u0644\u0638\u0627\u0647\u0631\u0629)"})]}),n?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden animate-pulse",children:[(0,s.jsx)("div",{className:"h-1 bg-gray-200"}),(0,s.jsx)("div",{className:"px-4 pt-4 h-6 bg-gray-100 mb-2"}),(0,s.jsxs)("div",{className:"px-4 pb-4 space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-100"}),(0,s.jsx)("div",{className:"h-4 bg-gray-100 w-2/3"}),(0,s.jsx)("div",{className:"h-4 bg-gray-100 w-1/2"})]})]},t))}):0===U.length?(0,s.jsxs)("div",{className:"p-6 bg-white rounded shadow flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-lg font-semibold mb-1",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0646\u062a\u0627\u0626\u062c \u0645\u0637\u0627\u0628\u0642\u0629"}),(0,s.jsx)("div",{className:"text-gray-600",children:"\u062c\u0631\u0651\u0628 \u062a\u0639\u062f\u064a\u0644 \u0639\u0648\u0627\u0645\u0644 \u0627\u0644\u0628\u062d\u062b \u0623\u0648 \u0623\u0636\u0641 \u063a\u0631\u0641\u0629 \u062c\u062f\u064a\u062f\u0629."})]}),(0,s.jsx)("button",{onClick:z,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0625\u0636\u0627\u0641\u0629 \u063a\u0631\u0641\u0629"})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:U.map(e=>(0,s.jsx)(Cr,{room:e,onEdit:()=>(c(e),void o(!0)),onDelete:()=>(async e=>{try{if(!e||!e.id)return;const t=window.prompt("\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641 \u0627\u0643\u062a\u0628: ok","");if(!t||"ok"!==String(t).trim().toLowerCase())return void window.alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062d\u0630\u0641.");const{error:n}=await _r.from("rooms").delete().eq("id",e.id);if(n)throw n;await L()}catch(t){console.error("Delete room failed",t),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u063a\u0631\u0641\u0629: "+(t.message||t))}})(e),onSelect:()=>{return t=e.id,void D(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},selected:I.has(e.id)},e.id))}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",e.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",P]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>T(e=>Math.max(0,e-1)),disabled:0===C,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,s.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",C+1]}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>T(e=>e+1),disabled:(C+1)*O>=P,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1",value:O,onChange:e=>{R(Number(e.target.value)),T(0)},children:[(0,s.jsx)("option",{value:6,children:"6"}),(0,s.jsx)("option",{value:12,children:"12"}),(0,s.jsx)("option",{value:24,children:"24"})]})]})]}),V>0&&(0,s.jsxs)("div",{className:"fixed bottom-6 right-6 bg-white border shadow-lg rounded p-3 flex items-center gap-2",dir:"rtl",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:["\u0627\u0644\u0645\u062d\u062f\u062f: ",V]}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1",onChange:e=>{const t=e.target.value;t&&K("status",t),e.target.value=""},children:[(0,s.jsx)("option",{value:"",children:"\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u062d\u0627\u0644\u0629..."}),(0,s.jsx)("option",{value:"available",children:"\u0645\u062a\u0627\u062d\u0629"}),(0,s.jsx)("option",{value:"reserved",children:"\u0645\u062d\u062c\u0648\u0632\u0629"}),(0,s.jsx)("option",{value:"occupied",children:"\u0645\u0634\u063a\u0648\u0644\u0629"}),(0,s.jsx)("option",{value:"maintenance",children:"\u0635\u064a\u0627\u0646\u0629"})]}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1",onChange:e=>{const t=e.target.value;t&&K("cleanliness",t),e.target.value=""},children:[(0,s.jsx)("option",{value:"",children:"\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0646\u0638\u0627\u0641\u0629..."}),(0,s.jsx)("option",{value:"clean",children:"\u0646\u0638\u064a\u0641\u0629"}),(0,s.jsx)("option",{value:"in_cleaning",children:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641"}),(0,s.jsx)("option",{value:"needs_cleaning",children:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629"})]}),(0,s.jsx)("button",{className:"border rounded px-2 py-1",onClick:()=>D(new Set),children:"\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u062a\u062d\u062f\u064a\u062f"})]}),i&&(0,s.jsx)(Ir,{initialData:l,buildings:u,floors:h,roomTypes:p,onClose:()=>o(!1),onSave:async e=>{try{const t={building_id:e.building_id,floor_id:e.floor_id,room_type_id:e.room_type_id,room_code:(e.room_code||"").trim(),room_number:(e.room_code||"").trim(),status:e.status||"available",cleanliness:e.cleanliness||"clean",description:e.description||null,features:Array.isArray(e.features)?e.features:String(e.features||"").split(",").map(e=>e.trim()).filter(Boolean),image_url:e.image_url||null},n=async()=>l&&l.id?_r.from("rooms").update(t).eq("id",l.id):_r.from("rooms").insert([t]);let{error:r}=await n();if(r){const e=String(r.message||r).toLowerCase();if(e.includes("room_number")&&e.includes("does not exist")){delete t.room_number;r=(await n()).error}if(r){const e=String(r.message||r).toLowerCase();["view_id","room_view_id"].forEach(n=>{e.includes(n)&&delete t[n]})}if(r)throw r}o(!1),await L()}catch(t){console.error("Save room failed",t),window.alert("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0641\u0638 \u0627\u0644\u063a\u0631\u0641\u0629: "+(t.message||t))}}})]})}const Lr={pending:{color:"#F59E0B",labelAr:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"},confirmed:{color:"#10B981",labelAr:"\u0645\u0624\u0643\u062f"},checked_in:{color:"#3B82F6",labelAr:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"},checked_out:{color:"#6B7280",labelAr:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"},canceled:{color:"#EF4444",labelAr:"\u0645\u0644\u063a\u064a"},cancelled:{color:"#EF4444",labelAr:"\u0645\u0644\u063a\u064a"},no_show:{color:"#F59E0B",labelAr:"\u0644\u0645 \u064a\u062d\u0636\u0631"},empty:{color:"#E5E7EB",labelAr:"\u0641\u0627\u0631\u063a"}},Ur={available:{color:"#10B981",labelAr:"\u0645\u062a\u0627\u062d\u0629"},reserved:{color:"#F59E0B",labelAr:"\u0645\u062d\u062c\u0648\u0632\u0629"},occupied:{color:"#3B82F6",labelAr:"\u0645\u0634\u063a\u0648\u0644\u0629"},maintenance:{color:"#6B7280",labelAr:"\u0635\u064a\u0627\u0646\u0629"},unknown:{color:"#9CA3AF",labelAr:"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"}},Mr={occupied:{color:"#3B82F6",labelAr:"\u0645\u0634\u063a\u0648\u0644"},empty:{color:"#E5E7EB",labelAr:"\u0641\u0627\u0631\u063a"}};function zr(e){const t=String(e||"").toLowerCase();return(Lr[t]||Lr.empty).color}function Br(e){const t=String(e||"").toLowerCase();return(Mr[t]||Mr.empty).color}function Fr(e){let{selectedDate:t,onDateChange:n,searchQuery:a="",refreshTick:i=0}=e;const[o,l]=(0,r.useState)([]),[c,u]=(0,r.useState)([]),[d,h]=(0,r.useState)(!0),[f,p]=(0,r.useState)(()=>{const e=new Date;return e.setHours(0,0,0,0),e.toISOString().slice(0,10)}),[m,g]=(0,r.useState)(null),[v,b]=(0,r.useState)(!0),y=async()=>{h(!0);try{const{data:e,error:t}=await _r.from("rooms_overview").select("*").order("room_code");if(t)throw t;l(e||[])}catch(e){console.error("Calendar load failed",e),l([])}finally{h(!1)}},x=async(e,t)=>{try{const{data:n,error:r}=await _r.rpc("get_calendar_reservations",{p_start:e,p_end:t});if(r)throw r;u(n||[])}catch(n){console.error("Load calendar reservations failed",n),u([])}};(0,r.useEffect)(()=>{y()},[]),(0,r.useEffect)(()=>{const e=new Date(f);e.setDate(e.getDate()+6),x(f,e.toISOString().slice(0,10))},[f]),(0,r.useEffect)(()=>{t&&t!==f&&p(t)},[t]),(0,r.useEffect)(()=>{const e=new Date(f);e.setDate(e.getDate()+6),y(),x(f,e.toISOString().slice(0,10))},[i]);const w=(e=>{const t=[],n=new Date(e);for(let r=0;r<7;r++){const e=new Date(n);e.setDate(n.getDate()+r),t.push(e)}return t})(f);return(0,s.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u062a\u0642\u0648\u064a\u0645 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a (\u0623\u0633\u0628\u0648\u0639)"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0635\u064f\u0645\u0651\u0645 \u0644\u064a\u0633\u0647\u0651\u0644 \u0639\u0644\u0649 \u0627\u0644\u0645\u0628\u062a\u062f\u0626 \u0641\u0647\u0645 \u0627\u0644\u062d\u0627\u0644\u0629 \u0648\u0627\u0644\u062d\u0631\u0643\u0629"}),v&&(0,s.jsxs)("div",{className:"mt-2 text-xs bg-amber-50 border border-amber-200 text-amber-800 rounded px-3 py-2 max-w-2xl",children:["\u2022 \u0627\u062e\u062a\u0631 \u062a\u0627\u0631\u064a\u062e \u0628\u062f\u0627\u064a\u0629 \u0627\u0644\u0623\u0633\u0628\u0648\u0639 \u0645\u0646 \u0627\u0644\u0645\u0631\u0628\u0639 \u0627\u0644\u0645\u062c\u0627\u0648\u0631 \u0644\u0639\u0631\u0636 \u0623\u0633\u0628\u0648\u0639 \u0643\u0627\u0645\u0644.",(0,s.jsx)("br",{}),"\u2022 \u0645\u0631\u0628\u0639\u0627\u062a \u0645\u0644\u0648\u0651\u0646\u0629 \u062a\u0639\u0646\u064a \u0623\u064a\u0627\u0645\u064b\u0627 \u0645\u062d\u062c\u0648\u0632\u0629. \u0627\u0644\u0644\u0648\u0646 \u064a\u0648\u0636\u0651\u062d \u0627\u0644\u062d\u0627\u0644\u0629 (\u0627\u0646\u0638\u0631 \u0627\u0644\u062f\u0644\u064a\u0644 \u0623\u062f\u0646\u0627\u0647).",(0,s.jsx)("br",{}),"\u2022 \u0644\u0644\u062a\u0645\u062f\u064a\u062f: \u0627\u0633\u062d\u0628 \u0645\u0646 \u0645\u0631\u0628\u0639 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 \u064a\u0648\u0645 \u0623\u0628\u0639\u062f \u0641\u064a \u0646\u0641\u0633 \u0635\u0641 \u0627\u0644\u063a\u0631\u0641\u0629.",(0,s.jsx)("br",{}),"\u2022 \u0644\u0644\u0646\u0642\u0644: \u0627\u0633\u062d\u0628 \u0645\u0646 \u0645\u0631\u0628\u0639 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 \u0635\u0641 \u063a\u0631\u0641\u0629 \u0623\u062e\u0631\u0649\u060c \u0648\u0633\u064a\u064f\u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0644\u0646\u0641\u0633 \u0639\u062f\u062f \u0627\u0644\u0644\u064a\u0627\u0644\u064a."]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{className:"border rounded px-3 py-2",type:"date",value:f,onChange:e=>{p(e.target.value),n&&n(e.target.value)}}),(0,s.jsx)("button",{className:"px-3 py-2 border rounded text-sm",onClick:()=>b(e=>!e),children:v?"\u0625\u062e\u0641\u0627\u0621 \u0627\u0644\u062a\u0639\u0644\u064a\u0645\u0627\u062a":"\u0625\u0638\u0647\u0627\u0631 \u0627\u0644\u062a\u0639\u0644\u064a\u0645\u0627\u062a"})]})]}),(0,s.jsxs)("div",{className:"mb-4 bg-white border rounded p-3 text-xs max-w-2xl",children:[(0,s.jsx)("div",{className:"font-semibold mb-2",children:"\u062f\u0644\u064a\u0644 \u0627\u0644\u0623\u0644\u0648\u0627\u0646"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-3",children:[{k:"pending",name:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"},{k:"confirmed",name:"\u0645\u0624\u0643\u062f"},{k:"checked_in",name:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"},{k:"checked_out",name:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"},{k:"canceled",name:"\u0645\u0644\u063a\u064a"},{k:"empty",name:"\u0641\u0627\u0631\u063a"}].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"inline-block w-4 h-4 rounded",style:{backgroundColor:"empty"===e.k?Lr.empty.color:zr(e.k)}}),(0,s.jsx)("span",{children:e.name})]},t))})]}),(0,s.jsx)("div",{className:"max-h-[70vh] overflow-auto bg-white rounded shadow relative",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"sticky top-0 bg-white z-10",children:(0,s.jsxs)("tr",{className:"bg-gray-50",children:[(0,s.jsx)("th",{className:"border-b px-3 py-2 text-right w-40",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),w.map((e,t)=>(0,s.jsx)("th",{className:"border-b px-3 py-2 text-center w-32",children:e.toLocaleDateString("ar-EG",{weekday:"long",day:"numeric",month:"numeric"})},t))]})}),(0,s.jsx)("tbody",{children:d?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:8,className:"px-3 py-4 text-center",children:"\u062a\u062d\u0645\u064a\u0644..."})}):o.filter(e=>{const t=(a||"").trim();if(!t)return!0;const n=(e.room_code||e.room_label||"").toLowerCase().includes(t.toLowerCase()),r=c.some(n=>n.room_id===e.id&&(n.guest_names||n.guest_name||"").toLowerCase().includes(t.toLowerCase()));return n||r}).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"border-t px-3 py-2",children:[e.room_code," \u2013 ",e.room_type_name_ar]}),w.map((t,n)=>{const r=t.toISOString().slice(0,10);let i=c.find(t=>t.room_id===e.id&&r>=t.start_date&&r<t.end_date);const o=(a||"").trim().toLowerCase();if(i&&o){(i.guest_names||i.guest_name||"").toLowerCase().includes(o)||(i=null)}const l=i?zr(i.status):Lr.empty.color,u=i?"".concat(i.room_label," | ").concat(i.guest_names||i.guest_name,"\n").concat(i.start_date," \u2192 ").concat(i.end_date," \u2022 ").concat(function(e){const t=String(e||"").toLowerCase();return(Lr[t]||{labelAr:"\u063a\u064a\u0631 \u0645\u0639\u0631\u0648\u0641"}).labelAr}(i.status)):"\u0641\u0627\u0631\u063a",d=i&&(i.guest_names||i.guest_name)||"",h=d?d.split("\u060c").map(e=>e.trim()).filter(Boolean):[],p=h.length>0?h[0]:"",v=h.length>1?h.length-1:0;return(0,s.jsx)("td",{className:"border-t px-3 py-2 select-none",onMouseDown:()=>{i&&g({res:i,startDate:r})},onMouseUp:async()=>{if(m&&m.res&&m.res.room_id===e.id)try{if(m.startDate!==r){const e=r,{error:t}=await _r.rpc("extend_reservation",{p_reservation_id:m.res.id,p_new_check_out:e});if(t)throw t;const n=new Date(f);n.setDate(n.getDate()+6),await x(f,n.toISOString().slice(0,10))}}catch(t){console.error("Drag/resize failed",t),alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0628\u0627\u0644\u0633\u062d\u0628: "+(t.message||t))}finally{g(null)}else if(m&&m.res)try{const t=(new Date(m.res.end_date)-new Date(m.res.start_date))/864e5,n=r,a=new Date(n);a.setDate(a.getDate()+t);const s=a.toISOString().slice(0,10),{error:i}=await _r.rpc("move_reservation",{p_reservation_id:m.res.id,p_new_room_id:e.id,p_new_check_in:n,p_new_check_out:s});if(i)throw i;const o=new Date(f);o.setDate(o.getDate()+6),await x(f,o.toISOString().slice(0,10))}catch(t){console.error("Move failed",t),alert("\u062a\u0639\u0630\u0651\u0631 \u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632: "+(t.message||t))}finally{g(null)}},onMouseLeave:()=>{},children:(0,s.jsx)("div",{className:"h-8 rounded flex items-center justify-center",style:{backgroundColor:l,cursor:i?"grab":"default"},title:u,children:i&&(0,s.jsxs)("div",{className:"bg-white/95 text-gray-800 text-[10px] px-2 py-[2px] rounded-sm shadow-sm border border-white/80 max-w-full flex items-center gap-1",children:[(0,s.jsx)("span",{className:"truncate","aria-label":"\u0627\u0644\u0633\u0627\u0643\u0646 \u0627\u0644\u0631\u0626\u064a\u0633\u064a",children:p}),v>0&&(0,s.jsxs)("span",{className:"text-gray-500","aria-label":"\u0639\u062f\u062f \u0627\u0644\u0636\u064a\u0648\u0641 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u064a\u0646",children:["+",v]})]})})},n)})]},e.id))})]})}),!d&&0===o.length&&(0,s.jsx)("div",{className:"mt-4 text-sm bg-blue-50 border border-blue-200 text-blue-800 rounded px-3 py-2",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641 \u0645\u0639\u0631\u0648\u0636\u0629. \u0623\u0636\u0641 \u063a\u0631\u0641\u064b\u0627 \u0623\u0648\u0644\u064b\u0627 \u0645\u0646 \u0635\u0641\u062d\u0629 \u0627\u0644\u063a\u0631\u0641 \u0644\u0639\u0631\u0636 \u0627\u0644\u062a\u0642\u0648\u064a\u0645."})]})}function qr(e){let{status:t}=e;const n=function(e){const t=String(e||"").toLowerCase();return(Ur[t]||Ur.unknown).color}(t);return(0,s.jsx)("div",{className:"h-1",style:{backgroundColor:n}})}function Wr(e){let{value:t}=e;const n={clean:{text:"\u0646\u0638\u064a\u0641\u0629",cls:"bg-green-100 text-green-700"},in_cleaning:{text:"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641",cls:"bg-amber-100 text-amber-700"},needs_cleaning:{text:"\u062a\u062d\u062a\u0627\u062c \u0646\u0638\u0627\u0641\u0629",cls:"bg-red-100 text-red-700"}},r=n[t]||n.clean;return(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(r.cls),children:r.text})}function Vr(e){let{room:t,resv:n,date:a,onDropReservation:i}=e;const o=Number(t.max_guests||t.capacity||0),[l,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(!1),[h,f]=(0,r.useState)([]),[p,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)(null),[b,y]=(0,r.useState)(""),[x,w]=(0,r.useState)([]),_=(0,r.useMemo)(()=>{if(!n)return 0;const e=Number(n.guests_count||0);return Math.max(0,Math.min(e,o||0))},[n,o]),j=(0,r.useCallback)(async()=>{try{d(!0);const{data:e,error:n}=await _r.rpc("get_room_beds_status",{p_room_id:t.id,p_date:a});if(n)throw n;c(e||[])}catch(e){console.warn("get_room_beds_status failed, fallback to capacity squares",(null===e||void 0===e?void 0:e.message)||e),c([])}finally{d(!1)}},[t.id,a]);(0,r.useEffect)(()=>{j()},[j]);const k=(0,r.useCallback)(async()=>{if(n&&n.id)try{m(!0);const{data:e,error:t}=await _r.rpc("list_reservation_guests",{p_reservation_id:n.id});if(t)throw t;f(e||[])}catch(e){console.warn("list_reservation_guests failed",(null===e||void 0===e?void 0:e.message)||e),f([])}finally{m(!1)}else f([])},[n]);(0,r.useEffect)(()=>{k()},[k]),(0,r.useEffect)(()=>{const e=(b||"").trim();if(!e)return void w([]);const t=setTimeout(async()=>{try{const{data:t,error:n}=await _r.from("guests").select("id, full_name, phone, email").or("full_name.ilike.%".concat(e,"%,phone.ilike.%").concat(e,"%,email.ilike.%").concat(e,"%")).limit(10);if(n)throw n;w(t||[])}catch(t){console.warn("guest search failed",(null===t||void 0===t?void 0:t.message)||t),w([])}},350);return()=>clearTimeout(t)},[b]);const N=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!n)return;const{error:r}=await _r.rpc("assign_bed_for_reservation",{p_reservation_id:n.id,p_room_bed_id:e.bed_id,p_guest_id:t||g||n.guest_id||null,p_start:n.check_in_date,p_end:n.check_out_date});if(r)throw r;await j(),await k()}catch(r){window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0633\u0646\u0627\u062f \u0627\u0644\u0633\u0631\u064a\u0631: "+(r.message||r))}},S=()=>{if(l.length>0)return(0,s.jsx)("div",{className:"flex flex-wrap gap-2","aria-label":"\u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629",children:l.map(e=>{const t=!!e.assignment_id;return(0,s.jsxs)("div",{className:"px-2 py-1 rounded border text-xs flex items-center gap-2 ".concat(t?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"),style:{borderColor:Br(t?"occupied":"empty")},title:t?"\u0645\u0634\u063a\u0648\u0644: ".concat(e.guest_name||"\u2014"):"\u0641\u0627\u0631\u063a",children:[(0,s.jsx)("button",{className:"underline",onClick:()=>{!t&&n&&N(e)},children:e.bed_code}),t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["\u2013 ",e.guest_name||"\u0645\u062c\u0647\u0648\u0644"]}),(0,s.jsx)("button",{className:"ml-2 text-red-600 hover:text-red-700",title:"\u0625\u0644\u063a\u0627\u0621",onClick:()=>(async e=>{try{const{error:t}=await _r.rpc("unassign_bed",{p_assignment_id:e});if(t)throw t;await j(),await k()}catch(t){window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0644\u063a\u0627\u0621 \u0625\u0633\u0646\u0627\u062f \u0627\u0644\u0633\u0631\u064a\u0631: "+(t.message||t))}})(e.assignment_id),children:"\u0625\u0644\u063a\u0627\u0621 \u2716"})]})]},e.bed_id)})});const e=[];for(let t=0;t<(o||0);t++){const n=t<_;e.push((0,s.jsx)("div",{className:"w-5 h-3 rounded-sm border",style:{backgroundColor:Br(n?"occupied":"empty"),borderColor:Br(n?"occupied":"empty")},title:n?"\u0645\u0634\u063a\u0648\u0644":"\u0641\u0627\u0631\u063a"},t))}return(0,s.jsx)("div",{className:"flex flex-wrap gap-1","aria-label":"\u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629: ".concat(_,"/").concat(o),children:e})};return(0,s.jsxs)("div",{onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();try{const n=JSON.parse(e.dataTransfer.getData("application/json"));if(!n||!n.id)return;if(String(n.room_id)===String(t.id))return;i&&i(n,t)}catch(n){}},className:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden",dir:"rtl",children:[(0,s.jsx)(qr,{status:t.status}),(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("div",{className:"font-bold text-gray-800",title:"\u0627\u0644\u063a\u0631\u0641\u0629",children:t.room_code||t.room_label}),(0,s.jsx)("div",{className:"text-xs text-gray-500",title:"\u0627\u0644\u0646\u0648\u0639",children:t.room_type_name_ar||t.room_type_name})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2 text-xs text-gray-600",children:[(0,s.jsxs)("div",{children:[t.floor_name," \u2013 ",t.building_name]}),(0,s.jsx)(Wr,{value:t.cleanliness})]}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)(S,{})}),n?(0,s.jsxs)("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.setData("application/json",JSON.stringify({id:n.id,room_id:n.room_id,check_in_date:n.check_in_date,check_out_date:n.check_out_date}))},className:"px-2 py-1 rounded text-xs bg-blue-50 border border-blue-200 text-blue-700 cursor-grab",title:"\u0627\u0644\u0646\u0632\u064a\u0644: ".concat(n.guest_name||"\u2014"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("span",{className:"truncate",children:n.guest_name||"\u0646\u0632\u064a\u0644"}),(0,s.jsxs)("span",{className:"text-[10px] text-gray-500",children:[_,"/",o]})]}),(0,s.jsxs)("div",{className:"text-[10px] text-gray-500",children:["\u0645\u0646 ",n.check_in_date," \u0625\u0644\u0649 ",n.check_out_date]}),(0,s.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 border border-gray-200 rounded",children:[(0,s.jsx)("div",{className:"text-xs font-semibold mb-1",children:"\u0636\u064a\u0648\u0641 \u0627\u0644\u062d\u062c\u0632"}),p?(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:0===h.length?(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0636\u064a\u0648\u0641 \u0625\u0636\u0627\u0641\u064a\u0648\u0646."}):h.map(e=>(0,s.jsxs)("label",{className:"px-2 py-1 rounded border text-xs cursor-pointer ".concat(g===e.guest_id?"bg-amber-50 border-amber-300 text-amber-800":"bg-white border-gray-300 text-gray-700"),children:[(0,s.jsx)("input",{type:"radio",name:"sel-".concat(n.id),className:"mr-1",checked:g===e.guest_id,onChange:()=>v(e.guest_id)}),e.full_name]},e.reservation_guest_id))}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{value:b,onChange:e=>y(e.target.value),className:"border rounded px-2 py-1 text-xs flex-1",placeholder:"\u0628\u062d\u062b: \u0627\u0644\u0627\u0633\u0645/\u0627\u0644\u0647\u0627\u062a\u0641/\u0627\u0644\u0628\u0631\u064a\u062f"}),x.length>0&&(0,s.jsx)("div",{className:"absolute mt-10 bg-white border rounded shadow p-2 text-xs max-h-40 overflow-auto z-10",children:x.map(e=>(0,s.jsxs)("div",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onClick:()=>(async e=>{try{if(!n||!n.id||!e)return;const{error:t}=await _r.rpc("add_reservation_guest",{p_reservation_id:n.id,p_guest_id:e,p_role:"additional"});if(t)throw t;v(e),y(""),w([]),await k(),await j();const r=(l||[]).find(e=>!e.assignment_id);r?await N(r,e):window.alert("\u0644\u0627 \u062a\u0648\u062c\u062f \u0623\u0633\u0650\u0631\u0651\u0629 \u0641\u0627\u0631\u063a\u0629 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u064a\u0648\u0645.")}catch(t){window.alert("\u062a\u0639\u0630\u0651\u0631 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0636\u064a\u0641 \u0644\u0644\u062d\u062c\u0632: "+(t.message||t))}})(e.id),children:[e.full_name," ",(0,s.jsxs)("span",{className:"text-gray-500",children:["(",e.phone||e.email||e.id.slice(0,8),")"]})]},e.id))})]}),(0,s.jsx)("div",{className:"mt-2 text-[11px] text-gray-500",children:"\u0627\u062e\u062a\u0631 \u0636\u064a\u0641\u064b\u0627\u060c \u062b\u0645 \u0627\u0636\u063a\u0637 \u0639\u0644\u0649 \u0633\u0631\u064a\u0631 \u0641\u0627\u0631\u063a \u0644\u0625\u0633\u0646\u0627\u062f\u0647."})]})]}):(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u062d\u062c\u0632 \u0641\u064a \u0647\u0630\u0627 \u0627\u0644\u062a\u0627\u0631\u064a\u062e"})]})]})}function Hr(e){let{selectedDate:t,onDateChange:n,searchQuery:a="",refreshTick:i=0}=e;const[o,l]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[c,u]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[f,p]=(0,r.useState)(!0),m=(0,r.useCallback)(async()=>{try{const{data:e,error:t}=await _r.from("rooms_overview").select("id, room_code, room_label, status, cleanliness, max_guests, room_type_name_ar, room_type_name, building_id, building_name, floor_id, floor_name").order("room_code");if(t)throw t;if(e&&e.length>0)return void u(e)}catch(e){console.warn("rooms_overview unavailable, falling back to base tables:",(null===e||void 0===e?void 0:e.message)||e)}try{const[e,n,r,a]=await Promise.all([_r.from("rooms").select("id, room_code, status, cleanliness, room_type_id, building_id, floor_id").order("room_code"),_r.from("room_types_active").select("id, name, name_ar, max_guests").order("display_order"),_r.from("buildings").select("id, name").order("name"),_r.from("floors").select("id, name, floor_number, number, building_id").order("id")]);let s=n.data||[];if(n.error||0===s.length)try{const e=await _r.from("room_types").select("id, name, name_ar, max_guests").order("id");e.error||(s=e.data||[])}catch(t){}const i=new Map;s.forEach(e=>i.set(String(e.id),e));const o=new Map;(r.data||[]).forEach(e=>o.set(String(e.id),e));const l=new Map;(a.data||[]).forEach(e=>l.set(String(e.id),e));const c=(e.data||[]).map(e=>{const t=i.get(String(e.room_type_id)),n=o.get(String(e.building_id)),r=l.get(String(e.floor_id)),a=e.room_code||(e.id?"\u063a\u0631\u0641\u0629 #".concat(String(e.id).slice(0,8)):"\u063a\u0631\u0641\u0629"),s=(null===n||void 0===n?void 0:n.name)||"\u0645\u0628\u0646\u0649",c=(null===r||void 0===r?void 0:r.name)||(null!==r&&void 0!==r&&r.floor_number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(r.floor_number):null!==r&&void 0!==r&&r.number?"\u0627\u0644\u0637\u0627\u0628\u0642 ".concat(r.number):"\u0637\u0627\u0628\u0642");return{id:e.id,room_code:e.room_code,room_label:a,status:e.status,cleanliness:e.cleanliness,max_guests:(null===t||void 0===t?void 0:t.max_guests)||0,room_type_name_ar:null===t||void 0===t?void 0:t.name_ar,room_type_name:null===t||void 0===t?void 0:t.name,building_id:e.building_id,building_name:s,floor_id:e.floor_id,floor_name:c}});u(c)}catch(n){console.error("Fallback loadRooms failed",n),u([])}},[]),g=(0,r.useCallback)(async e=>{try{const{data:t,error:n}=await _r.from("reservations").select("id, room_id, guest_id, guests_count, status, check_in_date, check_out_date, guests(full_name)").in("status",["pending","confirmed","checked_in"]).lte("check_in_date",e).gte("check_out_date",e);if(n)throw n;const r=(t||[]).map(e=>({id:e.id,room_id:e.room_id,guests_count:e.guests_count,status:e.status,check_in_date:e.check_in_date,check_out_date:e.check_out_date,guest_name:e.guests&&e.guests.full_name?e.guests.full_name:void 0}));h(r)}catch(t){console.error("loadResvsForDate failed",t),h([])}},[]),v=(0,r.useCallback)(async()=>{p(!0),await Promise.all([m(),g(o)]),p(!1)},[o,m,g]);(0,r.useEffect)(()=>{v()},[v]),(0,r.useEffect)(()=>{t&&t!==o&&l(t)},[t]),(0,r.useEffect)(()=>{v()},[i]),(0,r.useEffect)(()=>{const e=_r.channel("tashkeen-live").on("postgres_changes",{event:"*",schema:"public",table:"reservations"},()=>{g(o)}).on("postgres_changes",{event:"*",schema:"public",table:"rooms"},()=>{m()}).subscribe();return()=>{try{_r.removeChannel(e)}catch(t){}}},[o,m,g]);const b=(0,r.useMemo)(()=>{const e=new Map;return d.forEach(t=>{e.set(String(t.room_id),t)}),e},[d]),y=(0,r.useMemo)(()=>{const e=(a||"").trim().toLowerCase();if(!e)return c;const t=new Map;return d.forEach(e=>{t.set(String(e.room_id),e)}),c.filter(n=>{const r=(n.room_code||n.room_label||"").toLowerCase().includes(e),a=t.get(String(n.id)),s=!!a&&(a.guest_name||"").toLowerCase().includes(e);return r||s})},[c,d,a]),x=(0,r.useMemo)(()=>{const e=new Map;return y.forEach(t=>{const n=String(t.building_id||t.building_name||"\u2014"),r=String(t.floor_id||t.floor_name||"\u2014");e.has(n)||e.set(n,{label:t.building_name||"\u0645\u0628\u0646\u0649",floors:new Map});const a=e.get(n);a.floors.has(r)||a.floors.set(r,{label:t.floor_name||"\u0637\u0627\u0628\u0642",rooms:[]}),a.floors.get(r).rooms.push(t)}),Array.from(e.values()).map(e=>({label:e.label,floors:Array.from(e.floors.values()).map(e=>({label:e.label,rooms:e.rooms}))}))},[y]),w=async(e,t)=>{try{if(!window.confirm("\u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0625\u0644\u0649 ".concat(t.room_code||t.room_label," \u0644\u0646\u0641\u0633 \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e\u061f")))return;const{data:n,error:r}=await _r.rpc("move_reservation",{p_reservation_id:e.id,p_new_room_id:t.id,p_new_check_in:e.check_in_date,p_new_check_out:e.check_out_date});if(r)throw r;await g(o),window.alert("\u062a\u0645 \u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0628\u0646\u062c\u0627\u062d.")}catch(n){console.error("move failed",n),window.alert("\u062a\u0639\u0630\u0651\u0631 \u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632: "+(n.message||n))}};return(0,s.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0627\u0644\u062a\u0633\u0643\u064a\u0646 (\u0639\u0631\u0636 \u0625\u0634\u063a\u0627\u0644 \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629)"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0639\u0631\u0636 \u0628\u0635\u0631\u064a \u0644\u0639\u062f\u062f \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629 \u062d\u0633\u0628 \u0633\u0639\u0629 \u0627\u0644\u063a\u0631\u0641\u0629 \u0648\u0645\u0644\u0624\u0647\u0627 \u0628\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u062c\u0627\u0631\u064a\u0629 \u0641\u064a \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0645\u062d\u062f\u062f."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"date",className:"border rounded px-3 py-2",value:o,onChange:e=>{l(e.target.value),n&&n(e.target.value)},title:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,s.jsx)("button",{className:"border rounded px-3 py-2 bg-white hover:bg-gray-50",onClick:()=>{const e=(new Date).toISOString().slice(0,10);l(e),n&&n(e)},children:"\u0627\u0644\u064a\u0648\u0645"})]})]}),(0,s.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:["- \u0627\u0633\u062d\u0628 \u0628\u0637\u0627\u0642\u0629 \u0627\u0644\u0646\u0632\u064a\u0644 \u0645\u0646 \u063a\u0631\u0641\u0629 \u0625\u0644\u0649 \u0623\u062e\u0631\u0649 \u0644\u0646\u0642\u0644 \u0627\u0644\u062d\u062c\u0632 \u0644\u0646\u0641\u0633 \u0627\u0644\u0645\u062f\u0629. ",(0,s.jsx)("br",{}),"- \u0643\u0644 \u0645\u0633\u062a\u0637\u064a\u0644 \u0635\u063a\u064a\u0631 \u064a\u0645\u062b\u0644 \u0633\u0631\u064a\u0631\u064b\u0627\u061b \u0627\u0644\u0645\u0645\u062a\u0644\u0626 \u064a\u0639\u0646\u064a \u0645\u0634\u063a\u0648\u0644 \u062d\u0633\u0628 \u0639\u062f\u062f \u0627\u0644\u0636\u064a\u0648\u0641 \u0641\u064a \u0627\u0644\u062d\u062c\u0632. ",(0,s.jsx)("br",{}),"- \u064a\u0645\u0643\u0646\u0643 \u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0645\u0646 \u0627\u0644\u0623\u0639\u0644\u0649 \u0644\u0645\u0634\u0627\u0647\u062f\u0629 \u0625\u0634\u063a\u0627\u0644 \u064a\u0648\u0645 \u0645\u0639\u064a\u0646.",(0,s.jsxs)("div",{className:"mt-2 text-xs text-blue-900 flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"inline-block w-4 h-4 rounded",style:{backgroundColor:Br("occupied")}})," ",(0,s.jsx)("span",{children:"\u0633\u0631\u064a\u0631 \u0645\u0634\u063a\u0648\u0644"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"inline-block w-4 h-4 rounded",style:{backgroundColor:Br("empty")}})," ",(0,s.jsx)("span",{children:"\u0633\u0631\u064a\u0631 \u0641\u0627\u0631\u063a"})]})]})]}),f?(0,s.jsx)("div",{className:"text-gray-500",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):0===x.length?(0,s.jsx)("div",{className:"text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u063a\u0631\u0641."}):(0,s.jsx)("div",{className:"space-y-8",children:x.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-lg font-bold text-gray-800 mb-3",children:e.label}),(0,s.jsx)("div",{className:"space-y-6",children:e.floors.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:e.label}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:e.rooms.map(e=>(0,s.jsx)(Vr,{room:e,resv:b.get(String(e.id)),date:o,onDropReservation:w},e.id))})]},t))})]},t))})]})}function Kr(e){let{name:t,className:n}=e;const r={className:"w-4 h-4 ".concat(n||"")};switch(t){case"phone":return(0,s.jsx)("svg",Ce(Ce({},r),{},{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.11 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.12.9.32 1.77.59 2.61a2 2 0 0 1-.45 2.11L8 9a16 16 0 0 0 7 7l.56-.25a2 2 0 0 1 2.11-.45c.84.27 1.71.47 2.61.59A2 2 0 0 1 22 16.92z"})}));case"id":return(0,s.jsxs)("svg",Ce(Ce({},r),{},{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),(0,s.jsx)("circle",{cx:"8",cy:"12",r:"3"}),(0,s.jsx)("path",{d:"M14 10h6M14 14h6"})]}));case"email":return(0,s.jsxs)("svg",Ce(Ce({},r),{},{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M4 4h16a2 2 0 1 1 0 0v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"}),(0,s.jsx)("path",{d:"M22 6l-10 7L2 6"})]}));case"star":return(0,s.jsx)("svg",Ce(Ce({},r),{},{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z"})}));default:return null}}function Gr(e){let{label:t,active:n}=e;return(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(n?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:t})}function Jr(e){let{guest:t,onEdit:n,onDelete:r,onHistory:a}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow transform hover:-translate-y-0.5 border border-gray-200 overflow-hidden",dir:"rtl",children:[(0,s.jsx)("div",{className:"h-1 ".concat(t.is_vip?"bg-purple-500":"bg-blue-500")}),(0,s.jsx)("div",{className:"px-4 pt-4 flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-700 font-bold ".concat(t.is_vip?"ring-2 ring-purple-300":""),children:[t.avatar_url?(0,s.jsx)("img",{src:t.avatar_url,alt:t.full_name||"",className:"w-full h-full object-cover"}):(0,s.jsx)("span",{children:String(t.full_name||"\u061f").trim().split(/\s+/).slice(0,2).map(e=>e[0]).join("").toUpperCase()||"\u061f"}),t.is_vip&&(0,s.jsx)("span",{className:"absolute -bottom-1 -left-1 bg-purple-600 text-white rounded-full p-0.5",title:"\u0646\u0632\u064a\u0644 VIP",children:(0,s.jsx)(Kr,{name:"star",className:"w-3 h-3"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-gray-800 font-bold",children:t.full_name}),t.is_vip&&(0,s.jsxs)("span",{className:"hidden md:inline-flex items-center gap-1 text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",title:"\u0646\u0632\u064a\u0644 VIP",children:[(0,s.jsx)(Kr,{name:"star",className:"text-purple-600"})," VIP"]})]})]})}),(0,s.jsxs)("div",{className:"px-4 py-3 text-xs text-gray-600",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,s.jsx)(Kr,{name:"phone",className:"text-gray-500"}),(0,s.jsxs)("span",{children:["\u0647\u0627\u062a\u0641: ",t.phone||"\u2014"]})]}),(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,s.jsx)(Kr,{name:"id",className:"text-gray-500"}),(0,s.jsxs)("span",{children:["\u0647\u0648\u064a\u0629: ",t.national_id||"\u2014"]})]}),(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,s.jsx)(Kr,{name:"email",className:"text-gray-500"}),(0,s.jsxs)("span",{children:["\u0628\u0631\u064a\u062f: ",t.email||"\u2014"]})]}),t.id_doc_url&&(0,s.jsxs)("div",{className:"mb-1 text-xs",children:[(0,s.jsx)("a",{href:t.id_doc_url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"\u0639\u0631\u0636 \u0635\u0648\u0631\u0629 \u0627\u0644\u0647\u0648\u064a\u0629"}),t.id_doc_type&&(0,s.jsxs)("span",{className:"ml-2 text-gray-500",children:["(","passport"===t.id_doc_type?"\u062c\u0648\u0627\u0632 \u0633\u0641\u0631":"\u0628\u0637\u0627\u0642\u0629 \u0634\u062e\u0635\u064a\u0629",")"]})]}),(0,s.jsxs)("div",{className:"mb-1",children:["\u0623\u064f\u0646\u0634\u0626: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"\u2014"]}),(0,s.jsxs)("div",{className:"mb-2",children:["\u0622\u062e\u0631 \u0632\u064a\u0627\u0631\u0629: ",t.last_visit_at?new Date(t.last_visit_at).toLocaleDateString("ar-EG"):"\u2014"]}),(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,s.jsx)(Gr,{label:"\u0632\u064a\u0627\u0631\u0627\u062a: ".concat(t.visits_count||0),active:(t.visits_count||0)>0}),(0,s.jsx)(Gr,{label:t.has_current_stay?"\u062d\u062c\u0632 \u0642\u0627\u0626\u0645":"\u0644\u0627 \u064a\u0648\u062c\u062f \u062d\u062c\u0632 \u0642\u0627\u0626\u0645",active:t.has_current_stay}),(0,s.jsx)(Gr,{label:t.has_upcoming_reservation?"\u0642\u0627\u062f\u0650\u0645":"\u063a\u064a\u0631 \u0642\u0627\u062f\u0650\u0645",active:t.has_upcoming_reservation})]})]}),(0,s.jsx)("div",{className:"px-4 py-3 border-t bg-gray-50",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:a,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded text-sm flex-1",children:"\u0627\u0644\u0633\u062c\u0644 \ud83d\udcdc"}),(0,s.jsx)("button",{onClick:n,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062a\u0639\u062f\u064a\u0644 \u270d\ufe0f"}),(0,s.jsx)("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm flex-1",children:"\u062d\u0630\u0641 \ud83d\uddd1\ufe0f"})]})})]})}function $r(e){let{initialData:t,onClose:n,onSave:a}=e;const i=e=>{const t=String(e||"").trim().split(/\s+/);return 0===t.length?{first:"",last:""}:1===t.length?{first:t[0],last:""}:{first:t[0],last:t.slice(1).join(" ")}},o=(()=>{const e=(null===t||void 0===t?void 0:t.first_name)||"",n=(null===t||void 0===t?void 0:t.last_name)||"";return e.trim().length+n.trim().length===0&&null!==t&&void 0!==t&&t.full_name?i(t.full_name):{first:e,last:n}})(),[l,c]=(0,r.useState)(o.first||""),[u,d]=(0,r.useState)(o.last||""),[h,f]=(0,r.useState)((null===t||void 0===t?void 0:t.email)||""),[p,m]=(0,r.useState)((null===t||void 0===t?void 0:t.phone)||""),[g,v]=(0,r.useState)((null===t||void 0===t?void 0:t.nationality)||""),[b,y]=(0,r.useState)((null===t||void 0===t?void 0:t.national_id)||""),[x,w]=(0,r.useState)((null===t||void 0===t?void 0:t.address)||""),[_,j]=(0,r.useState)((null===t||void 0===t?void 0:t.city)||""),[k,N]=(0,r.useState)((null===t||void 0===t?void 0:t.country)||""),[S,E]=(0,r.useState)(!(null===t||void 0===t||!t.is_vip)),[C,T]=(0,r.useState)((null===t||void 0===t?void 0:t.avatar_url)||""),[O,R]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_type)||"national_id"),[P,A]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_number)||""),[I,D]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_url)||""),[L,U]=(0,r.useState)((null===t||void 0===t?void 0:t.id_doc_uploaded_at)||null),[M,z]=(0,r.useState)(!1),[B,F]=(0,r.useState)((null===t||void 0===t?void 0:t.notes)||""),[q,W]=(0,r.useState)(!1),[V,H]=(0,r.useState)({});r.useEffect(()=>{const e=(null===t||void 0===t?void 0:t.first_name)||"",n=(null===t||void 0===t?void 0:t.last_name)||"";let r={first:e,last:n};e.trim().length+n.trim().length===0&&null!==t&&void 0!==t&&t.full_name&&(r=i(t.full_name)),c(r.first||""),d(r.last||""),f((null===t||void 0===t?void 0:t.email)||""),m((null===t||void 0===t?void 0:t.phone)||""),v((null===t||void 0===t?void 0:t.nationality)||""),y((null===t||void 0===t?void 0:t.national_id)||""),w((null===t||void 0===t?void 0:t.address)||""),j((null===t||void 0===t?void 0:t.city)||""),N((null===t||void 0===t?void 0:t.country)||""),E(!(null===t||void 0===t||!t.is_vip)),T((null===t||void 0===t?void 0:t.avatar_url)||""),R((null===t||void 0===t?void 0:t.id_doc_type)||"national_id"),A((null===t||void 0===t?void 0:t.id_doc_number)||""),D((null===t||void 0===t?void 0:t.id_doc_url)||""),U((null===t||void 0===t?void 0:t.id_doc_uploaded_at)||null),F((null===t||void 0===t?void 0:t.notes)||""),H({})},[t]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg sm:max-w-xl md:max-w-2xl lg:max-w-3xl max-h-[90vh] flex flex-col",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b sticky top-0 bg-white z-10",children:(0,s.jsx)("h3",{className:"text-xl font-bold",children:t?"\u062a\u0639\u062f\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0646\u0632\u064a\u0644":"\u0625\u0636\u0627\u0641\u0629 \u0646\u0632\u064a\u0644 \u062c\u062f\u064a\u062f"})}),(0,s.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={},t=String(l).trim().length+String(u).trim().length>0,n="".concat(String(l||"").trim()," ").concat(String(u||"").trim()).trim();return t||0!==n.length||(e.full_name="\u0627\u0643\u062a\u0628 \u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644 \u0648\u0627\u0644\u0623\u062e\u064a\u0631 \u0623\u0648 \u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644."),H(e),0===Object.keys(e).length})()){W(!0);try{await a({first_name:l,last_name:u,avatar_url:C,id_doc_type:O,id_doc_number:P,id_doc_url:I,id_doc_uploaded_at:L,email:h,phone:p,nationality:g,national_id:b,address:x,city:_,country:k,is_vip:S,notes:B})}finally{W(!1)}}},className:"px-6 py-4 flex-1 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644 *"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:l,onChange:e=>{c(e.target.value),H(e=>Ce(Ce({},e),{},{full_name:void 0}))},placeholder:"\u0623\u062d\u0645\u062f"}),V.full_name&&(0,s.jsx)("div",{className:"text-red-600 text-xs mt-1",children:V.full_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u062e\u064a\u0631 *"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:u,onChange:e=>{d(e.target.value),H(e=>Ce(Ce({},e),{},{full_name:void 0}))},placeholder:"\u0645\u062d\u0645\u062f"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0631\u0627\u0628\u0637 \u0627\u0644\u0635\u0648\u0631\u0629 (\u0627\u062e\u062a\u064a\u0627\u0631\u064a)"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:C,onChange:e=>T(e.target.value),placeholder:"https://.../avatar.jpg"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0625\u0644\u0643\u062a\u0631\u0648\u0646\u064a"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:h,onChange:e=>f(e.target.value),placeholder:"name@example.com"})]}),(0,s.jsx)("div",{className:"md:col-span-2 border-t pt-4 mt-2",children:(0,s.jsxs)("details",{className:"group",children:[(0,s.jsxs)("summary",{className:"font-semibold text-sm cursor-pointer list-none flex items-center justify-between",children:[(0,s.jsx)("span",{children:"\u0647\u0648\u064a\u0629 \u0627\u0644\u0639\u0645\u064a\u0644"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 group-open:hidden",children:"\u0625\u0638\u0647\u0627\u0631"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 hidden group-open:inline",children:"\u0625\u062e\u0641\u0627\u0621"})]}),(0,s.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0646\u0648\u0639 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,s.jsxs)("select",{className:"mt-1 border rounded w-full px-3 py-2",value:O,onChange:e=>R(e.target.value),children:[(0,s.jsx)("option",{value:"national_id",children:"\u0628\u0637\u0627\u0642\u0629 \u0634\u062e\u0635\u064a\u0629"}),(0,s.jsx)("option",{value:"passport",children:"\u062c\u0648\u0627\u0632 \u0633\u0641\u0631"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:P,onChange:e=>A(e.target.value),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u062c\u0648\u0627\u0632/\u0627\u0644\u0628\u0637\u0627\u0642\u0629"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0631\u0641\u0639 \u0635\u0648\u0631\u0629 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,s.jsx)("input",{type:"file",accept:"image/*,application/pdf",className:"mt-1 w-full",onChange:async e=>{const t=e.target.files&&e.target.files[0];if(t)try{z(!0);const e="".concat(Date.now(),"_").concat(t.name.replace(/\s+/g,"_")),{error:n}=await _r.storage.from("guest-ids").upload(e,t,{upsert:!0,contentType:t.type});if(n)throw n;const{data:r}=_r.storage.from("guest-ids").getPublicUrl(e);null!==r&&void 0!==r&&r.publicUrl&&(D(r.publicUrl),U((new Date).toISOString()))}catch(n){console.error("Upload ID failed",n),alert("\u062a\u0639\u0630\u0651\u0631 \u0631\u0641\u0639 \u0627\u0644\u0647\u0648\u064a\u0629. \u062a\u0623\u0643\u062f \u0645\u0646 \u0635\u0644\u0627\u062d\u064a\u0627\u062a Storage \u062b\u0645 \u062d\u0627\u0648\u0644 \u0645\u062c\u062f\u062f\u064b\u0627.")}finally{z(!1)}}}),M&&(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"\u062c\u0627\u0631\u064d \u0627\u0644\u0631\u0641\u0639..."}),I&&(0,s.jsxs)("div",{className:"text-xs mt-1",children:[(0,s.jsx)("a",{href:I,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"\u0639\u0631\u0636 \u0627\u0644\u0647\u0648\u064a\u0629 \u0627\u0644\u0645\u0631\u0641\u0648\u0639\u0629"}),L&&(0,s.jsxs)("span",{className:"text-gray-500 ml-2",children:["(\u0645\u0631\u0641\u0648\u0639\u0629: ",new Date(L).toLocaleDateString("ar-EG"),")"]})]})]})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641 *"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:p,onChange:e=>m(e.target.value),placeholder:"01234567890"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u062c\u0646\u0633\u064a\u0629"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:g,onChange:e=>v(e.target.value),placeholder:"\u0645\u0635\u0631\u064a"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0648\u064a\u0629"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:b,onChange:e=>y(e.target.value),placeholder:"29901011234567"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0639\u0646\u0648\u0627\u0646"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:x,onChange:e=>w(e.target.value),placeholder:"\u0627\u0644\u0642\u0627\u0647\u0631\u0629 - \u0645\u0635\u0631 \u0627\u0644\u062c\u062f\u064a\u062f\u0629"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u062f\u064a\u0646\u0629"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:_,onChange:e=>j(e.target.value),placeholder:"\u0627\u0644\u0642\u0627\u0647\u0631\u0629"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u062f\u0648\u0644\u0629"}),(0,s.jsx)("input",{className:"mt-1 border rounded w-full px-3 py-2",value:k,onChange:e=>N(e.target.value),placeholder:"\u0645\u0635\u0631"})]}),(0,s.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:S,onChange:e=>E(e.target.checked)}),(0,s.jsx)("span",{className:"text-sm",children:"\u0646\u0632\u064a\u0644 VIP \u2b50"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),(0,s.jsx)("textarea",{className:"mt-1 border rounded w-full px-3 py-2",rows:3,value:B,onChange:e=>F(e.target.value),placeholder:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a \u0625\u0636\u0627\u0641\u064a\u0629..."})]})]}),(0,s.jsxs)("div",{className:"sticky bottom-0 -mx-6 px-6 pt-3 mt-6 bg-white border-t flex justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:n,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded",children:"\u0625\u0644\u063a\u0627\u0621"}),(0,s.jsx)("button",{type:"submit",disabled:q,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:q?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a"})]})]})]})})}function Qr(e){let{guest:t,onClose:n}=e;const[a,i]=(0,r.useState)([]),[o,l]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(async()=>{l(!0);try{const{data:e,error:n}=await _r.from("reservations").select("id, check_in_date, check_out_date, status, created_at, room_id").eq("guest_id",t.id).order("check_in_date",{ascending:!1});if(n)throw n;i(e||[])}catch(e){console.error("Load guest history failed",e),i([])}finally{l(!1)}})()},[null===t||void 0===t?void 0:t.id]),(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold",children:["\u0633\u062c\u0644 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a: ",(null===t||void 0===t?void 0:t.full_name)||""]}),(0,s.jsx)("button",{onClick:n,className:"text-gray-600 hover:text-gray-900",children:"\u0625\u063a\u0644\u0627\u0642 \u2716"})]}),(0,s.jsx)("div",{className:"p-6",children:o?(0,s.jsx)("div",{className:"text-gray-500",children:"\u062c\u0627\u0631\u064d \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."}):0===a.length?(0,s.jsx)("div",{className:"text-gray-600",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0633\u0627\u0628\u0642\u0629 \u0644\u0647\u0630\u0627 \u0627\u0644\u0646\u0632\u064a\u0644."}):(0,s.jsx)("div",{className:"space-y-3",children:a.map(e=>{var t;return(0,s.jsxs)("div",{className:"border rounded p-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-semibold",children:[e.check_in_date?new Date(e.check_in_date).toLocaleDateString("ar-EG"):"\u2014"," \u2192 ",e.check_out_date?new Date(e.check_out_date).toLocaleDateString("ar-EG"):"\u2014"]}),(0,s.jsxs)("div",{className:"text-xs text-gray-600",children:["\u0627\u0644\u062d\u0627\u0644\u0629: ",e.status||"\u2014"," \u2022 \u0625\u0646\u0634\u0626\u062a: ",e.created_at?new Date(e.created_at).toLocaleDateString("ar-EG"):"\u2014"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["\u0627\u0644\u063a\u0631\u0641\u0629: ",null!==(t=e.room_id)&&void 0!==t?t:"\u2014"]})]},e.id)})})})]})})}function Yr(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(0),[h,f]=(0,r.useState)(12),[p,m]=(0,r.useState)(0),[g,v]=(0,r.useState)(0),[b,y]=(0,r.useState)(!1),[x,w]=(0,r.useState)(null),[_,j]=(0,r.useState)({current:!1,upcoming:!1,vip:!1,inactive:!1});(0,r.useEffect)(()=>{const e=setTimeout(()=>c(i),350);return()=>clearTimeout(e)},[i]);const k=async()=>{a(!0);try{const{data:e,error:n,count:r}=await(()=>{const e=_r.from("guests_overview").select("*",{count:"exact"}).order("full_name",{ascending:!0,nullsFirst:!1}),t=(l||"").trim();t&&e.or("full_name.ilike.%".concat(t,"%,phone.ilike.%").concat(t,"%,national_id.ilike.%").concat(t,"%,email.ilike.%").concat(t,"%")),_.current&&e.eq("has_current_stay",!0),_.upcoming&&e.eq("has_upcoming_reservation",!0),_.vip&&e.eq("is_vip",!0),_.inactive&&e.eq("is_inactive",!0);const n=u*h,r=n+h-1;return e.range(n,r),e})();if(n)throw n;t(e||[]),m(r||0)}catch(e){console.error("Load guests failed",e),t([]),m(0)}finally{a(!1)}},N=async()=>{try{const e=new Date;e.setHours(0,0,0,0);const t=e.toISOString(),{error:n,count:r}=await _r.from("guests").select("*",{count:"exact",head:!0}).gte("created_at",t);if(n)throw n;v(r||0)}catch(e){console.warn("Load new guests count failed",e),v(0)}};(0,r.useEffect)(()=>{k()},[l,_,u,h]),(0,r.useEffect)(()=>{N()},[]);const S=(0,r.useMemo)(()=>({total:e.length,current:e.filter(e=>e.has_current_stay).length,upcoming:e.filter(e=>e.has_upcoming_reservation).length,vip:e.filter(e=>e.is_vip).length,inactive:e.filter(e=>!e.has_current_stay&&!e.has_upcoming_reservation).length}),[e]),E=()=>{w(null),y(!0)},[C,T]=(0,r.useState)(!1),[O,R]=(0,r.useState)(null);return(0,s.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0625\u062f\u0627\u0631\u0629 \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0628\u062d\u062b\u060c \u0641\u0644\u0627\u062a\u0631\u060c \u0648\u062a\u0631\u0642\u064a\u0645 \u0645\u0639 \u0639\u0631\u0636 \u0627\u0644\u0632\u064a\u0627\u0631\u0627\u062a"})]}),(0,s.jsx)("button",{onClick:E,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0646\u0632\u064a\u0644 \u062c\u062f\u064a\u062f +"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded border border-green-200 p-4 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-green-700",children:[(0,s.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M5 12h14M5 12a7 7 0 0 1 14 0M12 19a7 7 0 0 0 7-7"})}),(0,s.jsx)("span",{children:"\u062d\u0627\u0644\u064a\u0648\u0646"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-green-700",children:S.current})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded border border-amber-200 p-4 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-amber-700",children:[(0,s.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M3 12h18M12 3v18"})}),(0,s.jsx)("span",{children:"\u0642\u0627\u062f\u0650\u0645\u0648\u0646"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-amber-700",children:S.upcoming})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded border border-purple-200 p-4 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-purple-700",children:[(0,s.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z"})}),(0,s.jsx)("span",{children:"VIP"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-700",children:S.vip})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 rounded border border-emerald-200 p-4 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-emerald-700",children:[(0,s.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M5 12l5 5L20 7"})}),(0,s.jsx)("span",{children:"\u0646\u0632\u0644\u0627\u0621 \u0627\u0644\u062c\u062f\u062f"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-emerald-700",children:g})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded border border-blue-200 p-4 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-blue-700",children:[(0,s.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M3 12h18"}),(0,s.jsx)("path",{d:"M7 12v8M17 12v8"})]}),(0,s.jsx)("span",{children:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0646\u0632\u0644\u0627\u0621"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-700",children:p})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,s.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,s.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,s.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,s.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,s.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0627\u0633\u0645 \u0623\u0648 \u0627\u0644\u0647\u0627\u062a\u0641 \u0623\u0648 \u0627\u0644\u0647\u0648\u064a\u0629 \u0623\u0648 \u0627\u0644\u0628\u0631\u064a\u062f",value:i,onChange:e=>{o(e.target.value),d(0)}})]}),(0,s.jsx)("button",{onClick:()=>{j(e=>Ce(Ce({},e),{},{current:!e.current})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(_.current?"bg-green-600 text-white border-green-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u062d\u0627\u0644\u064a\u0648\u0646"}),(0,s.jsx)("button",{onClick:()=>{j(e=>Ce(Ce({},e),{},{upcoming:!e.upcoming})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(_.upcoming?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u0642\u0627\u062f\u0650\u0645\u0648\u0646"}),(0,s.jsx)("button",{onClick:()=>{j(e=>Ce(Ce({},e),{},{vip:!e.vip})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(_.vip?"bg-purple-600 text-white border-purple-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"VIP"}),(0,s.jsx)("button",{onClick:()=>{j(e=>Ce(Ce({},e),{},{inactive:!e.inactive})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(_.inactive?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u064a\u0646"}),(0,s.jsx)("button",{className:"border rounded px-3 py-2 text-gray-700 hover:bg-gray-100",onClick:()=>{o(""),j({current:!1,upcoming:!1,vip:!1,inactive:!1}),d(0)},children:"\u0625\u0639\u0627\u062f\u0629 \u0636\u0628\u0637"})]}),n?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden animate-pulse",children:[(0,s.jsx)("div",{className:"h-1 bg-gray-200"}),(0,s.jsx)("div",{className:"px-4 pt-4 h-6 bg-gray-100 mb-2"}),(0,s.jsxs)("div",{className:"px-4 pb-4 space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-100"}),(0,s.jsx)("div",{className:"h-4 bg-gray-100 w-2/3"}),(0,s.jsx)("div",{className:"h-4 bg-gray-100 w-1/2"})]})]},t))}):0===e.length?(0,s.jsxs)("div",{className:"p-6 bg-white rounded shadow flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-lg font-semibold mb-1",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0646\u062a\u0627\u0626\u062c \u0645\u0637\u0627\u0628\u0642\u0629"}),(0,s.jsx)("div",{className:"text-gray-600",children:"\u062c\u0631\u0651\u0628 \u062a\u0639\u062f\u064a\u0644 \u0639\u0648\u0627\u0645\u0644 \u0627\u0644\u0628\u062d\u062b \u0623\u0648 \u0623\u0636\u0641 \u0646\u0632\u064a\u0644\u064b\u0627 \u062c\u062f\u064a\u062f\u064b\u0627."})]}),(0,s.jsx)("button",{onClick:E,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"\u0646\u0632\u064a\u0644 \u062c\u062f\u064a\u062f"})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(e=>(0,s.jsx)(Jr,{guest:e,onEdit:()=>(w(e),void y(!0)),onDelete:()=>(async e=>{try{const t=window.prompt("\u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u0630\u0641 \u0627\u0643\u062a\u0628: ok","");if(!t||"ok"!==String(t).trim().toLowerCase())return;const{error:n}=await _r.from("guests").delete().eq("id",e.id);if(n)throw n;await k(),await N()}catch(t){console.error("Delete guest failed",t),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u0646\u0632\u064a\u0644: "+(t.message||t))}})(e),onHistory:()=>(R(e),void T(!0))},e.id))}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",e.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",p]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>d(e=>Math.max(0,e-1)),disabled:0===u,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,s.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",u+1]}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>d(e=>e+1),disabled:(u+1)*h>=p,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1",value:h,onChange:e=>{f(Number(e.target.value)),d(0)},children:[(0,s.jsx)("option",{value:6,children:"6"}),(0,s.jsx)("option",{value:12,children:"12"}),(0,s.jsx)("option",{value:24,children:"24"})]})]})]}),b&&(0,s.jsx)($r,{initialData:x,onClose:()=>y(!1),onSave:async e=>{try{if(!x||!x.id){const t=(e.phone||"").trim(),n=(e.national_id||"").trim();if(t||n){let e=[];t&&e.push("phone.eq.".concat(t)),n&&e.push("national_id.eq.".concat(n));const{data:r,error:a}=await _r.from("guests").select("id, full_name, phone, national_id, created_at").or(e.join(",")).limit(5);if(a)throw a;if(r&&r.length>0){if(window.confirm("\u064a\u0648\u062c\u062f \u0646\u0632\u064a\u0644 \u0645\u0633\u062c\u0644 \u0628\u0646\u0641\u0633 \u0627\u0644\u0647\u0627\u062a\u0641/\u0627\u0644\u0647\u0648\u064a\u0629:\n".concat(r[0].full_name||"\u0628\u062f\u0648\u0646 \u0627\u0633\u0645","\n\u062a\u0627\u0631\u064a\u062e: ").concat(r[0].created_at?new Date(r[0].created_at).toLocaleDateString("ar-EG"):"","\n\u0647\u0644 \u062a\u0631\u064a\u062f \u0641\u062a\u062d \u0628\u0637\u0627\u0642\u0629 \u0647\u0630\u0627 \u0627\u0644\u0646\u0632\u064a\u0644 \u0628\u062f\u0644\u0627\u064b \u0645\u0646 \u0625\u0646\u0634\u0627\u0621 \u062c\u062f\u064a\u062f\u061f")))return void w(r[0])}}}const t="".concat(String(e.first_name||"").trim()," ").concat(String(e.last_name||"").trim()).trim()||(e.full_name||"").trim(),n={first_name:(e.first_name||"").trim()||null,last_name:(e.last_name||"").trim()||null,full_name:t||null,avatar_url:(e.avatar_url||"").trim()||null,id_doc_type:(e.id_doc_type||"").trim()||null,id_doc_number:(e.id_doc_number||"").trim()||null,id_doc_url:(e.id_doc_url||"").trim()||null,id_doc_uploaded_at:e.id_doc_url?e.id_doc_uploaded_at||(new Date).toISOString():null,email:(e.email||"").trim()||null,phone:e.phone||null,nationality:(e.nationality||"").trim()||null,national_id:e.national_id||null,address:(e.address||"").trim()||null,city:(e.city||"").trim()||null,country:(e.country||"").trim()||null,is_vip:!!e.is_vip,notes:(e.notes||"").trim()||null},r=async()=>{const e={full_name:n.full_name,phone:n.phone,national_id:n.national_id};if(x&&x.id){const{error:t}=await _r.from("guests").update(e).eq("id",x.id);if(t)throw t}else{const{error:t}=await _r.from("guests").insert([e]);if(t)throw t}};if(x&&x.id){const{error:e}=await _r.from("guests").update(n).eq("id",x.id);if(e){if(!String(e.message||"").toLowerCase().includes("schema")&&!String(e.message||"").toLowerCase().includes("column"))throw e;await r()}}else{const{error:e}=await _r.from("guests").insert([n]);if(e){if(!String(e.message||"").toLowerCase().includes("schema")&&!String(e.message||"").toLowerCase().includes("column"))throw e;await r()}}y(!1),await k(),await N()}catch(t){console.error("Save guest failed",t),window.alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0627\u0644\u0646\u0632\u064a\u0644: "+(t.message||t))}}}),C&&O&&(0,s.jsx)(Qr,{guest:O,onClose:()=>{T(!1),R(null)}})]})}const Xr=[{value:"pending",label:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"},{value:"confirmed",label:"\u0645\u0624\u0643\u062f"},{value:"checked_in",label:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"},{value:"checked_out",label:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"},{value:"cancelled",label:"\u0645\u0644\u063a\u064a"},{value:"no_show",label:"\u0644\u0645 \u064a\u062d\u0636\u0631"}];function Zr(e){var t,n,a;let{initialData:i,onClose:o,onSave:l}=e;const[c,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)([]),[f,p]=(0,r.useState)("current"),[m,g]=(0,r.useState)([]),[v,b]=(0,r.useState)(!1),[y,x]=(0,r.useState)(!0),[w,_]=(0,r.useState)({guest_id:null,room_id:null,check_in_date:"",check_out_date:"",guests_count:1,status:"confirmed",nightly_rate:null,total_amount:null,amount_paid:0,currency:"EGP",payment_method:"cash",payer_type:"guest",agency_name:"",special_requests:"",notes:"",pending_guest_ids:[]}),j=(0,r.useMemo)(()=>{const e=m.find(e=>String(e.id)===String(w.room_id));return(null===e||void 0===e?void 0:e.max_guests)||null},[m,w.room_id]);(0,r.useEffect)(()=>{(async()=>{const e=await _r.from("guests_overview").select("id, full_name, created_at, has_current_stay, has_upcoming_reservation, is_inactive").order("full_name");h(e.data||[])})()},[]),(0,r.useEffect)(()=>{if(!i||!i.guest_id||0===d.length)return;const e=d.find(e=>String(e.id)===String(i.guest_id));e&&("today"!==f&&"current"!==f&&"upcoming"!==f||!e.is_inactive||p("all"))},[i,d,f]),(0,r.useEffect)(()=>{var e,t,n,r,a,s,o,l,c,u,d;i&&_({guest_id:i.guest_id,room_id:i.room_id,check_in_date:i.check_in_date,check_out_date:i.check_out_date,guests_count:null!==(e=i.guests_count)&&void 0!==e?e:1,status:null!==(t=i.status)&&void 0!==t?t:"confirmed",nightly_rate:null!==(n=i.nightly_rate)&&void 0!==n?n:null,total_amount:null!==(r=i.total_amount)&&void 0!==r?r:null,amount_paid:null!==(a=i.amount_paid)&&void 0!==a?a:0,currency:null!==(s=i.currency)&&void 0!==s?s:"EGP",payment_method:null!==(o=i.payment_method)&&void 0!==o?o:"cash",payer_type:null!==(l=i.payer_type)&&void 0!==l?l:"guest",agency_name:null!==(c=i.agency_name)&&void 0!==c?c:"",special_requests:null!==(u=i.special_requests)&&void 0!==u?u:"",notes:null!==(d=i.notes)&&void 0!==d?d:"",pending_guest_ids:[]})},[i]);const k=(0,r.useMemo)(()=>{if(!w.check_in_date||!w.check_out_date)return 0;const e=new Date(w.check_in_date),t=(new Date(w.check_out_date)-e)/864e5;return t>0?t:0},[w.check_in_date,w.check_out_date]);(0,r.useEffect)(()=>{if(y&&null!=w.nightly_rate&&k>0){const e=Math.round(Number(w.nightly_rate)*k*100)/100;_(t=>Ce(Ce({},t),{},{total_amount:e}))}},[w.nightly_rate,k,y]);const N=(0,r.useMemo)(()=>{const e=Number(w.total_amount||0),t=Number(w.amount_paid||0);return Math.max(0,Math.round(100*(e-t))/100)},[w.total_amount,w.amount_paid]),S=async()=>{b(!0);try{const{data:e,error:t}=await _r.from("rooms").select("id, room_number, room_code, status, cleanliness").order("room_number",{ascending:!0});if(t)throw t;g((e||[]).map(e=>({id:e.id,room_label:e.room_number||e.room_code||"\u063a\u0631\u0641\u0629 #"+String(e.id).slice(0,8),status:e.status,cleanliness:e.cleanliness})))}catch(e){console.error("Failed loading rooms list",e),g([])}finally{b(!1)}};(0,r.useEffect)(()=>{(async()=>{if(w.check_in_date&&w.check_out_date){b(!0);try{const{data:f,error:p}=await _r.rpc("get_available_rooms",{p_check_in:w.check_in_date,p_check_out:w.check_out_date,p_reservation_id:(null===i||void 0===i?void 0:i.id)||null});if(p)throw p;let m=f||[];if(null!==i&&void 0!==i&&i.room_id&&!m.some(e=>String(e.id)===String(i.room_id)))try{var e,t,n,r,a,s,o,l,c,u;const{data:h}=await _r.from("rooms").select("id, room_number, room_code, status, cleanliness, room_type_id").eq("id",i.room_id).single();let f=null;try{f=await _r.from("room_types").select("id,name,name_ar,base_price,max_guests").eq("id",h.room_type_id).single()}catch(d){}const p=null!==(e=null===(t=f)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.base_price)&&void 0!==e?e:null,g=(null===(r=f)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.name_ar)||(null===(s=f)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.name)||null,v=null!==(l=null===(c=f)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.max_guests)&&void 0!==l?l:null;h&&(m=[{id:h.id,room_label:h.room_number||h.room_code||"\u063a\u0631\u0641\u0629 #"+String(h.id).slice(0,8),status:h.status,cleanliness:h.cleanliness,room_type_id:h.room_type_id,room_type_name:g,base_price:p,max_guests:v},...m])}catch(h){}g(m)}catch(f){console.warn("get_available_rooms RPC not available, falling back",(null===f||void 0===f?void 0:f.message)||f),await S()}finally{b(!1)}}else await S()})()},[w.check_in_date,w.check_out_date]),(0,r.useEffect)(()=>{w.check_in_date&&w.check_out_date||S()},[]),(0,r.useEffect)(()=>{const e=m.find(e=>String(e.id)===String(w.room_id));e&&null!=e.base_price&&_(t=>Ce(Ce({},t),{},{nightly_rate:Number(e.base_price)}))},[w.room_id,m]);const[E,C]=(0,r.useState)(""),[T,O]=(0,r.useState)([]);(0,r.useEffect)(()=>{const e=(E||"").trim();if(!e)return void O([]);const t=setTimeout(async()=>{try{const{data:t,error:n}=await _r.from("guests_overview").select("id, full_name, phone, email, created_at, has_current_stay, has_upcoming_reservation, is_inactive").or("full_name.ilike.%".concat(e,"%,phone.ilike.%").concat(e,"%,email.ilike.%").concat(e,"%")).limit(10);if(n)throw n;O(t||[])}catch(t){O([])}},350);return()=>clearTimeout(t)},[E]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-start justify-center px-2 sm:px-3 py-4",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-[95vw] sm:max-w-xl md:max-w-2xl xl:max-w-3xl max-h-[85vh] overflow-auto",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b flex items-center justify-between sticky top-0 bg-white",children:[(0,s.jsx)("h3",{className:"font-bold",children:i?"\u062a\u0639\u062f\u064a\u0644 \u062d\u062c\u0632":"\u062d\u062c\u0632 \u062c\u062f\u064a\u062f"}),(0,s.jsx)("button",{className:"text-gray-500 hover:text-gray-700",onClick:o,children:"\u0625\u063a\u0644\u0627\u0642"})]}),(0,s.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{var t;if(u(!0),!w.guest_id||!w.room_id||!w.check_in_date||!w.check_out_date)return alert("\u064a\u0631\u062c\u0649 \u062a\u0639\u0628\u0626\u0629 \u062c\u0645\u064a\u0639 \u0627\u0644\u062d\u0642\u0648\u0644 \u0627\u0644\u0623\u0633\u0627\u0633\u064a\u0629"),void u(!1);try{const e=m.find(e=>String(e.id)===String(w.room_id));if(e&&e.cleanliness&&"clean"!==e.cleanliness){const e=new Date,t=e=>String(e).padStart(2,"0"),n="".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate()));if(String(w.check_in_date)===n){const e=window.prompt("\u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0646\u0638\u064a\u0641\u0629 \u0648\u0627\u0644\u062f\u062e\u0648\u0644 \u0627\u0644\u064a\u0648\u0645. \u0644\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632 \u0627\u0643\u062a\u0628: ok","");if(!e||"ok"!==String(e).trim().toLowerCase())return alert("\u062a\u0645 \u0625\u0644\u063a\u0627\u0621 \u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632 \u0644\u0647\u0630\u0647 \u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0627\u0644\u0646\u0638\u064a\u0641\u0629."),void u(!1)}}}catch(n){}try{if(!1===await(async()=>{const{data:e,error:t}=await _r.rpc("check_room_availability",{p_room_id:w.room_id,p_check_in:w.check_in_date,p_check_out:w.check_out_date,p_reservation_id:(null===i||void 0===i?void 0:i.id)||null});if(t)throw t;return e})())return alert("\u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0645\u062a\u0627\u062d\u0629 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0641\u062a\u0631\u0629"),void u(!1)}catch(r){}const e=m.find(e=>String(e.id)===String(w.room_id)),a=null!==(t=w.nightly_rate)&&void 0!==t?t:e&&null!=e.base_price?Number(e.base_price):null,s=y&&null!=a&&k>0?Math.round(a*k*100)/100:w.total_amount,o=Ce(Ce({},w),{},{nightly_rate:a,total_amount:s});l(o)}catch(e){console.error(e),alert("\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639")}finally{u(!1)}},className:"p-3 space-y-3 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0646\u0632\u064a\u0644"}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1 gap-1 text-[11px] text-gray-600",children:[(0,s.jsx)("span",{children:"\u0627\u062e\u062a\u0631 \u0645\u0646 \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 justify-end",children:[(0,s.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("today"===f?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700"),onClick:()=>p("today"),children:"\u0645\u0636\u0627\u0641\u0648\u0646 \u0627\u0644\u064a\u0648\u0645"}),(0,s.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("current"===f?"bg-emerald-600 text-white border-emerald-600":"bg-white text-gray-700"),onClick:()=>p("current"),children:"\u0645\u0642\u064a\u0645\u0648\u0646 \u062d\u0627\u0644\u064a\u0627\u064b"}),(0,s.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("upcoming"===f?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700"),onClick:()=>p("upcoming"),children:"\u0642\u0627\u062f\u0650\u0645\u0648\u0646"}),(0,s.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("inactive"===f?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700"),onClick:()=>p("inactive"),children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u064a\u0646"}),(0,s.jsx)("button",{type:"button",className:"px-2 py-0.5 border rounded ".concat("all"===f?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700"),onClick:()=>p("all"),children:"\u0627\u0644\u0643\u0644"})]})]}),(0,s.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:w.guest_id||"",onChange:e=>_(t=>Ce(Ce({},t),{},{guest_id:e.target.value||null})),children:[(0,s.jsx)("option",{value:"",children:"\u0627\u062e\u062a\u0631 \u0627\u0644\u0646\u0632\u064a\u0644"}),d.filter(e=>{if("all"===f)return!0;if("inactive"===f)return e.is_inactive;if("current"===f)return e.has_current_stay;if("upcoming"===f)return e.has_upcoming_reservation;if("today"===f){const t=e.created_at?String(e.created_at).slice(0,10):null,n=new Date,r=e=>String(e).padStart(2,"0");return t==="".concat(n.getFullYear(),"-").concat(r(n.getMonth()+1),"-").concat(r(n.getDate()))}return!0}).map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.full_name,e.is_inactive?" \u2014 \u063a\u064a\u0631 \u0646\u0634\u0637":e.has_current_stay?" \u2014 \u0645\u0642\u064a\u0645 \u062d\u0627\u0644\u064a\u0627\u064b":e.has_upcoming_reservation?" \u2014 \u0644\u062f\u064a\u0647 \u062d\u062c\u0632 \u0642\u0627\u062f\u0645":""]},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(()=>{const e=m.find(e=>String(e.id)===String(w.room_id));return e&&e.cleanliness&&"clean"!==e.cleanliness?(0,s.jsx)("div",{className:"mb-2 text-xs bg-yellow-50 text-yellow-800 border border-yellow-300 rounded px-2 py-1",children:"\u062a\u0646\u0628\u064a\u0647: \u0627\u0644\u063a\u0631\u0641\u0629 \u063a\u064a\u0631 \u0646\u0638\u064a\u0641\u0629 \u062d\u0627\u0644\u064a\u0627\u064b. \u0644\u0648 \u0627\u0644\u062f\u062e\u0648\u0644 \u0627\u0644\u064a\u0648\u0645 \u0633\u064a\u0637\u0644\u0628 \u062a\u0623\u0643\u064a\u062f."}):null})(),(0,s.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:w.room_id||"",onChange:e=>_(t=>Ce(Ce({},t),{},{room_id:e.target.value||null})),children:[(0,s.jsx)("option",{value:"",children:v?"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644":"\u0627\u062e\u062a\u0631 \u0627\u0644\u063a\u0631\u0641\u0629"}),m.map(e=>{const t=e.cleanliness&&"clean"!==e.cleanliness?" - ".concat("in_cleaning"===e.cleanliness?"\u062c\u0627\u0631\u064a \u062a\u0646\u0638\u064a\u0641":"\u063a\u064a\u0631 \u0646\u0638\u064a\u0641\u0629"):"",n=e.room_type_name?" \u2014 ".concat(e.room_type_name):"",r=null!=e.base_price?" \u2014 ".concat(e.base_price," ").concat("EGP"===w.currency?"\u062c\u0646\u064a\u0647":w.currency):"";return(0,s.jsx)("option",{value:e.id,children:(e.room_label||e.room_code||e.id)+n+r+t},e.id)})]}),(0,s.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:(()=>{const e=m.find(e=>String(e.id)===String(w.room_id));if(!e)return null;const t=null!=e.base_price?"".concat(e.base_price," ").concat("EGP"===w.currency?"\u062c\u0646\u064a\u0647":w.currency):"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f";return(0,s.jsxs)("span",{children:["\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629: ",(0,s.jsx)("b",{children:e.room_type_name||"\u063a\u064a\u0631 \u0645\u062d\u062f\u062f"})," \u2014 \u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0623\u0633\u0627\u0633\u064a: ".concat(t),j?" \u2014 \u0623\u0642\u0635\u0649 \u0639\u062f\u062f: ".concat(j):""]})})()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644"}),(0,s.jsx)("input",{type:"date",className:"border rounded w-full px-3 py-2",value:w.check_in_date,onChange:e=>_(t=>Ce(Ce({},t),{},{check_in_date:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c"}),(0,s.jsx)("input",{type:"date",className:"border rounded w-full px-3 py-2",value:w.check_out_date,onChange:e=>_(t=>Ce(Ce({},t),{},{check_out_date:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0639\u062f\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621"}),(0,s.jsx)("input",{type:"number",min:1,className:"border rounded w-full px-3 py-2",value:w.guests_count,onChange:e=>_(t=>Ce(Ce({},t),{},{guests_count:Number(e.target.value)||1}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,s.jsx)("select",{className:"border rounded w-full px-3 py-2",value:w.status,onChange:e=>_(t=>Ce(Ce({},t),{},{status:e.target.value})),children:Xr.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0633\u0639\u0631 \u0627\u0644\u0644\u064a\u0644\u0629 (\u0627\u0642\u062a\u0631\u0627\u062d \u0642\u0627\u0628\u0644 \u0644\u0644\u062a\u0639\u062f\u064a\u0644)"}),(0,s.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2",value:null!==(t=w.nightly_rate)&&void 0!==t?t:"",onChange:e=>_(t=>Ce(Ce({},t),{},{nightly_rate:""===e.target.value?null:Number(e.target.value)}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a"}),(0,s.jsxs)("label",{className:"flex items-center gap-1 text-[11px]",children:[(0,s.jsx)("input",{type:"checkbox",checked:y,onChange:e=>x(e.target.checked)}),(0,s.jsx)("span",{children:"\u062d\u0633\u0627\u0628 \u062a\u0644\u0642\u0627\u0626\u064a"})]})]}),(0,s.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2",value:null!==(n=w.total_amount)&&void 0!==n?n:"",onChange:e=>_(t=>Ce(Ce({},t),{},{total_amount:""===e.target.value?null:Number(e.target.value)})),disabled:y})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639"}),(0,s.jsx)("input",{type:"number",className:"border rounded w-full px-3 py-2",value:null!==(a=w.amount_paid)&&void 0!==a?a:0,onChange:e=>_(t=>Ce(Ce({},t),{},{amount_paid:Number(e.target.value)||0}))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a"}),(0,s.jsxs)("div",{className:"border rounded w-full px-3 py-2 bg-gray-50 text-red-700 font-semibold",children:[N," ","EGP"===w.currency?"\u062c\u0646\u064a\u0647":w.currency]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0644\u0639\u0645\u0644\u0629"}),(0,s.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:w.currency,onChange:e=>_(t=>Ce(Ce({},t),{},{currency:e.target.value})),children:[(0,s.jsx)("option",{value:"EGP",children:"\u062c\u0646\u064a\u0647"}),(0,s.jsx)("option",{value:"SAR",children:"\u0631\u064a\u0627\u0644"}),(0,s.jsx)("option",{value:"USD",children:"\u062f\u0648\u0644\u0627\u0631"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,s.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:w.payment_method,onChange:e=>_(t=>Ce(Ce({},t),{},{payment_method:e.target.value})),children:[(0,s.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a"}),(0,s.jsx)("option",{value:"card",children:"\u0628\u0637\u0627\u0642\u0629"}),(0,s.jsx)("option",{value:"transfer",children:"\u062a\u062d\u0648\u064a\u0644 \u0628\u0646\u0643\u064a"}),(0,s.jsx)("option",{value:"etisalat_cash",children:"\u0627\u062a\u0635\u0627\u0644\u0627\u062a \u0643\u0627\u0634"}),(0,s.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 bg-emerald-50 rounded p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0645\u0646 \u064a\u062f\u0641\u0639\u061f"}),(0,s.jsxs)("select",{className:"border rounded w-full px-3 py-2",value:w.payer_type,onChange:e=>_(t=>Ce(Ce({},t),{},{payer_type:e.target.value})),children:[(0,s.jsx)("option",{value:"guest",children:"\u0627\u0644\u0646\u0632\u064a\u0644 \u0646\u0641\u0633\u0647"}),(0,s.jsx)("option",{value:"agency",children:"\u0634\u0631\u0643\u0629/\u0648\u0643\u0627\u0644\u0629"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs mb-1",children:"\u0627\u0633\u0645 \u0627\u0644\u062c\u0647\u0629"}),(0,s.jsx)("input",{className:"border rounded w-full px-3 py-2",placeholder:"\u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629 \u0623\u0648 \u0627\u0644\u0648\u0643\u0627\u0644\u0629",value:w.agency_name,onChange:e=>_(t=>Ce(Ce({},t),{},{agency_name:e.target.value})),disabled:"agency"!==w.payer_type})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0645\u062f\u0641\u0648\u0639: ",(0,s.jsxs)("span",{className:"text-blue-700 font-semibold",children:[w.amount_paid||0," ","EGP"===w.currency?"\u062c\u0646\u064a\u0647":w.currency]})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0637\u0644\u0628\u0627\u062a \u062e\u0627\u0635\u0629"}),(0,s.jsx)("textarea",{className:"border rounded w-full px-3 py-2",rows:2,value:w.special_requests,onChange:e=>_(t=>Ce(Ce({},t),{},{special_requests:e.target.value}))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),(0,s.jsx)("textarea",{className:"border rounded w-full px-3 py-2",rows:2,value:w.notes,onChange:e=>_(t=>Ce(Ce({},t),{},{notes:e.target.value}))})]}),(0,s.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:[(0,s.jsx)("div",{className:"text-sm font-semibold mb-2",children:"\u0636\u064a\u0648\u0641 \u0625\u0636\u0627\u0641\u064a\u0648\u0646 \u0644\u0644\u062d\u062c\u0632"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:0===(w.pending_guest_ids||[]).length?(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0636\u064a\u0648\u0641 \u0625\u0636\u0627\u0641\u064a\u0648\u0646 \u0645\u0636\u0627\u0641\u0648\u0646."}):(w.pending_guest_ids||[]).map(e=>{const t=d.find(t=>String(t.id)===String(e));return(0,s.jsxs)("span",{className:"px-2 py-1 text-xs rounded border bg-white",children:[(null===t||void 0===t?void 0:t.full_name)||e,(0,s.jsx)("button",{type:"button",className:"ml-2 text-red-600",onClick:()=>{return t=e,void _(e=>Ce(Ce({},e),{},{pending_guest_ids:(e.pending_guest_ids||[]).filter(e=>String(e)!==String(t))}));var t},children:"\u0625\u0632\u0627\u0644\u0629 \u2716"})]},e)})}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{className:"border rounded px-3 py-2 w-full text-sm",placeholder:"\u0628\u062d\u062b \u0639\u0646 \u0636\u064a\u0641 \u0644\u0625\u0636\u0627\u0641\u062a\u0647 \u0644\u0644\u062d\u062c\u0632",value:E,onChange:e=>C(e.target.value)}),T.length>0&&(0,s.jsx)("div",{className:"absolute z-10 mt-1 bg-white border rounded shadow p-2 text-sm max-h-48 overflow-auto w-full",children:T.filter(e=>{if("all"===f)return!0;if("inactive"===f)return e.is_inactive;if("current"===f)return e.has_current_stay;if("upcoming"===f)return e.has_upcoming_reservation;if("today"===f){const t=e.created_at?String(e.created_at).slice(0,10):null,n=new Date,r=e=>String(e).padStart(2,"0");return t==="".concat(n.getFullYear(),"-").concat(r(n.getMonth()+1),"-").concat(r(n.getDate()))}return!0}).map(e=>(0,s.jsxs)("div",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onClick:()=>{return t=e.id,_(e=>Ce(Ce({},e),{},{pending_guest_ids:Array.from(new Set([...e.pending_guest_ids||[],t]))})),C(""),void O([]);var t},children:[e.full_name," ",(0,s.jsxs)("span",{className:"text-gray-500",children:["(",e.phone||e.email||String(e.id).slice(0,8),")"]}),(0,s.jsx)("span",{className:"ml-1 text-[10px] text-gray-500",children:e.is_inactive?"\u2014 \u063a\u064a\u0631 \u0646\u0634\u0637":e.has_current_stay?"\u2014 \u0645\u0642\u064a\u0645 \u062d\u0627\u0644\u064a\u0627\u064b":e.has_upcoming_reservation?"\u2014 \u0644\u062f\u064a\u0647 \u062d\u062c\u0632 \u0642\u0627\u062f\u0645":""})]},e.id))})]}),(0,s.jsx)("div",{className:"mt-2 text-[11px] text-gray-600",children:'\u0633\u064a\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u0636\u064a\u0648\u0641 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u064a\u0646 \u0645\u0639 \u0627\u0644\u062d\u062c\u0632\u060c \u0648\u064a\u0645\u0643\u0646 \u062a\u0648\u0632\u064a\u0639\u0647\u0645 \u0639\u0644\u0649 \u0627\u0644\u0623\u0633\u0650\u0631\u0651\u0629 \u0645\u0646 \u0634\u0627\u0634\u0629 "\u0627\u0644\u062a\u0633\u0643\u064a\u0646".'})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border-t pt-3 sticky bottom-0 bg-white px-3",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["\u0644\u064a\u0627\u0644\u064a: ",k]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",className:"px-4 py-2 border rounded",onClick:o,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",disabled:c,children:c?"\u062c\u0627\u0631\u064d \u0627\u0644\u062d\u0641\u0638...":i?"\u062a\u062d\u062f\u064a\u062b \u0627\u0644\u062d\u062c\u0632":"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062d\u062c\u0632"})]})]})]})]})})}function ea(e){let{rows:t,loading:n,onEdit:r,onDelete:a}=e;return n?(0,s.jsx)("div",{className:"py-16 text-center text-gray-500",children:"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644"}):null!==t&&void 0!==t&&t.length?(0,s.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{className:"text-right",children:[(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0646\u0632\u064a\u0644"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u063a\u0631\u0641\u0629"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062f\u062e\u0648\u0644"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062e\u0631\u0648\u062c"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0644\u064a\u0627\u0644\u064a"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0645\u062f\u0641\u0648\u0639"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a"}),(0,s.jsx)("th",{className:"px-3 py-2",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>{var t,n,i;return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:e.guest_name}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.room_id}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.check_in_date}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.check_out_date}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.nights}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("confirmed"===e.status?"bg-green-100 text-green-700":"checked_in"===e.status?"bg-blue-100 text-blue-700":"checked_out"===e.status?"bg-gray-100 text-gray-700":"cancelled"===e.status?"bg-red-100 text-red-700":"no_show"===e.status?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700"),children:"pending"===e.status?"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631":"confirmed"===e.status?"\u0645\u0624\u0643\u062f":"checked_in"===e.status?"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644":"checked_out"===e.status?"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c":"cancelled"===e.status?"\u0645\u0644\u063a\u064a":"no_show"===e.status?"\u0644\u0645 \u064a\u062d\u0636\u0631":e.status})}),(0,s.jsx)("td",{className:"px-3 py-2",children:null!==(t=e.total_amount)&&void 0!==t?t:"-"}),(0,s.jsx)("td",{className:"px-3 py-2",children:null!==(n=e.amount_paid)&&void 0!==n?n:"-"}),(0,s.jsx)("td",{className:"px-3 py-2",children:null!==(i=e.remaining_amount)&&void 0!==i?i:0}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"px-2 py-1 border rounded text-xs hover:bg-gray-50",onClick:()=>r(e),children:"\u062a\u0639\u062f\u064a\u0644"}),(0,s.jsx)("button",{className:"px-2 py-1 border rounded text-xs text-red-700 hover:bg-red-50",onClick:()=>a(e),children:"\u062d\u0630\u0641"})]})})]},e.id)})})]})}):(0,s.jsx)("div",{className:"py-16 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629"})}function ta(e){var t,n,r;let{r:a,onEdit:i,onDelete:o,onExtend:l,onPay:c,onInvoice:u}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden transition-colors ".concat((d=a.status,"confirmed"===d?"border-l-4 border-green-400 hover:bg-green-50":"checked_in"===d?"border-l-4 border-blue-400 hover:bg-blue-50":"checked_out"===d?"border-l-4 border-gray-400 hover:bg-gray-50":"cancelled"===d?"border-l-4 border-red-400 hover:bg-red-50":"no_show"===d?"border-l-4 border-amber-400 hover:bg-amber-50":"border-l-4 border-yellow-400 hover:bg-yellow-50")),dir:"rtl",children:[(0,s.jsx)("div",{className:"confirmed"===a.status?"h-1 bg-green-400":"checked_in"===a.status?"h-1 bg-blue-400":"checked_out"===a.status?"h-1 bg-gray-400":"cancelled"===a.status?"h-1 bg-red-400":"no_show"===a.status?"h-1 bg-amber-400":"h-1 bg-yellow-400"}),(0,s.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold",children:a.guest_name}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[a.guest_phone||"",a.guest_phone&&a.guest_email?" \u2022 ":"",a.guest_email||""]})]}),(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat((e=>"confirmed"===e?"bg-green-100 text-green-700":"checked_in"===e?"bg-blue-100 text-blue-700":"checked_out"===e?"bg-gray-100 text-gray-700":"cancelled"===e?"bg-red-100 text-red-700":"no_show"===e?"bg-orange-100 text-orange-700":"bg-yellow-100 text-yellow-700")(a.status)),children:(e=>"pending"===e?"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631":"confirmed"===e?"\u0645\u0624\u0643\u062f":"checked_in"===e?"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644":"checked_out"===e?"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c":"cancelled"===e?"\u0645\u0644\u063a\u064a":"no_show"===e?"\u0644\u0645 \u064a\u062d\u0636\u0631":e)(a.status)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.room_label||a.room_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0646\u0648\u0639 \u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.room_type_name||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.room_status||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0638\u0627\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.room_cleanliness||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062f\u062e\u0648\u0644:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.check_in_date})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062e\u0631\u0648\u062c:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.check_out_date})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0639\u062f\u062f \u0627\u0644\u0644\u064a\u0627\u0644\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.nights})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0639\u062f\u062f \u0627\u0644\u0646\u0632\u0644\u0627\u0621:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.guests_count||0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0633\u0639\u0631 \u0627\u0644\u0644\u064a\u0644\u0629:"})," ",(0,s.jsxs)("span",{className:"font-medium",children:[a.nightly_rate," ",a.currency||""]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.payment_method||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:null!==(t=a.total_amount)&&void 0!==t?t:"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639:"})," ",(0,s.jsx)("span",{className:"font-medium text-blue-700",children:null!==(n=a.amount_paid)&&void 0!==n?n:"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium text-red-700",children:null!==(r=a.remaining_amount)&&void 0!==r?r:0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u062d\u0627\u0644\u0629 \u0627\u0644\u0632\u0645\u0646\u064a\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:a.is_current?"\u062d\u0627\u0644\u064a":a.is_upcoming?"\u0642\u0627\u062f\u0645":"\u0645\u0646\u062a\u0647\u064a"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639 \u0645\u0646 \u062c\u0647\u0629:"})," ",(0,s.jsxs)("span",{className:"font-medium",children:[a.payer_type||"-"," ",a.agency_name?"(".concat(a.agency_name,")"):""]})]}),a.special_requests&&(0,s.jsxs)("div",{className:"col-span-2 text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1",children:["\u0637\u0644\u0628\u0627\u062a \u062e\u0627\u0635\u0629: ",a.special_requests]}),a.notes&&(0,s.jsxs)("div",{className:"col-span-2 text-gray-700 bg-gray-50 border border-gray-200 rounded px-2 py-1",children:["\u0645\u0644\u0627\u062d\u0638\u0627\u062a: ",a.notes]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-1",children:[(0,s.jsx)("button",{className:"px-3 py-1 border rounded text-xs",onClick:()=>i(a),children:"\u062a\u0639\u062f\u064a\u0644"}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded text-xs",onClick:()=>l&&l(a),children:"\u062a\u0645\u062f\u064a\u062f"}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded text-xs",onClick:()=>u&&u(a),children:"\u0641\u0627\u062a\u0648\u0631\u0629"}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded text-xs bg-emerald-600 text-white hover:bg-emerald-700",onClick:()=>c&&c(a),children:"\u062f\u0641\u0639"}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded text-xs text-red-700",onClick:()=>o(a),children:"\u062d\u0630\u0641"})]})]})]});var d}function na(e){let{row:t,onClose:n,onDone:a}=e;const[i,o]=(0,r.useState)((null===t||void 0===t?void 0:t.check_out_date)||""),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)([]);(0,r.useEffect)(()=>{o((null===t||void 0===t?void 0:t.check_out_date)||"")},[t]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,s.jsx)("div",{className:"font-bold",children:"\u062a\u0645\u062f\u064a\u062f \u0627\u0644\u062d\u062c\u0632"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"\u0627\u062e\u062a\u0631 \u062a\u0627\u0631\u064a\u062e \u0645\u063a\u0627\u062f\u0631\u0629 \u062c\u062f\u064a\u062f \u0648\u0633\u064a\u062a\u0645 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u0627\u0644\u062a\u0639\u0627\u0631\u0636"}),(0,s.jsxs)("div",{className:"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0632\u064a\u0644:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.guest_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.room_label})," \u2022 ",(0,s.jsx)("span",{className:"font-medium",children:t.room_type_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0641\u062a\u0631\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.check_in_date})," \u2192 ",(0,s.jsx)("span",{className:"font-medium",children:t.check_out_date})," (",(0,s.jsx)("span",{className:"font-medium",children:t.nights})," \u0644\u064a\u0627\u0644)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0633\u0639\u0631/\u0644\u064a\u0644\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.nightly_rate})," \u2022 ",(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.total_amount})," \u2022 ",(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.remaining_amount})]})]})]}),(0,s.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,s.jsx)("label",{className:"text-sm",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u0627\u0644\u062c\u062f\u064a\u062f"}),(0,s.jsx)("input",{type:"date",className:"border rounded px-3 py-2",value:i,onChange:e=>o(e.target.value)}),u&&(0,s.jsxs)("div",{className:"text-xs text-red-600",children:["\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062a\u0645\u062f\u064a\u062f: ",u]}),h&&h.length>0&&(0,s.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-3 text-xs",children:[(0,s.jsx)("div",{className:"font-semibold mb-2",children:"\u0628\u062f\u0627\u0626\u0644 \u0645\u0642\u062a\u0631\u062d\u0629 (Split Stay):"}),(0,s.jsx)("ul",{className:"list-disc pr-5",children:h.slice(0,5).map((e,t)=>(0,s.jsxs)("li",{children:[e.room_label,": ",e.available_from," \u2192 ",e.available_to," (",e.nights," \u0644\u064a\u0627\u0644)"]},t))})]})]}),(0,s.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,s.jsx)("button",{className:"px-3 py-2 border rounded",onClick:n,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-blue-600 text-white",disabled:l,onClick:async()=>{c(!0),d("");try{const{error:e}=await _r.rpc("extend_reservation",{p_reservation_id:t.id,p_new_check_out:i});if(e)throw e;a&&a(),n&&n()}catch(e){const n=String((null===e||void 0===e?void 0:e.message)||e||"");d(n);try{const{data:e,error:n}=await _r.rpc("suggest_split_stay",{p_check_in:t.check_in_date,p_check_out:i,p_room_type_id:null});n||f(e||[])}catch(r){}}finally{c(!1)}},children:l?"\u062c\u0627\u0631\u064d...":"\u062a\u0645\u062f\u064a\u062f"})]})]})})}function ra(e){let{row:t,onClose:n,onDone:a}=e;const[i,o]=(0,r.useState)(0),[l,c]=(0,r.useState)((null===t||void 0===t?void 0:t.payment_method)||"cash"),[u,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{o(Number((null===t||void 0===t?void 0:t.remaining_amount)||0)),c((null===t||void 0===t?void 0:t.payment_method)||"cash")},[t]);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,s.jsx)("div",{className:"font-bold",children:"\u062a\u0633\u062c\u064a\u0644 \u062f\u0641\u0639\u0629"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"\u0627\u062e\u062a\u0631 \u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639 \u0648\u0623\u062f\u062e\u0644 \u0627\u0644\u0645\u0628\u0644\u063a"}),(0,s.jsxs)("div",{className:"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0632\u064a\u0644:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.guest_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.room_label})," \u2022 ",(0,s.jsx)("span",{className:"font-medium",children:t.room_type_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0641\u062a\u0631\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.check_in_date})," \u2192 ",(0,s.jsx)("span",{className:"font-medium",children:t.check_out_date})," (",(0,s.jsx)("span",{className:"font-medium",children:t.nights})," \u0644\u064a\u0627\u0644)"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.total_amount})," \u2022 ",(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.amount_paid})," \u2022 ",(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.remaining_amount})]})]})]}),(0,s.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0645\u0628\u0644\u063a"}),(0,s.jsx)("input",{type:"number",className:"border rounded px-3 py-2",value:i,onChange:e=>o(e.target.value),min:0}),(0,s.jsx)("label",{className:"text-sm",children:"\u0637\u0631\u064a\u0642\u0629 \u0627\u0644\u062f\u0641\u0639"}),(0,s.jsxs)("select",{className:"border rounded px-3 py-2",value:l,onChange:e=>c(e.target.value),children:[(0,s.jsx)("option",{value:"cash",children:"\u0646\u0642\u062f\u064a"}),(0,s.jsx)("option",{value:"instapay",children:"\u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a"}),(0,s.jsx)("option",{value:"etisalat_cash",children:"\u0627\u062a\u0635\u0627\u0644\u0627\u062a \u0643\u0627\u0634"})]})]}),(0,s.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,s.jsx)("button",{className:"px-3 py-2 border rounded",onClick:n,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-emerald-600 text-white",disabled:u,onClick:async()=>{d(!0);try{const e=Number((null===t||void 0===t?void 0:t.amount_paid)||0)+Number(i||0),{error:r}=await _r.from("reservations").update({amount_paid:e,payment_method:l}).eq("id",t.id);if(r)throw r;a&&a(),n&&n()}catch(e){alert("\u062a\u0639\u0630\u0651\u0631 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u062f\u0641\u0639: "+(e.message||e))}finally{d(!1)}},children:u?"\u062c\u0627\u0631\u064d...":"\u062f\u0641\u0639"})]})]})})}function aa(e){let{row:t,onClose:n}=e;const[a,i]=(0,r.useState)(.14),[o,l]=(0,r.useState)(0),[c,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)(null),f=async()=>{u(!0);try{const{data:e,error:n}=await _r.rpc("calculate_invoice",{p_reservation_id:t.id,p_tax_rate:a,p_deposit:o});if(n)throw n;const r=Array.isArray(e)?e[0]:e;h(r||null)}catch(e){alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0633\u0627\u0628 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629: "+(e.message||e))}finally{u(!1)}};return(0,r.useEffect)(()=>{f()},[]),(0,s.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4",dir:"rtl",children:(0,s.jsxs)("div",{className:"bg-white w-full md:max-w-lg rounded-lg shadow-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,s.jsx)("div",{className:"font-bold",children:"\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u062d\u062c\u0632"}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"\u0645\u0644\u062e\u0635 \u0627\u0644\u0636\u0631\u0627\u0626\u0628 \u0648\u0627\u0644\u0648\u062f\u064a\u0639\u0629 \u0648\u0627\u0644\u0645\u062a\u0628\u0642\u064a"}),(0,s.jsxs)("div",{className:"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0646\u0632\u064a\u0644:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.guest_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u063a\u0631\u0641\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.room_label})," \u2022 ",(0,s.jsx)("span",{className:"font-medium",children:t.room_type_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0641\u062a\u0631\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:t.check_in_date})," \u2192 ",(0,s.jsx)("span",{className:"font-medium",children:t.check_out_date})," (",(0,s.jsx)("span",{className:"font-medium",children:t.nights})," \u0644\u064a\u0627\u0644)"]})]})]}),(0,s.jsxs)("div",{className:"p-4 flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0646\u0633\u0628\u0629 \u0627\u0644\u0636\u0631\u064a\u0628\u0629"}),(0,s.jsx)("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:a,onChange:e=>i(Number(e.target.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm",children:"\u0627\u0644\u0648\u062f\u064a\u0639\u0629"}),(0,s.jsx)("input",{type:"number",className:"border rounded px-3 py-2 w-full",value:o,onChange:e=>l(Number(e.target.value))})]})]}),(0,s.jsx)("button",{className:"px-3 py-2 border rounded text-sm w-fit",onClick:f,disabled:c,children:c?"\u062c\u0627\u0631\u064d...":"\u0625\u0639\u0627\u062f\u0629 \u0627\u0644\u062d\u0633\u0627\u0628"}),d&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0644\u064a\u0627\u0644\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.nights})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0633\u0639\u0631 \u0627\u0644\u0644\u064a\u0644\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.nightly_rate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.subtotal})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0636\u0631\u064a\u0628\u0629:"})," ",(0,s.jsxs)("span",{className:"font-medium",children:[d.tax_amount," (",100*d.tax_rate,"%)"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0648\u062f\u064a\u0639\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.deposit})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.total})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062f\u0641\u0648\u0639:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.paid_amount})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0627\u0644\u0645\u062a\u0628\u0642\u064a:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.remaining})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"\u0631\u0633\u0648\u0645 \u0627\u0644\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0645\u062a\u0648\u0642\u0639\u0629:"})," ",(0,s.jsx)("span",{className:"font-medium",children:d.cancellation_fee})]})]})]}),(0,s.jsxs)("div",{className:"px-4 py-3 border-t bg-gray-50 flex items-center justify-between",children:[(0,s.jsx)("button",{className:"px-3 py-2 border rounded",onClick:n,children:"\u0625\u063a\u0644\u0627\u0642"}),(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-gray-700 text-white",onClick:()=>alert("\u0645\u064a\u0632\u0629 PDF \u0633\u0646\u0636\u064a\u0641\u0647\u0627 \u0644\u0627\u062d\u0642\u064b\u0627"),children:"\u0637\u0628\u0627\u0639\u0629 PDF"})]})]})})}function sa(){const[e,t]=(0,r.useState)([]),[n,a]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(0),[h,f]=(0,r.useState)(10),[p,m]=(0,r.useState)(0),[g,v]=(0,r.useState)({current:!0,upcoming:!1,inactive:!1,status:""}),[b,y]=(0,r.useState)(!1),[x,w]=(0,r.useState)(null),[_,j]=(0,r.useState)("cards"),[k,N]=(0,r.useState)(null),[S,E]=(0,r.useState)(null),[C,T]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=setTimeout(()=>c(i),300);return()=>clearTimeout(e)},[i]);const O=async()=>{a(!0);try{const{data:e,error:n,count:r}=await(()=>{const e=_r.from("reservations_overview").select("*",{count:"exact"}).order("check_in_date",{ascending:!0,nullsFirst:!1}),t=(l||"").trim();t&&e.or("guest_name.ilike.%".concat(t,"%,room_id.eq.").concat(t)),g.current&&e.eq("is_current",!0),g.upcoming&&e.eq("is_upcoming",!0),g.inactive&&e.eq("is_past",!0),g.status&&e.eq("status",g.status);const n=u*h,r=n+h-1;return e.range(n,r),e})();if(n)throw n;t(e||[]),m(r||0)}catch(e){console.error("Load reservations failed",e),t([]),m(0)}finally{a(!1)}};(0,r.useEffect)(()=>{O()},[l,g,u,h]),(0,r.useEffect)(()=>{const e=_r.channel("reservations-live").on("postgres_changes",{event:"*",schema:"public",table:"reservations"},()=>{O()}).subscribe();return()=>{try{_r.removeChannel(e)}catch(t){}}},[]);const R=(0,r.useMemo)(()=>({cur:e.filter(e=>e.is_current).length,upc:e.filter(e=>e.is_upcoming).length,past:e.filter(e=>e.is_past).length,tot:p}),[e,p]),P=e=>{w(e),y(!0)},A=e=>{N(e)},I=e=>{E(e)},D=e=>{T(e)},L=async e=>{try{if(!window.confirm("\u062d\u0630\u0641 \u0647\u0630\u0627 \u0627\u0644\u062d\u062c\u0632\u061f"))return;const{error:t}=await _r.from("reservations").delete().eq("id",e.id);if(t)throw t;await O()}catch(t){console.error("Delete reservation failed",t),alert("\u062a\u0639\u0630\u0651\u0631 \u062d\u0630\u0641 \u0627\u0644\u062d\u062c\u0632: "+(t.message||t))}};return(0,s.jsxs)("div",{className:"p-8",dir:"rtl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"\u0646\u0638\u0627\u0645 \u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0630\u0643\u064a"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"\u0625\u062f\u0627\u0631\u0629 \u0634\u0627\u0645\u0644\u0629 \u0644\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0639 \u0627\u0644\u062a\u0639\u062f\u064a\u0644\u0627\u062a \u0648\u0627\u0644\u0625\u0644\u063a\u0627\u0621\u0627\u062a"})]}),(0,s.jsx)("button",{onClick:()=>{w(null),y(!0)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded",children:"\u062d\u062c\u0632 \u062c\u062f\u064a\u062f +"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-purple-700",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-700",children:R.cur})]}),(0,s.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-amber-700",children:"\u0627\u0644\u0642\u0627\u062f\u0645\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-amber-700",children:R.upc})]}),(0,s.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-700",children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u0629 / \u0645\u0646\u062a\u0647\u064a\u0629"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:R.past})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,s.jsxs)("div",{className:"relative flex-1 min-w-[220px]",children:[(0,s.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,s.jsxs)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"7"}),(0,s.jsx)("path",{d:"M21 21l-4.3-4.3"})]})}),(0,s.jsx)("input",{className:"border rounded pl-9 pr-3 py-2 w-full",placeholder:"\u0628\u062d\u062b \u0628\u0627\u0644\u0646\u0632\u064a\u0644 \u0623\u0648 \u0631\u0642\u0645 \u0627\u0644\u063a\u0631\u0641\u0629",value:i,onChange:e=>{o(e.target.value),d(0)}})]}),(0,s.jsx)("button",{onClick:()=>{v(e=>Ce(Ce({},e),{},{current:!e.current})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(g.current?"bg-purple-600 text-white border-purple-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u0627\u0644\u062d\u0627\u0644\u064a\u0629"}),(0,s.jsx)("button",{onClick:()=>{v(e=>Ce(Ce({},e),{},{upcoming:!e.upcoming})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(g.upcoming?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u0627\u0644\u0642\u0627\u062f\u0645\u0629"}),(0,s.jsx)("button",{onClick:()=>{v(e=>Ce(Ce({},e),{},{inactive:!e.inactive})),d(0)},className:"px-3 py-2 rounded text-sm border ".concat(g.inactive?"bg-gray-700 text-white border-gray-700":"bg-white text-gray-700 hover:bg-gray-50"),children:"\u063a\u064a\u0631 \u0646\u0634\u0637\u0629"}),(0,s.jsxs)("select",{className:"border rounded px-3 py-2 text-sm",value:g.status,onChange:e=>{v(t=>Ce(Ce({},t),{},{status:e.target.value})),d(0)},children:[(0,s.jsx)("option",{value:"",children:"\u0643\u0644 \u0627\u0644\u062d\u0627\u0644\u0627\u062a"}),(0,s.jsx)("option",{value:"pending",children:"\u0642\u064a\u062f \u0627\u0644\u0627\u0646\u062a\u0638\u0627\u0631"}),(0,s.jsx)("option",{value:"confirmed",children:"\u0645\u0624\u0643\u062f"}),(0,s.jsx)("option",{value:"checked_in",children:"\u062a\u0645 \u0627\u0644\u062f\u062e\u0648\u0644"}),(0,s.jsx)("option",{value:"checked_out",children:"\u062a\u0645 \u0627\u0644\u062e\u0631\u0648\u062c"}),(0,s.jsx)("option",{value:"cancelled",children:"\u0645\u0644\u063a\u064a"}),(0,s.jsx)("option",{value:"no_show",children:"\u0644\u0645 \u064a\u062d\u0636\u0631"})]}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-2 rounded text-sm border ".concat("cards"===_?"bg-gray-800 text-white":"bg-white text-gray-700"),onClick:()=>j("cards"),children:"\u0639\u0631\u0636 \u0643\u0628\u0637\u0627\u0642\u0627\u062a"}),(0,s.jsx)("button",{className:"px-3 py-2 rounded text-sm border ".concat("table"===_?"bg-gray-800 text-white":"bg-white text-gray-700"),onClick:()=>j("table"),children:"\u0639\u0631\u0636 \u0643\u062c\u062f\u0648\u0644"})]})]}),"table"===_?(0,s.jsx)(ea,{rows:e,loading:n,onEdit:P,onDelete:L}):n?(0,s.jsx)("div",{className:"py-16 text-center text-gray-500",children:"...\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644"}):0===e.length?(0,s.jsx)("div",{className:"py-16 text-center text-gray-500",children:"\u0644\u0627 \u062a\u0648\u062c\u062f \u062d\u062c\u0648\u0632\u0627\u062a \u0645\u0637\u0627\u0628\u0642\u0629"}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:e.map(e=>(0,s.jsx)(ta,{r:e,onEdit:P,onDelete:L,onExtend:A,onPay:I,onInvoice:D},e.id))}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["\u0627\u0644\u0646\u062a\u0627\u0626\u062c: ",e.length," / \u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a: ",p]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>d(e=>Math.max(0,e-1)),disabled:0===u,children:"\u0627\u0644\u0633\u0627\u0628\u0642"}),(0,s.jsxs)("span",{className:"text-sm",children:["\u0635\u0641\u062d\u0629 ",u+1]}),(0,s.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>d(e=>e+1),disabled:(u+1)*h>=p,children:"\u0627\u0644\u062a\u0627\u0644\u064a"}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1",value:h,onChange:e=>{f(Number(e.target.value)),d(0)},children:[(0,s.jsx)("option",{value:10,children:"10"}),(0,s.jsx)("option",{value:20,children:"20"})]})]})]}),b&&(0,s.jsx)(Zr,{initialData:x,onClose:()=>y(!1),onSave:async e=>{try{const n=Ce({},e),r=Array.isArray(n.pending_guest_ids)?n.pending_guest_ids:[];if(delete n.pending_guest_ids,x&&x.id){const{error:e}=await _r.from("reservations").update(n).eq("id",x.id);if(e)throw e;for(const n of r)try{await _r.rpc("add_reservation_guest",{p_reservation_id:x.id,p_guest_id:n,p_role:"additional"})}catch(t){}}else{const{data:e,error:a}=await _r.from("reservations").insert([n]).select("id").single();if(a)throw a;const s=null===e||void 0===e?void 0:e.id;if(s&&r.length>0)for(const n of r)try{await _r.rpc("add_reservation_guest",{p_reservation_id:s,p_guest_id:n,p_role:"additional"})}catch(t){}}y(!1),await O()}catch(n){console.error("Save reservation failed",n);const e=String((null===n||void 0===n?void 0:n.message)||n||"").toLowerCase();let t="\u062a\u0639\u0630\u0651\u0631 \u062d\u0641\u0638 \u0627\u0644\u062d\u062c\u0632.";e.includes("overlapping reservation")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0647\u0646\u0627\u0643 \u062a\u0639\u0627\u0631\u0636 \u0641\u064a \u0627\u0644\u062a\u0648\u0627\u0631\u064a\u062e \u0645\u0639 \u062d\u062c\u0632 \u0622\u062e\u0631 \u0644\u0646\u0641\u0633 \u0627\u0644\u063a\u0631\u0641\u0629.":e.includes("check_out_date must be after check_in_date")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062e\u0631\u0648\u062c \u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0628\u0639\u062f \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u062e\u0648\u0644.":e.includes("row-level security")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0644\u0627 \u062a\u0645\u0644\u0643 \u0627\u0644\u0635\u0644\u0627\u062d\u064a\u0629 \u0644\u062d\u0641\u0638 \u0627\u0644\u062d\u062c\u0632 (RLS).":e.includes("not-null")?t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0628\u0639\u0636 \u0627\u0644\u062d\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629 \u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644\u0629.":e.includes("invalid input syntax")&&(t="\u062a\u0639\u0630\u0651\u0631 \u0627\u0644\u062d\u0641\u0638: \u0645\u0634\u0643\u0644\u0629 \u0641\u064a \u0635\u064a\u063a\u0629 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u062f\u062e\u0644\u0629."),alert(t)}}}),k&&(0,s.jsx)(na,{row:k,onClose:()=>N(null),onDone:O}),S&&(0,s.jsx)(ra,{row:S,onClose:()=>E(null),onDone:O}),C&&(0,s.jsx)(aa,{row:C,onClose:()=>T(null)})]})}function ia(){const[e,t]=(0,r.useState)("reservations"),[n,a]=(0,r.useState)(()=>(new Date).toISOString().slice(0,10)),[i,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(0),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{try{const e=new URL(window.location.href).searchParams.get("tab");e&&["reservations","tashkeen","calendar"].includes(e)&&t(e)}catch(e){}},[]);const d=e=>{t(e);try{const t=new URL(window.location.href);t.searchParams.set("tab",e),window.history.replaceState({},"",t.toString())}catch(n){}},h=t=>{let{id:n,label:r}=t;return(0,s.jsx)("button",{onClick:()=>d(n),className:"px-4 py-2 text-sm rounded-t ".concat(e===n?"bg-white text-gray-900 border border-b-0":"bg-[#1f2a48] text-white hover:bg-[#223459]"," "),children:r})};return(0,r.useEffect)(()=>{const e=e=>{var t;if(!e.altKey)return;const n=e.key.toLowerCase(),r=e.target&&e.target.tagName?e.target.tagName.toLowerCase():"";if(!("input"===r||"textarea"===r||"select"===r||(null===(t=e.target)||void 0===t?void 0:t.isContentEditable))||["t","r"].includes(n))if("1"===n)d("reservations"),e.preventDefault();else if("2"===n)d("tashkeen"),e.preventDefault();else if("3"===n)d("calendar"),e.preventDefault();else if("t"===n)a((new Date).toISOString().slice(0,10)),e.preventDefault();else if("r"===n)c(e=>e+1),e.preventDefault();else if("f"===n){try{var s;null===(s=u.current)||void 0===s||s.focus()}catch(i){}e.preventDefault()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,s.jsxs)("div",{className:"p-0",dir:"rtl",children:[(0,s.jsxs)("div",{className:"sticky top-0 z-10 bg-[#15203a] border-b border-[#1f2a48]",children:[(0,s.jsx)("div",{className:"px-6 pt-4",children:(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a \u0627\u0644\u0634\u0627\u0645\u0644\u0629"})}),(0,s.jsxs)("div",{className:"px-6 flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(h,{id:"reservations",label:"\u0627\u0644\u062d\u062c\u0648\u0632\u0627\u062a"}),(0,s.jsx)(h,{id:"tashkeen",label:"\u0627\u0644\u062a\u0633\u0643\u064a\u0646"}),(0,s.jsx)(h,{id:"calendar",label:"\u0627\u0644\u062a\u0642\u0648\u064a\u0645"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 ml-auto my-2",children:[(0,s.jsx)("input",{type:"date",className:"border rounded px-3 py-2 text-sm",value:n,onChange:e=>a(e.target.value),title:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062a\u0627\u0631\u064a\u062e (Alt+T: \u0627\u0644\u064a\u0648\u0645)"}),(0,s.jsx)("button",{className:"border rounded px-3 py-2 text-sm bg-white hover:bg-gray-50",title:"\u0627\u0644\u064a\u0648\u0645 (Alt+T)",onClick:()=>a((new Date).toISOString().slice(0,10)),children:"\u0627\u0644\u064a\u0648\u0645"}),(0,s.jsx)("button",{className:"border rounded px-3 py-2 text-sm bg-white hover:bg-gray-50",title:"\u062a\u062d\u062f\u064a\u062b (Alt+R)",onClick:()=>c(e=>e+1),children:"\u062a\u062d\u062f\u064a\u062b"}),(0,s.jsx)("input",{ref:u,type:"text",className:"border rounded px-3 py-2 text-sm w-56",placeholder:"\u0628\u062d\u062b: \u0627\u0644\u0627\u0633\u0645/\u0627\u0644\u0647\u0627\u062a\u0641/\u0627\u0644\u063a\u0631\u0641\u0629 (Alt+F)",value:i,onChange:e=>o(e.target.value)})]})]})]}),(0,s.jsxs)("div",{className:"bg-white border rounded m-6 p-2",children:["reservations"===e&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(sa,{})}),"tashkeen"===e&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(Hr,{selectedDate:n,onDateChange:a,searchQuery:i,refreshTick:l})}),"calendar"===e&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(Fr,{selectedDate:n,onDateChange:a,searchQuery:i,refreshTick:l})})]})]})}function oa(){const[e,t]=(0,r.useState)("dashboard");try{console.log("MainLayout mounted")}catch(n){}(0,r.useEffect)(()=>{const e=e=>(e||"").replace(/^\/+/,"").replace(/\/+$/,"").split("?")[0].split("#")[0],r="undefined"!==typeof window&&window.location&&window.location.pathname?window.location.pathname:"/dashboard",a=e(r)||"dashboard";a&&t(a);const s=()=>{try{const n=e(window.location.pathname)||"dashboard";console.log("popstate ->",n),t(n)}catch(n){}};try{window.addEventListener("popstate",s)}catch(n){}return()=>{try{window.removeEventListener("popstate",s)}catch(n){}}},[]);return(0,s.jsxs)("div",{className:"flex min-h-screen bg-gray-100",children:[(0,s.jsx)(S,{onNavigate:e=>{try{console.log("handleNavigate ->",e)}catch(n){}t(e)}}),(0,s.jsx)("main",{className:"flex-1",children:(()=>{try{console.log("Render page:",e)}catch(n){}switch(e){case"dashboard":default:return(0,s.jsx)(jr,{});case"buildings":return(0,s.jsx)(Sr,{});case"floors":return(0,s.jsx)(Or,{});case"room-types":return(0,s.jsx)(Ar,{});case"rooms":return(0,s.jsx)(Dr,{});case"schedules":case"calendar":return(0,s.jsx)(Fr,{});case"tashkeen":return(0,s.jsx)(Hr,{});case"guests":return(0,s.jsx)(Yr,{});case"reservations":return(0,s.jsx)(ia,{})}})()})]})}function la(){return(0,s.jsx)(oa,{})}a.createRoot(document.getElementById("root")).render((0,s.jsx)(r.StrictMode,{children:(0,s.jsx)(la,{})}))})();
//# sourceMappingURL=main.04fccc42.js.map