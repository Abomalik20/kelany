{"ast":null,"code":"var _jsxFileName = \"F:\\\\kelany\\\\src\\\\pages\\\\Tashkeen.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useMemo, useState, useCallback, useContext } from 'react';\nimport { supabase } from '../supabaseClient';\nimport { getRoomStatusColor, getRoomStatusLabelAr, getOccupancyColor } from '../utils/status';\nimport ReservationModal from '../components/ReservationModal';\nimport { AuthContext } from '../App.jsx';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction StatusStrip({\n  status\n}) {\n  const color = getRoomStatusColor(status);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-1\",\n    style: {\n      backgroundColor: color\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 9,\n    columnNumber: 10\n  }, this);\n}\n_c = StatusStrip;\nfunction CleanBadge({\n  value\n}) {\n  const map = {\n    clean: {\n      text: 'نظيفة',\n      cls: 'bg-green-100 text-green-700'\n    },\n    in_cleaning: {\n      text: 'جاري تنظيف',\n      cls: 'bg-amber-100 text-amber-700'\n    },\n    needs_cleaning: {\n      text: 'تحتاج نظافة',\n      cls: 'bg-red-100 text-red-700'\n    }\n  };\n  const v = map[value] || map.clean;\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: `text-xs px-2 py-1 rounded ${v.cls}`,\n    children: v.text\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 19,\n    columnNumber: 10\n  }, this);\n}\n_c2 = CleanBadge;\nfunction RoomTile({\n  room,\n  resv,\n  date,\n  onDropReservation\n}) {\n  _s();\n  const capacity = Number(room.max_guests || room.capacity || 0);\n  const [beds, setBeds] = useState([]);\n  const [loadingBeds, setLoadingBeds] = useState(false);\n  const [resGuests, setResGuests] = useState([]);\n  const [loadingGuests, setLoadingGuests] = useState(false);\n  const [selectedGuestId, setSelectedGuestId] = useState(null);\n  const [guestSearch, setGuestSearch] = useState('');\n  const [guestResults, setGuestResults] = useState([]);\n  const [showDetails, setShowDetails] = useState(false);\n  const occupiedBeds = useMemo(() => {\n    if (!resv) return 0;\n    const gc = Number(resv.guests_count || 0);\n    return Math.max(0, Math.min(gc, capacity || 0));\n  }, [resv, capacity]);\n  const loadBeds = useCallback(async () => {\n    try {\n      setLoadingBeds(true);\n      const {\n        data,\n        error\n      } = await supabase.rpc('get_room_beds_status', {\n        p_room_id: room.id,\n        p_date: date\n      });\n      if (error) throw error;\n      setBeds(data || []);\n    } catch (e) {\n      console.warn('get_room_beds_status failed, fallback to capacity squares', (e === null || e === void 0 ? void 0 : e.message) || e);\n      setBeds([]);\n    } finally {\n      setLoadingBeds(false);\n    }\n  }, [room.id, date]);\n  useEffect(() => {\n    loadBeds();\n  }, [loadBeds]);\n  const loadReservationGuests = useCallback(async () => {\n    if (!resv || !resv.id) {\n      setResGuests([]);\n      return;\n    }\n    try {\n      setLoadingGuests(true);\n      const {\n        data,\n        error\n      } = await supabase.rpc('list_reservation_guests', {\n        p_reservation_id: resv.id\n      });\n      if (error) throw error;\n      setResGuests(data || []);\n    } catch (e) {\n      console.warn('list_reservation_guests failed', (e === null || e === void 0 ? void 0 : e.message) || e);\n      setResGuests([]);\n    } finally {\n      setLoadingGuests(false);\n    }\n  }, [resv]);\n  useEffect(() => {\n    loadReservationGuests();\n  }, [loadReservationGuests]);\n  useEffect(() => {\n    const term = (guestSearch || '').trim();\n    if (!term) {\n      setGuestResults([]);\n      return;\n    }\n    const t = setTimeout(async () => {\n      try {\n        const {\n          data,\n          error\n        } = await supabase.from('guests').select('id, full_name, phone, email').or(`full_name.ilike.%${term}%,phone.ilike.%${term}%,email.ilike.%${term}%`).limit(10);\n        if (error) throw error;\n        setGuestResults(data || []);\n      } catch (e) {\n        console.warn('guest search failed', (e === null || e === void 0 ? void 0 : e.message) || e);\n        setGuestResults([]);\n      }\n    }, 350);\n    return () => clearTimeout(t);\n  }, [guestSearch]);\n  const assignMainGuestToBed = async (bed, explicitGuestId = null) => {\n    try {\n      if (!resv) return;\n      const {\n        error\n      } = await supabase.rpc('assign_bed_for_reservation', {\n        p_reservation_id: resv.id,\n        p_room_bed_id: bed.bed_id,\n        p_guest_id: explicitGuestId || selectedGuestId || resv.guest_id || null,\n        p_start: resv.check_in_date,\n        p_end: resv.check_out_date\n      });\n      if (error) throw error;\n      await loadBeds();\n      await loadReservationGuests();\n    } catch (e) {\n      window.alert('تعذّر إسناد السرير: ' + (e.message || e));\n    }\n  };\n  const unassignBed = async assignmentId => {\n    try {\n      const {\n        error\n      } = await supabase.rpc('unassign_bed', {\n        p_assignment_id: assignmentId\n      });\n      if (error) throw error;\n      await loadBeds();\n      await loadReservationGuests();\n    } catch (e) {\n      window.alert('تعذّر إلغاء إسناد السرير: ' + (e.message || e));\n    }\n  };\n  const addGuestToReservation = async guestId => {\n    try {\n      if (!resv || !resv.id || !guestId) return;\n      const {\n        error\n      } = await supabase.rpc('add_reservation_guest', {\n        p_reservation_id: resv.id,\n        p_guest_id: guestId,\n        p_role: 'additional'\n      });\n      if (error) throw error;\n      setSelectedGuestId(guestId);\n      setGuestSearch('');\n      setGuestResults([]);\n      await loadReservationGuests();\n      await loadBeds();\n      const empty = (beds || []).find(b => !b.assignment_id);\n      if (empty) {\n        await assignMainGuestToBed(empty, guestId);\n      } else {\n        window.alert('لا توجد أسِرّة فارغة في هذه الغرفة لهذا اليوم.');\n      }\n    } catch (e) {\n      window.alert('تعذّر إضافة الضيف للحجز: ' + (e.message || e));\n    }\n  };\n  const handleDragOver = e => {\n    e.preventDefault();\n  };\n  const handleDrop = e => {\n    e.preventDefault();\n    try {\n      const payload = JSON.parse(e.dataTransfer.getData('application/json'));\n      if (!payload || !payload.id) return;\n      if (String(payload.room_id) === String(room.id)) return; // نفس الغرفة لا حاجة للنقل\n      onDropReservation && onDropReservation(payload, room);\n    } catch (_) {}\n  };\n  const Beds = () => {\n    if (beds.length > 0) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-wrap gap-2\",\n        \"aria-label\": `الأسِرّة`,\n        children: beds.map(b => {\n          const filled = !!b.assignment_id;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `px-2 py-1 rounded border text-xs flex items-center gap-2 ${filled ? 'bg-blue-50 text-blue-700' : 'bg-gray-50 text-gray-700'}`,\n            style: {\n              borderColor: getOccupancyColor(filled ? 'occupied' : 'empty')\n            },\n            title: filled ? `مشغول: ${b.guest_name || '—'}` : 'فارغ',\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"underline\",\n              onClick: () => {\n                if (!filled && resv) assignMainGuestToBed(b);\n              },\n              children: b.bed_code\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 17\n            }, this), filled && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"\\u2013 \", b.guest_name || 'مجهول']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 173,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"ml-2 text-red-600 hover:text-red-700\",\n                title: \"\\u0625\\u0644\\u063A\\u0627\\u0621\",\n                onClick: () => unassignBed(b.assignment_id),\n                children: \"\\u0625\\u0644\\u063A\\u0627\\u0621 \\u2716\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 174,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true)]\n          }, b.bed_id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this);\n    }\n    const items = [];\n    for (let i = 0; i < (capacity || 0); i++) {\n      const filled = i < occupiedBeds;\n      items.push(/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-5 h-3 rounded-sm border\",\n        style: {\n          backgroundColor: getOccupancyColor(filled ? 'occupied' : 'empty'),\n          borderColor: getOccupancyColor(filled ? 'occupied' : 'empty')\n        },\n        title: filled ? 'مشغول' : 'فارغ'\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this));\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-wrap gap-1\",\n      \"aria-label\": `الأسِرّة: ${occupiedBeds}/${capacity}`,\n      children: items\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 7\n    }, this);\n  };\n  const hasResv = !!resv;\n  const statusLabel = getRoomStatusLabelAr(room.status);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    onDragOver: handleDragOver,\n    onDrop: handleDrop,\n    className: `rounded-md shadow-sm border overflow-hidden text-xs transition-colors duration-150 ${hasResv ? 'bg-white border-gray-200' : 'bg-emerald-50 border-emerald-100'}`,\n    dir: \"rtl\",\n    children: [/*#__PURE__*/_jsxDEV(StatusStrip, {\n      status: room.status\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between mb-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-semibold text-gray-800 text-sm\",\n          title: \"\\u0627\\u0644\\u063A\\u0631\\u0641\\u0629\",\n          children: room.room_code || room.room_label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-1 text-[11px] text-gray-500\",\n          title: \"\\u0627\\u0644\\u0646\\u0648\\u0639 \\u0648\\u0627\\u0644\\u062D\\u0627\\u0644\\u0629\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"truncate max-w-[80px]\",\n            children: room.room_type_name_ar || room.room_type_name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"px-1.5 py-0.5 rounded-full text-[10px] text-white\",\n            style: {\n              backgroundColor: getRoomStatusColor(room.status)\n            },\n            children: statusLabel\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify_between mb-1 text-[11px] text-gray-600\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"truncate max-w-[55%]\",\n          children: [room.floor_name, \" \\u2013 \", room.building_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CleanBadge, {\n          value: room.cleanliness\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-2\",\n        children: /*#__PURE__*/_jsxDEV(Beds, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), resv ? /*#__PURE__*/_jsxDEV(\"div\", {\n        draggable: true,\n        onDragStart: e => {\n          e.dataTransfer.setData('application/json', JSON.stringify({\n            id: resv.id,\n            room_id: resv.room_id,\n            check_in_date: resv.check_in_date,\n            check_out_date: resv.check_out_date\n          }));\n        },\n        className: \"px-2 py-1 rounded text-[11px] bg-blue-50 border border-blue-200 text-blue-700 cursor-grab\",\n        title: `النزيل: ${resv.guest_name || '—'}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"truncate\",\n            children: resv.guest_name || 'نزيل'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-[10px] text-gray-500\",\n            children: [occupiedBeds, \"/\", capacity]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 13\n        }, this), resv.payer_type === 'agency' && resv.agency_name && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-0.5\",\n          title: `شركة/جهة: ${resv.agency_name}`,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"inline-flex max-w-full items-center px-2 py-0.5 rounded-full border border-emerald-300 bg-emerald-50 text-emerald-800 text-[9px] font-semibold truncate\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"mr-1\",\n              children: \"\\u0634\\u0631\\u0643\\u0629\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"truncate\",\n              children: resv.agency_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-[10px] text-gray-500 mt-0.5\",\n          children: [\"\\u0645\\u0646 \", resv.check_in_date, \" \\u0625\\u0644\\u0649 \", resv.check_out_date]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"mt-1 text-[11px] text-blue-600 hover:text-blue-700 underline\",\n          onClick: () => setShowDetails(v => !v),\n          children: showDetails ? 'إخفاء تفاصيل الضيوف' : 'إظهار تفاصيل الضيوف والأسِرّة'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 13\n        }, this), showDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-1 p-1.5 bg-gray-50 border border-gray-200 rounded\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-[11px] font-semibold mb-1\",\n            children: \"\\u0636\\u064A\\u0648\\u0641 \\u0627\\u0644\\u062D\\u062C\\u0632\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 17\n          }, this), loadingGuests ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-[11px] text-gray-500\",\n            children: \"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 19\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-wrap gap-1.5 mb-2\",\n            children: resGuests.length === 0 ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[11px] text-gray-500\",\n              children: \"\\u0644\\u0627 \\u064A\\u0648\\u062C\\u062F \\u0636\\u064A\\u0648\\u0641 \\u0625\\u0636\\u0627\\u0641\\u064A\\u0648\\u0646.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 23\n            }, this) : resGuests.map(g => /*#__PURE__*/_jsxDEV(\"label\", {\n              className: `px-2 py-0.5 rounded border text-[11px] cursor-pointer ${selectedGuestId === g.guest_id ? 'bg-amber-50 border-amber-300 text-amber-800' : 'bg-white border-gray-300 text-gray-700'}`,\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                name: `sel-${resv.id}`,\n                className: \"mr-1\",\n                checked: selectedGuestId === g.guest_id,\n                onChange: () => setSelectedGuestId(g.guest_id)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 276,\n                columnNumber: 25\n              }, this), g.full_name]\n            }, g.reservation_guest_id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 23\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-1.5\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              value: guestSearch,\n              onChange: e => setGuestSearch(e.target.value),\n              className: \"border rounded px-2 py-0.5 text-[11px] flex-1\",\n              placeholder: \"\\u0628\\u062D\\u062B: \\u0627\\u0644\\u0627\\u0633\\u0645/\\u0627\\u0644\\u0647\\u0627\\u062A\\u0641/\\u0627\\u0644\\u0628\\u0631\\u064A\\u062F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 19\n            }, this), guestResults.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute mt-8 bg-white border rounded shadow p-2 text-[11px] max-h-36 overflow-auto z-10\",\n              children: guestResults.map(gr => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"px-2 py-1 hover:bg-gray-100 cursor-pointer\",\n                onClick: () => addGuestToReservation(gr.id),\n                children: [gr.full_name, \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-500\",\n                  children: [\"(\", gr.phone || gr.email || gr.id.slice(0, 8), \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 288,\n                  columnNumber: 42\n                }, this)]\n              }, gr.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 287,\n                columnNumber: 25\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-1 text-[10px] text-gray-500\",\n            children: \"\\u0627\\u062E\\u062A\\u0631 \\u0636\\u064A\\u0641\\u064B\\u0627\\u060C \\u062B\\u0645 \\u0627\\u0636\\u063A\\u0637 \\u0639\\u0644\\u0649 \\u0633\\u0631\\u064A\\u0631 \\u0641\\u0627\\u0631\\u063A \\u0644\\u0625\\u0633\\u0646\\u0627\\u062F\\u0647.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-xs text-gray-400\",\n        children: \"\\u0644\\u0627 \\u064A\\u0648\\u062C\\u062F \\u062D\\u062C\\u0632 \\u0641\\u064A \\u0647\\u0630\\u0627 \\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 201,\n    columnNumber: 5\n  }, this);\n}\n_s(RoomTile, \"l9Pun0++yyQGhfg+DMQutTgyw64=\");\n_c3 = RoomTile;\nexport default function Tashkeen({\n  selectedDate,\n  onDateChange,\n  searchQuery = '',\n  refreshTick = 0\n}) {\n  _s2();\n  const currentUser = useContext(AuthContext);\n  const [date, setDate] = useState(() => new Date().toISOString().slice(0, 10));\n  const [rooms, setRooms] = useState([]);\n  const [resvs, setResvs] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [filterBuilding, setFilterBuilding] = useState('all');\n  const [filterFloor, setFilterFloor] = useState('all');\n  const [filterStatus, setFilterStatus] = useState('all');\n  const [editingResv, setEditingResv] = useState(null);\n  const loadRooms = useCallback(async () => {\n    // محاولة أولى: عرض rooms_overview إن وُجد\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('rooms_overview').select('id, room_code, room_label, status, cleanliness, max_guests, room_type_name_ar, room_type_name, building_id, building_name, floor_id, floor_name').order('room_code');\n      if (error) throw error;\n      if (data && data.length > 0) {\n        setRooms(data);\n        return;\n      }\n    } catch (e) {\n      console.warn('rooms_overview unavailable, falling back to base tables:', (e === null || e === void 0 ? void 0 : e.message) || e);\n    }\n\n    // بديل: الجداول الأساسية + عمليات إغناء عميلًا\n    try {\n      const [roomsRes, typesRes, buildingsRes, floorsRes] = await Promise.all([supabase.from('rooms').select('id, room_code, status, cleanliness, room_type_id, building_id, floor_id').order('room_code'), supabase.from('room_types_active').select('id, name, name_ar, max_guests').order('display_order'), supabase.from('buildings').select('id, name').order('name'), supabase.from('floors').select('id, name, floor_number, number, building_id').order('id')]);\n\n      // لو فشل room_types_active جرّب room_types العادية\n      let types = typesRes.data || [];\n      if (typesRes.error || types.length === 0) {\n        try {\n          const alt = await supabase.from('room_types').select('id, name, name_ar, max_guests').order('id');\n          if (!alt.error) types = alt.data || [];\n        } catch (_) {}\n      }\n      const typeMap = new Map();\n      types.forEach(t => typeMap.set(String(t.id), t));\n      const bMap = new Map();\n      (buildingsRes.data || []).forEach(b => bMap.set(String(b.id), b));\n      const fMap = new Map();\n      (floorsRes.data || []).forEach(f => fMap.set(String(f.id), f));\n      const enriched = (roomsRes.data || []).map(r => {\n        const t = typeMap.get(String(r.room_type_id));\n        const b = bMap.get(String(r.building_id));\n        const f = fMap.get(String(r.floor_id));\n        const room_label = r.room_code || (r.id ? `غرفة #${String(r.id).slice(0, 8)}` : 'غرفة');\n        const building_name = (b === null || b === void 0 ? void 0 : b.name) || 'مبنى';\n        const floor_name = (f === null || f === void 0 ? void 0 : f.name) || (f !== null && f !== void 0 && f.floor_number ? `الطابق ${f.floor_number}` : f !== null && f !== void 0 && f.number ? `الطابق ${f.number}` : 'طابق');\n        return {\n          id: r.id,\n          room_code: r.room_code,\n          room_label,\n          status: r.status,\n          cleanliness: r.cleanliness,\n          max_guests: (t === null || t === void 0 ? void 0 : t.max_guests) || 0,\n          room_type_name_ar: t === null || t === void 0 ? void 0 : t.name_ar,\n          room_type_name: t === null || t === void 0 ? void 0 : t.name,\n          building_id: r.building_id,\n          building_name,\n          floor_id: r.floor_id,\n          floor_name\n        };\n      });\n      setRooms(enriched);\n    } catch (e2) {\n      console.error('Fallback loadRooms failed', e2);\n      setRooms([]);\n    }\n  }, []);\n  const loadResvsForDate = useCallback(async d => {\n    try {\n      // الحجز الذي يغطي اليوم d: check_in <= d AND check_out > d (يوم الخروج متاح لحجز جديد)\n      const {\n        data,\n        error\n      } = await supabase.from('reservations').select('id, room_id, guest_id, guests_count, status, check_in_date, check_out_date, nightly_rate, total_amount, amount_paid, currency, payment_method, payer_type, agency_name, special_requests, notes, guests(full_name)').in('status', ['pending', 'confirmed', 'checked_in']).lte('check_in_date', d).gt('check_out_date', d);\n      if (error) throw error;\n      const mapped = (data || []).map(r => ({\n        id: r.id,\n        room_id: r.room_id,\n        guest_id: r.guest_id,\n        guests_count: r.guests_count,\n        status: r.status,\n        check_in_date: r.check_in_date,\n        check_out_date: r.check_out_date,\n        nightly_rate: r.nightly_rate,\n        total_amount: r.total_amount,\n        amount_paid: r.amount_paid,\n        currency: r.currency,\n        payment_method: r.payment_method,\n        payer_type: r.payer_type,\n        agency_name: r.agency_name,\n        special_requests: r.special_requests,\n        notes: r.notes,\n        guest_name: r.guests && r.guests.full_name ? r.guests.full_name : undefined\n      }));\n      setResvs(mapped);\n    } catch (e) {\n      console.error('loadResvsForDate failed', e);\n      setResvs([]);\n    }\n  }, []);\n  const reloadAll = useCallback(async () => {\n    setLoading(true);\n    await Promise.all([loadRooms(), loadResvsForDate(date)]);\n    setLoading(false);\n  }, [date, loadRooms, loadResvsForDate]);\n  useEffect(() => {\n    reloadAll();\n  }, [reloadAll]);\n\n  // Sync external date\n  useEffect(() => {\n    if (selectedDate && selectedDate !== date) {\n      setDate(selectedDate);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedDate]);\n\n  // External refresh\n  useEffect(() => {\n    reloadAll();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [refreshTick]);\n  useEffect(() => {\n    const ch = supabase.channel('tashkeen-live').on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'reservations'\n    }, () => {\n      loadResvsForDate(date);\n    }).on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'rooms'\n    }, () => {\n      loadRooms();\n    }).subscribe();\n    return () => {\n      try {\n        supabase.removeChannel(ch);\n      } catch (_) {}\n    };\n  }, [date, loadRooms, loadResvsForDate]);\n  const resvByRoom = useMemo(() => {\n    const m = new Map();\n    resvs.forEach(r => {\n      m.set(String(r.room_id), r);\n    });\n    return m;\n  }, [resvs]);\n  const filteredRooms = useMemo(() => {\n    let base = rooms;\n\n    // فلاتر المبنى / الدور / حالة الغرفة\n    if (filterBuilding !== 'all') {\n      base = base.filter(r => String(r.building_id || r.building_name || '') === filterBuilding);\n    }\n    if (filterFloor !== 'all') {\n      base = base.filter(r => String(r.floor_id || r.floor_name || '') === filterFloor);\n    }\n    if (filterStatus !== 'all') {\n      base = base.filter(r => String(r.status || '').toLowerCase() === filterStatus);\n    }\n    const term = (searchQuery || '').trim().toLowerCase();\n    if (!term) return base;\n    const resvByRoomLocal = new Map();\n    resvs.forEach(r => {\n      resvByRoomLocal.set(String(r.room_id), r);\n    });\n    return base.filter(r => {\n      const roomMatch = (r.room_code || r.room_label || '').toLowerCase().includes(term);\n      const rv = resvByRoomLocal.get(String(r.id));\n      const guestMatch = rv ? (rv.guest_name || '').toLowerCase().includes(term) : false;\n      return roomMatch || guestMatch;\n    });\n  }, [rooms, resvs, searchQuery, filterBuilding, filterFloor, filterStatus]);\n  const buildingOptions = useMemo(() => {\n    const m = new Map();\n    rooms.forEach(r => {\n      const key = String(r.building_id || r.building_name || '');\n      if (!key) return;\n      if (!m.has(key)) m.set(key, r.building_name || 'مبنى');\n    });\n    return Array.from(m.entries()).map(([value, label]) => ({\n      value,\n      label\n    }));\n  }, [rooms]);\n  const floorOptions = useMemo(() => {\n    const m = new Map();\n    rooms.forEach(r => {\n      const key = String(r.floor_id || r.floor_name || '');\n      if (!key) return;\n      if (!m.has(key)) m.set(key, r.floor_name || 'طابق');\n    });\n    return Array.from(m.entries()).map(([value, label]) => ({\n      value,\n      label\n    }));\n  }, [rooms]);\n  const stats = useMemo(() => {\n    const totalRooms = rooms.length;\n    const roomsWithResv = new Set(resvs.map(r => String(r.room_id))).size;\n    const totalBeds = rooms.reduce((sum, r) => sum + Number(r.max_guests || 0), 0);\n    const occupiedBeds = resvs.reduce((sum, r) => sum + Number(r.guests_count || 0), 0);\n    const emptyBeds = Math.max(0, totalBeds - occupiedBeds);\n    return {\n      totalRooms,\n      roomsWithResv,\n      totalBeds,\n      occupiedBeds,\n      emptyBeds\n    };\n  }, [rooms, resvs]);\n  const handleOpenEdit = roomId => {\n    const r = resvs.find(x => String(x.room_id) === String(roomId));\n    if (!r) return;\n    setEditingResv(r);\n  };\n  const handleOpenCreate = room => {\n    if (!room) return;\n    setEditingResv({\n      id: null,\n      guest_id: null,\n      room_id: room.id,\n      check_in_date: date,\n      check_out_date: date,\n      guests_count: 1,\n      status: 'confirmed',\n      nightly_rate: null,\n      total_amount: null,\n      amount_paid: 0,\n      currency: 'EGP',\n      payment_method: 'cash',\n      payer_type: 'guest',\n      agency_name: '',\n      special_requests: '',\n      notes: '',\n      pending_guest_ids: []\n    });\n  };\n  const handleSaveFromModal = async payload => {\n    try {\n      if (!payload) return;\n      const cleaned = {\n        ...payload\n      };\n      const pendingExtras = Array.isArray(cleaned.pending_guest_ids) ? cleaned.pending_guest_ids : [];\n      delete cleaned.pending_guest_ids;\n      if (editingResv && editingResv.id) {\n        const {\n          error\n        } = await supabase.from('reservations').update(cleaned).eq('id', editingResv.id);\n        if (error) throw error;\n        // إلحاق ضيوف إضافيين إن وُجدوا\n        if (editingResv.id && pendingExtras.length > 0) {\n          for (const gid of pendingExtras) {\n            try {\n              await supabase.rpc('add_reservation_guest', {\n                p_reservation_id: editingResv.id,\n                p_guest_id: gid,\n                p_role: 'additional'\n              });\n            } catch (_) {}\n          }\n        }\n      } else {\n        const {\n          data,\n          error\n        } = await supabase.from('reservations').insert([cleaned]).select('id').single();\n        if (error) throw error;\n        const newId = data === null || data === void 0 ? void 0 : data.id;\n        if (newId && pendingExtras.length > 0) {\n          for (const gid of pendingExtras) {\n            try {\n              await supabase.rpc('add_reservation_guest', {\n                p_reservation_id: newId,\n                p_guest_id: gid,\n                p_role: 'additional'\n              });\n            } catch (_) {}\n          }\n        }\n      }\n      await loadResvsForDate(date);\n      setEditingResv(null);\n    } catch (e) {\n      console.error('Failed to save reservation from Tashkeen', e);\n      const msg = String((e === null || e === void 0 ? void 0 : e.message) || e || '').toLowerCase();\n      let userMsg = 'تعذّر حفظ الحجز.';\n      if (msg.includes('overlapping reservation')) userMsg = 'تعذّر الحفظ: هناك تعارض في التواريخ مع حجز آخر لنفس الغرفة.';else if (msg.includes('check_out_date must be after check_in_date')) userMsg = 'تعذّر الحفظ: تاريخ الخروج يجب أن يكون بعد تاريخ الدخول.';else if (msg.includes('row-level security')) userMsg = 'تعذّر الحفظ: لا تملك الصلاحية لحفظ الحجز (RLS).';else if (msg.includes('not-null')) userMsg = 'تعذّر الحفظ: بعض الحقول المطلوبة غير مكتملة.';else if (msg.includes('invalid input syntax')) userMsg = 'تعذّر الحفظ: مشكلة في صيغة البيانات المدخلة.';\n      window.alert(userMsg);\n    }\n  };\n  const groups = useMemo(() => {\n    // تجميع حسب المبنى ثم الطابق\n    const byBuilding = new Map();\n    filteredRooms.forEach(r => {\n      const bKey = String(r.building_id || r.building_name || '—');\n      const fKey = String(r.floor_id || r.floor_name || '—');\n      if (!byBuilding.has(bKey)) byBuilding.set(bKey, {\n        label: r.building_name || 'مبنى',\n        floors: new Map()\n      });\n      const bObj = byBuilding.get(bKey);\n      if (!bObj.floors.has(fKey)) bObj.floors.set(fKey, {\n        label: r.floor_name || 'طابق',\n        rooms: []\n      });\n      bObj.floors.get(fKey).rooms.push(r);\n    });\n    // تحويل إلى مصفوفة قابلة للعرض\n    return Array.from(byBuilding.values()).map(b => ({\n      label: b.label,\n      floors: Array.from(b.floors.values()).map(f => ({\n        label: f.label,\n        rooms: f.rooms\n      }))\n    }));\n  }, [filteredRooms]);\n  const onDropReservation = async (payload, targetRoom) => {\n    try {\n      const targetRes = resvByRoom.get(String(targetRoom.id));\n      const staffId = currentUser && currentUser.id ? currentUser.id : null;\n\n      // إذا كانت الغرفة المستهدفة بها حجز آخر لنفس اليوم، اعرض خيار تبديل الغرف بين الحجزين\n      if (targetRes && String(targetRes.id) !== String(payload.id)) {\n        const okSwap = window.confirm(`الغرفة ${targetRoom.room_code || targetRoom.room_label} تحتوي على حجز آخر في هذا اليوم.\\n` + 'هل تريد تبديل الغرف بين الحجزين مع الاحتفاظ بنفس التواريخ؟');\n        if (!okSwap) return;\n        const {\n          error: swapError\n        } = await supabase.rpc('swap_room_reservations', {\n          p_reservation_id1: payload.id,\n          p_reservation_id2: targetRes.id,\n          p_staff_user_id: staffId\n        });\n        if (swapError) throw swapError;\n        await loadResvsForDate(date);\n        window.alert('تم تبديل الغرف بين الحجوزات بنجاح.');\n        return;\n      }\n\n      // في حالة عدم وجود حجز في الغرفة المستهدفة: نقل عادي لنفس التواريخ\n      const ok = window.confirm(`نقل الحجز إلى ${targetRoom.room_code || targetRoom.room_label} لنفس التواريخ؟`);\n      if (!ok) return;\n      const {\n        error\n      } = await supabase.rpc('move_reservation', {\n        p_reservation_id: payload.id,\n        p_new_room_id: targetRoom.id,\n        p_new_check_in: payload.check_in_date,\n        p_new_check_out: payload.check_out_date\n      });\n      if (error) throw error;\n      await loadResvsForDate(date);\n      window.alert('تم نقل الحجز بنجاح.');\n    } catch (e) {\n      console.error('move failed', e);\n      window.alert('تعذّر نقل الحجز: ' + (e.message || e));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4 md:p-6\",\n    dir: \"rtl\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-6 bg-white rounded-lg shadow border border-gray-200\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col md:flex-row md:items-center md:justify-between gap-3 px-4 pt-4 pb-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl md:text-2xl font-bold mb-1\",\n            children: \"\\u0627\\u0644\\u062A\\u0633\\u0643\\u064A\\u0646 (\\u0639\\u0631\\u0636 \\u0625\\u0634\\u063A\\u0627\\u0644 \\u0627\\u0644\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 650,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-500\",\n            children: \"\\u0639\\u0631\\u0636 \\u0628\\u0635\\u0631\\u064A \\u0644\\u0633\\u0639\\u0629 \\u0627\\u0644\\u063A\\u0631\\u0641 \\u0648\\u0639\\u062F\\u062F \\u0627\\u0644\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629 \\u0627\\u0644\\u0645\\u0634\\u063A\\u0648\\u0644\\u0629 \\u0641\\u064A \\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u0645\\u062D\\u062F\\u062F\\u060C \\u0645\\u0639 \\u0625\\u0645\\u0643\\u0627\\u0646\\u064A\\u0629 \\u062A\\u0648\\u0632\\u064A\\u0639 \\u0627\\u0644\\u0636\\u064A\\u0648\\u0641 \\u0639\\u0644\\u0649 \\u0627\\u0644\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629 \\u0628\\u0633\\u0647\\u0648\\u0644\\u0629.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 651,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 649,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            className: \"border rounded px-3 py-2 text-sm\",\n            value: date,\n            onChange: e => {\n              setDate(e.target.value);\n              onDateChange && onDateChange(e.target.value);\n            },\n            title: \"\\u0627\\u062E\\u062A\\u0631 \\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 654,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"border rounded px-3 py-2 bg-white hover:bg-gray-50 text-sm\",\n            onClick: () => {\n              const t = new Date().toISOString().slice(0, 10);\n              setDate(t);\n              onDateChange && onDateChange(t);\n            },\n            children: \"\\u0627\\u0644\\u064A\\u0648\\u0645\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 661,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 653,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 648,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"px-4 pb-3 border-t border-gray-100 bg-slate-50/80\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 text-xs md:text-sm text-gray-700 mt-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[11px] text-gray-500\",\n              children: \"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u063A\\u0631\\u0641\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 673,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-base font-semibold\",\n              children: stats.totalRooms\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 674,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 672,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[11px] text-gray-500\",\n              children: \"\\u063A\\u0631\\u0641 \\u0628\\u0647\\u0627 \\u062D\\u062C\\u0632 \\u0627\\u0644\\u064A\\u0648\\u0645\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 677,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-base font-semibold\",\n              children: stats.roomsWithResv\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 678,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 676,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[11px] text-gray-500\",\n              children: \"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 681,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-base font-semibold\",\n              children: stats.totalBeds\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 682,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 680,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[11px] text-gray-500\",\n              children: \"\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629 \\u0645\\u0634\\u063A\\u0648\\u0644\\u0629\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 685,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-base font-semibold text-blue-700\",\n              children: stats.occupiedBeds\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 686,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 684,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[11px] text-gray-500\",\n              children: \"\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629 \\u0641\\u0627\\u0631\\u063A\\u0629 \\u062A\\u0642\\u0631\\u064A\\u0628\\u064B\\u0627\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 689,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-base font-semibold text-emerald-700\",\n              children: stats.emptyBeds\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 690,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 688,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 671,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 670,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"px-4 pb-4 border-t border-gray-100 bg-slate-50/60\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-3 flex flex-wrap items-center gap-3 text-xs sm:text-sm\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-gray-600\",\n              children: \"\\u0627\\u0644\\u0645\\u0628\\u0646\\u0649:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 698,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"border rounded px-2 py-1 text-xs sm:text-sm\",\n              value: filterBuilding,\n              onChange: e => {\n                setFilterBuilding(e.target.value);\n                setFilterFloor('all');\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"all\",\n                children: \"\\u0627\\u0644\\u0643\\u0644\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 704,\n                columnNumber: 17\n              }, this), buildingOptions.map(opt => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: opt.value,\n                children: opt.label\n              }, opt.value, false, {\n                fileName: _jsxFileName,\n                lineNumber: 706,\n                columnNumber: 19\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 699,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 697,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-gray-600\",\n              children: \"\\u0627\\u0644\\u062F\\u0648\\u0631:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 711,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"border rounded px-2 py-1 text-xs sm:text-sm\",\n              value: filterFloor,\n              onChange: e => setFilterFloor(e.target.value),\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"all\",\n                children: \"\\u0627\\u0644\\u0643\\u0644\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 717,\n                columnNumber: 17\n              }, this), floorOptions.map(opt => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: opt.value,\n                children: opt.label\n              }, opt.value, false, {\n                fileName: _jsxFileName,\n                lineNumber: 719,\n                columnNumber: 19\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 712,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 710,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-gray-600\",\n              children: \"\\u062D\\u0627\\u0644\\u0629 \\u0627\\u0644\\u063A\\u0631\\u0641\\u0629:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 724,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"border rounded px-2 py-1 text-xs sm:text-sm\",\n              value: filterStatus,\n              onChange: e => setFilterStatus(e.target.value),\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"all\",\n                children: \"\\u0627\\u0644\\u0643\\u0644\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 730,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"available\",\n                children: \"\\u0645\\u062A\\u0627\\u062D\\u0629\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 731,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"reserved\",\n                children: \"\\u0645\\u062D\\u062C\\u0648\\u0632\\u0629\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 732,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"occupied\",\n                children: \"\\u0645\\u0634\\u063A\\u0648\\u0644\\u0629\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 733,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"maintenance\",\n                children: \"\\u0635\\u064A\\u0627\\u0646\\u0629\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 734,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 725,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 723,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 696,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-xs sm:text-sm text-blue-800 leading-relaxed\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"- \\u0627\\u0633\\u062D\\u0628 \\u0628\\u0637\\u0627\\u0642\\u0629 \\u0627\\u0644\\u0646\\u0632\\u064A\\u0644 \\u0645\\u0646 \\u063A\\u0631\\u0641\\u0629 \\u0625\\u0644\\u0649 \\u0623\\u062E\\u0631\\u0649 \\u0644\\u0646\\u0642\\u0644 \\u0627\\u0644\\u062D\\u062C\\u0632 \\u0644\\u0646\\u0641\\u0633 \\u0627\\u0644\\u0645\\u062F\\u0629.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 740,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"- \\u0643\\u0644 \\u0645\\u0633\\u062A\\u0637\\u064A\\u0644 \\u0635\\u063A\\u064A\\u0631 \\u064A\\u0645\\u062B\\u0644 \\u0633\\u0631\\u064A\\u0631\\u064B\\u0627\\u061B \\u0627\\u0644\\u0645\\u0645\\u062A\\u0644\\u0626 \\u064A\\u0639\\u0646\\u064A \\u0645\\u0634\\u063A\\u0648\\u0644 \\u062D\\u0633\\u0628 \\u0639\\u062F\\u062F \\u0627\\u0644\\u0636\\u064A\\u0648\\u0641 \\u0641\\u064A \\u0627\\u0644\\u062D\\u062C\\u0632.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 741,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"- \\u064A\\u0645\\u0643\\u0646\\u0643 \\u062A\\u063A\\u064A\\u064A\\u0631 \\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E \\u0645\\u0646 \\u0627\\u0644\\u0623\\u0639\\u0644\\u0649 \\u0644\\u0645\\u0634\\u0627\\u0647\\u062F\\u0629 \\u0625\\u0634\\u063A\\u0627\\u0644 \\u064A\\u0648\\u0645 \\u0645\\u0639\\u064A\\u0651\\u0646.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 742,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-2 text-[11px] sm:text-xs text-blue-900 flex flex-wrap items-center gap-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"inline-block w-4 h-4 rounded\",\n                style: {\n                  backgroundColor: getOccupancyColor('occupied')\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 744,\n                columnNumber: 56\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u0633\\u0631\\u064A\\u0631 \\u0645\\u0634\\u063A\\u0648\\u0644\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 744,\n                columnNumber: 170\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 744,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"inline-block w-4 h-4 rounded\",\n                style: {\n                  backgroundColor: getOccupancyColor('empty')\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 745,\n                columnNumber: 56\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u0633\\u0631\\u064A\\u0631 \\u0641\\u0627\\u0631\\u063A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 745,\n                columnNumber: 167\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 745,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 743,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 694,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 647,\n      columnNumber: 7\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-gray-500\",\n      children: \"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 752,\n      columnNumber: 9\n    }, this) : groups.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-gray-500\",\n      children: \"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u063A\\u0631\\u0641.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 754,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-8\",\n      children: groups.map((b, bi) => /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-lg font-bold text-gray-800 mb-3\",\n          children: b.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 759,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-5\",\n          children: b.floors.map((f, fi) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"border border-gray-200 rounded-lg bg-white/70\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-gray-50\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-sm font-semibold text-gray-700\",\n                children: f.label\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 764,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-[11px] text-gray-500\",\n                children: [\"\\u0639\\u062F\\u062F \\u0627\\u0644\\u063A\\u0631\\u0641: \", f.rooms.length]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 765,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 763,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"px-3 py-3\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5\",\n                children: f.rooms.map(room => {\n                  const hasResv = !!resvByRoom.get(String(room.id));\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"relative group\",\n                    children: [/*#__PURE__*/_jsxDEV(RoomTile, {\n                      room: room,\n                      resv: resvByRoom.get(String(room.id)),\n                      date: date,\n                      onDropReservation: onDropReservation\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 773,\n                      columnNumber: 31\n                    }, this), hasResv ? /*#__PURE__*/_jsxDEV(\"button\", {\n                      type: \"button\",\n                      className: \"absolute top-1 left-1 text-[10px] bg-white/90 border border-blue-300 text-blue-700 rounded px-1.5 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity\",\n                      onClick: () => handleOpenEdit(room.id),\n                      children: \"\\u062A\\u0639\\u062F\\u064A\\u0644 \\u0627\\u0644\\u062D\\u062C\\u0632\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 780,\n                      columnNumber: 33\n                    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                      type: \"button\",\n                      className: \"absolute top-1 left-1 text-[10px] bg-white/90 border border-emerald-300 text-emerald-700 rounded px-1.5 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity\",\n                      onClick: () => handleOpenCreate(room),\n                      children: \"\\u062D\\u062C\\u0632 \\u062C\\u062F\\u064A\\u062F\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 788,\n                      columnNumber: 33\n                    }, this)]\n                  }, room.id, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 772,\n                    columnNumber: 29\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 768,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 767,\n              columnNumber: 21\n            }, this)]\n          }, fi, true, {\n            fileName: _jsxFileName,\n            lineNumber: 762,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 15\n        }, this)]\n      }, bi, true, {\n        fileName: _jsxFileName,\n        lineNumber: 758,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 756,\n      columnNumber: 9\n    }, this), editingResv && /*#__PURE__*/_jsxDEV(ReservationModal, {\n      initialData: editingResv,\n      onClose: () => setEditingResv(null),\n      onSave: handleSaveFromModal,\n      onAfterAction: async () => {\n        await loadResvsForDate(date);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 810,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 646,\n    columnNumber: 5\n  }, this);\n}\n_s2(Tashkeen, \"l7WeCmPnCwZmm1hu2ThUvnP7jgE=\");\n_c4 = Tashkeen;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"StatusStrip\");\n$RefreshReg$(_c2, \"CleanBadge\");\n$RefreshReg$(_c3, \"RoomTile\");\n$RefreshReg$(_c4, \"Tashkeen\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","useCallback","useContext","supabase","getRoomStatusColor","getRoomStatusLabelAr","getOccupancyColor","ReservationModal","AuthContext","jsxDEV","_jsxDEV","Fragment","_Fragment","StatusStrip","status","color","className","style","backgroundColor","fileName","_jsxFileName","lineNumber","columnNumber","_c","CleanBadge","value","map","clean","text","cls","in_cleaning","needs_cleaning","v","children","_c2","RoomTile","room","resv","date","onDropReservation","_s","capacity","Number","max_guests","beds","setBeds","loadingBeds","setLoadingBeds","resGuests","setResGuests","loadingGuests","setLoadingGuests","selectedGuestId","setSelectedGuestId","guestSearch","setGuestSearch","guestResults","setGuestResults","showDetails","setShowDetails","occupiedBeds","gc","guests_count","Math","max","min","loadBeds","data","error","rpc","p_room_id","id","p_date","e","console","warn","message","loadReservationGuests","p_reservation_id","term","trim","t","setTimeout","from","select","or","limit","clearTimeout","assignMainGuestToBed","bed","explicitGuestId","p_room_bed_id","bed_id","p_guest_id","guest_id","p_start","check_in_date","p_end","check_out_date","window","alert","unassignBed","assignmentId","p_assignment_id","addGuestToReservation","guestId","p_role","empty","find","b","assignment_id","handleDragOver","preventDefault","handleDrop","payload","JSON","parse","dataTransfer","getData","String","room_id","_","Beds","length","filled","borderColor","title","guest_name","onClick","bed_code","items","i","push","hasResv","statusLabel","onDragOver","onDrop","dir","room_code","room_label","room_type_name_ar","room_type_name","floor_name","building_name","cleanliness","draggable","onDragStart","setData","stringify","payer_type","agency_name","type","g","name","checked","onChange","full_name","reservation_guest_id","target","placeholder","gr","phone","email","slice","_c3","Tashkeen","selectedDate","onDateChange","searchQuery","refreshTick","_s2","currentUser","setDate","Date","toISOString","rooms","setRooms","resvs","setResvs","loading","setLoading","filterBuilding","setFilterBuilding","filterFloor","setFilterFloor","filterStatus","setFilterStatus","editingResv","setEditingResv","loadRooms","order","roomsRes","typesRes","buildingsRes","floorsRes","Promise","all","types","alt","typeMap","Map","forEach","set","bMap","fMap","f","enriched","r","get","room_type_id","building_id","floor_id","floor_number","number","name_ar","e2","loadResvsForDate","d","in","lte","gt","mapped","nightly_rate","total_amount","amount_paid","currency","payment_method","special_requests","notes","guests","undefined","reloadAll","ch","channel","on","event","schema","table","subscribe","removeChannel","resvByRoom","m","filteredRooms","base","filter","toLowerCase","resvByRoomLocal","roomMatch","includes","rv","guestMatch","buildingOptions","key","has","Array","entries","label","floorOptions","stats","totalRooms","roomsWithResv","Set","size","totalBeds","reduce","sum","emptyBeds","handleOpenEdit","roomId","x","handleOpenCreate","pending_guest_ids","handleSaveFromModal","cleaned","pendingExtras","isArray","update","eq","gid","insert","single","newId","msg","userMsg","groups","byBuilding","bKey","fKey","floors","bObj","values","targetRoom","targetRes","staffId","okSwap","confirm","swapError","p_reservation_id1","p_reservation_id2","p_staff_user_id","ok","p_new_room_id","p_new_check_in","p_new_check_out","opt","bi","fi","initialData","onClose","onSave","onAfterAction","_c4","$RefreshReg$"],"sources":["F:/kelany/src/pages/Tashkeen.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState, useCallback, useContext } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\nimport { getRoomStatusColor, getRoomStatusLabelAr, getOccupancyColor } from '../utils/status';\r\nimport ReservationModal from '../components/ReservationModal';\r\nimport { AuthContext } from '../App.jsx';\r\n\r\nfunction StatusStrip({ status }) {\r\n  const color = getRoomStatusColor(status);\r\n  return <div className=\"h-1\" style={{ backgroundColor: color }} />;\r\n}\r\n\r\nfunction CleanBadge({ value }) {\r\n  const map = {\r\n    clean: { text: 'نظيفة', cls: 'bg-green-100 text-green-700' },\r\n    in_cleaning: { text: 'جاري تنظيف', cls: 'bg-amber-100 text-amber-700' },\r\n    needs_cleaning: { text: 'تحتاج نظافة', cls: 'bg-red-100 text-red-700' },\r\n  };\r\n  const v = map[value] || map.clean;\r\n  return <span className={`text-xs px-2 py-1 rounded ${v.cls}`}>{v.text}</span>;\r\n}\r\n\r\nfunction RoomTile({ room, resv, date, onDropReservation }) {\r\n  const capacity = Number(room.max_guests || room.capacity || 0);\r\n  const [beds, setBeds] = useState([]);\r\n  const [loadingBeds, setLoadingBeds] = useState(false);\r\n  const [resGuests, setResGuests] = useState([]);\r\n  const [loadingGuests, setLoadingGuests] = useState(false);\r\n  const [selectedGuestId, setSelectedGuestId] = useState(null);\r\n  const [guestSearch, setGuestSearch] = useState('');\r\n  const [guestResults, setGuestResults] = useState([]);\r\n  const [showDetails, setShowDetails] = useState(false);\r\n\r\n  const occupiedBeds = useMemo(() => {\r\n    if (!resv) return 0;\r\n    const gc = Number(resv.guests_count || 0);\r\n    return Math.max(0, Math.min(gc, capacity || 0));\r\n  }, [resv, capacity]);\r\n\r\n  const loadBeds = useCallback(async () => {\r\n    try {\r\n      setLoadingBeds(true);\r\n      const { data, error } = await supabase.rpc('get_room_beds_status', { p_room_id: room.id, p_date: date });\r\n      if (error) throw error;\r\n      setBeds(data || []);\r\n    } catch (e) {\r\n      console.warn('get_room_beds_status failed, fallback to capacity squares', e?.message || e);\r\n      setBeds([]);\r\n    } finally {\r\n      setLoadingBeds(false);\r\n    }\r\n  }, [room.id, date]);\r\n\r\n  useEffect(() => { loadBeds(); }, [loadBeds]);\r\n\r\n  const loadReservationGuests = useCallback(async () => {\r\n    if (!resv || !resv.id) { setResGuests([]); return; }\r\n    try {\r\n      setLoadingGuests(true);\r\n      const { data, error } = await supabase.rpc('list_reservation_guests', { p_reservation_id: resv.id });\r\n      if (error) throw error;\r\n      setResGuests(data || []);\r\n    } catch (e) {\r\n      console.warn('list_reservation_guests failed', e?.message || e);\r\n      setResGuests([]);\r\n    } finally {\r\n      setLoadingGuests(false);\r\n    }\r\n  }, [resv]);\r\n\r\n  useEffect(() => { loadReservationGuests(); }, [loadReservationGuests]);\r\n\r\n  useEffect(() => {\r\n    const term = (guestSearch || '').trim();\r\n    if (!term) { setGuestResults([]); return; }\r\n    const t = setTimeout(async () => {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from('guests')\r\n          .select('id, full_name, phone, email')\r\n          .or(`full_name.ilike.%${term}%,phone.ilike.%${term}%,email.ilike.%${term}%`)\r\n          .limit(10);\r\n        if (error) throw error;\r\n        setGuestResults(data || []);\r\n      } catch (e) {\r\n        console.warn('guest search failed', e?.message || e);\r\n        setGuestResults([]);\r\n      }\r\n    }, 350);\r\n    return () => clearTimeout(t);\r\n  }, [guestSearch]);\r\n\r\n  const assignMainGuestToBed = async (bed, explicitGuestId = null) => {\r\n    try {\r\n      if (!resv) return;\r\n      const { error } = await supabase.rpc('assign_bed_for_reservation', {\r\n        p_reservation_id: resv.id,\r\n        p_room_bed_id: bed.bed_id,\r\n        p_guest_id: explicitGuestId || selectedGuestId || resv.guest_id || null,\r\n        p_start: resv.check_in_date,\r\n        p_end: resv.check_out_date,\r\n      });\r\n      if (error) throw error;\r\n      await loadBeds();\r\n      await loadReservationGuests();\r\n    } catch (e) {\r\n      window.alert('تعذّر إسناد السرير: ' + (e.message || e));\r\n    }\r\n  };\r\n\r\n  const unassignBed = async (assignmentId) => {\r\n    try {\r\n      const { error } = await supabase.rpc('unassign_bed', { p_assignment_id: assignmentId });\r\n      if (error) throw error;\r\n      await loadBeds();\r\n      await loadReservationGuests();\r\n    } catch (e) {\r\n      window.alert('تعذّر إلغاء إسناد السرير: ' + (e.message || e));\r\n    }\r\n  };\r\n\r\n  const addGuestToReservation = async (guestId) => {\r\n    try {\r\n      if (!resv || !resv.id || !guestId) return;\r\n      const { error } = await supabase.rpc('add_reservation_guest', { p_reservation_id: resv.id, p_guest_id: guestId, p_role: 'additional' });\r\n      if (error) throw error;\r\n      setSelectedGuestId(guestId);\r\n      setGuestSearch('');\r\n      setGuestResults([]);\r\n      await loadReservationGuests();\r\n      await loadBeds();\r\n      const empty = (beds || []).find(b => !b.assignment_id);\r\n      if (empty) {\r\n        await assignMainGuestToBed(empty, guestId);\r\n      } else {\r\n        window.alert('لا توجد أسِرّة فارغة في هذه الغرفة لهذا اليوم.');\r\n      }\r\n    } catch (e) {\r\n      window.alert('تعذّر إضافة الضيف للحجز: ' + (e.message || e));\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e) => {\r\n    e.preventDefault();\r\n  };\r\n  const handleDrop = (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      const payload = JSON.parse(e.dataTransfer.getData('application/json'));\r\n      if (!payload || !payload.id) return;\r\n      if (String(payload.room_id) === String(room.id)) return; // نفس الغرفة لا حاجة للنقل\r\n      onDropReservation && onDropReservation(payload, room);\r\n    } catch (_) {}\r\n  };\r\n\r\n  const Beds = () => {\r\n    if (beds.length > 0) {\r\n      return (\r\n        <div className=\"flex flex-wrap gap-2\" aria-label={`الأسِرّة`}>\r\n          {beds.map(b => {\r\n            const filled = !!b.assignment_id;\r\n            return (\r\n              <div\r\n                key={b.bed_id}\r\n                className={`px-2 py-1 rounded border text-xs flex items-center gap-2 ${filled ? 'bg-blue-50 text-blue-700' : 'bg-gray-50 text-gray-700'}`}\r\n                style={{ borderColor: getOccupancyColor(filled ? 'occupied' : 'empty') }}\r\n                title={filled ? `مشغول: ${b.guest_name || '—'}` : 'فارغ'}\r\n              >\r\n                <button className=\"underline\" onClick={() => { if (!filled && resv) assignMainGuestToBed(b); }}>\r\n                  {b.bed_code}\r\n                </button>\r\n                {filled && (\r\n                  <>\r\n                    <span>– {b.guest_name || 'مجهول'}</span>\r\n                    <button className=\"ml-2 text-red-600 hover:text-red-700\" title=\"إلغاء\" onClick={() => unassignBed(b.assignment_id)}>إلغاء ✖</button>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      );\r\n    }\r\n    const items = [];\r\n    for (let i = 0; i < (capacity || 0); i++) {\r\n      const filled = i < occupiedBeds;\r\n      items.push(\r\n        <div key={i} className=\"w-5 h-3 rounded-sm border\" style={{ backgroundColor: getOccupancyColor(filled ? 'occupied' : 'empty'), borderColor: getOccupancyColor(filled ? 'occupied' : 'empty') }} title={filled ? 'مشغول' : 'فارغ'} />\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"flex flex-wrap gap-1\" aria-label={`الأسِرّة: ${occupiedBeds}/${capacity}`}>\r\n        {items}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const hasResv = !!resv;\r\n  const statusLabel = getRoomStatusLabelAr(room.status);\r\n\r\n  return (\r\n    <div\r\n      onDragOver={handleDragOver}\r\n      onDrop={handleDrop}\r\n      className={`rounded-md shadow-sm border overflow-hidden text-xs transition-colors duration-150 ${\r\n        hasResv ? 'bg-white border-gray-200' : 'bg-emerald-50 border-emerald-100'\r\n      }`}\r\n      dir=\"rtl\"\r\n    >\r\n      <StatusStrip status={room.status} />\r\n      <div className=\"p-2\">\r\n        <div className=\"flex items-center justify-between mb-1\">\r\n          <div className=\"font-semibold text-gray-800 text-sm\" title=\"الغرفة\">{room.room_code || room.room_label}</div>\r\n          <div className=\"flex items-center gap-1 text-[11px] text-gray-500\" title=\"النوع والحالة\">\r\n            <span className=\"truncate max-w-[80px]\">{room.room_type_name_ar || room.room_type_name}</span>\r\n            <span\r\n              className=\"px-1.5 py-0.5 rounded-full text-[10px] text-white\"\r\n              style={{ backgroundColor: getRoomStatusColor(room.status) }}\r\n            >\r\n              {statusLabel}\r\n            </span>\r\n          </div>\r\n        </div>\r\n            <div className=\"flex items-center justify_between mb-1 text-[11px] text-gray-600\">\r\n          <div className=\"truncate max-w-[55%]\">{room.floor_name} – {room.building_name}</div>\r\n          <CleanBadge value={room.cleanliness} />\r\n        </div>\r\n        <div className=\"mb-2\">\r\n          <Beds />\r\n        </div>\r\n        {resv ? (\r\n          <div\r\n            draggable\r\n            onDragStart={(e)=>{\r\n              e.dataTransfer.setData('application/json', JSON.stringify({\r\n                id: resv.id,\r\n                room_id: resv.room_id,\r\n                check_in_date: resv.check_in_date,\r\n                check_out_date: resv.check_out_date\r\n              }));\r\n            }}\r\n            className=\"px-2 py-1 rounded text-[11px] bg-blue-50 border border-blue-200 text-blue-700 cursor-grab\"\r\n            title={`النزيل: ${resv.guest_name || '—'}`}\r\n          >\r\n            <div className=\"flex items-center justify-between gap-2\">\r\n              <span className=\"truncate\">{resv.guest_name || 'نزيل'}</span>\r\n              <span className=\"text-[10px] text-gray-500\">{occupiedBeds}/{capacity}</span>\r\n            </div>\r\n            {resv.payer_type === 'agency' && resv.agency_name && (\r\n              <div className=\"mt-0.5\" title={`شركة/جهة: ${resv.agency_name}`}>\r\n                <span className=\"inline-flex max-w-full items-center px-2 py-0.5 rounded-full border border-emerald-300 bg-emerald-50 text-emerald-800 text-[9px] font-semibold truncate\">\r\n                  <span className=\"mr-1\">شركة</span>\r\n                  <span className=\"truncate\">{resv.agency_name}</span>\r\n                </span>\r\n              </div>\r\n            )}\r\n            <div className=\"text-[10px] text-gray-500 mt-0.5\">من {resv.check_in_date} إلى {resv.check_out_date}</div>\r\n            <button\r\n              type=\"button\"\r\n              className=\"mt-1 text-[11px] text-blue-600 hover:text-blue-700 underline\"\r\n              onClick={()=>setShowDetails(v=>!v)}\r\n            >\r\n              {showDetails ? 'إخفاء تفاصيل الضيوف' : 'إظهار تفاصيل الضيوف والأسِرّة'}\r\n            </button>\r\n            {/* Reservation guests panel (collapsible) */}\r\n            {showDetails && (\r\n              <div className=\"mt-1 p-1.5 bg-gray-50 border border-gray-200 rounded\">\r\n                <div className=\"text-[11px] font-semibold mb-1\">ضيوف الحجز</div>\r\n                {loadingGuests ? (\r\n                  <div className=\"text-[11px] text-gray-500\">جاري التحميل...</div>\r\n                ) : (\r\n                  <div className=\"flex flex-wrap gap-1.5 mb-2\">\r\n                    {resGuests.length === 0 ? (\r\n                      <span className=\"text-[11px] text-gray-500\">لا يوجد ضيوف إضافيون.</span>\r\n                    ) : resGuests.map(g => (\r\n                      <label key={g.reservation_guest_id} className={`px-2 py-0.5 rounded border text-[11px] cursor-pointer ${selectedGuestId===g.guest_id ? 'bg-amber-50 border-amber-300 text-amber-800' : 'bg-white border-gray-300 text-gray-700'}`}>\r\n                        <input type=\"radio\" name={`sel-${resv.id}`} className=\"mr-1\" checked={selectedGuestId===g.guest_id} onChange={()=>setSelectedGuestId(g.guest_id)} />\r\n                        {g.full_name}\r\n                      </label>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                <div className=\"flex items-center gap-1.5\">\r\n                  <input value={guestSearch} onChange={(e)=>setGuestSearch(e.target.value)} className=\"border rounded px-2 py-0.5 text-[11px] flex-1\" placeholder=\"بحث: الاسم/الهاتف/البريد\" />\r\n                  {guestResults.length > 0 && (\r\n                    <div className=\"absolute mt-8 bg-white border rounded shadow p-2 text-[11px] max-h-36 overflow-auto z-10\">\r\n                      {guestResults.map(gr => (\r\n                        <div key={gr.id} className=\"px-2 py-1 hover:bg-gray-100 cursor-pointer\" onClick={()=>addGuestToReservation(gr.id)}>\r\n                          {gr.full_name} <span className=\"text-gray-500\">({gr.phone || gr.email || gr.id.slice(0,8)})</span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"mt-1 text-[10px] text-gray-500\">اختر ضيفًا، ثم اضغط على سرير فارغ لإسناده.</div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-xs text-gray-400\">لا يوجد حجز في هذا التاريخ</div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Tashkeen({ selectedDate, onDateChange, searchQuery = '', refreshTick = 0 }) {\r\n  const currentUser = useContext(AuthContext);\r\n  const [date, setDate] = useState(() => new Date().toISOString().slice(0,10));\r\n  const [rooms, setRooms] = useState([]);\r\n  const [resvs, setResvs] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filterBuilding, setFilterBuilding] = useState('all');\r\n  const [filterFloor, setFilterFloor] = useState('all');\r\n  const [filterStatus, setFilterStatus] = useState('all');\r\n  const [editingResv, setEditingResv] = useState(null);\r\n\r\n  const loadRooms = useCallback(async () => {\r\n    // محاولة أولى: عرض rooms_overview إن وُجد\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('rooms_overview')\r\n        .select('id, room_code, room_label, status, cleanliness, max_guests, room_type_name_ar, room_type_name, building_id, building_name, floor_id, floor_name')\r\n        .order('room_code');\r\n      if (error) throw error;\r\n      if (data && data.length > 0) {\r\n        setRooms(data);\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      console.warn('rooms_overview unavailable, falling back to base tables:', e?.message || e);\r\n    }\r\n\r\n    // بديل: الجداول الأساسية + عمليات إغناء عميلًا\r\n    try {\r\n      const [roomsRes, typesRes, buildingsRes, floorsRes] = await Promise.all([\r\n        supabase.from('rooms').select('id, room_code, status, cleanliness, room_type_id, building_id, floor_id').order('room_code'),\r\n        supabase.from('room_types_active').select('id, name, name_ar, max_guests').order('display_order'),\r\n        supabase.from('buildings').select('id, name').order('name'),\r\n        supabase.from('floors').select('id, name, floor_number, number, building_id').order('id'),\r\n      ]);\r\n\r\n      // لو فشل room_types_active جرّب room_types العادية\r\n      let types = typesRes.data || [];\r\n      if (typesRes.error || types.length === 0) {\r\n        try {\r\n          const alt = await supabase.from('room_types').select('id, name, name_ar, max_guests').order('id');\r\n          if (!alt.error) types = alt.data || [];\r\n        } catch (_) {}\r\n      }\r\n\r\n      const typeMap = new Map();\r\n      types.forEach(t => typeMap.set(String(t.id), t));\r\n      const bMap = new Map();\r\n      (buildingsRes.data || []).forEach(b => bMap.set(String(b.id), b));\r\n      const fMap = new Map();\r\n      (floorsRes.data || []).forEach(f => fMap.set(String(f.id), f));\r\n\r\n      const enriched = (roomsRes.data || []).map(r => {\r\n        const t = typeMap.get(String(r.room_type_id));\r\n        const b = bMap.get(String(r.building_id));\r\n        const f = fMap.get(String(r.floor_id));\r\n        const room_label = r.room_code || (r.id ? `غرفة #${String(r.id).slice(0,8)}` : 'غرفة');\r\n        const building_name = b?.name || 'مبنى';\r\n        const floor_name = f?.name || (f?.floor_number ? `الطابق ${f.floor_number}` : (f?.number ? `الطابق ${f.number}` : 'طابق'));\r\n        return {\r\n          id: r.id,\r\n          room_code: r.room_code,\r\n          room_label,\r\n          status: r.status,\r\n          cleanliness: r.cleanliness,\r\n          max_guests: t?.max_guests || 0,\r\n          room_type_name_ar: t?.name_ar,\r\n          room_type_name: t?.name,\r\n          building_id: r.building_id,\r\n          building_name,\r\n          floor_id: r.floor_id,\r\n          floor_name,\r\n        };\r\n      });\r\n      setRooms(enriched);\r\n    } catch (e2) {\r\n      console.error('Fallback loadRooms failed', e2);\r\n      setRooms([]);\r\n    }\r\n  }, []);\r\n\r\n  const loadResvsForDate = useCallback(async (d) => {\r\n    try {\r\n      // الحجز الذي يغطي اليوم d: check_in <= d AND check_out > d (يوم الخروج متاح لحجز جديد)\r\n      const { data, error } = await supabase\r\n        .from('reservations')\r\n        .select('id, room_id, guest_id, guests_count, status, check_in_date, check_out_date, nightly_rate, total_amount, amount_paid, currency, payment_method, payer_type, agency_name, special_requests, notes, guests(full_name)')\r\n        .in('status', ['pending','confirmed','checked_in'])\r\n        .lte('check_in_date', d)\r\n        .gt('check_out_date', d);\r\n      if (error) throw error;\r\n      const mapped = (data || []).map(r => ({\r\n        id: r.id,\r\n        room_id: r.room_id,\r\n        guest_id: r.guest_id,\r\n        guests_count: r.guests_count,\r\n        status: r.status,\r\n        check_in_date: r.check_in_date,\r\n        check_out_date: r.check_out_date,\r\n        nightly_rate: r.nightly_rate,\r\n        total_amount: r.total_amount,\r\n        amount_paid: r.amount_paid,\r\n        currency: r.currency,\r\n        payment_method: r.payment_method,\r\n        payer_type: r.payer_type,\r\n        agency_name: r.agency_name,\r\n        special_requests: r.special_requests,\r\n        notes: r.notes,\r\n        guest_name: (r.guests && r.guests.full_name) ? r.guests.full_name : undefined,\r\n      }));\r\n      setResvs(mapped);\r\n    } catch (e) {\r\n      console.error('loadResvsForDate failed', e);\r\n      setResvs([]);\r\n    }\r\n  }, []);\r\n\r\n  const reloadAll = useCallback(async () => {\r\n    setLoading(true);\r\n    await Promise.all([loadRooms(), loadResvsForDate(date)]);\r\n    setLoading(false);\r\n  }, [date, loadRooms, loadResvsForDate]);\r\n\r\n  useEffect(() => { reloadAll(); }, [reloadAll]);\r\n\r\n  // Sync external date\r\n  useEffect(() => {\r\n    if (selectedDate && selectedDate !== date) {\r\n      setDate(selectedDate);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [selectedDate]);\r\n\r\n  // External refresh\r\n  useEffect(() => {\r\n    reloadAll();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [refreshTick]);\r\n\r\n  useEffect(() => {\r\n    const ch = supabase.channel('tashkeen-live')\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'reservations' }, () => { loadResvsForDate(date); })\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'rooms' }, () => { loadRooms(); })\r\n      .subscribe();\r\n    return () => { try { supabase.removeChannel(ch); } catch(_) {} };\r\n  }, [date, loadRooms, loadResvsForDate]);\r\n\r\n  const resvByRoom = useMemo(() => {\r\n    const m = new Map();\r\n    resvs.forEach(r => { m.set(String(r.room_id), r); });\r\n    return m;\r\n  }, [resvs]);\r\n\r\n  const filteredRooms = useMemo(() => {\r\n    let base = rooms;\r\n\r\n    // فلاتر المبنى / الدور / حالة الغرفة\r\n    if (filterBuilding !== 'all') {\r\n      base = base.filter(r => String(r.building_id || r.building_name || '') === filterBuilding);\r\n    }\r\n    if (filterFloor !== 'all') {\r\n      base = base.filter(r => String(r.floor_id || r.floor_name || '') === filterFloor);\r\n    }\r\n    if (filterStatus !== 'all') {\r\n      base = base.filter(r => String(r.status || '').toLowerCase() === filterStatus);\r\n    }\r\n\r\n    const term = (searchQuery || '').trim().toLowerCase();\r\n    if (!term) return base;\r\n    const resvByRoomLocal = new Map();\r\n    resvs.forEach(r => { resvByRoomLocal.set(String(r.room_id), r); });\r\n    return base.filter(r => {\r\n      const roomMatch = (r.room_code || r.room_label || '').toLowerCase().includes(term);\r\n      const rv = resvByRoomLocal.get(String(r.id));\r\n      const guestMatch = rv ? ((rv.guest_name || '').toLowerCase().includes(term)) : false;\r\n      return roomMatch || guestMatch;\r\n    });\r\n  }, [rooms, resvs, searchQuery, filterBuilding, filterFloor, filterStatus]);\r\n\r\n  const buildingOptions = useMemo(() => {\r\n    const m = new Map();\r\n    rooms.forEach(r => {\r\n      const key = String(r.building_id || r.building_name || '');\r\n      if (!key) return;\r\n      if (!m.has(key)) m.set(key, r.building_name || 'مبنى');\r\n    });\r\n    return Array.from(m.entries()).map(([value, label]) => ({ value, label }));\r\n  }, [rooms]);\r\n\r\n  const floorOptions = useMemo(() => {\r\n    const m = new Map();\r\n    rooms.forEach(r => {\r\n      const key = String(r.floor_id || r.floor_name || '');\r\n      if (!key) return;\r\n      if (!m.has(key)) m.set(key, r.floor_name || 'طابق');\r\n    });\r\n    return Array.from(m.entries()).map(([value, label]) => ({ value, label }));\r\n  }, [rooms]);\r\n\r\n  const stats = useMemo(() => {\r\n    const totalRooms = rooms.length;\r\n    const roomsWithResv = new Set(resvs.map(r => String(r.room_id))).size;\r\n    const totalBeds = rooms.reduce((sum, r) => sum + Number(r.max_guests || 0), 0);\r\n    const occupiedBeds = resvs.reduce((sum, r) => sum + Number(r.guests_count || 0), 0);\r\n    const emptyBeds = Math.max(0, totalBeds - occupiedBeds);\r\n    return { totalRooms, roomsWithResv, totalBeds, occupiedBeds, emptyBeds };\r\n  }, [rooms, resvs]);\r\n\r\n  const handleOpenEdit = (roomId) => {\r\n    const r = resvs.find(x => String(x.room_id) === String(roomId));\r\n    if (!r) return;\r\n    setEditingResv(r);\r\n  };\r\n\r\n  const handleOpenCreate = (room) => {\r\n    if (!room) return;\r\n    setEditingResv({\r\n      id: null,\r\n      guest_id: null,\r\n      room_id: room.id,\r\n      check_in_date: date,\r\n      check_out_date: date,\r\n      guests_count: 1,\r\n      status: 'confirmed',\r\n      nightly_rate: null,\r\n      total_amount: null,\r\n      amount_paid: 0,\r\n      currency: 'EGP',\r\n      payment_method: 'cash',\r\n      payer_type: 'guest',\r\n      agency_name: '',\r\n      special_requests: '',\r\n      notes: '',\r\n      pending_guest_ids: [],\r\n    });\r\n  };\r\n\r\n  const handleSaveFromModal = async (payload) => {\r\n    try {\r\n      if (!payload) return;\r\n      const cleaned = { ...payload };\r\n      const pendingExtras = Array.isArray(cleaned.pending_guest_ids) ? cleaned.pending_guest_ids : [];\r\n      delete cleaned.pending_guest_ids;\r\n\r\n      if (editingResv && editingResv.id) {\r\n        const { error } = await supabase.from('reservations').update(cleaned).eq('id', editingResv.id);\r\n        if (error) throw error;\r\n        // إلحاق ضيوف إضافيين إن وُجدوا\r\n        if (editingResv.id && pendingExtras.length > 0) {\r\n          for (const gid of pendingExtras) {\r\n            try { await supabase.rpc('add_reservation_guest', { p_reservation_id: editingResv.id, p_guest_id: gid, p_role: 'additional' }); } catch(_) {}\r\n          }\r\n        }\r\n      } else {\r\n        const { data, error } = await supabase.from('reservations').insert([cleaned]).select('id').single();\r\n        if (error) throw error;\r\n        const newId = data?.id;\r\n        if (newId && pendingExtras.length > 0) {\r\n          for (const gid of pendingExtras) {\r\n            try { await supabase.rpc('add_reservation_guest', { p_reservation_id: newId, p_guest_id: gid, p_role: 'additional' }); } catch(_) {}\r\n          }\r\n        }\r\n      }\r\n\r\n      await loadResvsForDate(date);\r\n      setEditingResv(null);\r\n    } catch (e) {\r\n      console.error('Failed to save reservation from Tashkeen', e);\r\n      const msg = String(e?.message || e || '').toLowerCase();\r\n      let userMsg = 'تعذّر حفظ الحجز.';\r\n      if (msg.includes('overlapping reservation')) userMsg = 'تعذّر الحفظ: هناك تعارض في التواريخ مع حجز آخر لنفس الغرفة.';\r\n      else if (msg.includes('check_out_date must be after check_in_date')) userMsg = 'تعذّر الحفظ: تاريخ الخروج يجب أن يكون بعد تاريخ الدخول.';\r\n      else if (msg.includes('row-level security')) userMsg = 'تعذّر الحفظ: لا تملك الصلاحية لحفظ الحجز (RLS).';\r\n      else if (msg.includes('not-null')) userMsg = 'تعذّر الحفظ: بعض الحقول المطلوبة غير مكتملة.';\r\n      else if (msg.includes('invalid input syntax')) userMsg = 'تعذّر الحفظ: مشكلة في صيغة البيانات المدخلة.';\r\n      window.alert(userMsg);\r\n    }\r\n  };\r\n\r\n  const groups = useMemo(() => {\r\n    // تجميع حسب المبنى ثم الطابق\r\n    const byBuilding = new Map();\r\n    filteredRooms.forEach(r => {\r\n      const bKey = String(r.building_id || r.building_name || '—');\r\n      const fKey = String(r.floor_id || r.floor_name || '—');\r\n      if (!byBuilding.has(bKey)) byBuilding.set(bKey, { label: r.building_name || 'مبنى', floors: new Map() });\r\n      const bObj = byBuilding.get(bKey);\r\n      if (!bObj.floors.has(fKey)) bObj.floors.set(fKey, { label: r.floor_name || 'طابق', rooms: [] });\r\n      bObj.floors.get(fKey).rooms.push(r);\r\n    });\r\n    // تحويل إلى مصفوفة قابلة للعرض\r\n    return Array.from(byBuilding.values()).map(b => ({\r\n      label: b.label,\r\n      floors: Array.from(b.floors.values()).map(f => ({ label: f.label, rooms: f.rooms }))\r\n    }));\r\n  }, [filteredRooms]);\r\n\r\n  const onDropReservation = async (payload, targetRoom) => {\r\n    try {\r\n      const targetRes = resvByRoom.get(String(targetRoom.id));\r\n      const staffId = currentUser && currentUser.id ? currentUser.id : null;\r\n\r\n      // إذا كانت الغرفة المستهدفة بها حجز آخر لنفس اليوم، اعرض خيار تبديل الغرف بين الحجزين\r\n      if (targetRes && String(targetRes.id) !== String(payload.id)) {\r\n        const okSwap = window.confirm(\r\n          `الغرفة ${targetRoom.room_code || targetRoom.room_label} تحتوي على حجز آخر في هذا اليوم.\\n` +\r\n          'هل تريد تبديل الغرف بين الحجزين مع الاحتفاظ بنفس التواريخ؟'\r\n        );\r\n        if (!okSwap) return;\r\n\r\n        const { error: swapError } = await supabase.rpc('swap_room_reservations', {\r\n          p_reservation_id1: payload.id,\r\n          p_reservation_id2: targetRes.id,\r\n          p_staff_user_id: staffId,\r\n        });\r\n        if (swapError) throw swapError;\r\n        await loadResvsForDate(date);\r\n        window.alert('تم تبديل الغرف بين الحجوزات بنجاح.');\r\n        return;\r\n      }\r\n\r\n      // في حالة عدم وجود حجز في الغرفة المستهدفة: نقل عادي لنفس التواريخ\r\n      const ok = window.confirm(`نقل الحجز إلى ${targetRoom.room_code || targetRoom.room_label} لنفس التواريخ؟`);\r\n      if (!ok) return;\r\n      const { error } = await supabase.rpc('move_reservation', {\r\n        p_reservation_id: payload.id,\r\n        p_new_room_id: targetRoom.id,\r\n        p_new_check_in: payload.check_in_date,\r\n        p_new_check_out: payload.check_out_date,\r\n      });\r\n      if (error) throw error;\r\n      await loadResvsForDate(date);\r\n      window.alert('تم نقل الحجز بنجاح.');\r\n    } catch (e) {\r\n      console.error('move failed', e);\r\n      window.alert('تعذّر نقل الحجز: ' + (e.message || e));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6\" dir=\"rtl\">\r\n      <div className=\"mb-6 bg-white rounded-lg shadow border border-gray-200\">\r\n        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-3 px-4 pt-4 pb-3\">\r\n          <div>\r\n            <h2 className=\"text-xl md:text-2xl font-bold mb-1\">التسكين (عرض إشغال الأسِرّة)</h2>\r\n            <p className=\"text-sm text-gray-500\">عرض بصري لسعة الغرف وعدد الأسِرّة المشغولة في التاريخ المحدد، مع إمكانية توزيع الضيوف على الأسِرّة بسهولة.</p>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              type=\"date\"\r\n              className=\"border rounded px-3 py-2 text-sm\"\r\n              value={date}\r\n              onChange={(e)=>{ setDate(e.target.value); onDateChange && onDateChange(e.target.value); }}\r\n              title=\"اختر التاريخ\"\r\n            />\r\n            <button\r\n              className=\"border rounded px-3 py-2 bg-white hover:bg-gray-50 text-sm\"\r\n              onClick={()=>{ const t = new Date().toISOString().slice(0,10); setDate(t); onDateChange && onDateChange(t); }}\r\n            >\r\n              اليوم\r\n            </button>\r\n          </div>\r\n        </div>\r\n        {/* شريط إحصائيات مختصر */}\r\n        <div className=\"px-4 pb-3 border-t border-gray-100 bg-slate-50/80\">\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 text-xs md:text-sm text-gray-700 mt-3\">\r\n            <div className=\"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\">\r\n              <span className=\"text-[11px] text-gray-500\">إجمالي الغرف</span>\r\n              <span className=\"text-base font-semibold\">{stats.totalRooms}</span>\r\n            </div>\r\n            <div className=\"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\">\r\n              <span className=\"text-[11px] text-gray-500\">غرف بها حجز اليوم</span>\r\n              <span className=\"text-base font-semibold\">{stats.roomsWithResv}</span>\r\n            </div>\r\n            <div className=\"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\">\r\n              <span className=\"text-[11px] text-gray-500\">إجمالي الأسِرّة</span>\r\n              <span className=\"text-base font-semibold\">{stats.totalBeds}</span>\r\n            </div>\r\n            <div className=\"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\">\r\n              <span className=\"text-[11px] text-gray-500\">أسِرّة مشغولة</span>\r\n              <span className=\"text-base font-semibold text-blue-700\">{stats.occupiedBeds}</span>\r\n            </div>\r\n            <div className=\"bg-white rounded border border-gray-200 px-3 py-2 flex flex-col\">\r\n              <span className=\"text-[11px] text-gray-500\">أسِرّة فارغة تقريبًا</span>\r\n              <span className=\"text-base font-semibold text-emerald-700\">{stats.emptyBeds}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"px-4 pb-4 border-t border-gray-100 bg-slate-50/60\">\r\n          {/* فلاتر سريعة */}\r\n          <div className=\"mt-3 flex flex-wrap items-center gap-3 text-xs sm:text-sm\">\r\n            <div className=\"flex items-center gap-1\">\r\n              <span className=\"text-gray-600\">المبنى:</span>\r\n              <select\r\n                className=\"border rounded px-2 py-1 text-xs sm:text-sm\"\r\n                value={filterBuilding}\r\n                onChange={(e)=>{ setFilterBuilding(e.target.value); setFilterFloor('all'); }}\r\n              >\r\n                <option value=\"all\">الكل</option>\r\n                {buildingOptions.map(opt => (\r\n                  <option key={opt.value} value={opt.value}>{opt.label}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div className=\"flex items-center gap-1\">\r\n              <span className=\"text-gray-600\">الدور:</span>\r\n              <select\r\n                className=\"border rounded px-2 py-1 text-xs sm:text-sm\"\r\n                value={filterFloor}\r\n                onChange={(e)=>setFilterFloor(e.target.value)}\r\n              >\r\n                <option value=\"all\">الكل</option>\r\n                {floorOptions.map(opt => (\r\n                  <option key={opt.value} value={opt.value}>{opt.label}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div className=\"flex items-center gap-1\">\r\n              <span className=\"text-gray-600\">حالة الغرفة:</span>\r\n              <select\r\n                className=\"border rounded px-2 py-1 text-xs sm:text-sm\"\r\n                value={filterStatus}\r\n                onChange={(e)=>setFilterStatus(e.target.value)}\r\n              >\r\n                <option value=\"all\">الكل</option>\r\n                <option value=\"available\">متاحة</option>\r\n                <option value=\"reserved\">محجوزة</option>\r\n                <option value=\"occupied\">مشغولة</option>\r\n                <option value=\"maintenance\">صيانة</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-xs sm:text-sm text-blue-800 leading-relaxed\">\r\n            <div>- اسحب بطاقة النزيل من غرفة إلى أخرى لنقل الحجز لنفس المدة.</div>\r\n            <div>- كل مستطيل صغير يمثل سريرًا؛ الممتلئ يعني مشغول حسب عدد الضيوف في الحجز.</div>\r\n            <div>- يمكنك تغيير التاريخ من الأعلى لمشاهدة إشغال يوم معيّن.</div>\r\n            <div className=\"mt-2 text-[11px] sm:text-xs text-blue-900 flex flex-wrap items-center gap-4\">\r\n              <div className=\"flex items-center gap-2\"><span className=\"inline-block w-4 h-4 rounded\" style={{ backgroundColor: getOccupancyColor('occupied') }}></span> <span>سرير مشغول</span></div>\r\n              <div className=\"flex items-center gap-2\"><span className=\"inline-block w-4 h-4 rounded\" style={{ backgroundColor: getOccupancyColor('empty') }}></span> <span>سرير فارغ</span></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"text-gray-500\">جاري التحميل...</div>\r\n      ) : groups.length === 0 ? (\r\n        <div className=\"text-gray-500\">لا توجد غرف.</div>\r\n      ) : (\r\n        <div className=\"space-y-8\">\r\n          {groups.map((b, bi) => (\r\n            <div key={bi}>\r\n              <div className=\"text-lg font-bold text-gray-800 mb-3\">{b.label}</div>\r\n              <div className=\"space-y-5\">\r\n                {b.floors.map((f, fi) => (\r\n                  <div key={fi} className=\"border border-gray-200 rounded-lg bg-white/70\">\r\n                    <div className=\"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-gray-50\">\r\n                      <div className=\"text-sm font-semibold text-gray-700\">{f.label}</div>\r\n                      <div className=\"text-[11px] text-gray-500\">عدد الغرف: {f.rooms.length}</div>\r\n                    </div>\r\n                    <div className=\"px-3 py-3\">\r\n                      <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5\">\r\n                        {f.rooms.map((room) => {\r\n                          const hasResv = !!resvByRoom.get(String(room.id));\r\n                          return (\r\n                            <div key={room.id} className=\"relative group\">\r\n                              <RoomTile\r\n                                room={room}\r\n                                resv={resvByRoom.get(String(room.id))}\r\n                                date={date}\r\n                                onDropReservation={onDropReservation}\r\n                              />\r\n                              {hasResv ? (\r\n                                <button\r\n                                  type=\"button\"\r\n                                  className=\"absolute top-1 left-1 text-[10px] bg-white/90 border border-blue-300 text-blue-700 rounded px-1.5 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                  onClick={()=>handleOpenEdit(room.id)}\r\n                                >\r\n                                  تعديل الحجز\r\n                                </button>\r\n                              ) : (\r\n                                <button\r\n                                  type=\"button\"\r\n                                  className=\"absolute top-1 left-1 text-[10px] bg-white/90 border border-emerald-300 text-emerald-700 rounded px-1.5 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                  onClick={()=>handleOpenCreate(room)}\r\n                                >\r\n                                  حجز جديد\r\n                                </button>\r\n                              )}\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {editingResv && (\r\n        <ReservationModal\r\n          initialData={editingResv}\r\n          onClose={()=>setEditingResv(null)}\r\n          onSave={handleSaveFromModal}\r\n          onAfterAction={async ()=>{ await loadResvsForDate(date); }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,UAAU,QAAQ,OAAO;AACpF,SAASC,QAAQ,QAAQ,mBAAmB;AAC5C,SAASC,kBAAkB,EAAEC,oBAAoB,EAAEC,iBAAiB,QAAQ,iBAAiB;AAC7F,OAAOC,gBAAgB,MAAM,gCAAgC;AAC7D,SAASC,WAAW,QAAQ,YAAY;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAEzC,SAASC,WAAWA,CAAC;EAAEC;AAAO,CAAC,EAAE;EAC/B,MAAMC,KAAK,GAAGX,kBAAkB,CAACU,MAAM,CAAC;EACxC,oBAAOJ,OAAA;IAAKM,SAAS,EAAC,KAAK;IAACC,KAAK,EAAE;MAAEC,eAAe,EAAEH;IAAM;EAAE;IAAAI,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAE,CAAC;AACnE;AAACC,EAAA,GAHQV,WAAW;AAKpB,SAASW,UAAUA,CAAC;EAAEC;AAAM,CAAC,EAAE;EAC7B,MAAMC,GAAG,GAAG;IACVC,KAAK,EAAE;MAAEC,IAAI,EAAE,OAAO;MAAEC,GAAG,EAAE;IAA8B,CAAC;IAC5DC,WAAW,EAAE;MAAEF,IAAI,EAAE,YAAY;MAAEC,GAAG,EAAE;IAA8B,CAAC;IACvEE,cAAc,EAAE;MAAEH,IAAI,EAAE,aAAa;MAAEC,GAAG,EAAE;IAA0B;EACxE,CAAC;EACD,MAAMG,CAAC,GAAGN,GAAG,CAACD,KAAK,CAAC,IAAIC,GAAG,CAACC,KAAK;EACjC,oBAAOjB,OAAA;IAAMM,SAAS,EAAE,6BAA6BgB,CAAC,CAACH,GAAG,EAAG;IAAAI,QAAA,EAAED,CAAC,CAACJ;EAAI;IAAAT,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAO,CAAC;AAC/E;AAACY,GAAA,GARQV,UAAU;AAUnB,SAASW,QAAQA,CAAC;EAAEC,IAAI;EAAEC,IAAI;EAAEC,IAAI;EAAEC;AAAkB,CAAC,EAAE;EAAAC,EAAA;EACzD,MAAMC,QAAQ,GAAGC,MAAM,CAACN,IAAI,CAACO,UAAU,IAAIP,IAAI,CAACK,QAAQ,IAAI,CAAC,CAAC;EAC9D,MAAM,CAACG,IAAI,EAAEC,OAAO,CAAC,GAAG7C,QAAQ,CAAC,EAAE,CAAC;EACpC,MAAM,CAAC8C,WAAW,EAAEC,cAAc,CAAC,GAAG/C,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACgD,SAAS,EAAEC,YAAY,CAAC,GAAGjD,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAACkD,aAAa,EAAEC,gBAAgB,CAAC,GAAGnD,QAAQ,CAAC,KAAK,CAAC;EACzD,MAAM,CAACoD,eAAe,EAAEC,kBAAkB,CAAC,GAAGrD,QAAQ,CAAC,IAAI,CAAC;EAC5D,MAAM,CAACsD,WAAW,EAAEC,cAAc,CAAC,GAAGvD,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACwD,YAAY,EAAEC,eAAe,CAAC,GAAGzD,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAAC0D,WAAW,EAAEC,cAAc,CAAC,GAAG3D,QAAQ,CAAC,KAAK,CAAC;EAErD,MAAM4D,YAAY,GAAG7D,OAAO,CAAC,MAAM;IACjC,IAAI,CAACsC,IAAI,EAAE,OAAO,CAAC;IACnB,MAAMwB,EAAE,GAAGnB,MAAM,CAACL,IAAI,CAACyB,YAAY,IAAI,CAAC,CAAC;IACzC,OAAOC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAACJ,EAAE,EAAEpB,QAAQ,IAAI,CAAC,CAAC,CAAC;EACjD,CAAC,EAAE,CAACJ,IAAI,EAAEI,QAAQ,CAAC,CAAC;EAEpB,MAAMyB,QAAQ,GAAGjE,WAAW,CAAC,YAAY;IACvC,IAAI;MACF8C,cAAc,CAAC,IAAI,CAAC;MACpB,MAAM;QAAEoB,IAAI;QAAEC;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACkE,GAAG,CAAC,sBAAsB,EAAE;QAAEC,SAAS,EAAElC,IAAI,CAACmC,EAAE;QAAEC,MAAM,EAAElC;MAAK,CAAC,CAAC;MACxG,IAAI8B,KAAK,EAAE,MAAMA,KAAK;MACtBvB,OAAO,CAACsB,IAAI,IAAI,EAAE,CAAC;IACrB,CAAC,CAAC,OAAOM,CAAC,EAAE;MACVC,OAAO,CAACC,IAAI,CAAC,2DAA2D,EAAE,CAAAF,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEG,OAAO,KAAIH,CAAC,CAAC;MAC1F5B,OAAO,CAAC,EAAE,CAAC;IACb,CAAC,SAAS;MACRE,cAAc,CAAC,KAAK,CAAC;IACvB;EACF,CAAC,EAAE,CAACX,IAAI,CAACmC,EAAE,EAAEjC,IAAI,CAAC,CAAC;EAEnBxC,SAAS,CAAC,MAAM;IAAEoE,QAAQ,CAAC,CAAC;EAAE,CAAC,EAAE,CAACA,QAAQ,CAAC,CAAC;EAE5C,MAAMW,qBAAqB,GAAG5E,WAAW,CAAC,YAAY;IACpD,IAAI,CAACoC,IAAI,IAAI,CAACA,IAAI,CAACkC,EAAE,EAAE;MAAEtB,YAAY,CAAC,EAAE,CAAC;MAAE;IAAQ;IACnD,IAAI;MACFE,gBAAgB,CAAC,IAAI,CAAC;MACtB,MAAM;QAAEgB,IAAI;QAAEC;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACkE,GAAG,CAAC,yBAAyB,EAAE;QAAES,gBAAgB,EAAEzC,IAAI,CAACkC;MAAG,CAAC,CAAC;MACpG,IAAIH,KAAK,EAAE,MAAMA,KAAK;MACtBnB,YAAY,CAACkB,IAAI,IAAI,EAAE,CAAC;IAC1B,CAAC,CAAC,OAAOM,CAAC,EAAE;MACVC,OAAO,CAACC,IAAI,CAAC,gCAAgC,EAAE,CAAAF,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEG,OAAO,KAAIH,CAAC,CAAC;MAC/DxB,YAAY,CAAC,EAAE,CAAC;IAClB,CAAC,SAAS;MACRE,gBAAgB,CAAC,KAAK,CAAC;IACzB;EACF,CAAC,EAAE,CAACd,IAAI,CAAC,CAAC;EAEVvC,SAAS,CAAC,MAAM;IAAE+E,qBAAqB,CAAC,CAAC;EAAE,CAAC,EAAE,CAACA,qBAAqB,CAAC,CAAC;EAEtE/E,SAAS,CAAC,MAAM;IACd,MAAMiF,IAAI,GAAG,CAACzB,WAAW,IAAI,EAAE,EAAE0B,IAAI,CAAC,CAAC;IACvC,IAAI,CAACD,IAAI,EAAE;MAAEtB,eAAe,CAAC,EAAE,CAAC;MAAE;IAAQ;IAC1C,MAAMwB,CAAC,GAAGC,UAAU,CAAC,YAAY;MAC/B,IAAI;QACF,MAAM;UAAEf,IAAI;UAAEC;QAAM,CAAC,GAAG,MAAMjE,QAAQ,CACnCgF,IAAI,CAAC,QAAQ,CAAC,CACdC,MAAM,CAAC,6BAA6B,CAAC,CACrCC,EAAE,CAAC,oBAAoBN,IAAI,kBAAkBA,IAAI,kBAAkBA,IAAI,GAAG,CAAC,CAC3EO,KAAK,CAAC,EAAE,CAAC;QACZ,IAAIlB,KAAK,EAAE,MAAMA,KAAK;QACtBX,eAAe,CAACU,IAAI,IAAI,EAAE,CAAC;MAC7B,CAAC,CAAC,OAAOM,CAAC,EAAE;QACVC,OAAO,CAACC,IAAI,CAAC,qBAAqB,EAAE,CAAAF,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEG,OAAO,KAAIH,CAAC,CAAC;QACpDhB,eAAe,CAAC,EAAE,CAAC;MACrB;IACF,CAAC,EAAE,GAAG,CAAC;IACP,OAAO,MAAM8B,YAAY,CAACN,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC3B,WAAW,CAAC,CAAC;EAEjB,MAAMkC,oBAAoB,GAAG,MAAAA,CAAOC,GAAG,EAAEC,eAAe,GAAG,IAAI,KAAK;IAClE,IAAI;MACF,IAAI,CAACrD,IAAI,EAAE;MACX,MAAM;QAAE+B;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACkE,GAAG,CAAC,4BAA4B,EAAE;QACjES,gBAAgB,EAAEzC,IAAI,CAACkC,EAAE;QACzBoB,aAAa,EAAEF,GAAG,CAACG,MAAM;QACzBC,UAAU,EAAEH,eAAe,IAAItC,eAAe,IAAIf,IAAI,CAACyD,QAAQ,IAAI,IAAI;QACvEC,OAAO,EAAE1D,IAAI,CAAC2D,aAAa;QAC3BC,KAAK,EAAE5D,IAAI,CAAC6D;MACd,CAAC,CAAC;MACF,IAAI9B,KAAK,EAAE,MAAMA,KAAK;MACtB,MAAMF,QAAQ,CAAC,CAAC;MAChB,MAAMW,qBAAqB,CAAC,CAAC;IAC/B,CAAC,CAAC,OAAOJ,CAAC,EAAE;MACV0B,MAAM,CAACC,KAAK,CAAC,sBAAsB,IAAI3B,CAAC,CAACG,OAAO,IAAIH,CAAC,CAAC,CAAC;IACzD;EACF,CAAC;EAED,MAAM4B,WAAW,GAAG,MAAOC,YAAY,IAAK;IAC1C,IAAI;MACF,MAAM;QAAElC;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACkE,GAAG,CAAC,cAAc,EAAE;QAAEkC,eAAe,EAAED;MAAa,CAAC,CAAC;MACvF,IAAIlC,KAAK,EAAE,MAAMA,KAAK;MACtB,MAAMF,QAAQ,CAAC,CAAC;MAChB,MAAMW,qBAAqB,CAAC,CAAC;IAC/B,CAAC,CAAC,OAAOJ,CAAC,EAAE;MACV0B,MAAM,CAACC,KAAK,CAAC,4BAA4B,IAAI3B,CAAC,CAACG,OAAO,IAAIH,CAAC,CAAC,CAAC;IAC/D;EACF,CAAC;EAED,MAAM+B,qBAAqB,GAAG,MAAOC,OAAO,IAAK;IAC/C,IAAI;MACF,IAAI,CAACpE,IAAI,IAAI,CAACA,IAAI,CAACkC,EAAE,IAAI,CAACkC,OAAO,EAAE;MACnC,MAAM;QAAErC;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACkE,GAAG,CAAC,uBAAuB,EAAE;QAAES,gBAAgB,EAAEzC,IAAI,CAACkC,EAAE;QAAEsB,UAAU,EAAEY,OAAO;QAAEC,MAAM,EAAE;MAAa,CAAC,CAAC;MACvI,IAAItC,KAAK,EAAE,MAAMA,KAAK;MACtBf,kBAAkB,CAACoD,OAAO,CAAC;MAC3BlD,cAAc,CAAC,EAAE,CAAC;MAClBE,eAAe,CAAC,EAAE,CAAC;MACnB,MAAMoB,qBAAqB,CAAC,CAAC;MAC7B,MAAMX,QAAQ,CAAC,CAAC;MAChB,MAAMyC,KAAK,GAAG,CAAC/D,IAAI,IAAI,EAAE,EAAEgE,IAAI,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,aAAa,CAAC;MACtD,IAAIH,KAAK,EAAE;QACT,MAAMnB,oBAAoB,CAACmB,KAAK,EAAEF,OAAO,CAAC;MAC5C,CAAC,MAAM;QACLN,MAAM,CAACC,KAAK,CAAC,gDAAgD,CAAC;MAChE;IACF,CAAC,CAAC,OAAO3B,CAAC,EAAE;MACV0B,MAAM,CAACC,KAAK,CAAC,2BAA2B,IAAI3B,CAAC,CAACG,OAAO,IAAIH,CAAC,CAAC,CAAC;IAC9D;EACF,CAAC;EAED,MAAMsC,cAAc,GAAItC,CAAC,IAAK;IAC5BA,CAAC,CAACuC,cAAc,CAAC,CAAC;EACpB,CAAC;EACD,MAAMC,UAAU,GAAIxC,CAAC,IAAK;IACxBA,CAAC,CAACuC,cAAc,CAAC,CAAC;IAClB,IAAI;MACF,MAAME,OAAO,GAAGC,IAAI,CAACC,KAAK,CAAC3C,CAAC,CAAC4C,YAAY,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAAC;MACtE,IAAI,CAACJ,OAAO,IAAI,CAACA,OAAO,CAAC3C,EAAE,EAAE;MAC7B,IAAIgD,MAAM,CAACL,OAAO,CAACM,OAAO,CAAC,KAAKD,MAAM,CAACnF,IAAI,CAACmC,EAAE,CAAC,EAAE,OAAO,CAAC;MACzDhC,iBAAiB,IAAIA,iBAAiB,CAAC2E,OAAO,EAAE9E,IAAI,CAAC;IACvD,CAAC,CAAC,OAAOqF,CAAC,EAAE,CAAC;EACf,CAAC;EAED,MAAMC,IAAI,GAAGA,CAAA,KAAM;IACjB,IAAI9E,IAAI,CAAC+E,MAAM,GAAG,CAAC,EAAE;MACnB,oBACEjH,OAAA;QAAKM,SAAS,EAAC,sBAAsB;QAAC,cAAY,UAAW;QAAAiB,QAAA,EAC1DW,IAAI,CAAClB,GAAG,CAACmF,CAAC,IAAI;UACb,MAAMe,MAAM,GAAG,CAAC,CAACf,CAAC,CAACC,aAAa;UAChC,oBACEpG,OAAA;YAEEM,SAAS,EAAE,4DAA4D4G,MAAM,GAAG,0BAA0B,GAAG,0BAA0B,EAAG;YAC1I3G,KAAK,EAAE;cAAE4G,WAAW,EAAEvH,iBAAiB,CAACsH,MAAM,GAAG,UAAU,GAAG,OAAO;YAAE,CAAE;YACzEE,KAAK,EAAEF,MAAM,GAAG,UAAUf,CAAC,CAACkB,UAAU,IAAI,GAAG,EAAE,GAAG,MAAO;YAAA9F,QAAA,gBAEzDvB,OAAA;cAAQM,SAAS,EAAC,WAAW;cAACgH,OAAO,EAAEA,CAAA,KAAM;gBAAE,IAAI,CAACJ,MAAM,IAAIvF,IAAI,EAAEmD,oBAAoB,CAACqB,CAAC,CAAC;cAAE,CAAE;cAAA5E,QAAA,EAC5F4E,CAAC,CAACoB;YAAQ;cAAA9G,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACL,CAAC,EACRsG,MAAM,iBACLlH,OAAA,CAAAE,SAAA;cAAAqB,QAAA,gBACEvB,OAAA;gBAAAuB,QAAA,GAAM,SAAE,EAAC4E,CAAC,CAACkB,UAAU,IAAI,OAAO;cAAA;gBAAA5G,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAAC,eACxCZ,OAAA;gBAAQM,SAAS,EAAC,sCAAsC;gBAAC8G,KAAK,EAAC,gCAAO;gBAACE,OAAO,EAAEA,CAAA,KAAM3B,WAAW,CAACQ,CAAC,CAACC,aAAa,CAAE;gBAAA7E,QAAA,EAAC;cAAO;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC;YAAA,eACpI,CACH;UAAA,GAbIuF,CAAC,CAACjB,MAAM;YAAAzE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAcV,CAAC;QAEV,CAAC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC,CAAC;IAEV;IACA,MAAM4G,KAAK,GAAG,EAAE;IAChB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAI1F,QAAQ,IAAI,CAAC,CAAC,EAAE0F,CAAC,EAAE,EAAE;MACxC,MAAMP,MAAM,GAAGO,CAAC,GAAGvE,YAAY;MAC/BsE,KAAK,CAACE,IAAI,cACR1H,OAAA;QAAaM,SAAS,EAAC,2BAA2B;QAACC,KAAK,EAAE;UAAEC,eAAe,EAAEZ,iBAAiB,CAACsH,MAAM,GAAG,UAAU,GAAG,OAAO,CAAC;UAAEC,WAAW,EAAEvH,iBAAiB,CAACsH,MAAM,GAAG,UAAU,GAAG,OAAO;QAAE,CAAE;QAACE,KAAK,EAAEF,MAAM,GAAG,OAAO,GAAG;MAAO,GAAvNO,CAAC;QAAAhH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAwN,CACrO,CAAC;IACH;IACA,oBACEZ,OAAA;MAAKM,SAAS,EAAC,sBAAsB;MAAC,cAAY,aAAa4C,YAAY,IAAInB,QAAQ,EAAG;MAAAR,QAAA,EACvFiG;IAAK;MAAA/G,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC;EAEV,CAAC;EAED,MAAM+G,OAAO,GAAG,CAAC,CAAChG,IAAI;EACtB,MAAMiG,WAAW,GAAGjI,oBAAoB,CAAC+B,IAAI,CAACtB,MAAM,CAAC;EAErD,oBACEJ,OAAA;IACE6H,UAAU,EAAExB,cAAe;IAC3ByB,MAAM,EAAEvB,UAAW;IACnBjG,SAAS,EAAE,sFACTqH,OAAO,GAAG,0BAA0B,GAAG,kCAAkC,EACxE;IACHI,GAAG,EAAC,KAAK;IAAAxG,QAAA,gBAETvB,OAAA,CAACG,WAAW;MAACC,MAAM,EAAEsB,IAAI,CAACtB;IAAO;MAAAK,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACpCZ,OAAA;MAAKM,SAAS,EAAC,KAAK;MAAAiB,QAAA,gBAClBvB,OAAA;QAAKM,SAAS,EAAC,wCAAwC;QAAAiB,QAAA,gBACrDvB,OAAA;UAAKM,SAAS,EAAC,qCAAqC;UAAC8G,KAAK,EAAC,sCAAQ;UAAA7F,QAAA,EAAEG,IAAI,CAACsG,SAAS,IAAItG,IAAI,CAACuG;QAAU;UAAAxH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eAC7GZ,OAAA;UAAKM,SAAS,EAAC,mDAAmD;UAAC8G,KAAK,EAAC,2EAAe;UAAA7F,QAAA,gBACtFvB,OAAA;YAAMM,SAAS,EAAC,uBAAuB;YAAAiB,QAAA,EAAEG,IAAI,CAACwG,iBAAiB,IAAIxG,IAAI,CAACyG;UAAc;YAAA1H,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO,CAAC,eAC9FZ,OAAA;YACEM,SAAS,EAAC,mDAAmD;YAC7DC,KAAK,EAAE;cAAEC,eAAe,EAAEd,kBAAkB,CAACgC,IAAI,CAACtB,MAAM;YAAE,CAAE;YAAAmB,QAAA,EAE3DqG;UAAW;YAAAnH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACR,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACJ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eACFZ,OAAA;QAAKM,SAAS,EAAC,kEAAkE;QAAAiB,QAAA,gBACnFvB,OAAA;UAAKM,SAAS,EAAC,sBAAsB;UAAAiB,QAAA,GAAEG,IAAI,CAAC0G,UAAU,EAAC,UAAG,EAAC1G,IAAI,CAAC2G,aAAa;QAAA;UAAA5H,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eACpFZ,OAAA,CAACc,UAAU;UAACC,KAAK,EAAEW,IAAI,CAAC4G;QAAY;UAAA7H,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACpC,CAAC,eACNZ,OAAA;QAAKM,SAAS,EAAC,MAAM;QAAAiB,QAAA,eACnBvB,OAAA,CAACgH,IAAI;UAAAvG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CAAC,EACLe,IAAI,gBACH3B,OAAA;QACEuI,SAAS;QACTC,WAAW,EAAGzE,CAAC,IAAG;UAChBA,CAAC,CAAC4C,YAAY,CAAC8B,OAAO,CAAC,kBAAkB,EAAEhC,IAAI,CAACiC,SAAS,CAAC;YACxD7E,EAAE,EAAElC,IAAI,CAACkC,EAAE;YACXiD,OAAO,EAAEnF,IAAI,CAACmF,OAAO;YACrBxB,aAAa,EAAE3D,IAAI,CAAC2D,aAAa;YACjCE,cAAc,EAAE7D,IAAI,CAAC6D;UACvB,CAAC,CAAC,CAAC;QACL,CAAE;QACFlF,SAAS,EAAC,2FAA2F;QACrG8G,KAAK,EAAE,WAAWzF,IAAI,CAAC0F,UAAU,IAAI,GAAG,EAAG;QAAA9F,QAAA,gBAE3CvB,OAAA;UAAKM,SAAS,EAAC,yCAAyC;UAAAiB,QAAA,gBACtDvB,OAAA;YAAMM,SAAS,EAAC,UAAU;YAAAiB,QAAA,EAAEI,IAAI,CAAC0F,UAAU,IAAI;UAAM;YAAA5G,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO,CAAC,eAC7DZ,OAAA;YAAMM,SAAS,EAAC,2BAA2B;YAAAiB,QAAA,GAAE2B,YAAY,EAAC,GAAC,EAACnB,QAAQ;UAAA;YAAAtB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzE,CAAC,EACLe,IAAI,CAACgH,UAAU,KAAK,QAAQ,IAAIhH,IAAI,CAACiH,WAAW,iBAC/C5I,OAAA;UAAKM,SAAS,EAAC,QAAQ;UAAC8G,KAAK,EAAE,aAAazF,IAAI,CAACiH,WAAW,EAAG;UAAArH,QAAA,eAC7DvB,OAAA;YAAMM,SAAS,EAAC,yJAAyJ;YAAAiB,QAAA,gBACvKvB,OAAA;cAAMM,SAAS,EAAC,MAAM;cAAAiB,QAAA,EAAC;YAAI;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAClCZ,OAAA;cAAMM,SAAS,EAAC,UAAU;cAAAiB,QAAA,EAAEI,IAAI,CAACiH;YAAW;cAAAnI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAChD;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACJ,CACN,eACDZ,OAAA;UAAKM,SAAS,EAAC,kCAAkC;UAAAiB,QAAA,GAAC,eAAG,EAACI,IAAI,CAAC2D,aAAa,EAAC,sBAAK,EAAC3D,IAAI,CAAC6D,cAAc;QAAA;UAAA/E,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eACzGZ,OAAA;UACE6I,IAAI,EAAC,QAAQ;UACbvI,SAAS,EAAC,8DAA8D;UACxEgH,OAAO,EAAEA,CAAA,KAAIrE,cAAc,CAAC3B,CAAC,IAAE,CAACA,CAAC,CAAE;UAAAC,QAAA,EAElCyB,WAAW,GAAG,qBAAqB,GAAG;QAA+B;UAAAvC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAChE,CAAC,EAERoC,WAAW,iBACVhD,OAAA;UAAKM,SAAS,EAAC,sDAAsD;UAAAiB,QAAA,gBACnEvB,OAAA;YAAKM,SAAS,EAAC,gCAAgC;YAAAiB,QAAA,EAAC;UAAU;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,EAC/D4B,aAAa,gBACZxC,OAAA;YAAKM,SAAS,EAAC,2BAA2B;YAAAiB,QAAA,EAAC;UAAe;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,gBAEhEZ,OAAA;YAAKM,SAAS,EAAC,6BAA6B;YAAAiB,QAAA,EACzCe,SAAS,CAAC2E,MAAM,KAAK,CAAC,gBACrBjH,OAAA;cAAMM,SAAS,EAAC,2BAA2B;cAAAiB,QAAA,EAAC;YAAqB;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,GACtE0B,SAAS,CAACtB,GAAG,CAAC8H,CAAC,iBACjB9I,OAAA;cAAoCM,SAAS,EAAE,yDAAyDoC,eAAe,KAAGoG,CAAC,CAAC1D,QAAQ,GAAG,6CAA6C,GAAG,wCAAwC,EAAG;cAAA7D,QAAA,gBAChOvB,OAAA;gBAAO6I,IAAI,EAAC,OAAO;gBAACE,IAAI,EAAE,OAAOpH,IAAI,CAACkC,EAAE,EAAG;gBAACvD,SAAS,EAAC,MAAM;gBAAC0I,OAAO,EAAEtG,eAAe,KAAGoG,CAAC,CAAC1D,QAAS;gBAAC6D,QAAQ,EAAEA,CAAA,KAAItG,kBAAkB,CAACmG,CAAC,CAAC1D,QAAQ;cAAE;gBAAA3E,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,EACnJkI,CAAC,CAACI,SAAS;YAAA,GAFFJ,CAAC,CAACK,oBAAoB;cAAA1I,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAG3B,CACR;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CACN,eACDZ,OAAA;YAAKM,SAAS,EAAC,2BAA2B;YAAAiB,QAAA,gBACxCvB,OAAA;cAAOe,KAAK,EAAE6B,WAAY;cAACqG,QAAQ,EAAGlF,CAAC,IAAGlB,cAAc,CAACkB,CAAC,CAACqF,MAAM,CAACrI,KAAK,CAAE;cAACT,SAAS,EAAC,+CAA+C;cAAC+I,WAAW,EAAC;YAA0B;cAAA5I,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,EAC5KkC,YAAY,CAACmE,MAAM,GAAG,CAAC,iBACtBjH,OAAA;cAAKM,SAAS,EAAC,0FAA0F;cAAAiB,QAAA,EACtGuB,YAAY,CAAC9B,GAAG,CAACsI,EAAE,iBAClBtJ,OAAA;gBAAiBM,SAAS,EAAC,4CAA4C;gBAACgH,OAAO,EAAEA,CAAA,KAAIxB,qBAAqB,CAACwD,EAAE,CAACzF,EAAE,CAAE;gBAAAtC,QAAA,GAC/G+H,EAAE,CAACJ,SAAS,EAAC,GAAC,eAAAlJ,OAAA;kBAAMM,SAAS,EAAC,eAAe;kBAAAiB,QAAA,GAAC,GAAC,EAAC+H,EAAE,CAACC,KAAK,IAAID,EAAE,CAACE,KAAK,IAAIF,EAAE,CAACzF,EAAE,CAAC4F,KAAK,CAAC,CAAC,EAAC,CAAC,CAAC,EAAC,GAAC;gBAAA;kBAAAhJ,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAAC;cAAA,GAD1F0I,EAAE,CAACzF,EAAE;gBAAApD,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAEV,CACN;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACC,CACN;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACE,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,gCAAgC;YAAAiB,QAAA,EAAC;UAA0C;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7F,CACN;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC,gBAENZ,OAAA;QAAKM,SAAS,EAAC,uBAAuB;QAAAiB,QAAA,EAAC;MAA0B;QAAAd,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CACvE;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACkB,EAAA,CA1RQL,QAAQ;AAAAiI,GAAA,GAARjI,QAAQ;AA4RjB,eAAe,SAASkI,QAAQA,CAAC;EAAEC,YAAY;EAAEC,YAAY;EAAEC,WAAW,GAAG,EAAE;EAAEC,WAAW,GAAG;AAAE,CAAC,EAAE;EAAAC,GAAA;EAClG,MAAMC,WAAW,GAAGzK,UAAU,CAACM,WAAW,CAAC;EAC3C,MAAM,CAAC8B,IAAI,EAAEsI,OAAO,CAAC,GAAG5K,QAAQ,CAAC,MAAM,IAAI6K,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACX,KAAK,CAAC,CAAC,EAAC,EAAE,CAAC,CAAC;EAC5E,MAAM,CAACY,KAAK,EAAEC,QAAQ,CAAC,GAAGhL,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACiL,KAAK,EAAEC,QAAQ,CAAC,GAAGlL,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACmL,OAAO,EAAEC,UAAU,CAAC,GAAGpL,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACqL,cAAc,EAAEC,iBAAiB,CAAC,GAAGtL,QAAQ,CAAC,KAAK,CAAC;EAC3D,MAAM,CAACuL,WAAW,EAAEC,cAAc,CAAC,GAAGxL,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACyL,YAAY,EAAEC,eAAe,CAAC,GAAG1L,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAAC2L,WAAW,EAAEC,cAAc,CAAC,GAAG5L,QAAQ,CAAC,IAAI,CAAC;EAEpD,MAAM6L,SAAS,GAAG5L,WAAW,CAAC,YAAY;IACxC;IACA,IAAI;MACF,MAAM;QAAEkE,IAAI;QAAEC;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CACnCgF,IAAI,CAAC,gBAAgB,CAAC,CACtBC,MAAM,CAAC,iJAAiJ,CAAC,CACzJ0G,KAAK,CAAC,WAAW,CAAC;MACrB,IAAI1H,KAAK,EAAE,MAAMA,KAAK;MACtB,IAAID,IAAI,IAAIA,IAAI,CAACwD,MAAM,GAAG,CAAC,EAAE;QAC3BqD,QAAQ,CAAC7G,IAAI,CAAC;QACd;MACF;IACF,CAAC,CAAC,OAAOM,CAAC,EAAE;MACVC,OAAO,CAACC,IAAI,CAAC,0DAA0D,EAAE,CAAAF,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEG,OAAO,KAAIH,CAAC,CAAC;IAC3F;;IAEA;IACA,IAAI;MACF,MAAM,CAACsH,QAAQ,EAAEC,QAAQ,EAAEC,YAAY,EAAEC,SAAS,CAAC,GAAG,MAAMC,OAAO,CAACC,GAAG,CAAC,CACtEjM,QAAQ,CAACgF,IAAI,CAAC,OAAO,CAAC,CAACC,MAAM,CAAC,yEAAyE,CAAC,CAAC0G,KAAK,CAAC,WAAW,CAAC,EAC3H3L,QAAQ,CAACgF,IAAI,CAAC,mBAAmB,CAAC,CAACC,MAAM,CAAC,+BAA+B,CAAC,CAAC0G,KAAK,CAAC,eAAe,CAAC,EACjG3L,QAAQ,CAACgF,IAAI,CAAC,WAAW,CAAC,CAACC,MAAM,CAAC,UAAU,CAAC,CAAC0G,KAAK,CAAC,MAAM,CAAC,EAC3D3L,QAAQ,CAACgF,IAAI,CAAC,QAAQ,CAAC,CAACC,MAAM,CAAC,6CAA6C,CAAC,CAAC0G,KAAK,CAAC,IAAI,CAAC,CAC1F,CAAC;;MAEF;MACA,IAAIO,KAAK,GAAGL,QAAQ,CAAC7H,IAAI,IAAI,EAAE;MAC/B,IAAI6H,QAAQ,CAAC5H,KAAK,IAAIiI,KAAK,CAAC1E,MAAM,KAAK,CAAC,EAAE;QACxC,IAAI;UACF,MAAM2E,GAAG,GAAG,MAAMnM,QAAQ,CAACgF,IAAI,CAAC,YAAY,CAAC,CAACC,MAAM,CAAC,+BAA+B,CAAC,CAAC0G,KAAK,CAAC,IAAI,CAAC;UACjG,IAAI,CAACQ,GAAG,CAAClI,KAAK,EAAEiI,KAAK,GAAGC,GAAG,CAACnI,IAAI,IAAI,EAAE;QACxC,CAAC,CAAC,OAAOsD,CAAC,EAAE,CAAC;MACf;MAEA,MAAM8E,OAAO,GAAG,IAAIC,GAAG,CAAC,CAAC;MACzBH,KAAK,CAACI,OAAO,CAACxH,CAAC,IAAIsH,OAAO,CAACG,GAAG,CAACnF,MAAM,CAACtC,CAAC,CAACV,EAAE,CAAC,EAAEU,CAAC,CAAC,CAAC;MAChD,MAAM0H,IAAI,GAAG,IAAIH,GAAG,CAAC,CAAC;MACtB,CAACP,YAAY,CAAC9H,IAAI,IAAI,EAAE,EAAEsI,OAAO,CAAC5F,CAAC,IAAI8F,IAAI,CAACD,GAAG,CAACnF,MAAM,CAACV,CAAC,CAACtC,EAAE,CAAC,EAAEsC,CAAC,CAAC,CAAC;MACjE,MAAM+F,IAAI,GAAG,IAAIJ,GAAG,CAAC,CAAC;MACtB,CAACN,SAAS,CAAC/H,IAAI,IAAI,EAAE,EAAEsI,OAAO,CAACI,CAAC,IAAID,IAAI,CAACF,GAAG,CAACnF,MAAM,CAACsF,CAAC,CAACtI,EAAE,CAAC,EAAEsI,CAAC,CAAC,CAAC;MAE9D,MAAMC,QAAQ,GAAG,CAACf,QAAQ,CAAC5H,IAAI,IAAI,EAAE,EAAEzC,GAAG,CAACqL,CAAC,IAAI;QAC9C,MAAM9H,CAAC,GAAGsH,OAAO,CAACS,GAAG,CAACzF,MAAM,CAACwF,CAAC,CAACE,YAAY,CAAC,CAAC;QAC7C,MAAMpG,CAAC,GAAG8F,IAAI,CAACK,GAAG,CAACzF,MAAM,CAACwF,CAAC,CAACG,WAAW,CAAC,CAAC;QACzC,MAAML,CAAC,GAAGD,IAAI,CAACI,GAAG,CAACzF,MAAM,CAACwF,CAAC,CAACI,QAAQ,CAAC,CAAC;QACtC,MAAMxE,UAAU,GAAGoE,CAAC,CAACrE,SAAS,KAAKqE,CAAC,CAACxI,EAAE,GAAG,SAASgD,MAAM,CAACwF,CAAC,CAACxI,EAAE,CAAC,CAAC4F,KAAK,CAAC,CAAC,EAAC,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC;QACtF,MAAMpB,aAAa,GAAG,CAAAlC,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAE4C,IAAI,KAAI,MAAM;QACvC,MAAMX,UAAU,GAAG,CAAA+D,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEpD,IAAI,MAAKoD,CAAC,aAADA,CAAC,eAADA,CAAC,CAAEO,YAAY,GAAG,UAAUP,CAAC,CAACO,YAAY,EAAE,GAAIP,CAAC,aAADA,CAAC,eAADA,CAAC,CAAEQ,MAAM,GAAG,UAAUR,CAAC,CAACQ,MAAM,EAAE,GAAG,MAAO,CAAC;QAC1H,OAAO;UACL9I,EAAE,EAAEwI,CAAC,CAACxI,EAAE;UACRmE,SAAS,EAAEqE,CAAC,CAACrE,SAAS;UACtBC,UAAU;UACV7H,MAAM,EAAEiM,CAAC,CAACjM,MAAM;UAChBkI,WAAW,EAAE+D,CAAC,CAAC/D,WAAW;UAC1BrG,UAAU,EAAE,CAAAsC,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEtC,UAAU,KAAI,CAAC;UAC9BiG,iBAAiB,EAAE3D,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEqI,OAAO;UAC7BzE,cAAc,EAAE5D,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEwE,IAAI;UACvByD,WAAW,EAAEH,CAAC,CAACG,WAAW;UAC1BnE,aAAa;UACboE,QAAQ,EAAEJ,CAAC,CAACI,QAAQ;UACpBrE;QACF,CAAC;MACH,CAAC,CAAC;MACFkC,QAAQ,CAAC8B,QAAQ,CAAC;IACpB,CAAC,CAAC,OAAOS,EAAE,EAAE;MACX7I,OAAO,CAACN,KAAK,CAAC,2BAA2B,EAAEmJ,EAAE,CAAC;MAC9CvC,QAAQ,CAAC,EAAE,CAAC;IACd;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMwC,gBAAgB,GAAGvN,WAAW,CAAC,MAAOwN,CAAC,IAAK;IAChD,IAAI;MACF;MACA,MAAM;QAAEtJ,IAAI;QAAEC;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CACnCgF,IAAI,CAAC,cAAc,CAAC,CACpBC,MAAM,CAAC,oNAAoN,CAAC,CAC5NsI,EAAE,CAAC,QAAQ,EAAE,CAAC,SAAS,EAAC,WAAW,EAAC,YAAY,CAAC,CAAC,CAClDC,GAAG,CAAC,eAAe,EAAEF,CAAC,CAAC,CACvBG,EAAE,CAAC,gBAAgB,EAAEH,CAAC,CAAC;MAC1B,IAAIrJ,KAAK,EAAE,MAAMA,KAAK;MACtB,MAAMyJ,MAAM,GAAG,CAAC1J,IAAI,IAAI,EAAE,EAAEzC,GAAG,CAACqL,CAAC,KAAK;QACpCxI,EAAE,EAAEwI,CAAC,CAACxI,EAAE;QACRiD,OAAO,EAAEuF,CAAC,CAACvF,OAAO;QAClB1B,QAAQ,EAAEiH,CAAC,CAACjH,QAAQ;QACpBhC,YAAY,EAAEiJ,CAAC,CAACjJ,YAAY;QAC5BhD,MAAM,EAAEiM,CAAC,CAACjM,MAAM;QAChBkF,aAAa,EAAE+G,CAAC,CAAC/G,aAAa;QAC9BE,cAAc,EAAE6G,CAAC,CAAC7G,cAAc;QAChC4H,YAAY,EAAEf,CAAC,CAACe,YAAY;QAC5BC,YAAY,EAAEhB,CAAC,CAACgB,YAAY;QAC5BC,WAAW,EAAEjB,CAAC,CAACiB,WAAW;QAC1BC,QAAQ,EAAElB,CAAC,CAACkB,QAAQ;QACpBC,cAAc,EAAEnB,CAAC,CAACmB,cAAc;QAChC7E,UAAU,EAAE0D,CAAC,CAAC1D,UAAU;QACxBC,WAAW,EAAEyD,CAAC,CAACzD,WAAW;QAC1B6E,gBAAgB,EAAEpB,CAAC,CAACoB,gBAAgB;QACpCC,KAAK,EAAErB,CAAC,CAACqB,KAAK;QACdrG,UAAU,EAAGgF,CAAC,CAACsB,MAAM,IAAItB,CAAC,CAACsB,MAAM,CAACzE,SAAS,GAAImD,CAAC,CAACsB,MAAM,CAACzE,SAAS,GAAG0E;MACtE,CAAC,CAAC,CAAC;MACHpD,QAAQ,CAAC2C,MAAM,CAAC;IAClB,CAAC,CAAC,OAAOpJ,CAAC,EAAE;MACVC,OAAO,CAACN,KAAK,CAAC,yBAAyB,EAAEK,CAAC,CAAC;MAC3CyG,QAAQ,CAAC,EAAE,CAAC;IACd;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMqD,SAAS,GAAGtO,WAAW,CAAC,YAAY;IACxCmL,UAAU,CAAC,IAAI,CAAC;IAChB,MAAMe,OAAO,CAACC,GAAG,CAAC,CAACP,SAAS,CAAC,CAAC,EAAE2B,gBAAgB,CAAClL,IAAI,CAAC,CAAC,CAAC;IACxD8I,UAAU,CAAC,KAAK,CAAC;EACnB,CAAC,EAAE,CAAC9I,IAAI,EAAEuJ,SAAS,EAAE2B,gBAAgB,CAAC,CAAC;EAEvC1N,SAAS,CAAC,MAAM;IAAEyO,SAAS,CAAC,CAAC;EAAE,CAAC,EAAE,CAACA,SAAS,CAAC,CAAC;;EAE9C;EACAzO,SAAS,CAAC,MAAM;IACd,IAAIwK,YAAY,IAAIA,YAAY,KAAKhI,IAAI,EAAE;MACzCsI,OAAO,CAACN,YAAY,CAAC;IACvB;IACA;EACF,CAAC,EAAE,CAACA,YAAY,CAAC,CAAC;;EAElB;EACAxK,SAAS,CAAC,MAAM;IACdyO,SAAS,CAAC,CAAC;IACX;EACF,CAAC,EAAE,CAAC9D,WAAW,CAAC,CAAC;EAEjB3K,SAAS,CAAC,MAAM;IACd,MAAM0O,EAAE,GAAGrO,QAAQ,CAACsO,OAAO,CAAC,eAAe,CAAC,CACzCC,EAAE,CAAC,kBAAkB,EAAE;MAAEC,KAAK,EAAE,GAAG;MAAEC,MAAM,EAAE,QAAQ;MAAEC,KAAK,EAAE;IAAe,CAAC,EAAE,MAAM;MAAErB,gBAAgB,CAAClL,IAAI,CAAC;IAAE,CAAC,CAAC,CAClHoM,EAAE,CAAC,kBAAkB,EAAE;MAAEC,KAAK,EAAE,GAAG;MAAEC,MAAM,EAAE,QAAQ;MAAEC,KAAK,EAAE;IAAQ,CAAC,EAAE,MAAM;MAAEhD,SAAS,CAAC,CAAC;IAAE,CAAC,CAAC,CAChGiD,SAAS,CAAC,CAAC;IACd,OAAO,MAAM;MAAE,IAAI;QAAE3O,QAAQ,CAAC4O,aAAa,CAACP,EAAE,CAAC;MAAE,CAAC,CAAC,OAAM/G,CAAC,EAAE,CAAC;IAAE,CAAC;EAClE,CAAC,EAAE,CAACnF,IAAI,EAAEuJ,SAAS,EAAE2B,gBAAgB,CAAC,CAAC;EAEvC,MAAMwB,UAAU,GAAGjP,OAAO,CAAC,MAAM;IAC/B,MAAMkP,CAAC,GAAG,IAAIzC,GAAG,CAAC,CAAC;IACnBvB,KAAK,CAACwB,OAAO,CAACM,CAAC,IAAI;MAAEkC,CAAC,CAACvC,GAAG,CAACnF,MAAM,CAACwF,CAAC,CAACvF,OAAO,CAAC,EAAEuF,CAAC,CAAC;IAAE,CAAC,CAAC;IACpD,OAAOkC,CAAC;EACV,CAAC,EAAE,CAAChE,KAAK,CAAC,CAAC;EAEX,MAAMiE,aAAa,GAAGnP,OAAO,CAAC,MAAM;IAClC,IAAIoP,IAAI,GAAGpE,KAAK;;IAEhB;IACA,IAAIM,cAAc,KAAK,KAAK,EAAE;MAC5B8D,IAAI,GAAGA,IAAI,CAACC,MAAM,CAACrC,CAAC,IAAIxF,MAAM,CAACwF,CAAC,CAACG,WAAW,IAAIH,CAAC,CAAChE,aAAa,IAAI,EAAE,CAAC,KAAKsC,cAAc,CAAC;IAC5F;IACA,IAAIE,WAAW,KAAK,KAAK,EAAE;MACzB4D,IAAI,GAAGA,IAAI,CAACC,MAAM,CAACrC,CAAC,IAAIxF,MAAM,CAACwF,CAAC,CAACI,QAAQ,IAAIJ,CAAC,CAACjE,UAAU,IAAI,EAAE,CAAC,KAAKyC,WAAW,CAAC;IACnF;IACA,IAAIE,YAAY,KAAK,KAAK,EAAE;MAC1B0D,IAAI,GAAGA,IAAI,CAACC,MAAM,CAACrC,CAAC,IAAIxF,MAAM,CAACwF,CAAC,CAACjM,MAAM,IAAI,EAAE,CAAC,CAACuO,WAAW,CAAC,CAAC,KAAK5D,YAAY,CAAC;IAChF;IAEA,MAAM1G,IAAI,GAAG,CAACyF,WAAW,IAAI,EAAE,EAAExF,IAAI,CAAC,CAAC,CAACqK,WAAW,CAAC,CAAC;IACrD,IAAI,CAACtK,IAAI,EAAE,OAAOoK,IAAI;IACtB,MAAMG,eAAe,GAAG,IAAI9C,GAAG,CAAC,CAAC;IACjCvB,KAAK,CAACwB,OAAO,CAACM,CAAC,IAAI;MAAEuC,eAAe,CAAC5C,GAAG,CAACnF,MAAM,CAACwF,CAAC,CAACvF,OAAO,CAAC,EAAEuF,CAAC,CAAC;IAAE,CAAC,CAAC;IAClE,OAAOoC,IAAI,CAACC,MAAM,CAACrC,CAAC,IAAI;MACtB,MAAMwC,SAAS,GAAG,CAACxC,CAAC,CAACrE,SAAS,IAAIqE,CAAC,CAACpE,UAAU,IAAI,EAAE,EAAE0G,WAAW,CAAC,CAAC,CAACG,QAAQ,CAACzK,IAAI,CAAC;MAClF,MAAM0K,EAAE,GAAGH,eAAe,CAACtC,GAAG,CAACzF,MAAM,CAACwF,CAAC,CAACxI,EAAE,CAAC,CAAC;MAC5C,MAAMmL,UAAU,GAAGD,EAAE,GAAI,CAACA,EAAE,CAAC1H,UAAU,IAAI,EAAE,EAAEsH,WAAW,CAAC,CAAC,CAACG,QAAQ,CAACzK,IAAI,CAAC,GAAI,KAAK;MACpF,OAAOwK,SAAS,IAAIG,UAAU;IAChC,CAAC,CAAC;EACJ,CAAC,EAAE,CAAC3E,KAAK,EAAEE,KAAK,EAAET,WAAW,EAAEa,cAAc,EAAEE,WAAW,EAAEE,YAAY,CAAC,CAAC;EAE1E,MAAMkE,eAAe,GAAG5P,OAAO,CAAC,MAAM;IACpC,MAAMkP,CAAC,GAAG,IAAIzC,GAAG,CAAC,CAAC;IACnBzB,KAAK,CAAC0B,OAAO,CAACM,CAAC,IAAI;MACjB,MAAM6C,GAAG,GAAGrI,MAAM,CAACwF,CAAC,CAACG,WAAW,IAAIH,CAAC,CAAChE,aAAa,IAAI,EAAE,CAAC;MAC1D,IAAI,CAAC6G,GAAG,EAAE;MACV,IAAI,CAACX,CAAC,CAACY,GAAG,CAACD,GAAG,CAAC,EAAEX,CAAC,CAACvC,GAAG,CAACkD,GAAG,EAAE7C,CAAC,CAAChE,aAAa,IAAI,MAAM,CAAC;IACxD,CAAC,CAAC;IACF,OAAO+G,KAAK,CAAC3K,IAAI,CAAC8J,CAAC,CAACc,OAAO,CAAC,CAAC,CAAC,CAACrO,GAAG,CAAC,CAAC,CAACD,KAAK,EAAEuO,KAAK,CAAC,MAAM;MAAEvO,KAAK;MAAEuO;IAAM,CAAC,CAAC,CAAC;EAC5E,CAAC,EAAE,CAACjF,KAAK,CAAC,CAAC;EAEX,MAAMkF,YAAY,GAAGlQ,OAAO,CAAC,MAAM;IACjC,MAAMkP,CAAC,GAAG,IAAIzC,GAAG,CAAC,CAAC;IACnBzB,KAAK,CAAC0B,OAAO,CAACM,CAAC,IAAI;MACjB,MAAM6C,GAAG,GAAGrI,MAAM,CAACwF,CAAC,CAACI,QAAQ,IAAIJ,CAAC,CAACjE,UAAU,IAAI,EAAE,CAAC;MACpD,IAAI,CAAC8G,GAAG,EAAE;MACV,IAAI,CAACX,CAAC,CAACY,GAAG,CAACD,GAAG,CAAC,EAAEX,CAAC,CAACvC,GAAG,CAACkD,GAAG,EAAE7C,CAAC,CAACjE,UAAU,IAAI,MAAM,CAAC;IACrD,CAAC,CAAC;IACF,OAAOgH,KAAK,CAAC3K,IAAI,CAAC8J,CAAC,CAACc,OAAO,CAAC,CAAC,CAAC,CAACrO,GAAG,CAAC,CAAC,CAACD,KAAK,EAAEuO,KAAK,CAAC,MAAM;MAAEvO,KAAK;MAAEuO;IAAM,CAAC,CAAC,CAAC;EAC5E,CAAC,EAAE,CAACjF,KAAK,CAAC,CAAC;EAEX,MAAMmF,KAAK,GAAGnQ,OAAO,CAAC,MAAM;IAC1B,MAAMoQ,UAAU,GAAGpF,KAAK,CAACpD,MAAM;IAC/B,MAAMyI,aAAa,GAAG,IAAIC,GAAG,CAACpF,KAAK,CAACvJ,GAAG,CAACqL,CAAC,IAAIxF,MAAM,CAACwF,CAAC,CAACvF,OAAO,CAAC,CAAC,CAAC,CAAC8I,IAAI;IACrE,MAAMC,SAAS,GAAGxF,KAAK,CAACyF,MAAM,CAAC,CAACC,GAAG,EAAE1D,CAAC,KAAK0D,GAAG,GAAG/N,MAAM,CAACqK,CAAC,CAACpK,UAAU,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;IAC9E,MAAMiB,YAAY,GAAGqH,KAAK,CAACuF,MAAM,CAAC,CAACC,GAAG,EAAE1D,CAAC,KAAK0D,GAAG,GAAG/N,MAAM,CAACqK,CAAC,CAACjJ,YAAY,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;IACnF,MAAM4M,SAAS,GAAG3M,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEuM,SAAS,GAAG3M,YAAY,CAAC;IACvD,OAAO;MAAEuM,UAAU;MAAEC,aAAa;MAAEG,SAAS;MAAE3M,YAAY;MAAE8M;IAAU,CAAC;EAC1E,CAAC,EAAE,CAAC3F,KAAK,EAAEE,KAAK,CAAC,CAAC;EAElB,MAAM0F,cAAc,GAAIC,MAAM,IAAK;IACjC,MAAM7D,CAAC,GAAG9B,KAAK,CAACrE,IAAI,CAACiK,CAAC,IAAItJ,MAAM,CAACsJ,CAAC,CAACrJ,OAAO,CAAC,KAAKD,MAAM,CAACqJ,MAAM,CAAC,CAAC;IAC/D,IAAI,CAAC7D,CAAC,EAAE;IACRnB,cAAc,CAACmB,CAAC,CAAC;EACnB,CAAC;EAED,MAAM+D,gBAAgB,GAAI1O,IAAI,IAAK;IACjC,IAAI,CAACA,IAAI,EAAE;IACXwJ,cAAc,CAAC;MACbrH,EAAE,EAAE,IAAI;MACRuB,QAAQ,EAAE,IAAI;MACd0B,OAAO,EAAEpF,IAAI,CAACmC,EAAE;MAChByB,aAAa,EAAE1D,IAAI;MACnB4D,cAAc,EAAE5D,IAAI;MACpBwB,YAAY,EAAE,CAAC;MACfhD,MAAM,EAAE,WAAW;MACnBgN,YAAY,EAAE,IAAI;MAClBC,YAAY,EAAE,IAAI;MAClBC,WAAW,EAAE,CAAC;MACdC,QAAQ,EAAE,KAAK;MACfC,cAAc,EAAE,MAAM;MACtB7E,UAAU,EAAE,OAAO;MACnBC,WAAW,EAAE,EAAE;MACf6E,gBAAgB,EAAE,EAAE;MACpBC,KAAK,EAAE,EAAE;MACT2C,iBAAiB,EAAE;IACrB,CAAC,CAAC;EACJ,CAAC;EAED,MAAMC,mBAAmB,GAAG,MAAO9J,OAAO,IAAK;IAC7C,IAAI;MACF,IAAI,CAACA,OAAO,EAAE;MACd,MAAM+J,OAAO,GAAG;QAAE,GAAG/J;MAAQ,CAAC;MAC9B,MAAMgK,aAAa,GAAGpB,KAAK,CAACqB,OAAO,CAACF,OAAO,CAACF,iBAAiB,CAAC,GAAGE,OAAO,CAACF,iBAAiB,GAAG,EAAE;MAC/F,OAAOE,OAAO,CAACF,iBAAiB;MAEhC,IAAIpF,WAAW,IAAIA,WAAW,CAACpH,EAAE,EAAE;QACjC,MAAM;UAAEH;QAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACgF,IAAI,CAAC,cAAc,CAAC,CAACiM,MAAM,CAACH,OAAO,CAAC,CAACI,EAAE,CAAC,IAAI,EAAE1F,WAAW,CAACpH,EAAE,CAAC;QAC9F,IAAIH,KAAK,EAAE,MAAMA,KAAK;QACtB;QACA,IAAIuH,WAAW,CAACpH,EAAE,IAAI2M,aAAa,CAACvJ,MAAM,GAAG,CAAC,EAAE;UAC9C,KAAK,MAAM2J,GAAG,IAAIJ,aAAa,EAAE;YAC/B,IAAI;cAAE,MAAM/Q,QAAQ,CAACkE,GAAG,CAAC,uBAAuB,EAAE;gBAAES,gBAAgB,EAAE6G,WAAW,CAACpH,EAAE;gBAAEsB,UAAU,EAAEyL,GAAG;gBAAE5K,MAAM,EAAE;cAAa,CAAC,CAAC;YAAE,CAAC,CAAC,OAAMe,CAAC,EAAE,CAAC;UAC9I;QACF;MACF,CAAC,MAAM;QACL,MAAM;UAAEtD,IAAI;UAAEC;QAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACgF,IAAI,CAAC,cAAc,CAAC,CAACoM,MAAM,CAAC,CAACN,OAAO,CAAC,CAAC,CAAC7L,MAAM,CAAC,IAAI,CAAC,CAACoM,MAAM,CAAC,CAAC;QACnG,IAAIpN,KAAK,EAAE,MAAMA,KAAK;QACtB,MAAMqN,KAAK,GAAGtN,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,EAAE;QACtB,IAAIkN,KAAK,IAAIP,aAAa,CAACvJ,MAAM,GAAG,CAAC,EAAE;UACrC,KAAK,MAAM2J,GAAG,IAAIJ,aAAa,EAAE;YAC/B,IAAI;cAAE,MAAM/Q,QAAQ,CAACkE,GAAG,CAAC,uBAAuB,EAAE;gBAAES,gBAAgB,EAAE2M,KAAK;gBAAE5L,UAAU,EAAEyL,GAAG;gBAAE5K,MAAM,EAAE;cAAa,CAAC,CAAC;YAAE,CAAC,CAAC,OAAMe,CAAC,EAAE,CAAC;UACrI;QACF;MACF;MAEA,MAAM+F,gBAAgB,CAAClL,IAAI,CAAC;MAC5BsJ,cAAc,CAAC,IAAI,CAAC;IACtB,CAAC,CAAC,OAAOnH,CAAC,EAAE;MACVC,OAAO,CAACN,KAAK,CAAC,0CAA0C,EAAEK,CAAC,CAAC;MAC5D,MAAMiN,GAAG,GAAGnK,MAAM,CAAC,CAAA9C,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEG,OAAO,KAAIH,CAAC,IAAI,EAAE,CAAC,CAAC4K,WAAW,CAAC,CAAC;MACvD,IAAIsC,OAAO,GAAG,kBAAkB;MAChC,IAAID,GAAG,CAAClC,QAAQ,CAAC,yBAAyB,CAAC,EAAEmC,OAAO,GAAG,6DAA6D,CAAC,KAChH,IAAID,GAAG,CAAClC,QAAQ,CAAC,4CAA4C,CAAC,EAAEmC,OAAO,GAAG,yDAAyD,CAAC,KACpI,IAAID,GAAG,CAAClC,QAAQ,CAAC,oBAAoB,CAAC,EAAEmC,OAAO,GAAG,iDAAiD,CAAC,KACpG,IAAID,GAAG,CAAClC,QAAQ,CAAC,UAAU,CAAC,EAAEmC,OAAO,GAAG,8CAA8C,CAAC,KACvF,IAAID,GAAG,CAAClC,QAAQ,CAAC,sBAAsB,CAAC,EAAEmC,OAAO,GAAG,8CAA8C;MACvGxL,MAAM,CAACC,KAAK,CAACuL,OAAO,CAAC;IACvB;EACF,CAAC;EAED,MAAMC,MAAM,GAAG7R,OAAO,CAAC,MAAM;IAC3B;IACA,MAAM8R,UAAU,GAAG,IAAIrF,GAAG,CAAC,CAAC;IAC5B0C,aAAa,CAACzC,OAAO,CAACM,CAAC,IAAI;MACzB,MAAM+E,IAAI,GAAGvK,MAAM,CAACwF,CAAC,CAACG,WAAW,IAAIH,CAAC,CAAChE,aAAa,IAAI,GAAG,CAAC;MAC5D,MAAMgJ,IAAI,GAAGxK,MAAM,CAACwF,CAAC,CAACI,QAAQ,IAAIJ,CAAC,CAACjE,UAAU,IAAI,GAAG,CAAC;MACtD,IAAI,CAAC+I,UAAU,CAAChC,GAAG,CAACiC,IAAI,CAAC,EAAED,UAAU,CAACnF,GAAG,CAACoF,IAAI,EAAE;QAAE9B,KAAK,EAAEjD,CAAC,CAAChE,aAAa,IAAI,MAAM;QAAEiJ,MAAM,EAAE,IAAIxF,GAAG,CAAC;MAAE,CAAC,CAAC;MACxG,MAAMyF,IAAI,GAAGJ,UAAU,CAAC7E,GAAG,CAAC8E,IAAI,CAAC;MACjC,IAAI,CAACG,IAAI,CAACD,MAAM,CAACnC,GAAG,CAACkC,IAAI,CAAC,EAAEE,IAAI,CAACD,MAAM,CAACtF,GAAG,CAACqF,IAAI,EAAE;QAAE/B,KAAK,EAAEjD,CAAC,CAACjE,UAAU,IAAI,MAAM;QAAEiC,KAAK,EAAE;MAAG,CAAC,CAAC;MAC/FkH,IAAI,CAACD,MAAM,CAAChF,GAAG,CAAC+E,IAAI,CAAC,CAAChH,KAAK,CAAC3C,IAAI,CAAC2E,CAAC,CAAC;IACrC,CAAC,CAAC;IACF;IACA,OAAO+C,KAAK,CAAC3K,IAAI,CAAC0M,UAAU,CAACK,MAAM,CAAC,CAAC,CAAC,CAACxQ,GAAG,CAACmF,CAAC,KAAK;MAC/CmJ,KAAK,EAAEnJ,CAAC,CAACmJ,KAAK;MACdgC,MAAM,EAAElC,KAAK,CAAC3K,IAAI,CAAC0B,CAAC,CAACmL,MAAM,CAACE,MAAM,CAAC,CAAC,CAAC,CAACxQ,GAAG,CAACmL,CAAC,KAAK;QAAEmD,KAAK,EAAEnD,CAAC,CAACmD,KAAK;QAAEjF,KAAK,EAAE8B,CAAC,CAAC9B;MAAM,CAAC,CAAC;IACrF,CAAC,CAAC,CAAC;EACL,CAAC,EAAE,CAACmE,aAAa,CAAC,CAAC;EAEnB,MAAM3M,iBAAiB,GAAG,MAAAA,CAAO2E,OAAO,EAAEiL,UAAU,KAAK;IACvD,IAAI;MACF,MAAMC,SAAS,GAAGpD,UAAU,CAAChC,GAAG,CAACzF,MAAM,CAAC4K,UAAU,CAAC5N,EAAE,CAAC,CAAC;MACvD,MAAM8N,OAAO,GAAG1H,WAAW,IAAIA,WAAW,CAACpG,EAAE,GAAGoG,WAAW,CAACpG,EAAE,GAAG,IAAI;;MAErE;MACA,IAAI6N,SAAS,IAAI7K,MAAM,CAAC6K,SAAS,CAAC7N,EAAE,CAAC,KAAKgD,MAAM,CAACL,OAAO,CAAC3C,EAAE,CAAC,EAAE;QAC5D,MAAM+N,MAAM,GAAGnM,MAAM,CAACoM,OAAO,CAC3B,UAAUJ,UAAU,CAACzJ,SAAS,IAAIyJ,UAAU,CAACxJ,UAAU,oCAAoC,GAC3F,4DACF,CAAC;QACD,IAAI,CAAC2J,MAAM,EAAE;QAEb,MAAM;UAAElO,KAAK,EAAEoO;QAAU,CAAC,GAAG,MAAMrS,QAAQ,CAACkE,GAAG,CAAC,wBAAwB,EAAE;UACxEoO,iBAAiB,EAAEvL,OAAO,CAAC3C,EAAE;UAC7BmO,iBAAiB,EAAEN,SAAS,CAAC7N,EAAE;UAC/BoO,eAAe,EAAEN;QACnB,CAAC,CAAC;QACF,IAAIG,SAAS,EAAE,MAAMA,SAAS;QAC9B,MAAMhF,gBAAgB,CAAClL,IAAI,CAAC;QAC5B6D,MAAM,CAACC,KAAK,CAAC,oCAAoC,CAAC;QAClD;MACF;;MAEA;MACA,MAAMwM,EAAE,GAAGzM,MAAM,CAACoM,OAAO,CAAC,iBAAiBJ,UAAU,CAACzJ,SAAS,IAAIyJ,UAAU,CAACxJ,UAAU,iBAAiB,CAAC;MAC1G,IAAI,CAACiK,EAAE,EAAE;MACT,MAAM;QAAExO;MAAM,CAAC,GAAG,MAAMjE,QAAQ,CAACkE,GAAG,CAAC,kBAAkB,EAAE;QACvDS,gBAAgB,EAAEoC,OAAO,CAAC3C,EAAE;QAC5BsO,aAAa,EAAEV,UAAU,CAAC5N,EAAE;QAC5BuO,cAAc,EAAE5L,OAAO,CAAClB,aAAa;QACrC+M,eAAe,EAAE7L,OAAO,CAAChB;MAC3B,CAAC,CAAC;MACF,IAAI9B,KAAK,EAAE,MAAMA,KAAK;MACtB,MAAMoJ,gBAAgB,CAAClL,IAAI,CAAC;MAC5B6D,MAAM,CAACC,KAAK,CAAC,qBAAqB,CAAC;IACrC,CAAC,CAAC,OAAO3B,CAAC,EAAE;MACVC,OAAO,CAACN,KAAK,CAAC,aAAa,EAAEK,CAAC,CAAC;MAC/B0B,MAAM,CAACC,KAAK,CAAC,mBAAmB,IAAI3B,CAAC,CAACG,OAAO,IAAIH,CAAC,CAAC,CAAC;IACtD;EACF,CAAC;EAED,oBACE/D,OAAA;IAAKM,SAAS,EAAC,YAAY;IAACyH,GAAG,EAAC,KAAK;IAAAxG,QAAA,gBACnCvB,OAAA;MAAKM,SAAS,EAAC,wDAAwD;MAAAiB,QAAA,gBACrEvB,OAAA;QAAKM,SAAS,EAAC,mFAAmF;QAAAiB,QAAA,gBAChGvB,OAAA;UAAAuB,QAAA,gBACEvB,OAAA;YAAIM,SAAS,EAAC,oCAAoC;YAAAiB,QAAA,EAAC;UAA4B;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eACpFZ,OAAA;YAAGM,SAAS,EAAC,uBAAuB;YAAAiB,QAAA,EAAC;UAA0G;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAChJ,CAAC,eACNZ,OAAA;UAAKM,SAAS,EAAC,yBAAyB;UAAAiB,QAAA,gBACtCvB,OAAA;YACE6I,IAAI,EAAC,MAAM;YACXvI,SAAS,EAAC,kCAAkC;YAC5CS,KAAK,EAAEa,IAAK;YACZqH,QAAQ,EAAGlF,CAAC,IAAG;cAAEmG,OAAO,CAACnG,CAAC,CAACqF,MAAM,CAACrI,KAAK,CAAC;cAAE8I,YAAY,IAAIA,YAAY,CAAC9F,CAAC,CAACqF,MAAM,CAACrI,KAAK,CAAC;YAAE,CAAE;YAC1FqG,KAAK,EAAC;UAAc;YAAA3G,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACrB,CAAC,eACFZ,OAAA;YACEM,SAAS,EAAC,4DAA4D;YACtEgH,OAAO,EAAEA,CAAA,KAAI;cAAE,MAAM/C,CAAC,GAAG,IAAI4F,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACX,KAAK,CAAC,CAAC,EAAC,EAAE,CAAC;cAAES,OAAO,CAAC3F,CAAC,CAAC;cAAEsF,YAAY,IAAIA,YAAY,CAACtF,CAAC,CAAC;YAAE,CAAE;YAAAhD,QAAA,EAC/G;UAED;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAENZ,OAAA;QAAKM,SAAS,EAAC,mDAAmD;QAAAiB,QAAA,eAChEvB,OAAA;UAAKM,SAAS,EAAC,4FAA4F;UAAAiB,QAAA,gBACzGvB,OAAA;YAAKM,SAAS,EAAC,iEAAiE;YAAAiB,QAAA,gBAC9EvB,OAAA;cAAMM,SAAS,EAAC,2BAA2B;cAAAiB,QAAA,EAAC;YAAY;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAC/DZ,OAAA;cAAMM,SAAS,EAAC,yBAAyB;cAAAiB,QAAA,EAAEiO,KAAK,CAACC;YAAU;cAAAhP,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAChE,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,iEAAiE;YAAAiB,QAAA,gBAC9EvB,OAAA;cAAMM,SAAS,EAAC,2BAA2B;cAAAiB,QAAA,EAAC;YAAiB;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACpEZ,OAAA;cAAMM,SAAS,EAAC,yBAAyB;cAAAiB,QAAA,EAAEiO,KAAK,CAACE;YAAa;cAAAjP,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACnE,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,iEAAiE;YAAAiB,QAAA,gBAC9EvB,OAAA;cAAMM,SAAS,EAAC,2BAA2B;cAAAiB,QAAA,EAAC;YAAe;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAClEZ,OAAA;cAAMM,SAAS,EAAC,yBAAyB;cAAAiB,QAAA,EAAEiO,KAAK,CAACK;YAAS;cAAApP,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC/D,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,iEAAiE;YAAAiB,QAAA,gBAC9EvB,OAAA;cAAMM,SAAS,EAAC,2BAA2B;cAAAiB,QAAA,EAAC;YAAa;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAChEZ,OAAA;cAAMM,SAAS,EAAC,uCAAuC;cAAAiB,QAAA,EAAEiO,KAAK,CAACtM;YAAY;cAAAzC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAChF,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,iEAAiE;YAAAiB,QAAA,gBAC9EvB,OAAA;cAAMM,SAAS,EAAC,2BAA2B;cAAAiB,QAAA,EAAC;YAAoB;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACvEZ,OAAA;cAAMM,SAAS,EAAC,0CAA0C;cAAAiB,QAAA,EAAEiO,KAAK,CAACQ;YAAS;cAAAvP,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAChF,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eACNZ,OAAA;QAAKM,SAAS,EAAC,mDAAmD;QAAAiB,QAAA,gBAEhEvB,OAAA;UAAKM,SAAS,EAAC,2DAA2D;UAAAiB,QAAA,gBACxEvB,OAAA;YAAKM,SAAS,EAAC,yBAAyB;YAAAiB,QAAA,gBACtCvB,OAAA;cAAMM,SAAS,EAAC,eAAe;cAAAiB,QAAA,EAAC;YAAO;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAC9CZ,OAAA;cACEM,SAAS,EAAC,6CAA6C;cACvDS,KAAK,EAAE4J,cAAe;cACtB1B,QAAQ,EAAGlF,CAAC,IAAG;gBAAE6G,iBAAiB,CAAC7G,CAAC,CAACqF,MAAM,CAACrI,KAAK,CAAC;gBAAE+J,cAAc,CAAC,KAAK,CAAC;cAAE,CAAE;cAAAvJ,QAAA,gBAE7EvB,OAAA;gBAAQe,KAAK,EAAC,KAAK;gBAAAQ,QAAA,EAAC;cAAI;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,EAChCqO,eAAe,CAACjO,GAAG,CAACsR,GAAG,iBACtBtS,OAAA;gBAAwBe,KAAK,EAAEuR,GAAG,CAACvR,KAAM;gBAAAQ,QAAA,EAAE+Q,GAAG,CAAChD;cAAK,GAAvCgD,GAAG,CAACvR,KAAK;gBAAAN,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAuC,CAC9D,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACI,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,yBAAyB;YAAAiB,QAAA,gBACtCvB,OAAA;cAAMM,SAAS,EAAC,eAAe;cAAAiB,QAAA,EAAC;YAAM;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAC7CZ,OAAA;cACEM,SAAS,EAAC,6CAA6C;cACvDS,KAAK,EAAE8J,WAAY;cACnB5B,QAAQ,EAAGlF,CAAC,IAAG+G,cAAc,CAAC/G,CAAC,CAACqF,MAAM,CAACrI,KAAK,CAAE;cAAAQ,QAAA,gBAE9CvB,OAAA;gBAAQe,KAAK,EAAC,KAAK;gBAAAQ,QAAA,EAAC;cAAI;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,EAChC2O,YAAY,CAACvO,GAAG,CAACsR,GAAG,iBACnBtS,OAAA;gBAAwBe,KAAK,EAAEuR,GAAG,CAACvR,KAAM;gBAAAQ,QAAA,EAAE+Q,GAAG,CAAChD;cAAK,GAAvCgD,GAAG,CAACvR,KAAK;gBAAAN,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAuC,CAC9D,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACI,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC,eACNZ,OAAA;YAAKM,SAAS,EAAC,yBAAyB;YAAAiB,QAAA,gBACtCvB,OAAA;cAAMM,SAAS,EAAC,eAAe;cAAAiB,QAAA,EAAC;YAAY;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACnDZ,OAAA;cACEM,SAAS,EAAC,6CAA6C;cACvDS,KAAK,EAAEgK,YAAa;cACpB9B,QAAQ,EAAGlF,CAAC,IAAGiH,eAAe,CAACjH,CAAC,CAACqF,MAAM,CAACrI,KAAK,CAAE;cAAAQ,QAAA,gBAE/CvB,OAAA;gBAAQe,KAAK,EAAC,KAAK;gBAAAQ,QAAA,EAAC;cAAI;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,eACjCZ,OAAA;gBAAQe,KAAK,EAAC,WAAW;gBAAAQ,QAAA,EAAC;cAAK;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,eACxCZ,OAAA;gBAAQe,KAAK,EAAC,UAAU;gBAAAQ,QAAA,EAAC;cAAM;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,eACxCZ,OAAA;gBAAQe,KAAK,EAAC,UAAU;gBAAAQ,QAAA,EAAC;cAAM;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,eACxCZ,OAAA;gBAAQe,KAAK,EAAC,aAAa;gBAAAQ,QAAA,EAAC;cAAK;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACpC,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAENZ,OAAA;UAAKM,SAAS,EAAC,qGAAqG;UAAAiB,QAAA,gBAClHvB,OAAA;YAAAuB,QAAA,EAAK;UAA2D;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACtEZ,OAAA;YAAAuB,QAAA,EAAK;UAAyE;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACpFZ,OAAA;YAAAuB,QAAA,EAAK;UAAwD;YAAAd,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACnEZ,OAAA;YAAKM,SAAS,EAAC,6EAA6E;YAAAiB,QAAA,gBAC1FvB,OAAA;cAAKM,SAAS,EAAC,yBAAyB;cAAAiB,QAAA,gBAACvB,OAAA;gBAAMM,SAAS,EAAC,8BAA8B;gBAACC,KAAK,EAAE;kBAAEC,eAAe,EAAEZ,iBAAiB,CAAC,UAAU;gBAAE;cAAE;gBAAAa,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAAC,KAAC,eAAAZ,OAAA;gBAAAuB,QAAA,EAAM;cAAU;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CAAC,eACxLZ,OAAA;cAAKM,SAAS,EAAC,yBAAyB;cAAAiB,QAAA,gBAACvB,OAAA;gBAAMM,SAAS,EAAC,8BAA8B;gBAACC,KAAK,EAAE;kBAAEC,eAAe,EAAEZ,iBAAiB,CAAC,OAAO;gBAAE;cAAE;gBAAAa,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAAC,KAAC,eAAAZ,OAAA;gBAAAuB,QAAA,EAAM;cAAS;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACjL,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,EAEL6J,OAAO,gBACNzK,OAAA;MAAKM,SAAS,EAAC,eAAe;MAAAiB,QAAA,EAAC;IAAe;MAAAd,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC,GAClDsQ,MAAM,CAACjK,MAAM,KAAK,CAAC,gBACrBjH,OAAA;MAAKM,SAAS,EAAC,eAAe;MAAAiB,QAAA,EAAC;IAAY;MAAAd,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC,gBAEjDZ,OAAA;MAAKM,SAAS,EAAC,WAAW;MAAAiB,QAAA,EACvB2P,MAAM,CAAClQ,GAAG,CAAC,CAACmF,CAAC,EAAEoM,EAAE,kBAChBvS,OAAA;QAAAuB,QAAA,gBACEvB,OAAA;UAAKM,SAAS,EAAC,sCAAsC;UAAAiB,QAAA,EAAE4E,CAAC,CAACmJ;QAAK;UAAA7O,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eACrEZ,OAAA;UAAKM,SAAS,EAAC,WAAW;UAAAiB,QAAA,EACvB4E,CAAC,CAACmL,MAAM,CAACtQ,GAAG,CAAC,CAACmL,CAAC,EAAEqG,EAAE,kBAClBxS,OAAA;YAAcM,SAAS,EAAC,+CAA+C;YAAAiB,QAAA,gBACrEvB,OAAA;cAAKM,SAAS,EAAC,iFAAiF;cAAAiB,QAAA,gBAC9FvB,OAAA;gBAAKM,SAAS,EAAC,qCAAqC;gBAAAiB,QAAA,EAAE4K,CAAC,CAACmD;cAAK;gBAAA7O,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,eACpEZ,OAAA;gBAAKM,SAAS,EAAC,2BAA2B;gBAAAiB,QAAA,GAAC,qDAAW,EAAC4K,CAAC,CAAC9B,KAAK,CAACpD,MAAM;cAAA;gBAAAxG,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACzE,CAAC,eACNZ,OAAA;cAAKM,SAAS,EAAC,WAAW;cAAAiB,QAAA,eACxBvB,OAAA;gBAAKM,SAAS,EAAC,qFAAqF;gBAAAiB,QAAA,EACjG4K,CAAC,CAAC9B,KAAK,CAACrJ,GAAG,CAAEU,IAAI,IAAK;kBACrB,MAAMiG,OAAO,GAAG,CAAC,CAAC2G,UAAU,CAAChC,GAAG,CAACzF,MAAM,CAACnF,IAAI,CAACmC,EAAE,CAAC,CAAC;kBACjD,oBACE7D,OAAA;oBAAmBM,SAAS,EAAC,gBAAgB;oBAAAiB,QAAA,gBAC3CvB,OAAA,CAACyB,QAAQ;sBACPC,IAAI,EAAEA,IAAK;sBACXC,IAAI,EAAE2M,UAAU,CAAChC,GAAG,CAACzF,MAAM,CAACnF,IAAI,CAACmC,EAAE,CAAC,CAAE;sBACtCjC,IAAI,EAAEA,IAAK;sBACXC,iBAAiB,EAAEA;oBAAkB;sBAAApB,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OACtC,CAAC,EACD+G,OAAO,gBACN3H,OAAA;sBACE6I,IAAI,EAAC,QAAQ;sBACbvI,SAAS,EAAC,+JAA+J;sBACzKgH,OAAO,EAAEA,CAAA,KAAI2I,cAAc,CAACvO,IAAI,CAACmC,EAAE,CAAE;sBAAAtC,QAAA,EACtC;oBAED;sBAAAd,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAQ,CAAC,gBAETZ,OAAA;sBACE6I,IAAI,EAAC,QAAQ;sBACbvI,SAAS,EAAC,qKAAqK;sBAC/KgH,OAAO,EAAEA,CAAA,KAAI8I,gBAAgB,CAAC1O,IAAI,CAAE;sBAAAH,QAAA,EACrC;oBAED;sBAAAd,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAQ,CACT;kBAAA,GAvBOc,IAAI,CAACmC,EAAE;oBAAApD,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAwBZ,CAAC;gBAEV,CAAC;cAAC;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACC;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC;UAAA,GAtCE4R,EAAE;YAAA/R,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAuCP,CACN;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACC,CAAC;MAAA,GA7CE2R,EAAE;QAAA9R,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OA8CP,CACN;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CACN,EAEAqK,WAAW,iBACVjL,OAAA,CAACH,gBAAgB;MACf4S,WAAW,EAAExH,WAAY;MACzByH,OAAO,EAAEA,CAAA,KAAIxH,cAAc,CAAC,IAAI,CAAE;MAClCyH,MAAM,EAAErC,mBAAoB;MAC5BsC,aAAa,EAAE,MAAAA,CAAA,KAAU;QAAE,MAAM9F,gBAAgB,CAAClL,IAAI,CAAC;MAAE;IAAE;MAAAnB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC5D,CACF;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV;AAACoJ,GAAA,CAjgBuBL,QAAQ;AAAAkJ,GAAA,GAARlJ,QAAQ;AAAA,IAAA9I,EAAA,EAAAW,GAAA,EAAAkI,GAAA,EAAAmJ,GAAA;AAAAC,YAAA,CAAAjS,EAAA;AAAAiS,YAAA,CAAAtR,GAAA;AAAAsR,YAAA,CAAApJ,GAAA;AAAAoJ,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}