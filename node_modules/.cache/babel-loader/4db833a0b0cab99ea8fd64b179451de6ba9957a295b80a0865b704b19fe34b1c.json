{"ast":null,"code":"import React,{useEffect,useState}from'react';import{supabase}from'../supabaseClient';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PaymentModal(_ref){let{row,onClose,onDone}=_ref;const[amount,setAmount]=useState(0);const[method,setMethod]=useState((row===null||row===void 0?void 0:row.payment_method)||'cash');const[loading,setLoading]=useState(false);useEffect(()=>{setAmount(Number((row===null||row===void 0?void 0:row.remaining_amount)||0));setMethod((row===null||row===void 0?void 0:row.payment_method)||'cash');},[row]);const submit=async()=>{setLoading(true);try{const paid=Number((row===null||row===void 0?void 0:row.amount_paid)||0)+Number(amount||0);const{error}=await supabase.from('reservations').update({amount_paid:paid,payment_method:method}).eq('id',row.id);if(error)throw error;onDone&&onDone();onClose&&onClose();}catch(e){alert('تعذّر تسجيل الدفع: '+(e.message||e));}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4\",dir:\"rtl\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 border-b\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-bold\",children:\"\\u062A\\u0633\\u062C\\u064A\\u0644 \\u062F\\u0641\\u0639\\u0629\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"\\u0627\\u062E\\u062A\\u0631 \\u0637\\u0631\\u064A\\u0642\\u0629 \\u0627\\u0644\\u062F\\u0641\\u0639 \\u0648\\u0623\\u062F\\u062E\\u0644 \\u0627\\u0644\\u0645\\u0628\\u0644\\u063A\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0646\\u0632\\u064A\\u0644:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.guest_name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u063A\\u0631\\u0641\\u0629:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.room_label}),\" \\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.room_type_name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0641\\u062A\\u0631\\u0629:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.check_in_date}),\" \\u2192 \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.check_out_date}),\" (\",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.nights}),\" \\u0644\\u064A\\u0627\\u0644)\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.total_amount}),\" \\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0645\\u062F\\u0641\\u0648\\u0639:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.amount_paid}),\" \\u2022 \",/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0627\\u0644\\u0645\\u062A\\u0628\\u0642\\u064A:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:row.remaining_amount})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 flex flex-col gap-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:\"\\u0627\\u0644\\u0645\\u0628\\u0644\\u063A\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"border rounded px-3 py-2\",value:amount,onChange:e=>setAmount(e.target.value),min:0}),/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:\"\\u0637\\u0631\\u064A\\u0642\\u0629 \\u0627\\u0644\\u062F\\u0641\\u0639\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded px-3 py-2\",value:method,onChange:e=>setMethod(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"\\u0646\\u0642\\u062F\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"instapay\",children:\"\\u0625\\u0646\\u0633\\u062A\\u0627\\u0628\\u0627\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"etisalat_cash\",children:\"\\u0627\\u062A\\u0635\\u0627\\u0644\\u0627\\u062A \\u0643\\u0627\\u0634\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 border-t bg-gray-50 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-2 border rounded\",onClick:onClose,children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-2 rounded bg-emerald-600 text-white\",disabled:loading,onClick:submit,children:loading?'جارٍ...':'دفع'})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","supabase","jsx","_jsx","jsxs","_jsxs","PaymentModal","_ref","row","onClose","onDone","amount","setAmount","method","setMethod","payment_method","loading","setLoading","Number","remaining_amount","submit","paid","amount_paid","error","from","update","eq","id","e","alert","message","className","dir","children","guest_name","room_label","room_type_name","check_in_date","check_out_date","nights","total_amount","type","value","onChange","target","min","onClick","disabled"],"sources":["F:/kelany/src/components/PaymentModal.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\n\r\nexport default function PaymentModal({ row, onClose, onDone }) {\r\n  const [amount, setAmount] = useState(0);\r\n  const [method, setMethod] = useState(row?.payment_method || 'cash');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setAmount(Number(row?.remaining_amount || 0));\r\n    setMethod(row?.payment_method || 'cash');\r\n  }, [row]);\r\n\r\n  const submit = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const paid = Number(row?.amount_paid || 0) + Number(amount || 0);\r\n      const { error } = await supabase.from('reservations').update({ amount_paid: paid, payment_method: method }).eq('id', row.id);\r\n      if (error) throw error;\r\n      onDone && onDone();\r\n      onClose && onClose();\r\n    } catch(e) {\r\n      alert('تعذّر تسجيل الدفع: '+(e.message||e));\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/30 flex items-end md:items-center justify-center p-4\" dir=\"rtl\">\r\n      <div className=\"bg-white w-full md:max-w-md rounded-lg shadow-lg overflow-hidden\">\r\n        <div className=\"px-4 py-3 border-b\">\r\n          <div className=\"font-bold\">تسجيل دفعة</div>\r\n          <div className=\"text-xs text-gray-500\">اختر طريقة الدفع وأدخل المبلغ</div>\r\n          <div className=\"mt-2 text-xs bg-gray-50 border border-gray-200 rounded p-2\">\r\n            <div><span className=\"text-gray-500\">النزيل:</span> <span className=\"font-medium\">{row.guest_name}</span></div>\r\n            <div><span className=\"text-gray-500\">الغرفة:</span> <span className=\"font-medium\">{row.room_label}</span> • <span className=\"font-medium\">{row.room_type_name}</span></div>\r\n            <div><span className=\"text-gray-500\">الفترة:</span> <span className=\"font-medium\">{row.check_in_date}</span> → <span className=\"font-medium\">{row.check_out_date}</span> (<span className=\"font-medium\">{row.nights}</span> ليال)</div>\r\n            <div><span className=\"text-gray-500\">الإجمالي:</span> <span className=\"font-medium\">{row.total_amount}</span> • <span className=\"text-gray-500\">المدفوع:</span> <span className=\"font-medium\">{row.amount_paid}</span> • <span className=\"text-gray-500\">المتبقي:</span> <span className=\"font-medium\">{row.remaining_amount}</span></div>\r\n          </div>\r\n        </div>\r\n        <div className=\"p-4 flex flex-col gap-3\">\r\n          <label className=\"text-sm\">المبلغ</label>\r\n          <input type=\"number\" className=\"border rounded px-3 py-2\" value={amount} onChange={e=>setAmount(e.target.value)} min={0} />\r\n          <label className=\"text-sm\">طريقة الدفع</label>\r\n          <select className=\"border rounded px-3 py-2\" value={method} onChange={e=>setMethod(e.target.value)}>\r\n            <option value=\"cash\">نقدي</option>\r\n            <option value=\"instapay\">إنستاباي</option>\r\n            <option value=\"etisalat_cash\">اتصالات كاش</option>\r\n          </select>\r\n        </div>\r\n        <div className=\"px-4 py-3 border-t bg-gray-50 flex items-center justify-between\">\r\n          <button className=\"px-3 py-2 border rounded\" onClick={onClose}>إلغاء</button>\r\n          <button className=\"px-3 py-2 rounded bg-emerald-600 text-white\" disabled={loading} onClick={submit}>{loading?'جارٍ...':'دفع'}</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,mBAAmB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE7C,cAAe,SAAS,CAAAC,YAAYA,CAAAC,IAAA,CAA2B,IAA1B,CAAEC,GAAG,CAAEC,OAAO,CAAEC,MAAO,CAAC,CAAAH,IAAA,CAC3D,KAAM,CAACI,MAAM,CAAEC,SAAS,CAAC,CAAGZ,QAAQ,CAAC,CAAC,CAAC,CACvC,KAAM,CAACa,MAAM,CAAEC,SAAS,CAAC,CAAGd,QAAQ,CAAC,CAAAQ,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEO,cAAc,GAAI,MAAM,CAAC,CACnE,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CAE7CD,SAAS,CAAC,IAAM,CACda,SAAS,CAACM,MAAM,CAAC,CAAAV,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEW,gBAAgB,GAAI,CAAC,CAAC,CAAC,CAC7CL,SAAS,CAAC,CAAAN,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEO,cAAc,GAAI,MAAM,CAAC,CAC1C,CAAC,CAAE,CAACP,GAAG,CAAC,CAAC,CAET,KAAM,CAAAY,MAAM,CAAG,KAAAA,CAAA,GAAY,CACzBH,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,CACF,KAAM,CAAAI,IAAI,CAAGH,MAAM,CAAC,CAAAV,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEc,WAAW,GAAI,CAAC,CAAC,CAAGJ,MAAM,CAACP,MAAM,EAAI,CAAC,CAAC,CAChE,KAAM,CAAEY,KAAM,CAAC,CAAG,KAAM,CAAAtB,QAAQ,CAACuB,IAAI,CAAC,cAAc,CAAC,CAACC,MAAM,CAAC,CAAEH,WAAW,CAAED,IAAI,CAAEN,cAAc,CAAEF,MAAO,CAAC,CAAC,CAACa,EAAE,CAAC,IAAI,CAAElB,GAAG,CAACmB,EAAE,CAAC,CAC5H,GAAIJ,KAAK,CAAE,KAAM,CAAAA,KAAK,CACtBb,MAAM,EAAIA,MAAM,CAAC,CAAC,CAClBD,OAAO,EAAIA,OAAO,CAAC,CAAC,CACtB,CAAE,MAAMmB,CAAC,CAAE,CACTC,KAAK,CAAC,qBAAqB,EAAED,CAAC,CAACE,OAAO,EAAEF,CAAC,CAAC,CAAC,CAC7C,CAAC,OAAS,CAAEX,UAAU,CAAC,KAAK,CAAC,CAAE,CACjC,CAAC,CAED,mBACEd,IAAA,QAAK4B,SAAS,CAAC,6EAA6E,CAACC,GAAG,CAAC,KAAK,CAAAC,QAAA,cACpG5B,KAAA,QAAK0B,SAAS,CAAC,kEAAkE,CAAAE,QAAA,eAC/E5B,KAAA,QAAK0B,SAAS,CAAC,oBAAoB,CAAAE,QAAA,eACjC9B,IAAA,QAAK4B,SAAS,CAAC,WAAW,CAAAE,QAAA,CAAC,yDAAU,CAAK,CAAC,cAC3C9B,IAAA,QAAK4B,SAAS,CAAC,uBAAuB,CAAAE,QAAA,CAAC,4JAA6B,CAAK,CAAC,cAC1E5B,KAAA,QAAK0B,SAAS,CAAC,4DAA4D,CAAAE,QAAA,eACzE5B,KAAA,QAAA4B,QAAA,eAAK9B,IAAA,SAAM4B,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,uCAAO,CAAM,CAAC,IAAC,cAAA9B,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAAC0B,UAAU,CAAO,CAAC,EAAK,CAAC,cAC/G7B,KAAA,QAAA4B,QAAA,eAAK9B,IAAA,SAAM4B,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,uCAAO,CAAM,CAAC,IAAC,cAAA9B,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAAC2B,UAAU,CAAO,CAAC,WAAG,cAAAhC,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAAC4B,cAAc,CAAO,CAAC,EAAK,CAAC,cAC3K/B,KAAA,QAAA4B,QAAA,eAAK9B,IAAA,SAAM4B,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,uCAAO,CAAM,CAAC,IAAC,cAAA9B,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAAC6B,aAAa,CAAO,CAAC,WAAG,cAAAlC,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAAC8B,cAAc,CAAO,CAAC,KAAE,cAAAnC,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAAC+B,MAAM,CAAO,CAAC,6BAAM,EAAK,CAAC,cACvOlC,KAAA,QAAA4B,QAAA,eAAK9B,IAAA,SAAM4B,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,mDAAS,CAAM,CAAC,IAAC,cAAA9B,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAACgC,YAAY,CAAO,CAAC,WAAG,cAAArC,IAAA,SAAM4B,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,6CAAQ,CAAM,CAAC,IAAC,cAAA9B,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAACc,WAAW,CAAO,CAAC,WAAG,cAAAnB,IAAA,SAAM4B,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,6CAAQ,CAAM,CAAC,IAAC,cAAA9B,IAAA,SAAM4B,SAAS,CAAC,aAAa,CAAAE,QAAA,CAAEzB,GAAG,CAACW,gBAAgB,CAAO,CAAC,EAAK,CAAC,EACvU,CAAC,EACH,CAAC,cACNd,KAAA,QAAK0B,SAAS,CAAC,yBAAyB,CAAAE,QAAA,eACtC9B,IAAA,UAAO4B,SAAS,CAAC,SAAS,CAAAE,QAAA,CAAC,sCAAM,CAAO,CAAC,cACzC9B,IAAA,UAAOsC,IAAI,CAAC,QAAQ,CAACV,SAAS,CAAC,0BAA0B,CAACW,KAAK,CAAE/B,MAAO,CAACgC,QAAQ,CAAEf,CAAC,EAAEhB,SAAS,CAACgB,CAAC,CAACgB,MAAM,CAACF,KAAK,CAAE,CAACG,GAAG,CAAE,CAAE,CAAE,CAAC,cAC3H1C,IAAA,UAAO4B,SAAS,CAAC,SAAS,CAAAE,QAAA,CAAC,+DAAW,CAAO,CAAC,cAC9C5B,KAAA,WAAQ0B,SAAS,CAAC,0BAA0B,CAACW,KAAK,CAAE7B,MAAO,CAAC8B,QAAQ,CAAEf,CAAC,EAAEd,SAAS,CAACc,CAAC,CAACgB,MAAM,CAACF,KAAK,CAAE,CAAAT,QAAA,eACjG9B,IAAA,WAAQuC,KAAK,CAAC,MAAM,CAAAT,QAAA,CAAC,0BAAI,CAAQ,CAAC,cAClC9B,IAAA,WAAQuC,KAAK,CAAC,UAAU,CAAAT,QAAA,CAAC,kDAAQ,CAAQ,CAAC,cAC1C9B,IAAA,WAAQuC,KAAK,CAAC,eAAe,CAAAT,QAAA,CAAC,+DAAW,CAAQ,CAAC,EAC5C,CAAC,EACN,CAAC,cACN5B,KAAA,QAAK0B,SAAS,CAAC,iEAAiE,CAAAE,QAAA,eAC9E9B,IAAA,WAAQ4B,SAAS,CAAC,0BAA0B,CAACe,OAAO,CAAErC,OAAQ,CAAAwB,QAAA,CAAC,gCAAK,CAAQ,CAAC,cAC7E9B,IAAA,WAAQ4B,SAAS,CAAC,6CAA6C,CAACgB,QAAQ,CAAE/B,OAAQ,CAAC8B,OAAO,CAAE1B,MAAO,CAAAa,QAAA,CAAEjB,OAAO,CAAC,SAAS,CAAC,KAAK,CAAS,CAAC,EACnI,CAAC,EACH,CAAC,CACH,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}