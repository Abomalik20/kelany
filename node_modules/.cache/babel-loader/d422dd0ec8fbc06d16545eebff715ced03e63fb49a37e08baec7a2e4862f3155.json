{"ast":null,"code":"import React,{useEffect,useState}from'react';import{supabase}from'../supabaseClient';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";export default function GuestHistoryModal(_ref){let{guest,onClose}=_ref;const[rows,setRows]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{const load=async()=>{setLoading(true);try{const{data,error}=await supabase.from('reservations').select('id, check_in_date, check_out_date, status, created_at, room_id').eq('guest_id',guest.id).order('check_in_date',{ascending:false});if(error)throw error;setRows(data||[]);}catch(e){console.error('Load guest history failed',e);setRows([]);}finally{setLoading(false);}};load();},[guest===null||guest===void 0?void 0:guest.id]);return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\",dir:\"rtl\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-2xl\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-4 border-b flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold\",children:[\"\\u0633\\u062C\\u0644 \\u0627\\u0644\\u062D\\u062C\\u0648\\u0632\\u0627\\u062A: \",(guest===null||guest===void 0?void 0:guest.full_name)||'']}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-600 hover:text-gray-900\",children:\"\\u0625\\u063A\\u0644\\u0627\\u0642 \\u2716\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"\\u062C\\u0627\\u0631\\u064D \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"}):rows.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600\",children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u062D\\u062C\\u0648\\u0632\\u0627\\u062A \\u0633\\u0627\\u0628\\u0642\\u0629 \\u0644\\u0647\\u0630\\u0627 \\u0627\\u0644\\u0646\\u0632\\u064A\\u0644.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:rows.map(r=>{var _r$room_id;return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-3 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-semibold\",children:[r.check_in_date?new Date(r.check_in_date).toLocaleDateString('ar-EG'):'—',\" \\u2192 \",r.check_out_date?new Date(r.check_out_date).toLocaleDateString('ar-EG'):'—']}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-600\",children:[\"\\u0627\\u0644\\u062D\\u0627\\u0644\\u0629: \",r.status||'—',\" \\u2022 \\u0625\\u0646\\u0634\\u0626\\u062A: \",r.created_at?new Date(r.created_at).toLocaleDateString('ar-EG'):'—']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"\\u0627\\u0644\\u063A\\u0631\\u0641\\u0629: \",(_r$room_id=r.room_id)!==null&&_r$room_id!==void 0?_r$room_id:'—']})]},r.id);})})})]})});}","map":{"version":3,"names":["React","useEffect","useState","supabase","jsxs","_jsxs","jsx","_jsx","GuestHistoryModal","_ref","guest","onClose","rows","setRows","loading","setLoading","load","data","error","from","select","eq","id","order","ascending","e","console","className","dir","children","full_name","onClick","length","map","r","_r$room_id","check_in_date","Date","toLocaleDateString","check_out_date","status","created_at","room_id"],"sources":["F:/kelany/src/components/GuestHistoryModal.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\n\r\nexport default function GuestHistoryModal({ guest, onClose }) {\r\n  const [rows, setRows] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from('reservations')\r\n          .select('id, check_in_date, check_out_date, status, created_at, room_id')\r\n          .eq('guest_id', guest.id)\r\n          .order('check_in_date', { ascending: false });\r\n        if (error) throw error;\r\n        setRows(data || []);\r\n      } catch (e) {\r\n        console.error('Load guest history failed', e);\r\n        setRows([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    load();\r\n  }, [guest?.id]);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\" dir=\"rtl\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-2xl\">\r\n        <div className=\"px-6 py-4 border-b flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-bold\">سجل الحجوزات: {guest?.full_name || ''}</h3>\r\n          <button onClick={onClose} className=\"text-gray-600 hover:text-gray-900\">إغلاق ✖</button>\r\n        </div>\r\n        <div className=\"p-6\">\r\n          {loading ? (\r\n            <div className=\"text-gray-500\">جارٍ التحميل...</div>\r\n          ) : rows.length === 0 ? (\r\n            <div className=\"text-gray-600\">لا توجد حجوزات سابقة لهذا النزيل.</div>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {rows.map(r => (\r\n                <div key={r.id} className=\"border rounded p-3 flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"font-semibold\">{r.check_in_date ? new Date(r.check_in_date).toLocaleDateString('ar-EG') : '—'} → {r.check_out_date ? new Date(r.check_out_date).toLocaleDateString('ar-EG') : '—'}</div>\r\n                    <div className=\"text-xs text-gray-600\">الحالة: {r.status || '—'} • إنشئت: {r.created_at ? new Date(r.created_at).toLocaleDateString('ar-EG') : '—'}</div>\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500\">الغرفة: {r.room_id ?? '—'}</div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,mBAAmB,CAAC,OAAAC,IAAA,IAAAC,KAAA,CAAAC,GAAA,IAAAC,IAAA,yBAE7C,cAAe,SAAS,CAAAC,iBAAiBA,CAAAC,IAAA,CAAqB,IAApB,CAAEC,KAAK,CAAEC,OAAQ,CAAC,CAAAF,IAAA,CAC1D,KAAM,CAACG,IAAI,CAAEC,OAAO,CAAC,CAAGX,QAAQ,CAAC,EAAE,CAAC,CACpC,KAAM,CAACY,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CAE5CD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAe,IAAI,CAAG,KAAAA,CAAA,GAAY,CACvBD,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,CACF,KAAM,CAAEE,IAAI,CAAEC,KAAM,CAAC,CAAG,KAAM,CAAAf,QAAQ,CACnCgB,IAAI,CAAC,cAAc,CAAC,CACpBC,MAAM,CAAC,gEAAgE,CAAC,CACxEC,EAAE,CAAC,UAAU,CAAEX,KAAK,CAACY,EAAE,CAAC,CACxBC,KAAK,CAAC,eAAe,CAAE,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CAC/C,GAAIN,KAAK,CAAE,KAAM,CAAAA,KAAK,CACtBL,OAAO,CAACI,IAAI,EAAI,EAAE,CAAC,CACrB,CAAE,MAAOQ,CAAC,CAAE,CACVC,OAAO,CAACR,KAAK,CAAC,2BAA2B,CAAEO,CAAC,CAAC,CAC7CZ,OAAO,CAAC,EAAE,CAAC,CACb,CAAC,OAAS,CACRE,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CACDC,IAAI,CAAC,CAAC,CACR,CAAC,CAAE,CAACN,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEY,EAAE,CAAC,CAAC,CAEf,mBACEf,IAAA,QAAKoB,SAAS,CAAC,4EAA4E,CAACC,GAAG,CAAC,KAAK,CAAAC,QAAA,cACnGxB,KAAA,QAAKsB,SAAS,CAAC,gDAAgD,CAAAE,QAAA,eAC7DxB,KAAA,QAAKsB,SAAS,CAAC,sDAAsD,CAAAE,QAAA,eACnExB,KAAA,OAAIsB,SAAS,CAAC,mBAAmB,CAAAE,QAAA,EAAC,uEAAc,CAAC,CAAAnB,KAAK,SAALA,KAAK,iBAALA,KAAK,CAAEoB,SAAS,GAAI,EAAE,EAAK,CAAC,cAC7EvB,IAAA,WAAQwB,OAAO,CAAEpB,OAAQ,CAACgB,SAAS,CAAC,mCAAmC,CAAAE,QAAA,CAAC,uCAAO,CAAQ,CAAC,EACrF,CAAC,cACNtB,IAAA,QAAKoB,SAAS,CAAC,KAAK,CAAAE,QAAA,CACjBf,OAAO,cACNP,IAAA,QAAKoB,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,wEAAe,CAAK,CAAC,CAClDjB,IAAI,CAACoB,MAAM,GAAK,CAAC,cACnBzB,IAAA,QAAKoB,SAAS,CAAC,eAAe,CAAAE,QAAA,CAAC,0KAAiC,CAAK,CAAC,cAEtEtB,IAAA,QAAKoB,SAAS,CAAC,WAAW,CAAAE,QAAA,CACvBjB,IAAI,CAACqB,GAAG,CAACC,CAAC,OAAAC,UAAA,oBACT9B,KAAA,QAAgBsB,SAAS,CAAC,sDAAsD,CAAAE,QAAA,eAC9ExB,KAAA,QAAAwB,QAAA,eACExB,KAAA,QAAKsB,SAAS,CAAC,eAAe,CAAAE,QAAA,EAAEK,CAAC,CAACE,aAAa,CAAG,GAAI,CAAAC,IAAI,CAACH,CAAC,CAACE,aAAa,CAAC,CAACE,kBAAkB,CAAC,OAAO,CAAC,CAAG,GAAG,CAAC,UAAG,CAACJ,CAAC,CAACK,cAAc,CAAG,GAAI,CAAAF,IAAI,CAACH,CAAC,CAACK,cAAc,CAAC,CAACD,kBAAkB,CAAC,OAAO,CAAC,CAAG,GAAG,EAAM,CAAC,cACxMjC,KAAA,QAAKsB,SAAS,CAAC,uBAAuB,CAAAE,QAAA,EAAC,wCAAQ,CAACK,CAAC,CAACM,MAAM,EAAI,GAAG,CAAC,0CAAU,CAACN,CAAC,CAACO,UAAU,CAAG,GAAI,CAAAJ,IAAI,CAACH,CAAC,CAACO,UAAU,CAAC,CAACH,kBAAkB,CAAC,OAAO,CAAC,CAAG,GAAG,EAAM,CAAC,EACtJ,CAAC,cACNjC,KAAA,QAAKsB,SAAS,CAAC,uBAAuB,CAAAE,QAAA,EAAC,wCAAQ,EAAAM,UAAA,CAACD,CAAC,CAACQ,OAAO,UAAAP,UAAA,UAAAA,UAAA,CAAI,GAAG,EAAM,CAAC,GAL/DD,CAAC,CAACZ,EAMP,CAAC,EACP,CAAC,CACC,CACN,CACE,CAAC,EACH,CAAC,CACH,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}