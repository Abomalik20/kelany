{"ast":null,"code":"import _objectSpread from\"F:/kelany/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useState}from'react';import{supabase}from'../supabaseClient';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const statusOptions=[{value:'pending',label:'قيد الانتظار'},{value:'confirmed',label:'مؤكد'},{value:'checked_in',label:'تم الدخول'},{value:'checked_out',label:'تم الخروج'},{value:'cancelled',label:'ملغي'},{value:'no_show',label:'لم يحضر'}];export default function ReservationModal(_ref){var _form$nightly_rate2,_form$total_amount,_form$amount_paid;let{initialData,onClose,onSave}=_ref;const[saving,setSaving]=useState(false);const[guests,setGuests]=useState([]);const[guestFilter,setGuestFilter]=useState('current');// today | current | upcoming | inactive | all\nconst[rooms,setRooms]=useState([]);const[roomsLoading,setRoomsLoading]=useState(false);const[totalAuto,setTotalAuto]=useState(true);const[form,setForm]=useState({guest_id:null,room_id:null,check_in_date:'',check_out_date:'',guests_count:1,status:'confirmed',nightly_rate:null,total_amount:null,amount_paid:0,currency:'EGP',payment_method:'cash',payer_type:'guest',agency_name:'',special_requests:'',notes:'',// pending extra guests to attach on save (used mainly for new reservations)\npending_guest_ids:[]});const maxGuestsForSelected=useMemo(()=>{const r=rooms.find(x=>String(x.id)===String(form.room_id));return(r===null||r===void 0?void 0:r.max_guests)||null;},[rooms,form.room_id]);useEffect(()=>{const loadGuests=async()=>{const g=await supabase.from('guests_overview').select('id, full_name, created_at, has_current_stay, has_upcoming_reservation, is_inactive').order('full_name');setGuests(g.data||[]);};loadGuests();},[]);// Ensure the selected guest remains visible when editing, even if inactive\nuseEffect(()=>{if(!initialData||!initialData.guest_id||guests.length===0)return;const current=guests.find(g=>String(g.id)===String(initialData.guest_id));if(!current)return;if((guestFilter==='today'||guestFilter==='current'||guestFilter==='upcoming')&&current.is_inactive){setGuestFilter('all');}},[initialData,guests,guestFilter]);useEffect(()=>{if(initialData){var _initialData$guests_c,_initialData$status,_initialData$nightly_,_initialData$total_am,_initialData$amount_p,_initialData$currency,_initialData$payment_,_initialData$payer_ty,_initialData$agency_n,_initialData$special_,_initialData$notes;setForm({guest_id:initialData.guest_id,room_id:initialData.room_id,check_in_date:initialData.check_in_date,check_out_date:initialData.check_out_date,guests_count:(_initialData$guests_c=initialData.guests_count)!==null&&_initialData$guests_c!==void 0?_initialData$guests_c:1,status:(_initialData$status=initialData.status)!==null&&_initialData$status!==void 0?_initialData$status:'confirmed',nightly_rate:(_initialData$nightly_=initialData.nightly_rate)!==null&&_initialData$nightly_!==void 0?_initialData$nightly_:null,total_amount:(_initialData$total_am=initialData.total_amount)!==null&&_initialData$total_am!==void 0?_initialData$total_am:null,amount_paid:(_initialData$amount_p=initialData.amount_paid)!==null&&_initialData$amount_p!==void 0?_initialData$amount_p:0,currency:(_initialData$currency=initialData.currency)!==null&&_initialData$currency!==void 0?_initialData$currency:'EGP',payment_method:(_initialData$payment_=initialData.payment_method)!==null&&_initialData$payment_!==void 0?_initialData$payment_:'cash',payer_type:(_initialData$payer_ty=initialData.payer_type)!==null&&_initialData$payer_ty!==void 0?_initialData$payer_ty:'guest',agency_name:(_initialData$agency_n=initialData.agency_name)!==null&&_initialData$agency_n!==void 0?_initialData$agency_n:'',special_requests:(_initialData$special_=initialData.special_requests)!==null&&_initialData$special_!==void 0?_initialData$special_:'',notes:(_initialData$notes=initialData.notes)!==null&&_initialData$notes!==void 0?_initialData$notes:'',pending_guest_ids:[]});}},[initialData]);const nights=useMemo(()=>{if(!form.check_in_date||!form.check_out_date)return 0;const start=new Date(form.check_in_date);const end=new Date(form.check_out_date);const diff=(end-start)/(1000*60*60*24);return diff>0?diff:0;},[form.check_in_date,form.check_out_date]);useEffect(()=>{if(totalAuto&&form.nightly_rate!=null&&nights>0){const total=Math.round(Number(form.nightly_rate)*nights*100)/100;setForm(f=>_objectSpread(_objectSpread({},f),{},{total_amount:total}));}},[form.nightly_rate,nights,totalAuto]);const remaining=useMemo(()=>{const t=Number(form.total_amount||0);const p=Number(form.amount_paid||0);return Math.max(0,Math.round((t-p)*100)/100);},[form.total_amount,form.amount_paid]);const checkAvailability=async()=>{const{data,error}=await supabase.rpc('check_room_availability',{p_room_id:form.room_id,p_check_in:form.check_in_date,p_check_out:form.check_out_date,p_reservation_id:(initialData===null||initialData===void 0?void 0:initialData.id)||null});if(error)throw error;return data;// expected boolean\n};const loadAllRooms=async()=>{setRoomsLoading(true);try{// Fallback: read from rooms table\nconst{data,error}=await supabase.from('rooms').select('id, room_number, room_code, status, cleanliness').order('room_number',{ascending:true});if(error)throw error;setRooms((data||[]).map(r=>({id:r.id,room_label:r.room_number||r.room_code||'غرفة #'+String(r.id).slice(0,8),status:r.status,cleanliness:r.cleanliness})));}catch(e){console.error('Failed loading rooms list',e);setRooms([]);}finally{setRoomsLoading(false);}};const loadAvailableRooms=async()=>{if(!form.check_in_date||!form.check_out_date){await loadAllRooms();return;}setRoomsLoading(true);try{const{data,error}=await supabase.rpc('get_available_rooms',{p_check_in:form.check_in_date,p_check_out:form.check_out_date,p_reservation_id:(initialData===null||initialData===void 0?void 0:initialData.id)||null});if(error)throw error;// Ensure current room is present when editing\nlet list=data||[];if(initialData!==null&&initialData!==void 0&&initialData.room_id&&!list.some(r=>String(r.id)===String(initialData.room_id))){try{var _rt$data$base_price,_rt,_rt$data,_rt2,_rt2$data,_rt3,_rt3$data,_rt$data$max_guests,_rt4,_rt4$data;const{data:cur}=await supabase.from('rooms').select('id, room_number, room_code, status, cleanliness, room_type_id').eq('id',initialData.room_id).single();let rt=null;try{rt=await supabase.from('room_types').select('id,name,name_ar,base_price,max_guests').eq('id',cur.room_type_id).single();}catch(_unused){}const base_price=(_rt$data$base_price=(_rt=rt)===null||_rt===void 0?void 0:(_rt$data=_rt.data)===null||_rt$data===void 0?void 0:_rt$data.base_price)!==null&&_rt$data$base_price!==void 0?_rt$data$base_price:null;const room_type_name=((_rt2=rt)===null||_rt2===void 0?void 0:(_rt2$data=_rt2.data)===null||_rt2$data===void 0?void 0:_rt2$data.name_ar)||((_rt3=rt)===null||_rt3===void 0?void 0:(_rt3$data=_rt3.data)===null||_rt3$data===void 0?void 0:_rt3$data.name)||null;const max_guests=(_rt$data$max_guests=(_rt4=rt)===null||_rt4===void 0?void 0:(_rt4$data=_rt4.data)===null||_rt4$data===void 0?void 0:_rt4$data.max_guests)!==null&&_rt$data$max_guests!==void 0?_rt$data$max_guests:null;if(cur)list=[{id:cur.id,room_label:cur.room_number||cur.room_code||'غرفة #'+String(cur.id).slice(0,8),status:cur.status,cleanliness:cur.cleanliness,room_type_id:cur.room_type_id,room_type_name,base_price,max_guests},...list];}catch(_unused2){}}setRooms(list);}catch(e){console.warn('get_available_rooms RPC not available, falling back',(e===null||e===void 0?void 0:e.message)||e);await loadAllRooms();}finally{setRoomsLoading(false);}};useEffect(()=>{loadAvailableRooms();/* initial load and when dates change */},[form.check_in_date,form.check_out_date]);useEffect(()=>{if(!form.check_in_date||!form.check_out_date)loadAllRooms();},[]);// When room changes, default nightly_rate from room type base_price and clamp guests_count\nuseEffect(()=>{const r=rooms.find(x=>String(x.id)===String(form.room_id));if(r&&r.base_price!=null){setForm(f=>_objectSpread(_objectSpread({},f),{},{nightly_rate:Number(r.base_price)}));}},[form.room_id,rooms]);const handleSubmit=async e=>{e.preventDefault();try{var _form$nightly_rate;setSaving(true);if(!form.guest_id||!form.room_id||!form.check_in_date||!form.check_out_date){alert('يرجى تعبئة جميع الحقول الأساسية');setSaving(false);return;}// Require explicit OK confirmation if room is not clean AND check-in is today\ntry{const selectedRoom=rooms.find(x=>String(x.id)===String(form.room_id));if(selectedRoom&&selectedRoom.cleanliness&&selectedRoom.cleanliness!=='clean'){const today=new Date();const pad=n=>String(n).padStart(2,'0');const todayStr=\"\".concat(today.getFullYear(),\"-\").concat(pad(today.getMonth()+1),\"-\").concat(pad(today.getDate()));if(String(form.check_in_date)===todayStr){const confirmText=window.prompt('الغرفة غير نظيفة والدخول اليوم. لتأكيد الحجز اكتب: ok','');if(!confirmText||String(confirmText).trim().toLowerCase()!=='ok'){alert('تم إلغاء تأكيد الحجز لهذه الغرفة غير النظيفة.');setSaving(false);return;}}}}catch(_){}// مرونة مطلوبة: لا منع صارم عند تجاوز الحد الأقصى المقترح لعدد النزلاء\n// Optional: availability check if RPC exists, otherwise rely on trigger\ntry{const ok=await checkAvailability();if(ok===false){alert('الغرفة غير متاحة في هذه الفترة');setSaving(false);return;}}catch(_unused3){// silently ignore if RPC not available\n}// Ensure nightly_rate snapshot from room type, and computed total\nconst selected=rooms.find(x=>String(x.id)===String(form.room_id));const nightly=(_form$nightly_rate=form.nightly_rate)!==null&&_form$nightly_rate!==void 0?_form$nightly_rate:selected&&selected.base_price!=null?Number(selected.base_price):null;const total=totalAuto?nightly!=null&&nights>0?Math.round(nightly*nights*100)/100:form.total_amount:form.total_amount;const payload=_objectSpread(_objectSpread({},form),{},{nightly_rate:nightly,total_amount:total});onSave(payload);}catch(e){console.error(e);alert('حدث خطأ غير متوقع');}finally{setSaving(false);}};// Guests inside reservation (UI-only for now; parent handles saving extra guests via RPC)\nconst[guestSearch,setGuestSearch]=useState('');const[guestResults,setGuestResults]=useState([]);useEffect(()=>{const term=(guestSearch||'').trim();if(!term){setGuestResults([]);return;}const t=setTimeout(async()=>{try{const{data,error}=await supabase.from('guests_overview').select('id, full_name, phone, email, created_at, has_current_stay, has_upcoming_reservation, is_inactive').or(\"full_name.ilike.%\".concat(term,\"%,phone.ilike.%\").concat(term,\"%,email.ilike.%\").concat(term,\"%\")).limit(10);if(error)throw error;setGuestResults(data||[]);}catch(e){setGuestResults([]);}},350);return()=>clearTimeout(t);},[guestSearch]);const addExtraGuestLocal=guestId=>{setForm(f=>_objectSpread(_objectSpread({},f),{},{pending_guest_ids:Array.from(new Set([...(f.pending_guest_ids||[]),guestId]))}));setGuestSearch('');setGuestResults([]);};const removeExtraGuestLocal=guestId=>{setForm(f=>_objectSpread(_objectSpread({},f),{},{pending_guest_ids:(f.pending_guest_ids||[]).filter(id=>String(id)!==String(guestId))}));};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/40 z-50 flex items-start justify-center px-2 sm:px-3 py-4\",dir:\"rtl\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-lg w-full max-w-[95vw] sm:max-w-xl md:max-w-2xl xl:max-w-3xl max-h-[85vh] overflow-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 border-b flex items-center justify-between sticky top-0 bg-white\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold\",children:initialData?'تعديل حجز':'حجز جديد'}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-500 hover:text-gray-700\",onClick:onClose,children:\"\\u0625\\u063A\\u0644\\u0627\\u0642\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"p-3 space-y-3 overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u0646\\u0632\\u064A\\u0644\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-1 gap-1 text-[11px] text-gray-600\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0627\\u062E\\u062A\\u0631 \\u0645\\u0646 \\u0627\\u0644\\u0646\\u0632\\u0644\\u0627\\u0621\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-1 justify-end\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"px-2 py-0.5 border rounded \".concat(guestFilter==='today'?'bg-indigo-600 text-white border-indigo-600':'bg-white text-gray-700'),onClick:()=>setGuestFilter('today'),children:\"\\u0645\\u0636\\u0627\\u0641\\u0648\\u0646 \\u0627\\u0644\\u064A\\u0648\\u0645\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"px-2 py-0.5 border rounded \".concat(guestFilter==='current'?'bg-emerald-600 text-white border-emerald-600':'bg-white text-gray-700'),onClick:()=>setGuestFilter('current'),children:\"\\u0645\\u0642\\u064A\\u0645\\u0648\\u0646 \\u062D\\u0627\\u0644\\u064A\\u0627\\u064B\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"px-2 py-0.5 border rounded \".concat(guestFilter==='upcoming'?'bg-amber-600 text-white border-amber-600':'bg-white text-gray-700'),onClick:()=>setGuestFilter('upcoming'),children:\"\\u0642\\u0627\\u062F\\u0650\\u0645\\u0648\\u0646\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"px-2 py-0.5 border rounded \".concat(guestFilter==='inactive'?'bg-gray-700 text-white border-gray-700':'bg-white text-gray-700'),onClick:()=>setGuestFilter('inactive'),children:\"\\u063A\\u064A\\u0631 \\u0646\\u0634\\u0637\\u064A\\u0646\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"px-2 py-0.5 border rounded \".concat(guestFilter==='all'?'bg-blue-600 text-white border-blue-600':'bg-white text-gray-700'),onClick:()=>setGuestFilter('all'),children:\"\\u0627\\u0644\\u0643\\u0644\"})]})]}),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded w-full px-3 py-2\",value:form.guest_id||'',onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{guest_id:e.target.value||null})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0627\\u062E\\u062A\\u0631 \\u0627\\u0644\\u0646\\u0632\\u064A\\u0644\"}),guests.filter(g=>{if(guestFilter==='all')return true;if(guestFilter==='inactive')return g.is_inactive;if(guestFilter==='current')return g.has_current_stay;if(guestFilter==='upcoming')return g.has_upcoming_reservation;if(guestFilter==='today'){const created=g.created_at?String(g.created_at).slice(0,10):null;const d=new Date();const pad=n=>String(n).padStart(2,'0');const todayStr=\"\".concat(d.getFullYear(),\"-\").concat(pad(d.getMonth()+1),\"-\").concat(pad(d.getDate()));return created===todayStr;}return true;}).map(g=>/*#__PURE__*/_jsxs(\"option\",{value:g.id,children:[g.full_name,g.is_inactive?' — غير نشط':g.has_current_stay?' — مقيم حالياً':g.has_upcoming_reservation?' — لديه حجز قادم':'']},g.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u063A\\u0631\\u0641\\u0629\"}),(()=>{const r=rooms.find(x=>String(x.id)===String(form.room_id));if(r&&r.cleanliness&&r.cleanliness!=='clean'){return/*#__PURE__*/_jsx(\"div\",{className:\"mb-2 text-xs bg-yellow-50 text-yellow-800 border border-yellow-300 rounded px-2 py-1\",children:\"\\u062A\\u0646\\u0628\\u064A\\u0647: \\u0627\\u0644\\u063A\\u0631\\u0641\\u0629 \\u063A\\u064A\\u0631 \\u0646\\u0638\\u064A\\u0641\\u0629 \\u062D\\u0627\\u0644\\u064A\\u0627\\u064B. \\u0644\\u0648 \\u0627\\u0644\\u062F\\u062E\\u0648\\u0644 \\u0627\\u0644\\u064A\\u0648\\u0645 \\u0633\\u064A\\u0637\\u0644\\u0628 \\u062A\\u0623\\u0643\\u064A\\u062F.\"});}return null;})(),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded w-full px-3 py-2\",value:form.room_id||'',onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{room_id:e.target.value||null})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:roomsLoading?'...جاري التحميل':'اختر الغرفة'}),rooms.map(r=>{const suffix=r.cleanliness&&r.cleanliness!=='clean'?\" - \".concat(r.cleanliness==='in_cleaning'?'جاري تنظيف':'غير نظيفة'):'';const typeInfo=r.room_type_name?\" \\u2014 \".concat(r.room_type_name):'';const priceInfo=r.base_price!=null?\" \\u2014 \".concat(r.base_price,\" \").concat(form.currency==='EGP'?'جنيه':form.currency):'';return/*#__PURE__*/_jsx(\"option\",{value:r.id,children:(r.room_label||r.room_code||r.id)+typeInfo+priceInfo+suffix},r.id);})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-600 mt-1\",children:(()=>{const r=rooms.find(x=>String(x.id)===String(form.room_id));if(!r)return null;const priceTxt=r.base_price!=null?\"\".concat(r.base_price,\" \").concat(form.currency==='EGP'?'جنيه':form.currency):'غير محدد';return/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0646\\u0648\\u0639 \\u0627\\u0644\\u063A\\u0631\\u0641\\u0629: \",/*#__PURE__*/_jsx(\"b\",{children:r.room_type_name||'غير محدد'}),\" \\u2014 \\u0627\\u0644\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0623\\u0633\\u0627\\u0633\\u064A: \".concat(priceTxt),maxGuestsForSelected?\" \\u2014 \\u0623\\u0642\\u0635\\u0649 \\u0639\\u062F\\u062F: \".concat(maxGuestsForSelected):'']});})()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u062F\\u062E\\u0648\\u0644\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"border rounded w-full px-3 py-2\",value:form.check_in_date,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{check_in_date:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u062E\\u0631\\u0648\\u062C\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"border rounded w-full px-3 py-2\",value:form.check_out_date,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{check_out_date:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0639\\u062F\\u062F \\u0627\\u0644\\u0646\\u0632\\u0644\\u0627\\u0621\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:1,className:\"border rounded w-full px-3 py-2\",value:form.guests_count,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{guests_count:Number(e.target.value)||1}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u062D\\u0627\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"select\",{className:\"border rounded w-full px-3 py-2\",value:form.status,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{status:e.target.value})),children:statusOptions.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.value,children:s.label},s.value))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0644\\u064A\\u0644\\u0629 (\\u0627\\u0642\\u062A\\u0631\\u0627\\u062D \\u0642\\u0627\\u0628\\u0644 \\u0644\\u0644\\u062A\\u0639\\u062F\\u064A\\u0644)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"border rounded w-full px-3 py-2\",value:(_form$nightly_rate2=form.nightly_rate)!==null&&_form$nightly_rate2!==void 0?_form$nightly_rate2:'',onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{nightly_rate:e.target.value===''?null:Number(e.target.value)}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center gap-1 text-[11px]\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:totalAuto,onChange:e=>setTotalAuto(e.target.checked)}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062D\\u0633\\u0627\\u0628 \\u062A\\u0644\\u0642\\u0627\\u0626\\u064A\"})]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"border rounded w-full px-3 py-2\",value:(_form$total_amount=form.total_amount)!==null&&_form$total_amount!==void 0?_form$total_amount:'',onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{total_amount:e.target.value===''?null:Number(e.target.value)})),disabled:totalAuto})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u0645\\u062F\\u0641\\u0648\\u0639\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"border rounded w-full px-3 py-2\",value:(_form$amount_paid=form.amount_paid)!==null&&_form$amount_paid!==void 0?_form$amount_paid:0,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{amount_paid:Number(e.target.value)||0}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u0645\\u062A\\u0628\\u0642\\u064A\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded w-full px-3 py-2 bg-gray-50 text-red-700 font-semibold\",children:[remaining,\" \",form.currency==='EGP'?'جنيه':form.currency]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0644\\u0639\\u0645\\u0644\\u0629\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded w-full px-3 py-2\",value:form.currency,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{currency:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"EGP\",children:\"\\u062C\\u0646\\u064A\\u0647\"}),/*#__PURE__*/_jsx(\"option\",{value:\"SAR\",children:\"\\u0631\\u064A\\u0627\\u0644\"}),/*#__PURE__*/_jsx(\"option\",{value:\"USD\",children:\"\\u062F\\u0648\\u0644\\u0627\\u0631\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0637\\u0631\\u064A\\u0642\\u0629 \\u0627\\u0644\\u062F\\u0641\\u0639\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded w-full px-3 py-2\",value:form.payment_method,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{payment_method:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"\\u0646\\u0642\\u062F\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"card\",children:\"\\u0628\\u0637\\u0627\\u0642\\u0629\"}),/*#__PURE__*/_jsx(\"option\",{value:\"transfer\",children:\"\\u062A\\u062D\\u0648\\u064A\\u0644 \\u0628\\u0646\\u0643\\u064A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"etisalat_cash\",children:\"\\u0627\\u062A\\u0635\\u0627\\u0644\\u0627\\u062A \\u0643\\u0627\\u0634\"}),/*#__PURE__*/_jsx(\"option\",{value:\"instapay\",children:\"\\u0625\\u0646\\u0633\\u062A\\u0627\\u0628\\u0627\\u064A\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-3 bg-emerald-50 rounded p-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0645\\u0646 \\u064A\\u062F\\u0641\\u0639\\u061F\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded w-full px-3 py-2\",value:form.payer_type,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{payer_type:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"guest\",children:\"\\u0627\\u0644\\u0646\\u0632\\u064A\\u0644 \\u0646\\u0641\\u0633\\u0647\"}),/*#__PURE__*/_jsx(\"option\",{value:\"agency\",children:\"\\u0634\\u0631\\u0643\\u0629/\\u0648\\u0643\\u0627\\u0644\\u0629\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs mb-1\",children:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u062C\\u0647\\u0629\"}),/*#__PURE__*/_jsx(\"input\",{className:\"border rounded w-full px-3 py-2\",placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0634\\u0631\\u0643\\u0629 \\u0623\\u0648 \\u0627\\u0644\\u0648\\u0643\\u0627\\u0644\\u0629\",value:form.agency_name,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{agency_name:e.target.value})),disabled:form.payer_type!=='agency'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-end\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[\"\\u0627\\u0644\\u0645\\u062F\\u0641\\u0648\\u0639: \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-blue-700 font-semibold\",children:[form.amount_paid||0,\" \",form.currency==='EGP'?'جنيه':form.currency]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm mb-1\",children:\"\\u0637\\u0644\\u0628\\u0627\\u062A \\u062E\\u0627\\u0635\\u0629\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"border rounded w-full px-3 py-2\",rows:2,value:form.special_requests,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{special_requests:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm mb-1\",children:\"\\u0645\\u0644\\u0627\\u062D\\u0638\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"border rounded w-full px-3 py-2\",rows:2,value:form.notes,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{notes:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-3 bg-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-semibold mb-2\",children:\"\\u0636\\u064A\\u0648\\u0641 \\u0625\\u0636\\u0627\\u0641\\u064A\\u0648\\u0646 \\u0644\\u0644\\u062D\\u062C\\u0632\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2 mb-2\",children:(form.pending_guest_ids||[]).length===0?/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500\",children:\"\\u0644\\u0627 \\u064A\\u0648\\u062C\\u062F \\u0636\\u064A\\u0648\\u0641 \\u0625\\u0636\\u0627\\u0641\\u064A\\u0648\\u0646 \\u0645\\u0636\\u0627\\u0641\\u0648\\u0646.\"}):(form.pending_guest_ids||[]).map(id=>{const g=guests.find(x=>String(x.id)===String(id));return/*#__PURE__*/_jsxs(\"span\",{className:\"px-2 py-1 text-xs rounded border bg-white\",children:[(g===null||g===void 0?void 0:g.full_name)||id,/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"ml-2 text-red-600\",onClick:()=>removeExtraGuestLocal(id),children:\"\\u0625\\u0632\\u0627\\u0644\\u0629 \\u2716\"})]},id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"border rounded px-3 py-2 w-full text-sm\",placeholder:\"\\u0628\\u062D\\u062B \\u0639\\u0646 \\u0636\\u064A\\u0641 \\u0644\\u0625\\u0636\\u0627\\u0641\\u062A\\u0647 \\u0644\\u0644\\u062D\\u062C\\u0632\",value:guestSearch,onChange:e=>setGuestSearch(e.target.value)}),guestResults.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute z-10 mt-1 bg-white border rounded shadow p-2 text-sm max-h-48 overflow-auto w-full\",children:guestResults.filter(gr=>{if(guestFilter==='all')return true;if(guestFilter==='inactive')return gr.is_inactive;if(guestFilter==='current')return gr.has_current_stay;if(guestFilter==='upcoming')return gr.has_upcoming_reservation;if(guestFilter==='today'){const created=gr.created_at?String(gr.created_at).slice(0,10):null;const d=new Date();const pad=n=>String(n).padStart(2,'0');const todayStr=\"\".concat(d.getFullYear(),\"-\").concat(pad(d.getMonth()+1),\"-\").concat(pad(d.getDate()));return created===todayStr;}return true;}).map(gr=>/*#__PURE__*/_jsxs(\"div\",{className:\"px-2 py-1 hover:bg-gray-100 cursor-pointer\",onClick:()=>addExtraGuestLocal(gr.id),children:[gr.full_name,' ',/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500\",children:[\"(\",gr.phone||gr.email||String(gr.id).slice(0,8),\")\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-1 text-[10px] text-gray-500\",children:gr.is_inactive?'— غير نشط':gr.has_current_stay?'— مقيم حالياً':gr.has_upcoming_reservation?'— لديه حجز قادم':''})]},gr.id))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-[11px] text-gray-600\",children:\"\\u0633\\u064A\\u062A\\u0645 \\u062D\\u0641\\u0638 \\u0627\\u0644\\u0636\\u064A\\u0648\\u0641 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u064A\\u064A\\u0646 \\u0645\\u0639 \\u0627\\u0644\\u062D\\u062C\\u0632\\u060C \\u0648\\u064A\\u0645\\u0643\\u0646 \\u062A\\u0648\\u0632\\u064A\\u0639\\u0647\\u0645 \\u0639\\u0644\\u0649 \\u0627\\u0644\\u0623\\u0633\\u0650\\u0631\\u0651\\u0629 \\u0645\\u0646 \\u0634\\u0627\\u0634\\u0629 \\\"\\u0627\\u0644\\u062A\\u0633\\u0643\\u064A\\u0646\\\".\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between border-t pt-3 sticky bottom-0 bg-white px-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"\\u0644\\u064A\\u0627\\u0644\\u064A: \",nights]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"px-4 py-2 border rounded\",onClick:onClose,children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded\",disabled:saving,children:saving?'جارٍ الحفظ...':initialData?'تحديث الحجز':'تأكيد الحجز'})]})]})]})]})});}","map":{"version":3,"names":["React","useEffect","useMemo","useState","supabase","jsx","_jsx","jsxs","_jsxs","statusOptions","value","label","ReservationModal","_ref","_form$nightly_rate2","_form$total_amount","_form$amount_paid","initialData","onClose","onSave","saving","setSaving","guests","setGuests","guestFilter","setGuestFilter","rooms","setRooms","roomsLoading","setRoomsLoading","totalAuto","setTotalAuto","form","setForm","guest_id","room_id","check_in_date","check_out_date","guests_count","status","nightly_rate","total_amount","amount_paid","currency","payment_method","payer_type","agency_name","special_requests","notes","pending_guest_ids","maxGuestsForSelected","r","find","x","String","id","max_guests","loadGuests","g","from","select","order","data","length","current","is_inactive","_initialData$guests_c","_initialData$status","_initialData$nightly_","_initialData$total_am","_initialData$amount_p","_initialData$currency","_initialData$payment_","_initialData$payer_ty","_initialData$agency_n","_initialData$special_","_initialData$notes","nights","start","Date","end","diff","total","Math","round","Number","f","_objectSpread","remaining","t","p","max","checkAvailability","error","rpc","p_room_id","p_check_in","p_check_out","p_reservation_id","loadAllRooms","ascending","map","room_label","room_number","room_code","slice","cleanliness","e","console","loadAvailableRooms","list","some","_rt$data$base_price","_rt","_rt$data","_rt2","_rt2$data","_rt3","_rt3$data","_rt$data$max_guests","_rt4","_rt4$data","cur","eq","single","rt","room_type_id","_unused","base_price","room_type_name","name_ar","name","_unused2","warn","message","handleSubmit","preventDefault","_form$nightly_rate","alert","selectedRoom","today","pad","n","padStart","todayStr","concat","getFullYear","getMonth","getDate","confirmText","window","prompt","trim","toLowerCase","_","ok","_unused3","selected","nightly","payload","guestSearch","setGuestSearch","guestResults","setGuestResults","term","setTimeout","or","limit","clearTimeout","addExtraGuestLocal","guestId","Array","Set","removeExtraGuestLocal","filter","className","dir","children","onClick","onSubmit","type","onChange","target","has_current_stay","has_upcoming_reservation","created","created_at","d","full_name","suffix","typeInfo","priceInfo","priceTxt","min","s","checked","disabled","placeholder","rows","gr","phone","email"],"sources":["F:/kelany/src/components/ReservationModal.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\n\r\nconst statusOptions = [\r\n  { value: 'pending', label: 'قيد الانتظار' },\r\n  { value: 'confirmed', label: 'مؤكد' },\r\n  { value: 'checked_in', label: 'تم الدخول' },\r\n  { value: 'checked_out', label: 'تم الخروج' },\r\n  { value: 'cancelled', label: 'ملغي' },\r\n  { value: 'no_show', label: 'لم يحضر' },\r\n];\r\n\r\nexport default function ReservationModal({ initialData, onClose, onSave }) {\r\n  const [saving, setSaving] = useState(false);\r\n  const [guests, setGuests] = useState([]);\r\n  const [guestFilter, setGuestFilter] = useState('current'); // today | current | upcoming | inactive | all\r\n  const [rooms, setRooms] = useState([]);\r\n  const [roomsLoading, setRoomsLoading] = useState(false);\r\n  const [totalAuto, setTotalAuto] = useState(true);\r\n\r\n  const [form, setForm] = useState({\r\n    guest_id: null,\r\n    room_id: null,\r\n    check_in_date: '',\r\n    check_out_date: '',\r\n    guests_count: 1,\r\n    status: 'confirmed',\r\n    nightly_rate: null,\r\n    total_amount: null,\r\n    amount_paid: 0,\r\n    currency: 'EGP',\r\n    payment_method: 'cash',\r\n    payer_type: 'guest',\r\n    agency_name: '',\r\n    special_requests: '',\r\n    notes: '',\r\n    // pending extra guests to attach on save (used mainly for new reservations)\r\n    pending_guest_ids: [],\r\n  });\r\n\r\n  const maxGuestsForSelected = useMemo(() => {\r\n    const r = rooms.find(x => String(x.id) === String(form.room_id));\r\n    return r?.max_guests || null;\r\n  }, [rooms, form.room_id]);\r\n\r\n  useEffect(()=>{\r\n    const loadGuests = async ()=>{\r\n      const g = await supabase\r\n        .from('guests_overview')\r\n        .select('id, full_name, created_at, has_current_stay, has_upcoming_reservation, is_inactive')\r\n        .order('full_name');\r\n      setGuests(g.data||[]);\r\n    };\r\n    loadGuests();\r\n  }, []);\r\n\r\n  // Ensure the selected guest remains visible when editing, even if inactive\r\n  useEffect(() => {\r\n    if (!initialData || !initialData.guest_id || guests.length === 0) return;\r\n    const current = guests.find(g => String(g.id) === String(initialData.guest_id));\r\n    if (!current) return;\r\n    if ((guestFilter === 'today' || guestFilter === 'current' || guestFilter === 'upcoming') && current.is_inactive) {\r\n      setGuestFilter('all');\r\n    }\r\n  }, [initialData, guests, guestFilter]);\r\n\r\n  useEffect(()=>{\r\n    if (initialData) {\r\n      setForm({\r\n        guest_id: initialData.guest_id,\r\n        room_id: initialData.room_id,\r\n        check_in_date: initialData.check_in_date,\r\n        check_out_date: initialData.check_out_date,\r\n        guests_count: initialData.guests_count ?? 1,\r\n        status: initialData.status ?? 'confirmed',\r\n        nightly_rate: initialData.nightly_rate ?? null,\r\n        total_amount: initialData.total_amount ?? null,\r\n        amount_paid: initialData.amount_paid ?? 0,\r\n        currency: initialData.currency ?? 'EGP',\r\n        payment_method: initialData.payment_method ?? 'cash',\r\n        payer_type: initialData.payer_type ?? 'guest',\r\n        agency_name: initialData.agency_name ?? '',\r\n        special_requests: initialData.special_requests ?? '',\r\n        notes: initialData.notes ?? '',\r\n        pending_guest_ids: [],\r\n      });\r\n    }\r\n  }, [initialData]);\r\n\r\n  const nights = useMemo(()=>{\r\n    if (!form.check_in_date || !form.check_out_date) return 0;\r\n    const start = new Date(form.check_in_date);\r\n    const end = new Date(form.check_out_date);\r\n    const diff = (end - start) / (1000*60*60*24);\r\n    return diff > 0 ? diff : 0;\r\n  }, [form.check_in_date, form.check_out_date]);\r\n\r\n  useEffect(()=>{\r\n    if (totalAuto && form.nightly_rate != null && nights>0) {\r\n      const total = Math.round(Number(form.nightly_rate) * nights * 100) / 100;\r\n      setForm(f=>({ ...f, total_amount: total }));\r\n    }\r\n  }, [form.nightly_rate, nights, totalAuto]);\r\n\r\n  const remaining = useMemo(()=>{\r\n    const t = Number(form.total_amount||0);\r\n    const p = Number(form.amount_paid||0);\r\n    return Math.max(0, Math.round((t - p) * 100) / 100);\r\n  }, [form.total_amount, form.amount_paid]);\r\n\r\n  const checkAvailability = async () => {\r\n    const { data, error } = await supabase.rpc('check_room_availability', {\r\n      p_room_id: form.room_id,\r\n      p_check_in: form.check_in_date,\r\n      p_check_out: form.check_out_date,\r\n      p_reservation_id: initialData?.id || null,\r\n    });\r\n    if (error) throw error;\r\n    return data; // expected boolean\r\n  };\r\n\r\n  const loadAllRooms = async () => {\r\n    setRoomsLoading(true);\r\n    try {\r\n      // Fallback: read from rooms table\r\n      const { data, error } = await supabase\r\n        .from('rooms')\r\n        .select('id, room_number, room_code, status, cleanliness')\r\n        .order('room_number', { ascending: true });\r\n      if (error) throw error;\r\n      setRooms((data||[]).map(r=>({\r\n        id: r.id,\r\n        room_label: r.room_number || r.room_code || ('غرفة #' + String(r.id).slice(0,8)),\r\n        status: r.status,\r\n        cleanliness: r.cleanliness\r\n      })));\r\n    } catch(e) {\r\n      console.error('Failed loading rooms list', e);\r\n      setRooms([]);\r\n    } finally {\r\n      setRoomsLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadAvailableRooms = async () => {\r\n    if (!form.check_in_date || !form.check_out_date) { await loadAllRooms(); return; }\r\n    setRoomsLoading(true);\r\n    try {\r\n      const { data, error } = await supabase.rpc('get_available_rooms', {\r\n        p_check_in: form.check_in_date,\r\n        p_check_out: form.check_out_date,\r\n        p_reservation_id: initialData?.id || null,\r\n      });\r\n      if (error) throw error;\r\n      // Ensure current room is present when editing\r\n      let list = (data||[]);\r\n      if (initialData?.room_id && !list.some(r=>String(r.id)===String(initialData.room_id))) {\r\n        try {\r\n          const { data: cur } = await supabase.from('rooms').select('id, room_number, room_code, status, cleanliness, room_type_id').eq('id', initialData.room_id).single();\r\n          let rt = null;\r\n          try { rt = await supabase.from('room_types').select('id,name,name_ar,base_price,max_guests').eq('id', cur.room_type_id).single(); } catch {}\r\n          const base_price = rt?.data?.base_price ?? null;\r\n          const room_type_name = rt?.data?.name_ar || rt?.data?.name || null;\r\n          const max_guests = rt?.data?.max_guests ?? null;\r\n          if (cur) list = [{ id: cur.id, room_label: cur.room_number || cur.room_code || ('غرفة #' + String(cur.id).slice(0,8)), status: cur.status, cleanliness: cur.cleanliness, room_type_id: cur.room_type_id, room_type_name, base_price, max_guests }, ...list];\r\n        } catch {}\r\n      }\r\n      setRooms(list);\r\n    } catch (e) {\r\n      console.warn('get_available_rooms RPC not available, falling back', e?.message || e);\r\n      await loadAllRooms();\r\n    } finally {\r\n      setRoomsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(()=>{ loadAvailableRooms(); /* initial load and when dates change */ }, [form.check_in_date, form.check_out_date]);\r\n  useEffect(()=>{ if (!form.check_in_date || !form.check_out_date) loadAllRooms(); }, []);\r\n\r\n  // When room changes, default nightly_rate from room type base_price and clamp guests_count\r\n  useEffect(()=>{\r\n    const r = rooms.find(x => String(x.id) === String(form.room_id));\r\n    if (r && r.base_price != null) {\r\n      setForm(f => ({ ...f, nightly_rate: Number(r.base_price) }));\r\n    }\r\n  }, [form.room_id, rooms]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      setSaving(true);\r\n      if (!form.guest_id || !form.room_id || !form.check_in_date || !form.check_out_date) {\r\n        alert('يرجى تعبئة جميع الحقول الأساسية');\r\n        setSaving(false);\r\n        return;\r\n      }\r\n      // Require explicit OK confirmation if room is not clean AND check-in is today\r\n      try {\r\n        const selectedRoom = rooms.find(x => String(x.id) === String(form.room_id));\r\n        if (selectedRoom && selectedRoom.cleanliness && selectedRoom.cleanliness !== 'clean') {\r\n          const today = new Date();\r\n          const pad = (n)=> String(n).padStart(2,'0');\r\n          const todayStr = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;\r\n          if (String(form.check_in_date) === todayStr) {\r\n            const confirmText = window.prompt('الغرفة غير نظيفة والدخول اليوم. لتأكيد الحجز اكتب: ok', '');\r\n            if (!confirmText || String(confirmText).trim().toLowerCase() !== 'ok') {\r\n              alert('تم إلغاء تأكيد الحجز لهذه الغرفة غير النظيفة.');\r\n              setSaving(false);\r\n              return;\r\n            }\r\n          }\r\n        }\r\n      } catch(_) {}\r\n      // مرونة مطلوبة: لا منع صارم عند تجاوز الحد الأقصى المقترح لعدد النزلاء\r\n      // Optional: availability check if RPC exists, otherwise rely on trigger\r\n      try {\r\n        const ok = await checkAvailability();\r\n        if (ok === false) {\r\n          alert('الغرفة غير متاحة في هذه الفترة');\r\n          setSaving(false);\r\n          return;\r\n        }\r\n      } catch {\r\n        // silently ignore if RPC not available\r\n      }\r\n  // Ensure nightly_rate snapshot from room type, and computed total\r\n  const selected = rooms.find(x => String(x.id) === String(form.room_id));\r\n  const nightly = form.nightly_rate ?? (selected && selected.base_price != null ? Number(selected.base_price) : null);\r\n  const total = totalAuto ? (nightly != null && nights > 0 ? Math.round(nightly * nights * 100) / 100 : form.total_amount) : form.total_amount;\r\n  const payload = { ...form, nightly_rate: nightly, total_amount: total };\r\n      onSave(payload);\r\n    } catch(e) {\r\n      console.error(e);\r\n      alert('حدث خطأ غير متوقع');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Guests inside reservation (UI-only for now; parent handles saving extra guests via RPC)\r\n  const [guestSearch, setGuestSearch] = useState('');\r\n  const [guestResults, setGuestResults] = useState([]);\r\n  useEffect(() => {\r\n    const term = (guestSearch||'').trim();\r\n    if (!term) { setGuestResults([]); return; }\r\n    const t = setTimeout(async () => {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from('guests_overview')\r\n          .select('id, full_name, phone, email, created_at, has_current_stay, has_upcoming_reservation, is_inactive')\r\n          .or(`full_name.ilike.%${term}%,phone.ilike.%${term}%,email.ilike.%${term}%`)\r\n          .limit(10);\r\n        if (error) throw error;\r\n        setGuestResults(data||[]);\r\n      } catch(e) { setGuestResults([]); }\r\n    }, 350);\r\n    return () => clearTimeout(t);\r\n  }, [guestSearch]);\r\n\r\n  const addExtraGuestLocal = (guestId) => {\r\n    setForm(f => ({ ...f, pending_guest_ids: Array.from(new Set([...(f.pending_guest_ids||[]), guestId])) }));\r\n    setGuestSearch(''); setGuestResults([]);\r\n  };\r\n\r\n  const removeExtraGuestLocal = (guestId) => {\r\n    setForm(f => ({ ...f, pending_guest_ids: (f.pending_guest_ids||[]).filter(id => String(id) !== String(guestId)) }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/40 z-50 flex items-start justify-center px-2 sm:px-3 py-4\" dir=\"rtl\">\r\n      <div className=\"bg-white rounded-lg shadow-lg w-full max-w-[95vw] sm:max-w-xl md:max-w-2xl xl:max-w-3xl max-h-[85vh] overflow-auto\">\r\n        <div className=\"px-4 py-3 border-b flex items-center justify-between sticky top-0 bg-white\">\r\n          <h3 className=\"font-bold\">{initialData ? 'تعديل حجز' : 'حجز جديد'}</h3>\r\n          <button className=\"text-gray-500 hover:text-gray-700\" onClick={onClose}>إغلاق</button>\r\n        </div>\r\n        <form onSubmit={handleSubmit} className=\"p-3 space-y-3 overflow-y-auto\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">النزيل</label>\r\n              <div className=\"flex items-center justify-between mb-1 gap-1 text-[11px] text-gray-600\">\r\n                <span>اختر من النزلاء</span>\r\n                <div className=\"flex flex-wrap gap-1 justify-end\">\r\n                  <button type=\"button\" className={`px-2 py-0.5 border rounded ${guestFilter==='today'?'bg-indigo-600 text-white border-indigo-600':'bg-white text-gray-700'}`} onClick={()=>setGuestFilter('today')}>مضافون اليوم</button>\r\n                  <button type=\"button\" className={`px-2 py-0.5 border rounded ${guestFilter==='current'?'bg-emerald-600 text-white border-emerald-600':'bg-white text-gray-700'}`} onClick={()=>setGuestFilter('current')}>مقيمون حالياً</button>\r\n                  <button type=\"button\" className={`px-2 py-0.5 border rounded ${guestFilter==='upcoming'?'bg-amber-600 text-white border-amber-600':'bg-white text-gray-700'}`} onClick={()=>setGuestFilter('upcoming')}>قادِمون</button>\r\n                  <button type=\"button\" className={`px-2 py-0.5 border rounded ${guestFilter==='inactive'?'bg-gray-700 text-white border-gray-700':'bg-white text-gray-700'}`} onClick={()=>setGuestFilter('inactive')}>غير نشطين</button>\r\n                  <button type=\"button\" className={`px-2 py-0.5 border rounded ${guestFilter==='all'?'bg-blue-600 text-white border-blue-600':'bg-white text-gray-700'}`} onClick={()=>setGuestFilter('all')}>الكل</button>\r\n                </div>\r\n              </div>\r\n              <select className=\"border rounded w-full px-3 py-2\" value={form.guest_id||''} onChange={e=>setForm(f=>({ ...f, guest_id: e.target.value||null }))}>\r\n                <option value=\"\">اختر النزيل</option>\r\n                {guests\r\n                  .filter(g => {\r\n                    if (guestFilter === 'all') return true;\r\n                    if (guestFilter === 'inactive') return g.is_inactive;\r\n                    if (guestFilter === 'current') return g.has_current_stay;\r\n                    if (guestFilter === 'upcoming') return g.has_upcoming_reservation;\r\n                    if (guestFilter === 'today') {\r\n                      const created = g.created_at ? String(g.created_at).slice(0,10) : null;\r\n                      const d = new Date(); const pad = (n)=>String(n).padStart(2,'0');\r\n                      const todayStr = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;\r\n                      return created === todayStr;\r\n                    }\r\n                    return true;\r\n                  })\r\n                  .map(g=> (\r\n                    <option key={g.id} value={g.id}>\r\n                      {g.full_name}\r\n                      {g.is_inactive ? ' — غير نشط' : (g.has_current_stay ? ' — مقيم حالياً' : (g.has_upcoming_reservation ? ' — لديه حجز قادم' : ''))}\r\n                    </option>\r\n                  ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">الغرفة</label>\r\n              {(() => {\r\n                const r = rooms.find(x => String(x.id) === String(form.room_id));\r\n                if (r && r.cleanliness && r.cleanliness !== 'clean') {\r\n                  return (\r\n                    <div className=\"mb-2 text-xs bg-yellow-50 text-yellow-800 border border-yellow-300 rounded px-2 py-1\">\r\n                      تنبيه: الغرفة غير نظيفة حالياً. لو الدخول اليوم سيطلب تأكيد.\r\n                    </div>\r\n                  );\r\n                }\r\n                return null;\r\n              })()}\r\n              <select className=\"border rounded w-full px-3 py-2\" value={form.room_id||''} onChange={e=>setForm(f=>({ ...f, room_id: e.target.value||null }))}>\r\n                <option value=\"\">{roomsLoading ? '...جاري التحميل' : 'اختر الغرفة'}</option>\r\n                {rooms.map(r=> {\r\n                  const suffix = r.cleanliness && r.cleanliness !== 'clean' ? ` - ${r.cleanliness==='in_cleaning' ? 'جاري تنظيف' : 'غير نظيفة'}` : '';\r\n                  const typeInfo = r.room_type_name ? ` — ${r.room_type_name}` : '';\r\n                  const priceInfo = r.base_price != null ? ` — ${r.base_price} ${form.currency==='EGP'?'جنيه':form.currency}` : '';\r\n                  return <option key={r.id} value={r.id}>{(r.room_label || r.room_code || r.id) + typeInfo + priceInfo + suffix}</option>;\r\n                })}\r\n              </select>\r\n              <div className=\"text-xs text-gray-600 mt-1\">\r\n                {(() => {\r\n                  const r = rooms.find(x => String(x.id) === String(form.room_id));\r\n                  if (!r) return null;\r\n                  const priceTxt = r.base_price != null ? `${r.base_price} ${form.currency==='EGP'?'جنيه':form.currency}` : 'غير محدد';\r\n                  return (\r\n                    <span>\r\n                      نوع الغرفة: <b>{r.room_type_name || 'غير محدد'}</b>\r\n                      {` — السعر الأساسي: ${priceTxt}`}\r\n                      {maxGuestsForSelected ? ` — أقصى عدد: ${maxGuestsForSelected}` : ''}\r\n                    </span>\r\n                  );\r\n                })()}\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">تاريخ الدخول</label>\r\n              <input type=\"date\" className=\"border rounded w-full px-3 py-2\" value={form.check_in_date} onChange={e=>setForm(f=>({ ...f, check_in_date: e.target.value }))} />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">تاريخ الخروج</label>\r\n              <input type=\"date\" className=\"border rounded w-full px-3 py-2\" value={form.check_out_date} onChange={e=>setForm(f=>({ ...f, check_out_date: e.target.value }))} />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">عدد النزلاء</label>\r\n              <input type=\"number\" min={1} className=\"border rounded w-full px-3 py-2\" value={form.guests_count} onChange={e=>setForm(f=>({ ...f, guests_count: Number(e.target.value)||1 }))} />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">الحالة</label>\r\n              <select className=\"border rounded w-full px-3 py-2\" value={form.status} onChange={e=>setForm(f=>({ ...f, status: e.target.value }))}>\r\n                {statusOptions.map(s=> <option key={s.value} value={s.value}>{s.label}</option>)}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">سعر الليلة (اقتراح قابل للتعديل)</label>\r\n              <input type=\"number\" className=\"border rounded w-full px-3 py-2\" value={form.nightly_rate ?? ''} onChange={e=>setForm(f=>({ ...f, nightly_rate: (e.target.value===''? null : Number(e.target.value)) }))} />\r\n            </div>\r\n            <div>\r\n              <div className=\"flex items-center justify-between\">\r\n                <label className=\"block text-xs mb-1\">الإجمالي</label>\r\n                <label className=\"flex items-center gap-1 text-[11px]\">\r\n                  <input type=\"checkbox\" checked={totalAuto} onChange={e=>setTotalAuto(e.target.checked)} />\r\n                  <span>حساب تلقائي</span>\r\n                </label>\r\n              </div>\r\n              <input type=\"number\" className=\"border rounded w-full px-3 py-2\" value={form.total_amount ?? ''} onChange={e=>setForm(f=>({ ...f, total_amount: (e.target.value===''? null : Number(e.target.value)) }))} disabled={totalAuto} />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">المدفوع</label>\r\n              <input type=\"number\" className=\"border rounded w-full px-3 py-2\" value={form.amount_paid ?? 0} onChange={e=>setForm(f=>({ ...f, amount_paid: Number(e.target.value)||0 }))} />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">المتبقي</label>\r\n              <div className=\"border rounded w-full px-3 py-2 bg-gray-50 text-red-700 font-semibold\">{remaining} {form.currency === 'EGP' ? 'جنيه' : form.currency}</div>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">العملة</label>\r\n              <select className=\"border rounded w-full px-3 py-2\" value={form.currency} onChange={e=>setForm(f=>({ ...f, currency: e.target.value }))}>\r\n                <option value=\"EGP\">جنيه</option>\r\n                <option value=\"SAR\">ريال</option>\r\n                <option value=\"USD\">دولار</option>\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">طريقة الدفع</label>\r\n              <select className=\"border rounded w-full px-3 py-2\" value={form.payment_method} onChange={e=>setForm(f=>({ ...f, payment_method: e.target.value }))}>\r\n                <option value=\"cash\">نقدي</option>\r\n                <option value=\"card\">بطاقة</option>\r\n                <option value=\"transfer\">تحويل بنكي</option>\r\n                <option value=\"etisalat_cash\">اتصالات كاش</option>\r\n                <option value=\"instapay\">إنستاباي</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 bg-emerald-50 rounded p-3\">\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">من يدفع؟</label>\r\n              <select className=\"border rounded w-full px-3 py-2\" value={form.payer_type} onChange={e=>setForm(f=>({ ...f, payer_type: e.target.value }))}>\r\n                <option value=\"guest\">النزيل نفسه</option>\r\n                <option value=\"agency\">شركة/وكالة</option>\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs mb-1\">اسم الجهة</label>\r\n              <input className=\"border rounded w-full px-3 py-2\" placeholder=\"اسم الشركة أو الوكالة\" value={form.agency_name} onChange={e=>setForm(f=>({ ...f, agency_name: e.target.value }))} disabled={form.payer_type!=='agency'} />\r\n            </div>\r\n            <div className=\"flex items-end\">\r\n              <div className=\"text-sm text-gray-600\">المدفوع: <span className=\"text-blue-700 font-semibold\">{form.amount_paid||0} {form.currency==='EGP'?'جنيه':form.currency}</span></div>\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm mb-1\">طلبات خاصة</label>\r\n            <textarea className=\"border rounded w-full px-3 py-2\" rows={2} value={form.special_requests} onChange={e=>setForm(f=>({ ...f, special_requests: e.target.value }))} />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm mb-1\">ملاحظات</label>\r\n            <textarea className=\"border rounded w-full px-3 py-2\" rows={2} value={form.notes} onChange={e=>setForm(f=>({ ...f, notes: e.target.value }))} />\r\n          </div>\r\n\r\n            {/* Extra guests inside reservation (for new reservations, saved post-submit) */}\r\n            <div className=\"border rounded p-3 bg-gray-50\">\r\n              <div className=\"text-sm font-semibold mb-2\">ضيوف إضافيون للحجز</div>\r\n              <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                {(form.pending_guest_ids||[]).length === 0 ? (\r\n                  <span className=\"text-xs text-gray-500\">لا يوجد ضيوف إضافيون مضافون.</span>\r\n                ) : (\r\n                  (form.pending_guest_ids||[]).map(id => {\r\n                    const g = guests.find(x => String(x.id) === String(id));\r\n                    return (\r\n                      <span key={id} className=\"px-2 py-1 text-xs rounded border bg-white\">\r\n                        {g?.full_name || id}\r\n                        <button type=\"button\" className=\"ml-2 text-red-600\" onClick={()=>removeExtraGuestLocal(id)}>إزالة ✖</button>\r\n                      </span>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n              <div className=\"relative\">\r\n                <input className=\"border rounded px-3 py-2 w-full text-sm\" placeholder=\"بحث عن ضيف لإضافته للحجز\" value={guestSearch} onChange={e=>setGuestSearch(e.target.value)} />\r\n                {guestResults.length > 0 && (\r\n                  <div className=\"absolute z-10 mt-1 bg-white border rounded shadow p-2 text-sm max-h-48 overflow-auto w-full\">\r\n                    {guestResults\r\n                      .filter(gr => {\r\n                        if (guestFilter === 'all') return true;\r\n                        if (guestFilter === 'inactive') return gr.is_inactive;\r\n                        if (guestFilter === 'current') return gr.has_current_stay;\r\n                        if (guestFilter === 'upcoming') return gr.has_upcoming_reservation;\r\n                        if (guestFilter === 'today') {\r\n                          const created = gr.created_at ? String(gr.created_at).slice(0,10) : null;\r\n                          const d = new Date(); const pad = (n)=>String(n).padStart(2,'0');\r\n                          const todayStr = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;\r\n                          return created === todayStr;\r\n                        }\r\n                        return true;\r\n                      })\r\n                      .map(gr => (\r\n                        <div key={gr.id} className=\"px-2 py-1 hover:bg-gray-100 cursor-pointer\" onClick={()=>addExtraGuestLocal(gr.id)}>\r\n                          {gr.full_name}{' '}\r\n                          <span className=\"text-gray-500\">({gr.phone || gr.email || String(gr.id).slice(0,8)})</span>\r\n                          <span className=\"ml-1 text-[10px] text-gray-500\">\r\n                            {gr.is_inactive ? '— غير نشط' : (gr.has_current_stay ? '— مقيم حالياً' : (gr.has_upcoming_reservation ? '— لديه حجز قادم' : ''))}\r\n                          </span>\r\n                        </div>\r\n                      ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"mt-2 text-[11px] text-gray-600\">سيتم حفظ الضيوف الإضافيين مع الحجز، ويمكن توزيعهم على الأسِرّة من شاشة \"التسكين\".</div>\r\n            </div>\r\n\r\n          <div className=\"flex items-center justify-between border-t pt-3 sticky bottom-0 bg-white px-3\">\r\n            <div className=\"text-sm text-gray-500\">ليالي: {nights}</div>\r\n            <div className=\"flex gap-2\">\r\n              <button type=\"button\" className=\"px-4 py-2 border rounded\" onClick={onClose}>إلغاء</button>\r\n              <button type=\"submit\" className=\"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded\" disabled={saving}>{saving? 'جارٍ الحفظ...' : (initialData ? 'تحديث الحجز' : 'تأكيد الحجز')}</button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}