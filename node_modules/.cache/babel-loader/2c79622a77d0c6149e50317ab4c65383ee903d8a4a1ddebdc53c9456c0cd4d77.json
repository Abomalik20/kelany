{"ast":null,"code":"var _jsxFileName = \"F:\\\\kelany\\\\src\\\\pages\\\\Floors.jsx\",\n  _s = $RefreshSig$();\nimport React, { useContext, useEffect, useState } from 'react';\nimport { supabase } from '../supabaseClient';\nimport RoomCard from '../components/RoomCard';\nimport FloorModal from '../components/FloorModal';\nimport { AuthContext } from '../App.jsx';\nimport { canDeleteCore } from '../utils/permissions';\nimport { HotelIcon, RoomsTotalIcon, RoomsAvailableIcon, RoomsReservedIcon, RoomsOccupiedIcon, RoomsMaintenanceIcon, MaintenanceIcon } from '../components/Icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Floors() {\n  _s();\n  const currentUser = useContext(AuthContext);\n  const [buildings, setBuildings] = useState([]);\n  const [selectedBuilding, setSelectedBuilding] = useState(null);\n  const [floors, setFloors] = useState([]);\n  const [rooms, setRooms] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showFloorModal, setShowFloorModal] = useState(false);\n  const [editingFloor, setEditingFloor] = useState(null);\n  const loadBuildings = async () => {\n    const {\n      data,\n      error\n    } = await supabase.from('buildings').select('*').order('created_at', {\n      ascending: false\n    });\n    if (!error) {\n      setBuildings(data || []);\n      if (!selectedBuilding && data && data.length) setSelectedBuilding(data[0]);\n    }\n  };\n  const loadData = async buildingId => {\n    setLoading(true);\n    try {\n      const {\n        data: fdata,\n        error: ferr\n      } = await supabase.from('building_floor_overview').select('*').eq('building_id', buildingId).order('floor_number', {\n        ascending: true\n      });\n      let mergedFloors = fdata || [];\n\n      // Also fetch the raw floors rows to get any new columns (name, maintenance_note, capacity, needs_inspection)\n      try {\n        const {\n          data: tableFloors,\n          error: tfErr\n        } = await supabase.from('floors').select('*').eq('building_id', buildingId);\n        if (!tfErr && tableFloors) {\n          // build map by id and by floor_number\n          const byId = new Map(tableFloors.map(r => [String(r.id), r]));\n          const byNumber = new Map(tableFloors.map(r => [String(r.floor_number), r]));\n          mergedFloors = (mergedFloors || []).map(f => {\n            const tableRow = f.floor_id && byId.has(String(f.floor_id)) ? byId.get(String(f.floor_id)) : byNumber.has(String(f.floor_number)) ? byNumber.get(String(f.floor_number)) : null;\n            if (tableRow) {\n              var _tableRow$floor_numbe, _ref, _tableRow$floor_name, _tableRow$name, _tableRow$status, _tableRow$description, _tableRow$maintenance, _tableRow$capacity, _tableRow$needs_inspe;\n              return {\n                ...f,\n                // prefer table values for new fields\n                floor_id: tableRow.id || f.floor_id,\n                floor_number: (_tableRow$floor_numbe = tableRow.floor_number) !== null && _tableRow$floor_numbe !== void 0 ? _tableRow$floor_numbe : f.floor_number,\n                floor_name: (_ref = (_tableRow$floor_name = tableRow.floor_name) !== null && _tableRow$floor_name !== void 0 ? _tableRow$floor_name : tableRow.name) !== null && _ref !== void 0 ? _ref : f.floor_name,\n                name: (_tableRow$name = tableRow.name) !== null && _tableRow$name !== void 0 ? _tableRow$name : f.name,\n                status: (_tableRow$status = tableRow.status) !== null && _tableRow$status !== void 0 ? _tableRow$status : f.status,\n                description: (_tableRow$description = tableRow.description) !== null && _tableRow$description !== void 0 ? _tableRow$description : f.description,\n                maintenance_note: (_tableRow$maintenance = tableRow.maintenance_note) !== null && _tableRow$maintenance !== void 0 ? _tableRow$maintenance : f.maintenance_note,\n                capacity: (_tableRow$capacity = tableRow.capacity) !== null && _tableRow$capacity !== void 0 ? _tableRow$capacity : f.capacity,\n                needs_inspection: (_tableRow$needs_inspe = tableRow.needs_inspection) !== null && _tableRow$needs_inspe !== void 0 ? _tableRow$needs_inspe : f.needs_inspection\n              };\n            }\n            return f;\n          });\n\n          // include any table rows that are not present in the view\n          const existingIds = new Set((mergedFloors || []).map(x => String(x.floor_id || x.id)));\n          for (const tr of tableFloors) {\n            if (!existingIds.has(String(tr.id))) {\n              var _tr$floor_name;\n              mergedFloors.push({\n                floor_id: tr.id,\n                building_id: tr.building_id,\n                floor_number: tr.floor_number,\n                floor_name: (_tr$floor_name = tr.floor_name) !== null && _tr$floor_name !== void 0 ? _tr$floor_name : tr.name,\n                name: tr.name,\n                status: tr.status,\n                description: tr.description,\n                maintenance_note: tr.maintenance_note,\n                capacity: tr.capacity,\n                needs_inspection: tr.needs_inspection\n              });\n            }\n          }\n        }\n      } catch (e) {\n        console.warn('Failed fetching raw floors rows', e);\n      }\n      if (!ferr) setFloors(mergedFloors || []);\n      const {\n        data: rdata,\n        error: rerr\n      } = await supabase.from('rooms_by_floor').select('*').eq('building_id', buildingId).order('room_code', {\n        ascending: true\n      });\n      if (!rerr) setRooms(rdata || []);\n    } catch (e) {\n      console.error(e);\n      setFloors([]);\n      setRooms([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    loadBuildings();\n  }, []);\n  useEffect(() => {\n    if (selectedBuilding) loadData(selectedBuilding.id);\n  }, [selectedBuilding]);\n  const goToAddRooms = (buildingId, floorNumber) => {\n    const url = `/rooms?building=${buildingId}&floor=${floorNumber}`;\n    try {\n      window.location.href = url;\n    } catch (e) {\n      console.log('navigate', url);\n    }\n  };\n  const handleDeleteRoom = async room => {\n    try {\n      if (!canDeleteCore(currentUser)) {\n        window.alert('لا تملك صلاحية حذف الغرف. هذه الصلاحية متاحة للمدير فقط.');\n        return;\n      }\n      if (!room || !room.id) return;\n      const confirmText = window.prompt('لتأكيد الحذف اكتب: ok', '');\n      if (!confirmText || String(confirmText).trim().toLowerCase() !== 'ok') {\n        window.alert('تم إلغاء الحذف.');\n        return;\n      }\n      const {\n        error\n      } = await supabase.from('rooms').delete().eq('id', room.id);\n      if (error) throw error;\n      const bId = room.building_id || selectedBuilding && selectedBuilding.id;\n      if (bId) await loadData(bId);\n    } catch (e) {\n      console.error('Delete room from Floors failed', e);\n      window.alert('تعذّر حذف الغرفة: ' + (e.message || e));\n    }\n  };\n  const handleEditFloor = async floor => {\n    console.log('handleEditFloor - floor:', floor);\n    // fetch full row from floors table to populate modal with all fields\n    try {\n      if (floor.floor_id) {\n        const {\n          data: full,\n          error: fullErr\n        } = await supabase.from('floors').select('*').eq('id', floor.floor_id).single();\n        if (!fullErr && full) {\n          setEditingFloor({\n            ...floor,\n            ...full\n          });\n        } else {\n          console.warn('Could not fetch full floor row, using view row', fullErr);\n          setEditingFloor(floor);\n        }\n      } else {\n        setEditingFloor(floor);\n      }\n    } catch (e) {\n      console.warn('Error fetching full floor row', e);\n      setEditingFloor(floor);\n    }\n    setShowFloorModal(true);\n  };\n  const handleSaveFloor = async payload => {\n    console.group('handleSaveFloor');\n    console.log('payload:', payload);\n    try {\n      const id = payload.id;\n      if (!id) throw new Error('Missing floor id');\n\n      // Build a bulk update payload with all editable fields\n      const updatePayload = {};\n      if (payload.status !== undefined) updatePayload.status = payload.status;\n      if (payload.description !== undefined) updatePayload.description = payload.description;\n      if (payload.name !== undefined) updatePayload.name = payload.name;\n      if (payload.maintenance_note !== undefined) updatePayload.maintenance_note = payload.maintenance_note;\n      if (payload.capacity !== undefined && payload.capacity !== null) updatePayload.capacity = Number(payload.capacity);\n      if (payload.needs_inspection !== undefined) updatePayload.needs_inspection = Boolean(payload.needs_inspection);\n      console.log('Attempting bulk update with payload:', updatePayload);\n\n      // Try updating; if the DB complains about a missing column, remove it from payload and retry.\n      let attempts = 0;\n      let lastResult = null;\n      while (attempts < 6) {\n        attempts += 1;\n        const res = await supabase.from('floors').update(updatePayload).eq('id', id);\n        console.log('bulk update attempt', attempts, res);\n        if (!res.error) {\n          lastResult = res;\n          break;\n        }\n        lastResult = res;\n        const em = (res.error.message || '').toLowerCase();\n        const colMatch = em.match(/column \\\"([^\\\"]+)\\\"/);\n        if (colMatch && colMatch[1]) {\n          const col = colMatch[1];\n          if (updatePayload.hasOwnProperty(col)) {\n            console.warn('Removing column from payload and retrying:', col);\n            delete updatePayload[col];\n            continue;\n          }\n        }\n        // try other message format\n        const m2 = em.match(/could not find the '([^']+)'/);\n        if (m2 && m2[1] && updatePayload.hasOwnProperty(m2[1])) {\n          console.warn('Removing column (alt message) from payload and retrying:', m2[1]);\n          delete updatePayload[m2[1]];\n          continue;\n        }\n        // otherwise cannot recover\n        throw res.error;\n      }\n\n      // fetch the updated floor row for verification\n      try {\n        const {\n          data: refData,\n          error: refErr\n        } = await supabase.from('floors').select('*').eq('id', id).single();\n        console.log('Refetched floor row:', {\n          refData,\n          refErr\n        });\n        if (!refErr && refData) {\n          setFloors(prev => prev.map(fl => {\n            // view rows use `floor_id` whereas table has `id`\n            if (fl.floor_id && String(fl.floor_id) === String(refData.id) || fl.id && String(fl.id) === String(refData.id)) {\n              var _refData$floor_number, _ref2, _refData$floor_name, _refData$name, _refData$status, _refData$description, _refData$maintenance_, _refData$capacity, _refData$needs_inspec;\n              return {\n                ...fl,\n                floor_id: refData.id,\n                floor_number: (_refData$floor_number = refData.floor_number) !== null && _refData$floor_number !== void 0 ? _refData$floor_number : fl.floor_number,\n                floor_name: (_ref2 = (_refData$floor_name = refData.floor_name) !== null && _refData$floor_name !== void 0 ? _refData$floor_name : refData.name) !== null && _ref2 !== void 0 ? _ref2 : fl.floor_name,\n                name: (_refData$name = refData.name) !== null && _refData$name !== void 0 ? _refData$name : fl.name,\n                status: (_refData$status = refData.status) !== null && _refData$status !== void 0 ? _refData$status : fl.status,\n                description: (_refData$description = refData.description) !== null && _refData$description !== void 0 ? _refData$description : fl.description,\n                maintenance_note: (_refData$maintenance_ = refData.maintenance_note) !== null && _refData$maintenance_ !== void 0 ? _refData$maintenance_ : fl.maintenance_note,\n                capacity: (_refData$capacity = refData.capacity) !== null && _refData$capacity !== void 0 ? _refData$capacity : fl.capacity,\n                needs_inspection: (_refData$needs_inspec = refData.needs_inspection) !== null && _refData$needs_inspec !== void 0 ? _refData$needs_inspec : fl.needs_inspection\n              };\n            }\n            return fl;\n          }));\n        }\n      } catch (re) {\n        console.warn('Failed refetching floor row', re);\n      }\n      setShowFloorModal(false);\n      if (selectedBuilding) loadData(selectedBuilding.id);\n    } catch (e) {\n      console.error('Failed saving floor', e);\n      // show more details to the user so they can paste the error\n      try {\n        const msg = e && e.message ? e.message : JSON.stringify(e);\n        window.alert('حصل خطأ أثناء حفظ الطابق: ' + msg);\n      } catch (ae) {\n        window.alert('حصل خطأ أثناء حفظ الطابق. فتح الـ Console لمزيد من التفاصيل.');\n      }\n    }\n    console.groupEnd();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-8\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-between mb-6\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-400\",\n          children: /*#__PURE__*/_jsxDEV(HotelIcon, {\n            className: \"w-12 h-12\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-2xl font-bold\",\n            children: \"\\u0625\\u062F\\u0627\\u0631\\u0629 \\u0627\\u0644\\u0637\\u0648\\u0627\\u0628\\u0642\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-500\",\n            children: [\"\\u0639\\u0631\\u0636 \\u0648\\u0637\\u0628\\u0627\\u0639\\u0629 \\u0637\\u0648\\u0627\\u0628\\u0642 \\u0648\\u063A\\u0631\\u0641 \\u0627\\u0644\\u0645\\u0628\\u0646\\u0649\", selectedBuilding ? ` — ${selectedBuilding.name}` : '']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex gap-4 overflow-auto\",\n        children: buildings.map(b => /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setSelectedBuilding(b),\n          className: `min-w-[160px] p-4 rounded shadow flex flex-col items-start justify-center ${selectedBuilding && selectedBuilding.id === b.id ? 'border-2 border-blue-400 bg-white' : 'bg-white/80'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500\",\n            children: [\"\\u0645\\u0628\\u0646\\u0649 \", b.code]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-semibold\",\n            children: b.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs mt-2 inline-flex items-center gap-2\",\n            children: b.status === 'maintenance' ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"px-2 py-1 rounded text-yellow-800 bg-yellow-100\",\n              children: \"\\u0635\\u064A\\u0627\\u0646\\u0629\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 19\n            }, this) : b.status === 'inactive' ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"px-2 py-1 rounded text-gray-700 bg-gray-100\",\n              children: \"\\u063A\\u064A\\u0631 \\u0646\\u0634\\u0637\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 281,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"px-2 py-1 rounded text-white bg-green-500\",\n              children: \"\\u0646\\u0634\\u0637\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 15\n          }, this)]\n        }, b.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4\",\n        children: (() => {\n          // aggregate counts from floors\n          const totals = floors.reduce((acc, f) => {\n            acc.total += Number(f.total_rooms || 0);\n            acc.available += Number(f.available_rooms || 0);\n            acc.occupied += Number(f.occupied_rooms || 0);\n            acc.reserved += Number(f.reserved_rooms || 0);\n            acc.maintenance += Number(f.maintenance_rooms || 0);\n            return acc;\n          }, {\n            total: 0,\n            available: 0,\n            occupied: 0,\n            reserved: 0,\n            maintenance: 0\n          });\n          return [{\n            key: 'total',\n            label: 'إجمالي الغرف',\n            value: totals.total,\n            color: 'bg-white',\n            iconBg: 'bg-indigo-100 text-indigo-700',\n            icon: /*#__PURE__*/_jsxDEV(RoomsTotalIcon, {\n              className: \"w-8 h-8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 303,\n              columnNumber: 141\n            }, this)\n          }, {\n            key: 'available',\n            label: 'متاحة',\n            value: totals.available,\n            color: 'bg-green-50',\n            iconBg: 'bg-green-100 text-green-700',\n            icon: /*#__PURE__*/_jsxDEV(RoomsAvailableIcon, {\n              className: \"w-8 h-8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 143\n            }, this)\n          }, {\n            key: 'reserved',\n            label: 'محجوزة',\n            value: totals.reserved,\n            color: 'bg-amber-50',\n            iconBg: 'bg-amber-100 text-amber-700',\n            icon: /*#__PURE__*/_jsxDEV(RoomsReservedIcon, {\n              className: \"w-8 h-8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 142\n            }, this)\n          }, {\n            key: 'occupied',\n            label: 'مشغولة',\n            value: totals.occupied,\n            color: 'bg-rose-50',\n            iconBg: 'bg-rose-100 text-rose-700',\n            icon: /*#__PURE__*/_jsxDEV(RoomsOccupiedIcon, {\n              className: \"w-8 h-8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 139\n            }, this)\n          }, {\n            key: 'maintenance',\n            label: 'صيانة',\n            value: totals.maintenance,\n            color: 'bg-yellow-50',\n            iconBg: 'bg-yellow-100 text-yellow-700',\n            icon: /*#__PURE__*/_jsxDEV(RoomsMaintenanceIcon, {\n              className: \"w-8 h-8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 150\n            }, this)\n          }].map(box => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `p-4 rounded shadow ${box.color}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-between\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-sm text-gray-500\",\n                  children: box.label\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 312,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-2xl font-bold mt-1\",\n                  children: box.value\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 313,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 311,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `p-2 rounded-full ${box.iconBg}`,\n                children: box.icon\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 315,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 17\n            }, this)\n          }, box.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 15\n          }, this));\n        })()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 7\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\u062A\\u062D\\u0645\\u064A\\u0644...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-6\",\n      children: [floors.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6 bg-white rounded shadow\",\n        children: \"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0637\\u0648\\u0627\\u0628\\u0642 \\u0644\\u0639\\u0631\\u0636\\u0647\\u0627 \\u0641\\u064A \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0645\\u0628\\u0646\\u0649.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 13\n      }, this) : floors.map(f => /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"bg-white rounded shadow\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 flex items-center justify-between\",\n          style: f.status === 'maintenance' ? {\n            background: 'linear-gradient(90deg,#ff416c,#ff4b2b)'\n          } : f.status === 'inactive' ? {\n            background: 'linear-gradient(90deg,#757f9a,#d7dde8)'\n          } : {\n            background: 'linear-gradient(90deg,#6a11cb,#2575fc)'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-white\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-lg font-semibold\",\n                children: f.floor_name || f.name || `الطابق ${f.floor_number}`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 346,\n                columnNumber: 23\n              }, this), f.status === 'maintenance' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs\",\n                children: [/*#__PURE__*/_jsxDEV(MaintenanceIcon, {\n                  className: \"w-4 h-4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 349,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"\\u0635\\u064A\\u0627\\u0646\\u0629\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 350,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 348,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-sm opacity-90\",\n              children: [f.total_rooms, \" \\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\xB7 \", f.available_rooms, \" \\u0645\\u062A\\u0627\\u062D\\u0629 \\xB7 \", f.occupied_rooms, \" \\u0645\\u0634\\u063A\\u0648\\u0644\\u0629\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 21\n            }, this), f.description && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs opacity-90 mt-1\",\n              children: f.description\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 356,\n              columnNumber: 23\n            }, this), f.maintenance_note && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs opacity-90 mt-1\",\n              children: [\"\\u0645\\u0644\\u0627\\u062D\\u0638\\u0629: \", f.maintenance_note]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 23\n            }, this), f.capacity !== undefined && f.capacity !== null && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs opacity-90 mt-1\",\n              children: [\"\\u0633\\u0639\\u0629: \", f.capacity]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 362,\n              columnNumber: 23\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-white text-sm flex items-center gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleEditFloor(f),\n              className: \"bg-white/20 px-3 py-1 rounded text-white\",\n              children: \"\\u062A\\u0639\\u062F\\u064A\\u0644 \\u0627\\u0644\\u0637\\u0627\\u0628\\u0642\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 366,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: selectedBuilding && selectedBuilding.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 367,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-6\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex gap-4 overflow-x-auto\",\n            children: rooms.filter(r => r.floor_id === f.floor_id).length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-full py-8 text-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-gray-400 mb-4\",\n                children: \"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u063A\\u0631\\u0641 \\u0641\\u064A \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0637\\u0627\\u0628\\u0642\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 375,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => goToAddRooms(f.building_id, f.floor_number),\n                className: \"bg-blue-600 text-white px-4 py-2 rounded\",\n                children: \"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u063A\\u0631\\u0641\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 376,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 23\n            }, this) : rooms.filter(r => r.floor_id === f.floor_id).map(r => /*#__PURE__*/_jsxDEV(RoomCard, {\n              room: r,\n              onEdit: () => goToAddRooms(r.building_id, r.floor_number),\n              onDelete: () => handleDeleteRoom(r)\n            }, r.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 25\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 17\n        }, this)]\n      }, f.floor_id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 15\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded shadow p-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"font-semibold mb-3\",\n          children: \"\\u0645\\u062E\\u0637\\u0637 \\u0627\\u0644\\u0645\\u0628\\u0646\\u0649 \\u0627\\u0644\\u0643\\u0627\\u0645\\u0644\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"overflow-auto\",\n          children: /*#__PURE__*/_jsxDEV(\"table\", {\n            className: \"w-full text-sm\",\n            children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n              children: /*#__PURE__*/_jsxDEV(\"tr\", {\n                className: \"text-left text-gray-500\",\n                children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0627\\u0644\\u0637\\u0627\\u0628\\u0642\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 400,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0639\\u062F\\u062F \\u0627\\u0644\\u063A\\u0631\\u0641\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 401,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0645\\u062A\\u0627\\u062D\\u0629\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 402,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0645\\u0634\\u063A\\u0648\\u0644\\u0629\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 403,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0645\\u062D\\u062C\\u0648\\u0632\\u0629\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 404,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0635\\u064A\\u0627\\u0646\\u0629\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 405,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  className: \"p-2\",\n                  children: \"\\u0645\\u0639\\u062F\\u0644 \\u0627\\u0644\\u0627\\u0634\\u063A\\u0627\\u0644\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 406,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 399,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n              children: floors.map(f => /*#__PURE__*/_jsxDEV(\"tr\", {\n                className: \"border-t\",\n                children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2\",\n                  children: [\"\\u0627\\u0644\\u0637\\u0627\\u0628\\u0642 \", f.floor_number]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 412,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2\",\n                  children: f.total_rooms\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 413,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2 text-green-600\",\n                  children: f.available_rooms\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 414,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2 text-red-600\",\n                  children: f.occupied_rooms\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 415,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2 text-yellow-600\",\n                  children: f.reserved_rooms\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 416,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2\",\n                  children: f.maintenance_rooms\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 417,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"p-2\",\n                  children: [Math.round((f.occupancy_rate || 0) * 100), \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 418,\n                  columnNumber: 23\n                }, this)]\n              }, f.floor_id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 411,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 409,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }, this), showFloorModal && /*#__PURE__*/_jsxDEV(FloorModal, {\n      initialData: editingFloor,\n      onClose: () => setShowFloorModal(false),\n      onSave: handleSaveFloor\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 257,\n    columnNumber: 5\n  }, this);\n}\n_s(Floors, \"Tje8nqo7vq1/H66HvKlIhrHMeUc=\");\n_c = Floors;\nvar _c;\n$RefreshReg$(_c, \"Floors\");","map":{"version":3,"names":["React","useContext","useEffect","useState","supabase","RoomCard","FloorModal","AuthContext","canDeleteCore","HotelIcon","RoomsTotalIcon","RoomsAvailableIcon","RoomsReservedIcon","RoomsOccupiedIcon","RoomsMaintenanceIcon","MaintenanceIcon","jsxDEV","_jsxDEV","Floors","_s","currentUser","buildings","setBuildings","selectedBuilding","setSelectedBuilding","floors","setFloors","rooms","setRooms","loading","setLoading","showFloorModal","setShowFloorModal","editingFloor","setEditingFloor","loadBuildings","data","error","from","select","order","ascending","length","loadData","buildingId","fdata","ferr","eq","mergedFloors","tableFloors","tfErr","byId","Map","map","r","String","id","byNumber","floor_number","f","tableRow","floor_id","has","get","_tableRow$floor_numbe","_ref","_tableRow$floor_name","_tableRow$name","_tableRow$status","_tableRow$description","_tableRow$maintenance","_tableRow$capacity","_tableRow$needs_inspe","floor_name","name","status","description","maintenance_note","capacity","needs_inspection","existingIds","Set","x","tr","_tr$floor_name","push","building_id","e","console","warn","rdata","rerr","goToAddRooms","floorNumber","url","window","location","href","log","handleDeleteRoom","room","alert","confirmText","prompt","trim","toLowerCase","delete","bId","message","handleEditFloor","floor","full","fullErr","single","handleSaveFloor","payload","group","Error","updatePayload","undefined","Number","Boolean","attempts","lastResult","res","update","em","colMatch","match","col","hasOwnProperty","m2","refData","refErr","prev","fl","_refData$floor_number","_ref2","_refData$floor_name","_refData$name","_refData$status","_refData$description","_refData$maintenance_","_refData$capacity","_refData$needs_inspec","re","msg","JSON","stringify","ae","groupEnd","className","children","fileName","_jsxFileName","lineNumber","columnNumber","b","onClick","code","totals","reduce","acc","total","total_rooms","available","available_rooms","occupied","occupied_rooms","reserved","reserved_rooms","maintenance","maintenance_rooms","key","label","value","color","iconBg","icon","box","style","background","filter","onEdit","onDelete","Math","round","occupancy_rate","initialData","onClose","onSave","_c","$RefreshReg$"],"sources":["F:/kelany/src/pages/Floors.jsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\r\nimport { supabase } from '../supabaseClient';\r\nimport RoomCard from '../components/RoomCard';\r\nimport FloorModal from '../components/FloorModal';\r\nimport { AuthContext } from '../App.jsx';\r\nimport { canDeleteCore } from '../utils/permissions';\r\nimport { HotelIcon, RoomsTotalIcon, RoomsAvailableIcon, RoomsReservedIcon, RoomsOccupiedIcon, RoomsMaintenanceIcon, MaintenanceIcon } from '../components/Icons';\r\n\r\nexport default function Floors() {\r\n  const currentUser = useContext(AuthContext);\r\n  const [buildings, setBuildings] = useState([]);\r\n  const [selectedBuilding, setSelectedBuilding] = useState(null);\r\n  const [floors, setFloors] = useState([]);\r\n  const [rooms, setRooms] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showFloorModal, setShowFloorModal] = useState(false);\r\n  const [editingFloor, setEditingFloor] = useState(null);\r\n\r\n  const loadBuildings = async () => {\r\n    const { data, error } = await supabase.from('buildings').select('*').order('created_at', { ascending: false });\r\n    if (!error) {\r\n      setBuildings(data || []);\r\n      if (!selectedBuilding && data && data.length) setSelectedBuilding(data[0]);\r\n    }\r\n  };\r\n\r\n  const loadData = async (buildingId) => {\r\n    setLoading(true);\r\n    try {\r\n      const { data: fdata, error: ferr } = await supabase\r\n        .from('building_floor_overview')\r\n        .select('*')\r\n        .eq('building_id', buildingId)\r\n        .order('floor_number', { ascending: true });\r\n      let mergedFloors = fdata || [];\r\n\r\n      // Also fetch the raw floors rows to get any new columns (name, maintenance_note, capacity, needs_inspection)\r\n      try {\r\n        const { data: tableFloors, error: tfErr } = await supabase.from('floors').select('*').eq('building_id', buildingId);\r\n        if (!tfErr && tableFloors) {\r\n          // build map by id and by floor_number\r\n          const byId = new Map(tableFloors.map(r => [String(r.id), r]));\r\n          const byNumber = new Map(tableFloors.map(r => [String(r.floor_number), r]));\r\n\r\n          mergedFloors = (mergedFloors || []).map(f => {\r\n            const tableRow = (f.floor_id && byId.has(String(f.floor_id))) ? byId.get(String(f.floor_id)) : (byNumber.has(String(f.floor_number)) ? byNumber.get(String(f.floor_number)) : null);\r\n            if (tableRow) {\r\n              return {\r\n                ...f,\r\n                // prefer table values for new fields\r\n                floor_id: tableRow.id || f.floor_id,\r\n                floor_number: tableRow.floor_number ?? f.floor_number,\r\n                floor_name: tableRow.floor_name ?? tableRow.name ?? f.floor_name,\r\n                name: tableRow.name ?? f.name,\r\n                status: tableRow.status ?? f.status,\r\n                description: tableRow.description ?? f.description,\r\n                maintenance_note: tableRow.maintenance_note ?? f.maintenance_note,\r\n                capacity: tableRow.capacity ?? f.capacity,\r\n                needs_inspection: tableRow.needs_inspection ?? f.needs_inspection,\r\n              };\r\n            }\r\n            return f;\r\n          });\r\n\r\n          // include any table rows that are not present in the view\r\n          const existingIds = new Set((mergedFloors || []).map(x => String(x.floor_id || x.id)));\r\n          for (const tr of tableFloors) {\r\n            if (!existingIds.has(String(tr.id))) {\r\n              mergedFloors.push({\r\n                floor_id: tr.id,\r\n                building_id: tr.building_id,\r\n                floor_number: tr.floor_number,\r\n                floor_name: tr.floor_name ?? tr.name,\r\n                name: tr.name,\r\n                status: tr.status,\r\n                description: tr.description,\r\n                maintenance_note: tr.maintenance_note,\r\n                capacity: tr.capacity,\r\n                needs_inspection: tr.needs_inspection,\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed fetching raw floors rows', e);\r\n      }\r\n\r\n      if (!ferr) setFloors(mergedFloors || []);\r\n\r\n      const { data: rdata, error: rerr } = await supabase\r\n        .from('rooms_by_floor')\r\n        .select('*')\r\n        .eq('building_id', buildingId)\r\n        .order('room_code', { ascending: true });\r\n      if (!rerr) setRooms(rdata || []);\r\n    } catch (e) {\r\n      console.error(e);\r\n      setFloors([]);\r\n      setRooms([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadBuildings();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedBuilding) loadData(selectedBuilding.id);\r\n  }, [selectedBuilding]);\r\n\r\n  const goToAddRooms = (buildingId, floorNumber) => {\r\n    const url = `/rooms?building=${buildingId}&floor=${floorNumber}`;\r\n    try { window.location.href = url; } catch (e) { console.log('navigate', url); }\r\n  };\r\n\r\n  const handleDeleteRoom = async (room) => {\r\n    try {\r\n      if (!canDeleteCore(currentUser)) {\r\n        window.alert('لا تملك صلاحية حذف الغرف. هذه الصلاحية متاحة للمدير فقط.');\r\n        return;\r\n      }\r\n      if (!room || !room.id) return;\r\n      const confirmText = window.prompt('لتأكيد الحذف اكتب: ok', '');\r\n      if (!confirmText || String(confirmText).trim().toLowerCase() !== 'ok') {\r\n        window.alert('تم إلغاء الحذف.');\r\n        return;\r\n      }\r\n      const { error } = await supabase.from('rooms').delete().eq('id', room.id);\r\n      if (error) throw error;\r\n      const bId = room.building_id || (selectedBuilding && selectedBuilding.id);\r\n      if (bId) await loadData(bId);\r\n    } catch (e) {\r\n      console.error('Delete room from Floors failed', e);\r\n      window.alert('تعذّر حذف الغرفة: ' + (e.message || e));\r\n    }\r\n  };\r\n\r\n  const handleEditFloor = async (floor) => {\r\n    console.log('handleEditFloor - floor:', floor);\r\n    // fetch full row from floors table to populate modal with all fields\r\n    try {\r\n      if (floor.floor_id) {\r\n        const { data: full, error: fullErr } = await supabase.from('floors').select('*').eq('id', floor.floor_id).single();\r\n        if (!fullErr && full) {\r\n          setEditingFloor({ ...floor, ...full });\r\n        } else {\r\n          console.warn('Could not fetch full floor row, using view row', fullErr);\r\n          setEditingFloor(floor);\r\n        }\r\n      } else {\r\n        setEditingFloor(floor);\r\n      }\r\n    } catch (e) {\r\n      console.warn('Error fetching full floor row', e);\r\n      setEditingFloor(floor);\r\n    }\r\n    setShowFloorModal(true);\r\n  };\r\n\r\n  const handleSaveFloor = async (payload) => {\r\n    console.group('handleSaveFloor');\r\n    console.log('payload:', payload);\r\n    try {\r\n      const id = payload.id;\r\n      if (!id) throw new Error('Missing floor id');\r\n\r\n      // Build a bulk update payload with all editable fields\r\n      const updatePayload = {};\r\n      if (payload.status !== undefined) updatePayload.status = payload.status;\r\n      if (payload.description !== undefined) updatePayload.description = payload.description;\r\n      if (payload.name !== undefined) updatePayload.name = payload.name;\r\n      if (payload.maintenance_note !== undefined) updatePayload.maintenance_note = payload.maintenance_note;\r\n      if (payload.capacity !== undefined && payload.capacity !== null) updatePayload.capacity = Number(payload.capacity);\r\n      if (payload.needs_inspection !== undefined) updatePayload.needs_inspection = Boolean(payload.needs_inspection);\r\n\r\n      console.log('Attempting bulk update with payload:', updatePayload);\r\n\r\n      // Try updating; if the DB complains about a missing column, remove it from payload and retry.\r\n      let attempts = 0;\r\n      let lastResult = null;\r\n      while (attempts < 6) {\r\n        attempts += 1;\r\n        const res = await supabase.from('floors').update(updatePayload).eq('id', id);\r\n        console.log('bulk update attempt', attempts, res);\r\n        if (!res.error) {\r\n          lastResult = res;\r\n          break;\r\n        }\r\n        lastResult = res;\r\n        const em = (res.error.message || '').toLowerCase();\r\n        const colMatch = em.match(/column \\\"([^\\\"]+)\\\"/);\r\n        if (colMatch && colMatch[1]) {\r\n          const col = colMatch[1];\r\n          if (updatePayload.hasOwnProperty(col)) {\r\n            console.warn('Removing column from payload and retrying:', col);\r\n            delete updatePayload[col];\r\n            continue;\r\n          }\r\n        }\r\n        // try other message format\r\n        const m2 = em.match(/could not find the '([^']+)'/);\r\n        if (m2 && m2[1] && updatePayload.hasOwnProperty(m2[1])) {\r\n          console.warn('Removing column (alt message) from payload and retrying:', m2[1]);\r\n          delete updatePayload[m2[1]];\r\n          continue;\r\n        }\r\n        // otherwise cannot recover\r\n        throw res.error;\r\n      }\r\n\r\n      // fetch the updated floor row for verification\r\n      try {\r\n        const { data: refData, error: refErr } = await supabase.from('floors').select('*').eq('id', id).single();\r\n        console.log('Refetched floor row:', { refData, refErr });\r\n        if (!refErr && refData) {\r\n          setFloors(prev => prev.map(fl => {\r\n            // view rows use `floor_id` whereas table has `id`\r\n            if ((fl.floor_id && String(fl.floor_id) === String(refData.id)) || (fl.id && String(fl.id) === String(refData.id))) {\r\n                return {\r\n                  ...fl,\r\n                  floor_id: refData.id,\r\n                  floor_number: refData.floor_number ?? fl.floor_number,\r\n                  floor_name: refData.floor_name ?? refData.name ?? fl.floor_name,\r\n                  name: refData.name ?? fl.name,\r\n                  status: refData.status ?? fl.status,\r\n                  description: refData.description ?? fl.description,\r\n                  maintenance_note: refData.maintenance_note ?? fl.maintenance_note,\r\n                  capacity: refData.capacity ?? fl.capacity,\r\n                  needs_inspection: refData.needs_inspection ?? fl.needs_inspection,\r\n                };\r\n            }\r\n            return fl;\r\n          }));\r\n        }\r\n      } catch (re) {\r\n        console.warn('Failed refetching floor row', re);\r\n      }\r\n\r\n      setShowFloorModal(false);\r\n      if (selectedBuilding) loadData(selectedBuilding.id);\r\n    } catch (e) {\r\n      console.error('Failed saving floor', e);\r\n      // show more details to the user so they can paste the error\r\n      try {\r\n        const msg = e && e.message ? e.message : JSON.stringify(e);\r\n        window.alert('حصل خطأ أثناء حفظ الطابق: ' + msg);\r\n      } catch (ae) {\r\n        window.alert('حصل خطأ أثناء حفظ الطابق. فتح الـ Console لمزيد من التفاصيل.');\r\n      }\r\n    }\r\n    console.groupEnd();\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-8\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <div className=\"p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-400\">\r\n            <HotelIcon className=\"w-12 h-12\" />\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold\">إدارة الطوابق</h2>\r\n            <p className=\"text-sm text-gray-500\">عرض وطباعة طوابق وغرف المبنى{selectedBuilding ? ` — ${selectedBuilding.name}` : ''}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex gap-4 overflow-auto\">\r\n          {buildings.map((b) => (\r\n            <button key={b.id}\r\n              onClick={() => setSelectedBuilding(b)}\r\n              className={`min-w-[160px] p-4 rounded shadow flex flex-col items-start justify-center ${selectedBuilding && selectedBuilding.id === b.id ? 'border-2 border-blue-400 bg-white' : 'bg-white/80'}`}>\r\n              <div className=\"text-sm text-gray-500\">مبنى {b.code}</div>\r\n              <div className=\"font-semibold\">{b.name}</div>\r\n              <div className=\"text-xs mt-2 inline-flex items-center gap-2\">\r\n                {b.status === 'maintenance' ? (\r\n                  <span className=\"px-2 py-1 rounded text-yellow-800 bg-yellow-100\">صيانة</span>\r\n                ) : b.status === 'inactive' ? (\r\n                  <span className=\"px-2 py-1 rounded text-gray-700 bg-gray-100\">غير نشط</span>\r\n                ) : (\r\n                  <span className=\"px-2 py-1 rounded text-white bg-green-500\">نشط</span>\r\n                )}\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Summary boxes */}\r\n        <div className=\"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n          {(() => {\r\n            // aggregate counts from floors\r\n            const totals = floors.reduce((acc, f) => {\r\n              acc.total += Number(f.total_rooms || 0);\r\n              acc.available += Number(f.available_rooms || 0);\r\n              acc.occupied += Number(f.occupied_rooms || 0);\r\n              acc.reserved += Number(f.reserved_rooms || 0);\r\n              acc.maintenance += Number(f.maintenance_rooms || 0);\r\n              return acc;\r\n            }, { total: 0, available: 0, occupied: 0, reserved: 0, maintenance: 0 });\r\n            return [\r\n              { key: 'total', label: 'إجمالي الغرف', value: totals.total, color: 'bg-white', iconBg: 'bg-indigo-100 text-indigo-700', icon: <RoomsTotalIcon className=\"w-8 h-8\" /> },\r\n              { key: 'available', label: 'متاحة', value: totals.available, color: 'bg-green-50', iconBg: 'bg-green-100 text-green-700', icon: <RoomsAvailableIcon className=\"w-8 h-8\" /> },\r\n              { key: 'reserved', label: 'محجوزة', value: totals.reserved, color: 'bg-amber-50', iconBg: 'bg-amber-100 text-amber-700', icon: <RoomsReservedIcon className=\"w-8 h-8\" /> },\r\n              { key: 'occupied', label: 'مشغولة', value: totals.occupied, color: 'bg-rose-50', iconBg: 'bg-rose-100 text-rose-700', icon: <RoomsOccupiedIcon className=\"w-8 h-8\" /> },\r\n              { key: 'maintenance', label: 'صيانة', value: totals.maintenance, color: 'bg-yellow-50', iconBg: 'bg-yellow-100 text-yellow-700', icon: <RoomsMaintenanceIcon className=\"w-8 h-8\" /> },\r\n            ].map(box => (\r\n              <div key={box.key} className={`p-4 rounded shadow ${box.color}`}>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-sm text-gray-500\">{box.label}</div>\r\n                    <div className=\"text-2xl font-bold mt-1\">{box.value}</div>\r\n                  </div>\r\n                  <div className={`p-2 rounded-full ${box.iconBg}`}>\r\n                    {box.icon}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ));\r\n          })()}\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div>تحميل...</div>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {floors.length === 0 ? (\r\n            <div className=\"p-6 bg-white rounded shadow\">لا توجد طوابق لعرضها في هذا المبنى.</div>\r\n          ) : (\r\n            floors.map((f) => (\r\n              <section key={f.floor_id} className=\"bg-white rounded shadow\">\r\n                <div\r\n                  className=\"p-4 flex items-center justify-between\"\r\n                  style={\r\n                    f.status === 'maintenance'\r\n                      ? { background: 'linear-gradient(90deg,#ff416c,#ff4b2b)' }\r\n                      : f.status === 'inactive'\r\n                      ? { background: 'linear-gradient(90deg,#757f9a,#d7dde8)' }\r\n                      : { background: 'linear-gradient(90deg,#6a11cb,#2575fc)' }\r\n                  }\r\n                >\r\n                  <div className=\"text-white\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"text-lg font-semibold\">{f.floor_name || f.name || `الطابق ${f.floor_number}`}</div>\r\n                      {f.status === 'maintenance' && (\r\n                        <div className=\"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-100 text-yellow-800 text-xs\">\r\n                          <MaintenanceIcon className=\"w-4 h-4\" />\r\n                          <span>صيانة</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-sm opacity-90\">{f.total_rooms} إجمالي · {f.available_rooms} متاحة · {f.occupied_rooms} مشغولة</div>\r\n                    { (f.description) && (\r\n                      <div className=\"text-xs opacity-90 mt-1\">{f.description}</div>\r\n                    ) }\r\n                    { (f.maintenance_note) && (\r\n                      <div className=\"text-xs opacity-90 mt-1\">ملاحظة: {f.maintenance_note}</div>\r\n                    ) }\r\n                    { (f.capacity !== undefined && f.capacity !== null) && (\r\n                      <div className=\"text-xs opacity-90 mt-1\">سعة: {f.capacity}</div>\r\n                    ) }\r\n                  </div>\r\n                  <div className=\"text-white text-sm flex items-center gap-3\">\r\n                    <button onClick={() => handleEditFloor(f)} className=\"bg-white/20 px-3 py-1 rounded text-white\">تعديل الطابق</button>\r\n                    <div>{selectedBuilding && selectedBuilding.name}</div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                  <div className=\"flex gap-4 overflow-x-auto\">\r\n                    {rooms.filter(r => r.floor_id === f.floor_id).length === 0 ? (\r\n                      <div className=\"w-full py-8 text-center\">\r\n                        <div className=\"text-gray-400 mb-4\">لا توجد غرف في هذا الطابق</div>\r\n                        <button onClick={() => goToAddRooms(f.building_id, f.floor_number)} className=\"bg-blue-600 text-white px-4 py-2 rounded\">إضافة غرف</button>\r\n                      </div>\r\n                    ) : (\r\n                      rooms.filter(r => r.floor_id === f.floor_id).map((r) => (\r\n                        <RoomCard\r\n                          key={r.id}\r\n                          room={r}\r\n                          onEdit={() => goToAddRooms(r.building_id, r.floor_number)}\r\n                          onDelete={() => handleDeleteRoom(r)}\r\n                        />\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </section>\r\n            ))\r\n          )}\r\n\r\n          <div className=\"bg-white rounded shadow p-4\">\r\n            <h3 className=\"font-semibold mb-3\">مخطط المبنى الكامل</h3>\r\n            <div className=\"overflow-auto\">\r\n              <table className=\"w-full text-sm\">\r\n                <thead>\r\n                  <tr className=\"text-left text-gray-500\">\r\n                    <th className=\"p-2\">الطابق</th>\r\n                    <th className=\"p-2\">عدد الغرف</th>\r\n                    <th className=\"p-2\">متاحة</th>\r\n                    <th className=\"p-2\">مشغولة</th>\r\n                    <th className=\"p-2\">محجوزة</th>\r\n                    <th className=\"p-2\">صيانة</th>\r\n                    <th className=\"p-2\">معدل الاشغال</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {floors.map((f) => (\r\n                    <tr key={f.floor_id} className=\"border-t\">\r\n                      <td className=\"p-2\">الطابق {f.floor_number}</td>\r\n                      <td className=\"p-2\">{f.total_rooms}</td>\r\n                      <td className=\"p-2 text-green-600\">{f.available_rooms}</td>\r\n                      <td className=\"p-2 text-red-600\">{f.occupied_rooms}</td>\r\n                      <td className=\"p-2 text-yellow-600\">{f.reserved_rooms}</td>\r\n                      <td className=\"p-2\">{f.maintenance_rooms}</td>\r\n                      <td className=\"p-2\">{Math.round((f.occupancy_rate || 0) * 100)}%</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      )}\r\n\r\n      {showFloorModal && (\r\n        <FloorModal\r\n          initialData={editingFloor}\r\n          onClose={() => setShowFloorModal(false)}\r\n          onSave={handleSaveFloor}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}